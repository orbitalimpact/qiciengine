!function(a,b,c){"use strict";function d(){document.body.style.background="rgb(59, 60, 64)",qc.widget.List.prototype._selectBackground="#3e4b6b",qc.widget.List.prototype._labelColor="#caccd8",qc.widget.List.prototype._labelFont="13px Arial",qc.widget.List.prototype._labelSelectColor="#ceae37",qc.widget.Tree.prototype._labelColor="#caccd8",qc.widget.Tree.prototype._labelSelectColor="#ceae37",qc.widget.Tree.prototype._selectBackground="#3e4b6b",qc.widget.Tree.prototype._inactiveSelectBackground="rgb(72, 72, 72)",qc.widget.TextField.prototype._ninePatchImage="textfield.9",qc.widget.TextField.prototype._ninePatchBorder=[8,8,8,8],qc.widget.TextField.prototype._borderColor=null,qc.widget.TextField.prototype._padding=[1,2,1,2],qc.editor.Dialog.prototype._ninePatchImage="dialog.9",qc.editor.Dialog.prototype._ninePatchBorder=[50,10,10,10],qc.editor.Dialog.prototype._titleBackground=null,qc.editor.Dialog.prototype._titleColor="#fecb19",qc.editor.Dialog.prototype._titleFont="14px Arial",qc.editor.Dialog.prototype._htmlColor="#caccd8",qc.editor.Dialog.prototype._buttonNinePatchImage="dialog_button.9",qc.editor.Dialog.prototype._buttonNinePatchBorder=[10,10,10,10],qc.editor.Dialog.prototype._buttonActiveNinePatchImage="dialog_button_active.9",qc.editor.Dialog.prototype._buttonActiveNinePatchBorder=[10,10,10,10],qc.editor.Dialog.prototype._closeNinePatchImage="dialog.close.9",qc.editor.Dialog.prototype._closeNinePatchBorder=[13,13,13,13],qc.editor.Dialog.prototype._buttonColor="#caccd8",qc.editor.Dialog.prototype._closeIcon="dialogClose",qc.editor.ProgressBar.prototype._textColor="#caccd8"}function e(){qc.widget.Container.prototype._background="rgb(38, 50, 56)",qc.widget.Button.prototype._textColor="#caccd8",qc.widget.Button.prototype._ninePatchImage="inspector_button.9",qc.widget.Button.prototype._ninePatchBorder=[8,8,8,8],qc.widget.Button.prototype._hoverNinePatchImage="inspector_button.9",qc.widget.Button.prototype._hoverNinePatchBorder=[8,8,8,8],qc.widget.Button.prototype._activeNinePatchImage="inspector_button_active.9",qc.widget.Button.prototype._activeNinePatchBorder=[8,8,8,8]}function f(){document.body.style.background="rgb(59, 60, 64)",k.Color.iconBackground="rgb(105, 105, 105)",k.Color.selectColor="rgba(0, 0, 0, 0)",k.Color.checkColor="#fff",k.Color.disabledBackground="rgba(255, 255, 255, 0.4)",qc.widget.Menu.prototype._ninePatchImage="menu.9",qc.widget.Menu.prototype._ninePatchBorder=[10,10,10,10],qc.widget.Menu.prototype._activeNinePatchImage="menu_active.9",qc.widget.Menu.prototype._activeNinePatchBorder=[10,10,10,10],qc.widget.Menu.prototype._hoverBackground=null,qc.widget.Menu.prototype._hoverGradientColor=null,qc.widget.Menu.prototype._labelColor="#caccd8",qc.widget.Menu.prototype._activeLabelColor="#caccd8",qc.widget.ContextMenu.prototype._ninePatchImage="contextmenu.9",qc.widget.ContextMenu.prototype._ninePatchBorder=[16,16,16,16],qc.widget.ContextMenu.prototype._borderWidth=0,qc.widget.ContextMenu.prototype._borderColor="rgba(0, 0, 0, 0)",qc.widget.ContextMenu.prototype._labelColor="#caccd8",qc.widget.ContextMenu.prototype._hoverLabelColor="#ceae37",qc.widget.ContextMenu.prototype._hoverBackground="#3e4b6b",qc.widget.ContextMenu.prototype._borderColor="rgb(35, 35, 35)",qc.widget.CheckBox.prototype._checkIcon="checkIcon",qc.widget.CheckBox.prototype._uncheckIcon="uncheckIcon",qc.widget.TextField.prototype._ninePatchImage="textfield.9",qc.widget.TextField.prototype._ninePatchBorder=[8,8,8,8],qc.widget.TextField.prototype._borderColor=null,qc.widget.TextField.prototype._textColor="#060a0b",qc.editor.DropDownList.prototype._ninePatchImage="textfield.9",qc.editor.DropDownList.prototype._ninePatchBorder=[8,8,8,8],qc.editor.DropDownList.prototype._borderWidth=0,qc.editor.DropDownList.prototype._textColor="#060a0b",qc.editor.DropDownList.prototype._dropDownBackground="rgb(56, 56, 56)",qc.editor.DropDownList.prototype._filterColor="rgb(220, 220, 220)",qc.editor.DropDownList.prototype._iconBackground="rgb(246, 247, 249)",qc.widget.Slider.prototype._background="rgb(32, 32, 32)",qc.widget.Slider.prototype._forecolor="rgb(32, 32, 32)",qc.widget.Slider.prototype._thumbBackground="rgb(60, 60, 60)",qc.widget.Slider.prototype._thumbGradientColor="rgb(93, 93, 93)",qc.widget.Slider.prototype._thumbGradient="linear.north",qc.widget.Slider.prototype._thumbBorderColor="rgb(32, 32, 32)",qc.widget.ButtonBase.prototype._background="rgb(93, 93, 93)",qc.widget.ButtonBase.prototype._gradientColor="rgb(60, 60, 60)",qc.widget.ButtonBase.prototype._hoverBackground="rgb(93, 93, 93)",qc.widget.ButtonBase.prototype._hoverGradientColor="rgb(60, 60, 60)",qc.widget.ButtonBase.prototype._activeBackground="rgb(99, 99, 99)",qc.widget.ButtonBase.prototype._activeGradientColor="rgb(130, 130, 130)",qc.widget.ButtonBase.prototype._borderColor="rgb(32, 32, 32)",qc.widget.ButtonBase.prototype._textColor="rgb(177, 177, 177)",qc.editor.PreviewView.prototype._ninePatchImage="preview.9",qc.editor.PreviewView.prototype._ninePatchBorder=[32,40,32,40],qc.editor.InspectorButton.prototype._ninePatchImage="inspector_button.9",qc.editor.InspectorButton.prototype._ninePatchBorder=[10,10,10,10],qc.editor.InspectorButton.prototype._hoverNinePatchImage="inspector_button.9",qc.editor.InspectorButton.prototype._hoverNinePatchBorder=[10,10,10,10],qc.editor.InspectorButton.prototype._activeNinePatchImage="inspector_button_active.9",qc.editor.InspectorButton.prototype._activeNinePatchBorder=[10,10,10,10],qc.editor.InspectorButton.prototype._borderColor=0,qc.editor.ProgressBar.prototype._textColor="#caccd8",qc.editor.Text.prototype._textColor="#caccd8",qc.widget.Label.prototype._textColor="#caccd8",qc.widget.Tree.prototype._labelColor="#caccd8",qc.widget.Tree.prototype._labelSelectColor="#ceae37",qc.widget.Tree.prototype._selectBackground="#3e4b6b",qc.widget.Tree.prototype._inactiveSelectBackground="rgb(72, 72, 72)",qc.widget.List.prototype._labelColor="#caccd8",qc.widget.List.prototype._labelSelectColor="#ceae37",qc.widget.List.prototype._selectBackground="#3e4b6b",qc.widget.List.prototype._inactiveSelectBackground="rgb(72, 72, 72)",qc.widget.graph.GraphView.prototype._labelColor="#caccd8",qc.widget.graph.GraphView.prototype._labelSelectColor="#ceae37",qc.widget.graph.GraphView.prototype._selectBackground="#3e4b6b",qc.widget.graph.GraphView.prototype._inactiveSelectBackground="rgb(72, 72, 72)",qc.widget.ColorChooser.prototype._background="rgb(49, 49, 49)",qc.widget.ColorChooser.prototype._color="rgb(177, 177, 177)",qc.widget.ColorChooser.prototype._shadow=!1,qc.widget.ColorChooser.prototype._thumbBorderColor="white",qc.widget.ColorChooser.prototype._titleColor="black",qc.widget.layout.BorderLayout.prototype._splitterColor="rgb(100, 101, 105)",qc.widget.layout.BorderLayout.prototype._toggleIconBackground="rgb(49, 49, 49)",qc.widget.layout.SplitLayout.prototype._splitterColor="rgb(100, 101, 105)",qc.widget.Tabs.prototype._titleBackground="#27282c",qc.widget.Tabs.prototype._tabNinePatchImage="tab.9",qc.widget.Tabs.prototype._tabNinePatchBorder=[10,10,10,10],qc.widget.Tabs.prototype._tabActiveNinePatchImage="tab.9",qc.widget.Tabs.prototype._tabActiveNinePatchBorder=[10,10,10,10],qc.widget.Tabs.prototype._labelColor="#ebd541",qc.widget.Tabs.prototype._borderWidth=0,qc.widget.Tabs.prototype._splitterColor="rgba(0, 0, 0, 0)",qc.editor.Dialog.prototype._ninePatchImage="dialog.9",qc.editor.Dialog.prototype._ninePatchBorder=[50,10,10,10],qc.editor.Dialog.prototype._titleBackground=null,qc.editor.Dialog.prototype._titleColor="#fecb19",qc.editor.Dialog.prototype._titleFont="14px Arial",qc.editor.Dialog.prototype._htmlColor="#caccd8",qc.editor.Dialog.prototype._buttonNinePatchImage="dialog_button.9",qc.editor.Dialog.prototype._buttonNinePatchBorder=[10,10,10,10],qc.editor.Dialog.prototype._buttonActiveNinePatchImage="dialog_button_active.9",qc.editor.Dialog.prototype._buttonActiveNinePatchBorder=[10,10,10,10],qc.editor.Dialog.prototype._closeNinePatchImage="dialog.close.9",qc.editor.Dialog.prototype._closeNinePatchBorder=[13,13,13,13],qc.editor.Dialog.prototype._buttonColor="#caccd8",qc.editor.Dialog.prototype._closeIcon="dialogClose",qc.editor.FrameList.prototype._background="rgb(65, 65, 65)",qc.editor.FrameList.prototype._borderColor="rgb(32, 32, 32)",qc.editor.ResourceList.prototype._background="rgb(65, 65, 65)",qc.editor.ResourceList.prototype._borderColor="rgb(32, 32, 32)",qc.editor.ObjectSelectPane.prototype._background="rgb(59, 60, 64)",qc.widget.ComboBox.prototype._border="1px solid rgb(32, 32, 32)",qc.widget.ComboBox.prototype._background="rgb(65, 65, 65)",Na.prototype._background=null,Na.prototype._gradientColor=null,Na.prototype.titleNinePatchImage="panel_title.9",Na.prototype.titleNinePatchBorder=[5,5,5,5],Na.prototype.titleTextNinePatchImage="panel_title_text.9",Na.prototype.titleTextNinePatchBorder=[10,10,10,10],Na.prototype._titleColor="rgb(177, 177, 177)",Na.prototype._titleLineColor="rgb(89, 89, 89)",qc.editor.InspectorList.prototype._background="rgb(65, 65, 65)",qc.editor.InspectorList.prototype._borderColor="rgb(32, 32, 32)",qc.editor.FilterList.prototype._background="rgb(65, 65, 65)",qc.editor.FilterList.prototype._borderColor="rgb(32, 32, 32)",qc.editor.Painter.prototype._background="rgb(65, 65, 65)",qc.editor.Painter.prototype._borderColor="rgb(32, 32, 32)",qc.editor.ProgressBar.prototype._background=null,qc.editor.LeftBanner.prototype._ninePatchImage="banner_background.9",qc.editor.LeftBanner.prototype._ninePatchBorder=[8,4,8,4],qc.editor.RunBanner.prototype._ninePatchImage="banner_background.9",qc.editor.RunBanner.prototype._ninePatchBorder=[8,4,8,4],qc.editor.MiddleBanner.prototype._ninePatchImage="banner_background.9",qc.editor.MiddleBanner.prototype._ninePatchBorder=[8,4,8,4],qc.editor.RightBanner.prototype._ninePatchImage="banner_background.9",qc.editor.RightBanner.prototype._ninePatchBorder=[8,4,8,4],qc.editor.AnchorPresetsView.prototype._background="rgb(45, 45, 45)",qc.editor.AnchorPresetsView.prototype._titleBackground="rgb(49, 49, 49)",qc.editor.AnchorPresetsView.prototype._borderColor="rgb(110, 110, 110)",qc.editor.AnchorButton.prototype._labelColor="rgb(177, 177, 177)",qc.editor.AnchorButton.prototype._imageBackground="rgb(61, 61, 61)",qc.editor.CurveButton.prototype._imageBackground="rgb(61, 61, 61)",qc.editor.CurveButton.prototype._imageBorderColor="rgb(32, 32, 32)",qc.editor.ComponentsPanel.prototype._background="rgb(49, 49, 49)",qc.editor.ComponentsPanel.prototype._titleBackground="rgb(63, 63, 63)",qc.editor.ComponentsPanel.prototype._borderColor="rgb(110, 110, 110)",qc.editor.AddComponentButton.prototype._ninePatchImage="inspector_button.9",qc.editor.AddComponentButton.prototype._ninePatchBorder=[10,10,10,10],qc.editor.AddComponentButton.prototype._hoverNinePatchImage="inspector_button.9",qc.editor.AddComponentButton.prototype._hoverNinePatchBorder=[10,10,10,10],qc.editor.AddComponentButton.prototype._activeNinePatchImage="inspector_button_active.9",qc.editor.AddComponentButton.prototype._activeNinePatchBorder=[10,10,10,10],qc.editor.AddComponentButton.prototype._borderWidth=0;var a="rgba(153, 153, 155, 0.5)";qc.widget.List.prototype._scrollBarColor=a,qc.widget.Tree.prototype._scrollBarColor=a,qc.widget.graph.GraphView.prototype._scrollBarColor=a,qc.widget.Container.prototype._scrollBarColor=a,ga.menu.view.style.background="#212025",ga.leftBanner.view.style.background="#212025",ga.runBanner.view.style.background="#212025",ga.middleBanner.view.style.background="#212025",ga.rightBanner.view.style.background="#212025",ga.leftBanner.findViewById("editMode").ninePatchImage="banner_button.9",ga.leftBanner.findViewById("editMode").ninePatchBorder=[8,8,8,8],ga.leftBanner.findViewById("sceneHandler").ninePatchImage="banner_button.9",ga.leftBanner.findViewById("sceneHandler").ninePatchBorder=[8,8,8,8],ga.project.layout.topSplitterColor="url("+ga.assetSkinPath+"projectSplitter.png)",ga.inspector.layout.splitterColor="url("+ga.assetSkinPath+"panel_title.9.png)",ga.mainContainer.iv(!0)}function g(){}function h(){}function i(){}if(!qc.editor){qc.editor={},qc.editor.gui={};var j=2*Math.PI,k=qc.widget.Default,l=k.devicePixelRatio,m=k.define,n=k.layout,o=k.inflate,p=k.createDiv,q=k.createCanvas,r=k.removeHTML,s=k.initContext,t=k.setCanvas,u=k.unionPoint,v=k.containsPoint,w=k.intersectionLineRect,x=k.intersectionLineLine,y=k.getDistance,z=k.startDragging,A=k.isDragging,B=k.getClientPoint,C=k.getPagePoint,D=k.isSelectAll,E=k.isDelete,F=k.isEsc,G=k.isEnter,H=k.isLeft,I=k.isRight,J=k.isUp,K=k.isDown,L=k.isDoubleClick,M=k.getTouchCount,N=k.isLeftButton,O=k.isShiftDown,P=k.isCtrlDown,Q=k.initDash,R=k.restoreDash,S=k.drawText,T=k.drawArc,U=k.callLater,V=k.createAnim,W=k.startAnim,X=k.timeNow,Y=k.preventDefault,Z=k.isMac,$=a&&a.process&&a.process.versions.electron,_=function(b,d){d=d||a;var e,f,g=decodeURIComponent(d.location.search.substring(1)),h=g.split("&");for(f=0;f<h.length;f++)if(e=h[f].split("="),e[0]===b)return e[1]===c?!0:e[1]},aa=qc.editor.gui;qc.editor.VERSION="1.0.2",qc.editor.version={latestVersion:{}},qc.editor.version.showUpdateDialog=function(){qc.editor._progressUpdateDialog&&qc.editor._progressUpdateDialog.visible||nb(ga._("A new version of QICI Engine is available!"),ga._("Update Info"),[{text:ga._("Update"),key:"enter",onClick:function(){qc.editor.version.updateVersion(),this.hide()}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}])},qc.editor.version.updateVersion=function(){qc.editor.Operation.UPDATE_VERSION(function(a){ga.notification.info(0!==a.result?ga._("You are using the latest version."):ga._("Begin to update..."))})},qc.editor.version.showProgressUpdateDialog=function(){if(qc.editor.__updateFailedDialog&&qc.editor.__updateFailedDialog.visible)return null;if(!qc.editor._progressUpdateDialog){var a=qc.editor._progressUpdateDialog=new qc.editor.ProgressDialog;a.title=ga._("Update version"),a.modal=!0,a.width=300,a.height=100,a.tools=[],a.show()}return qc.editor._progressUpdateDialog.visible||qc.editor._progressUpdateDialog.show(),qc.editor._progressUpdateDialog},qc.editor.version.progressUpdateDialog=function(a,b){var c=qc.editor.version.showProgressUpdateDialog();c&&(c.progressBar.percent=a,c.progressBar.text=b)},qc.editor.version.showUpdateFailed=function(a){if(qc.editor._progressUpdateDialog&&qc.editor._progressUpdateDialog.hide(),qc.editor.__updateFailedDialog)qc.editor.__updateFailedDialog.show(),qc.editor.__updateFailedDialog.requestFocus();else{var b;switch(a){case-2:b=ga._("Download failed, please try again.");break;case-1:default:b=ga._("Failed to update, please make sure no files are occupied by other process.")}qc.editor.__updateFailedDialog=nb(b,ga._("Confirm"),[{text:ga._("OK"),key:"enter",onClick:function(){this.hide()}}])}},qc.editor.version.showUpdateFinished=function(){qc.editor._progressUpdateDialog&&qc.editor._progressUpdateDialog.hide(),nb(ga._("The update is completed, and refresh to load the new version?"),ga._("Confirm"),[{text:ga._("Refresh"),key:"enter",onClick:function(){this.hide(),a.location.reload(!0)}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}])},qc.editor.version.checkLatestUpdates=function(){var a=qc.editor,b=qc.editor.version.latestVersion;a.Operation.CHECK_FOR_UPDATES(!1,function(c){a.version.mixin(c,b),a.version.versionCompare(qc.editor.VERSION,b.editor)<0&&qc.editor.version.showUpdateDialog()})},qc.editor.version.versionCompare=function(a,b){if("string"!=typeof a||"string"!=typeof b)return 1;for(var c=a.split("."),d=b.split("."),e=Math.max(c.length,d.length),f=0;e>f;++f){var g=c[f]?parseInt(c[f]):0,h=d[f]?parseInt(d[f]):0;if(g!==h)return g-h}return 0},qc.editor.version.mixin=function(a,b){if(!a||"object"!=typeof a)return b;for(var c in a){var d=typeof a[c],e=a[c];b[c]=a[c]&&"object"===d?typeof b[c]===d?qc.editor.version.mixin(a[c],b[c]):qc.editor.version.mixin(a[c],new e.constructor):a[c]}return b},qc.editor.version.archiveVersion=function(a){qc.editor.Operation.ARCHIVE_VERSION(a,function(){})},aa._containers=[],aa.titleLine=function(a,b,c){var d=aa._containers,e=d[d.length-1],f={cells:[]},g=[];0===e.length&&(f.widths=aa.columnWidths);var h=new qc.widget.Label({text:a,align:"left",iconWidth:12,iconHeight:12,padding:0,icon:b?"collapse":"expand"});if(h._expand=!b,c){f.cells.push({colspan:aa.columnWidths.length-(c._layoutConfig.colspan||0),fill:"none",element:h});var i=c._layoutConfig;delete c._layoutConfig,i.element=c,f.cells.push(i)}else f.cells.push({colspan:aa.columnWidths.length,fill:"none",element:h});return e.push(f),h.addEventListener("click",function(){h._expand=!h._expand,h.icon=h._expand?"expand":"collapse";for(var a=h;a&&!(a instanceof qc.widget.Container&&a.layout instanceof qc.widget.layout.TableLayout);)a=a.parent;if(a)for(var b=0;b<g.length;b++)h._expand?a.layout.showRow(g[b]):a.layout.hideRow(g[b])}),{index:e.length-1,add:function(a){var c=a.index;a=d[d.length-1][c],a.visible=!b,g.push(c)}}},aa.line=function(a,b){var d=aa._containers,e=d[d.length-1],f={cells:[]};null!=b&&(f.height=b),0===e.length&&(f.widths=aa.columnWidths);for(var g=0;g<a.length;g++){var h=a[g],i=h._layoutConfig;0===g&&i&&i.cellPadding===c&&(i.cellPadding=[1,1,1,15]),f.cells.push(i),delete h._layoutConfig}return e.push(f),{index:e.length-1}},aa.divider=function(a,b){var c=new qc.editor.Divider;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.label=function(a,b,c){var d=new qc.editor.Label;c=c||{},c.element=d,d._layoutConfig=c,d.text=a;for(var e in b)d[e]=b[e];return d},aa.text=function(a,b,c){var d=new qc.editor.Text;c=c||{},c.element=d,d._layoutConfig=c,d.text=a;for(var e in b)d[e]=b[e];return d},aa.empty=function(a){var b={};return a=a||{},a.element=null,b._layoutConfig=a,b},aa.comp=function(a,b,c){c=c||{},c.element=a,a._layoutConfig=c;for(var d in b)a[d]=b[d];return a},aa.button=function(a,b,c){var d=new qc.editor.InspectorButton;c=c||{},c.element=d,d._layoutConfig=c,d.text=a;for(var e in b)d[e]=b[e];return d},aa.curveButton=function(a,b){var c=new qc.editor.CurveButton;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.buttonGroup=function(a,b,c){var d=new qc.editor.ButtonGroup;if(c=c||{},c.element=d,d._layoutConfig=c,a){for(var e=[],f=0;f<a.length;f++){var g=new qc.widget.ToggleButton(a[f]);e.push(g)}d.setItems(e)}for(var h in b)d[h]=b[h];return d},aa.imageList=function(a,b){var c=new qc.editor.ImageList;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.painter=function(a,b){var c=new qc.editor.Painter;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.stringInput=function(a,b){var c=new qc.editor.StringInput;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.objectInput=function(a,b){var c,d=a.objectType;null==a.targetField&&(a.targetField=a.bind),c="texture"===d?aa._textureInput(a):"font"===d||"bitmapFont"===d?aa._fontInput(a):"allFont"===d?aa._allFontInput(a):"sound"===d?aa._soundInput(a):"textAsset"===d?aa._textAssetInput(a):"excelAsset"===d?aa._excelAssetInput(a):"prefab"===d?aa._prefabInput(a):"node"===d?aa._nodeInput(a):new qc.editor.ObjectInput,b=b||{},b.element=c,c._layoutConfig=b;for(var e in a)c[e]=a[e];return c},aa._textureInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(!(c instanceof qc.editor.FileNode))return;var d=(c.master||c).treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.Atlas))return;return!0}};e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)f(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&f(c)){var d=c.view.draggingData,g=(d.master||d).treeData.resUUID,h=ga.game.assets.find(g);e.resetNinePatchImage(),e.setTextureObjectValue(h,d.master?d.name:null,!0)}};var g;return c.indexOf("/")>0&&(g=c.substring(c.indexOf("/")+1),c=c.substring(0,c.indexOf("/"))),g?e.setTextureObjectValue(d[c],d[g]):e.setTextureObjectValue(d[c]),e.onValueChanged=b,e},aa._allFontInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(c.master)return;if(!(c instanceof qc.editor.FileNode))return;var d=c.treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.Font))return;return!0}};e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)f(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&f(c)){var d=c.view.draggingData,g=d.treeData.resUUID,h=ga.game.assets.find(g);e.resetNinePatchImage(),e.setObjectValue(h,!0)}};var g=d[c];return e.setObjectValue(g),e.onValueChanged=b,e},aa._fontInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f="bitmapFont"===a.objectType?qc.UIText.BITMAPFONT:qc.UIText.WEBFONT,g=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(c.master)return;if(!(c instanceof qc.editor.FileNode))return;var d=c.treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.Font))return;if(e._fontFamily!==f)return;return!0}};e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)g(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&g(c)){var d=c.view.draggingData,f=d.treeData.resUUID,h=ga.game.assets.find(f);e.resetNinePatchImage(),e.setObjectValue(h,!0)}};var h=d[c];return e.setObjectValue(h),e.onValueChanged=b,e},aa._soundInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(c.master)return;if(!(c instanceof qc.editor.FileNode))return;var d=c.treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.SoundAsset))return;return!0}};e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)f(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&f(c)){var d=c.view.draggingData,g=d.treeData.resUUID,h=ga.game.assets.find(g);e.resetNinePatchImage(),e.setObjectValue(h,!0)}};var g=d[c];return e.setObjectValue(g),e.onValueChanged=b,e},aa._textAssetInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(c.master)return;if(!(c instanceof qc.editor.FileNode))return;var d=c.treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.TextAsset))return;return!0}};e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)f(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&f(c)){var d=c.view.draggingData,g=d.treeData.resUUID,h=ga.game.assets.find(g);e.resetNinePatchImage(),e.setObjectValue(h,!0)}};var g=d[c];return e.setObjectValue(g),e.onValueChanged=b,e},aa._excelAssetInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(c.master)return;if(!(c instanceof qc.editor.FileNode))return;var d=c.treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.ExcelAsset))return;return!0}};e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)f(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&f(c)){var d=c.view.draggingData,g=d.treeData.resUUID,h=ga.game.assets.find(g);e.resetNinePatchImage(),e.setObjectValue(h,!0)}};var g=d[c];return e.setObjectValue(g),e.onValueChanged=b,e},aa._prefabInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target;delete a.onValueChanged;var e=new Da(a),f=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(!c)return;if(c.master)return;if(!(c instanceof qc.editor.FileNode))return;var d=c.treeData.resUUID,e=ga.game.assets.find(d);if(!(e instanceof qc.Prefab))return;return!0}};return e.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)e.resetNinePatchImage();else if("enter"===b)f(c)&&(e._objectInput.ninePatchImage="textfield_active.9",e._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&f(c)){var d=c.view.draggingData,g=d.treeData.resUUID,h=ga.game.assets.find(g);e.resetNinePatchImage(),e.setObjectValue(h,!0)}},e.onValueChanged=b,e.setObjectValue(d[c]),e},aa._nodeInput=function(a){var b=a.onValueChanged,c=a.targetField,d=a.target,e=a.nodeType||qc.Node;delete a.onValueChanged;var f=new Da(a),g=d[c];f.setObjectValue(g);var h=function(a){var b=a.view.draggingData;return b=b.node,b instanceof e?!0:void 0};return f.objectInput.handleCrossDrag=function(a,b,c){if("exit"===b||"cancel"===b)f.resetNinePatchImage();else if("enter"===b)h(c)&&(f._objectInput.ninePatchImage="textfield_active.9",f._objectInput.ninePatchBorder=[10,10,10,10]);else if("drop"===b&&h(c)){var d=c.view.draggingData.node;f.resetNinePatchImage(),f.setObjectValue(d,!0)}},f.onValueChanged=b,f},aa.textArea=function(a,b){var c=new qc.editor.TextAreaContainer;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.numberInput=function(a,b){var c=new qc.editor.NumberInput;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.angleInput=function(a,b){var c=new qc.editor.AngleInput;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.sliderInput=function(a,b){var c=new qc.editor.SliderInput(a);b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.intInput=function(a,b){var c=new qc.editor.IntInput;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.checkBox=function(a,b){var c=new qc.editor.CheckBox;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.toggleButton=function(a,b){var c=new qc.editor.ToggleButton;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.dropDownList=function(a,b){var c=new qc.editor.DropDownList;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.multiDropDownList=function(a,b){var c=new qc.editor.MultiDropDownList;b=b||{},b.element=c,c._layoutConfig=b;for(var d in a)c[d]=a[d];return c},aa.colorPicker=function(a,b){var c,d={};a&&null!=a["dropDown.colorChooser.alphaEnabled"]?(c=a["dropDown.colorChooser.alphaEnabled"],delete a["dropDown.colorChooser.alphaEnabled"]):c=!0,d["dropDown.colorChooser.alphaEnabled"]=c;var e=new qc.editor.ColorPicker(d);b=b||{},b.element=e,e._layoutConfig=b;for(var f in a)e[f]=a[f];return e},b.defineProperty(aa,"containers",{get:function(){var a=this._containers;return this._columnWidths=[],this._containers=[],a}}),b.defineProperty(aa,"columnWidths",{get:function(){return this._columnWidths},set:function(a){this._columnWidths=a,this._containers.push([])}}),qc.editor.Language={"QICI Engine/About QICI Engine...":{zh:"青瓷引擎/关于青瓷引擎..."},"QICI Engine/Check for Updates...":{zh:"青瓷引擎/检测更新..."},"QICI Engine/Help/zh/Manual...":{zh:"青瓷引擎/帮助/中文/手册..."},"QICI Engine/Help/zh/API...":{zh:"青瓷引擎/帮助/中文/API..."},"QICI Engine/Help/zh/Forum...":{zh:"青瓷引擎/帮助/中文/论坛..."},"QICI Engine/Help/en/Manual...":{zh:"青瓷引擎/帮助/英文/手册..."},"QICI Engine/Help/en/API...":{zh:"青瓷引擎/帮助/英文/API..."},"QICI Engine/Help/en/Forum...":{zh:"青瓷引擎/帮助/英文/论坛..."},"QICI Engine/Preference...":{zh:"青瓷引擎/偏好设置"},"Project/New Scene":{zh:"工程/新场景"},"Project/Save Scene":{zh:"工程/保存场景"},"Project/Reload Scene":{zh:"工程/刷新场景"},"Project/Open Recent":{zh:"工程/打开最近工程"},"Project/New Project":{zh:"工程/新建工程"},"Project/Open Project":{zh:"工程/打开工程"},"Project/Publish...":{zh:"工程/发布..."},"Project/Settings...":{zh:"工程/设置..."},"Edit/Undo":{zh:"编辑/回退"},"Edit/Redo":{zh:"编辑/重做"},"Edit/Cut":{zh:"编辑/剪切"},"Edit/Copy":{zh:"编辑/拷贝"},"Edit/Paste":{zh:"编辑/粘贴"},"Edit/Duplicate":{zh:"编辑/复制"},"Edit/Delete":{zh:"编辑/删除"},"Edit/Preview (WebGL)":{zh:"编辑/预览（WebGL）"},"Edit/Preview (Canvas)":{zh:"编辑/预览（Canvas）"},"Edit/Run":{zh:"编辑/运行"},"Edit/Apply To Prefab":{zh:"编辑/应用预制修改"},"GameObject/Empty Node":{zh:"游戏对象/空节点"},"GameObject/Image":{zh:"游戏对象/图片"},"GameObject/Sprite":{zh:"游戏对象/精灵"},"GameObject/Text":{zh:"游戏对象/文本"},"GameObject/Button":{zh:"游戏对象/按钮"},"GameObject/Toggle":{zh:"游戏对象/开关"},"GameObject/ScrollBar":{zh:"游戏对象/滚动条"},"GameObject/ScrollView":{zh:"游戏对象/滚动视图"},"GameObject/ProgressBar":{zh:"游戏对象/进度条"},"GameObject/Slider":{zh:"游戏对象/拉条"},"GameObject/Input Field":{zh:"游戏对象/输入框"},"GameObject/Sound":{zh:"游戏对象/音效"},"GameObject/Dom":{zh:"游戏对象/Dom节点"},"GameObject/UIRoot":{zh:"游戏对象/UIRoot"},"GameObject/Emitter":{zh:"游戏对象/粒子发射器"},"GameObject/Tilemap":{zh:"游戏对象/瓦片地图"},"GameObject/Graphics":{zh:"游戏对象/绘图"},"Empty Node":{zh:"空节点"},Image:{zh:"图片"},Sprite:{zh:"精灵"},Text:{zh:"文本"},Button:{zh:"按钮"},Toggle:{zh:"开关"},ScrollBar:{zh:"滚动条"},ScrollView:{zh:"滚动视图"},ProgressBar:{zh:"进度条"},Slider:{zh:"拉条"},"Input Field":{zh:"输入框"},Sound:{zh:"音效"},Emitter:{zh:"粒子发射器"},Graphics:{zh:"绘图"},Tilemap:{zh:"瓦片地图"},"Tool/Frame Animation Editor":{zh:"工具/帧动作编辑器"},"Tool/Repack Texture Atlases":{zh:"工具/重打包图集"},"Tool/Import Assets":{zh:"工具/资源导入"},"Tool/Create WebFont":{zh:"工具/创建WebFont"},"Plugins/Plugin Manager":{zh:"插件/插件管理"},"Plugins/Plugin Store":{zh:"插件/插件商店"},"Plugins/Export Plugin":{zh:"插件/导出插件"},"Layout/Portrait":{zh:"布局/竖屏"},"Layout/Landscape":{zh:"布局/横屏"},"Language/中文":{zh:"语言/中文"},"Language/English":{zh:"语言/English"},"Quit running mode first":{zh:"请先退出运行模式"},"Stop editing prefab first":{zh:"请先结束预制编辑"},"Enter the new scene name":{zh:"请输入新场景名"},"Do you want to save the scene?":{zh:"是否保存当前场景？"},"Do you want to save the changes?":{zh:"是否保存改变？"},"Don't Save":{zh:"不保存"},Save:{zh:"保存"},Cancel:{zh:"取消"},"Add Component":{zh:"添加脚本"},Components:{zh:"脚本列表"},Rebuild:{zh:"重新生成"},Preference:{zh:"偏好设置"},"UI Atlas":{zh:"图集"},"Normal Texture":{zh:"普通贴图"},Atlas:{zh:"图集"},"Frame Animation":{zh:"帧动画"},DragonBone:{zh:"骨骼动画"},"DragonBone(Sampled)":{zh:"骨骼动画（采样）"},"Edit Frame Animation":{zh:"编辑帧动作"},Sampled:{zh:"动作采样"},"DragonBone({0}) sampling is done":{zh:"骨骼（{0}）采样完成"},"Animations List":{zh:"动作列表"},Name:{zh:"名称"},Loop:{zh:"循环"},Operation:{zh:"操作"},Play:{zh:"播放"},Pause:{zh:"暂停"},"Next Frame":{zh:"下一帧"},Frames:{zh:"图片帧"},"Nine Patch Padding":{zh:"九宫格间距"},"Web Font":{zh:"Web Font"},"Font Name":{en:"Name",zh:"字体名称"},"Font URLs (One URL per line)":{zh:"字体地址（按行分开）"},"Font URLs are invalid":{zh:"字体的地址非法"},"Name must be digital or letter":{zh:"字体名称应该为数字或字母"},"Web font is saved to: ":{zh:"字体被保存到："},"JavaScript Dependence Management":{zh:"脚本依赖管理"},Script:{zh:"脚本"},Path:{zh:"路径"},Entry:{zh:"入口脚本"},"Drop JavaScript File Here":{zh:"将JS文件拖拽到这里"},"Dependence List":{zh:"依赖列表"},"Add Filter":{zh:"添加着色器"},"Apply Prefab":{zh:"应用预制修改"},"Plugin Manager":{zh:"插件管理"},"Plugin List":{zh:"插件列表"},"Check for Updates":{zh:"检测更新"},"Version Info":{zh:"版本信息"},Update:{zh:"更新"},"Project Settings":{zh:"工程设置"},"Project Name":{zh:"工程名"},"Game Name":{zh:"游戏名"},Company:{zh:"公司名"},Identifier:{zh:"标识符"},Instance:{zh:"实例名"},Version:{zh:"版本号"},Width:{zh:"宽度"},Orientation:{zh:"转向"},"Auto Rotate":{zh:"自动旋转"},Portrait:{zh:"竖屏"},Landscape:{zh:"横屏"},"Frame Rate":{zh:"帧率"},"Background Color":{zh:"背景色"},Apply:{zh:"应用"},"Scene List":{zh:"场景列表"},"Reset Native Size":{zh:"重置大小"},"Generate Layers":{zh:"生成图层"},Relayout:{zh:"重排"},On:{zh:"开启"},"Frame Animation Editor":{zh:"帧动作编辑"},"File must be texture atlas":{zh:"文件必须为图集资源"},"DragonBone cannot be modified.":{zh:"骨骼动画不能被编辑"},"Drop Atlas File Here":{zh:"将图集文件拖到这里"},Animation:{zh:"动作"}," New ":{zh:" 新建 "}," Save ":{zh:" 保存 "}," Delete ":{
zh:" 删除 "}," Back ":{zh:" 返回 "},"Animation is empty":{zh:"动作帧信息不能为空"},"Animation's name is invalid":{zh:"动作名非法"},"Please create an animation":{zh:"请先创建一个动作"},"Import Assets":{zh:"资源导入"},Import:{zh:"导入"},"Asset Name":{zh:"资源名称"},"Asset Path":{zh:"资源路径"},"Asset Type":{zh:"资源类型"},"List of Files":{zh:"文件列表"},"Drop files here":{zh:"拖拽文件到此处"},"Invalid asset":{zh:"未检测到资源"},"The asset name is invalid":{zh:"资源名称非法"},"Asset path is empty":{zh:"请选择保存路径"},"Files is empty":{zh:"导入文件列表为空"},"Import is done":{zh:"资源导入成功"},"Import error:":{zh:"资源导入失败："},"Double click to select the folder":{zh:"双击选择文件夹"},"Set Curr To Start":{zh:"设置当前值为起始值"},"Set Curr To End":{zh:"设置当前值为结束值"},"Play/Stop":{zh:"运行/停止"},"Reset To Begin":{zh:"重置到起始值"},"Play/Stop Group":{zh:"运行组/停止组"},"Reset Group to Begin":{zh:"重置组到起始值"},"Stop editing frame animation?":{zh:"正在编辑帧动作，确定要退出吗？"},Yes:{zh:"是"},"New Folder":{zh:"创建目录"},"Open in Local File Explorer":{zh:"在本地文件管理器中打开"},Delete:{zh:"删除"},Rename:{zh:"重命名"},"New JavaScript File":{zh:"创建JavaScript脚本"},Reimport:{zh:"重新导入资源"},"Sure to delete this file?":{zh:"确认删除选择文件？"},"{0} cannot be removed(builtin files).":{zh:"{0}为内置文件，无法删除。"},"{0} cannot be modified(builtin files).":{zh:"{0}为内置文件，无法编辑。"},"JavaScript File":{en:"JavaScript",zh:"JavaScript文件"},"Enter a new JavaScript file name":{zh:"输入JavaScript文件名"},Expand:{zh:"展开"},Collapse:{zh:"合并"},"Enter a new folder name":{zh:"请输入目录名"},"Downscaling is done.":{zh:"缩放成功"},"Please select an animation asset":{zh:"请选中一个动画资源"},"Folder created":{zh:"创建目录成功"},"Failed to create folder":{zh:"创建目录失败"},"Stop running game?":{zh:"是否停止当前运行中的游戏？"},Stop:{zh:"停止"},"Publish failed:":{zh:"发布失败："},"Publish succeeded":{zh:"发布成功"},"Remove completed":{zh:"删除成功"},"Remove failed:":{zh:"删除失败"},"Rename succeeded":{zh:"重命名完成"},"Scene saved":{zh:"场景保存完成"},"Prefab saved":{zh:"预制保存完成"},"Built-in files cannot be modified":{zh:"内置文件不能被编辑"},"Reimport completed":{zh:"资源重导入完成"},"Operation completed":{zh:"操作成功"},"Connect failed":{zh:"连接失败"},"Sure to remove this component?":{zh:"确定删除此组件？"},Remove:{zh:"删除"},OK:{zh:"确定"},BitmapFont:{zh:"BitmapFont"},Cut:{zh:"剪切"},Copy:{zh:"拷贝"},Paste:{zh:"粘贴"},Create:{zh:"创建"},Duplicate:{zh:"复制"},"Sure to remove this node?":{zh:"确定删除选择节点吗？"},"Failed to fetch recent projects list":{zh:"获取最近打开的工程列表失败。"},Open:{zh:"打开"},"Open Project":{zh:"打开工程"},"Failed to open project":{zh:"打开工程失败。"},"Failed to create project":{zh:"创建工程失败。"},"Close Tip":{en:"Make sure the changes you made in the scene are saved.\nYour changes will be lost if you donnot save them.\nDo you really want to exit?",zh:"请确定所有数据已保存，确定要退出编辑吗？"},Folder:{zh:"文件夹"},"Choose Folder":{zh:"选择文件夹"},"Double click to choose the folder":{zh:"双击选择文件夹"},"Please choose a folder to create the project":{zh:"请选择创建工程路径"},"Create a new project":{zh:"创建新工程"},"Project Folder":{zh:"工程路径"},"Recent Opened Projects":{en:"Recent Projects",zh:"最近打开的工程"},"Recent Projects":{zh:"最近工程"},"New Project":{zh:"新建工程"},"Code Editor":{zh:"代码编辑器"},"Code Preview":{zh:"代码预览"},"Code Saved":{zh:"代码已保存"},"Select Object":{zh:"选择对象"},"You are using the latest version.":{zh:"当前使用的已经是最新版本。"},"Local Editor Version: ":{zh:"本地编辑器版本："},"Latest Editor Version: ":{zh:"最新编辑器版本："},"Local Core Version: ":{zh:"本地核心库版本："},"Latest Core Version: ":{zh:"最新核心库版本："},"Begin to update...":{zh:"开始更新版本..."},"Update failed, please try again later.":{zh:"更新失败，请稍后重试。"},"Updated successfully, restart the node.js server and refresh this page":{zh:"更新成功，请重启后台Node.js服务，并刷新本页面。"},"Update Info":{zh:"更新信息"},"A new version of QICI Engine is available!":{zh:"青瓷引擎有新的版本发布了！"},"Pan Mode":{en:"Pan",zh:"移动场景"},"Move Mode":{en:"Move",zh:"移动元素"},"Scale Mode":{en:"Scale",zh:"缩放"},"Transform Mode":{en:"Transform",zh:"变换"},"Fit Content":{zh:"重置场景大小"},"Show/Hide Grid":{zh:"显示/隐藏标尺"},"Show/Hide Debug":{zh:"显示/隐藏调试信息"},"Checking...":{zh:"检查中..."},Install:{zh:"安装"},"Installing...":{zh:"安装中..."},Installed:{zh:"已安装"},"{0} has been successfully installed.":{zh:"{0}安装成功"},"{0} failed to install.":{zh:"{0}安装失败"},"Operate Failed":{zh:"操作失败。"},"Revert to Dragonbones successfully.":{zh:"成功还原动作为骨骼动画。"},Revert:{zh:"还原为骨骼动画。"},"Loading Prefab":{zh:"加载预制"},"Project has been removed successfully.":{zh:"工程已删除"},Warning:{zh:"警告"},Confirm:{zh:"确认"},Prompt:{zh:"提示"},"Search:":{zh:"搜索："},"Downloading...":{zh:"下载中..."},"Backup current version...":{zh:"备份现有版本中..."},"Completing update...":{zh:"正在完成更新，请稍候..."},"Update version":{zh:"版本更新"},"The update is completed, and refresh to load the new version":{zh:"更新完成，刷新页面载入新版本?"},Refresh:{zh:"更新"},"Failed to update, please make sure no files are occupied by other process.":{zh:"更新失败。请确认文件未被其他进程使用。"},"Download failed, please try again.":{zh:"下载更新失败，请重试。"},"Script added.":{zh:"脚本成功挂载在节点上。"},"Start to download images, count: ":{zh:"开始下载图元，数量"},"Images downloaded, Start to pack atlas.":{zh:"所有图元已成功下载，开始打包"},"All atlases has been packed.":{zh:"全部图集打包完毕！！！"},"Show Retainers":{zh:"查看引用者"},Retainers:{zh:"引用者"},"No retainer":{zh:"没有其它节点引用此节点"},"Run in Background":{zh:"后台运行"},Antialias:{zh:"抗锯齿"},Transparent:{zh:"背景透明"},Renderer:{zh:"渲染器"},"Can not move file into raw floder":{zh:"无法将文件移动到raw目录下"},"Prefab cannot be removed":{zh:"Prefab不能删除"},"Failed to add component":{en:"The component isn't supported by this node.",zh:"此节点不支持挂载该组件。"},"TweenFunction func error":{en:"More than one function with the same name: ",zh:"存在多个相同函数名的函数："},Edit:{zh:"编辑"},"Edit Text":{zh:"编辑文本"},"Please input an integer between 1 - 60":{zh:"请输入一个 1 - 60 的整数"},"Sample Frame Rate(1-60, default 15)":{zh:"每秒采样帧率（1-60，默认15帧）"},"Current scripts rely on other, it can not be used as the entrance.":{zh:"当前脚本依赖其他文件，无法作为入口。"},"Curve Editor":{zh:"曲线编辑器"},"Add Key":{zh:"添加关键帧"},"Delete Key":{zh:"删除关键帧"},"Reset View":{zh:"重置显示范围"},"√ Auto":{zh:"√ 自动"},Auto:{zh:"自动"},"√ Free Smooth":{zh:"√ 平滑"},"Free Smooth":{zh:"平滑"},"√ Flat":{zh:"√ 水平"},Flat:{zh:"水平"},"√ Broken":{zh:"√ 打断"},Broken:{zh:"打断"},"√ Ping Pong":{zh:"√ 反复"},"Ping Pong":{zh:"反复"},"√ Loop":{zh:"√ 循环"},"√ Clamp":{zh:"√ 固定"},Clamp:{zh:"固定"},"Save as New Curve":{zh:"保存为新曲线"},"Delete Curve":{zh:"删除曲线"},"Add Default Curves":{zh:"添加默认曲线"},"Developer Mode":{zh:"开发者模式"},Restore:{zh:"恢复"},Reload:{zh:"重新加载"},"Scene file changed":{zh:"场景原文件在外部被修改，是否需要重新加载原场景？(重新加载的话，临时场景内容会丢失)",en:"scene's source file has been changed outside, do you want to reload the original scene. (If reload, the changes in the temporary scene will be lost permanently)"},"State History Size":{zh:"场景历史记录保存数量"},"Save Scene Interval":{zh:"自动保存临时场景的间隔时间"},"Use System Editor for JavaScript":{zh:"使用系统编辑器打开JavaScript文件"},"Double Click":{zh:"双击"},"Shift + Double Click":{zh:"Shift + 双击"},"Current Scene is not {0}, can not revert.":{zh:"当前编辑中的场景并非{0}，不能执行还原操作"},"Revert Failed.":{zh:"还原失败"},Calculate:{zh:"计算"},"Asset is not loaded, please try later.":{zh:"资源尚未加载完毕，请稍后再尝试。"},"Current node is not allowed to add this component.":{zh:"当前节点无法添加此组件。"},"Please first stop to edit prafab.":{zh:"请先退出编辑预制状态。"},"It is not allowed to edit prafab in running mode.":{zh:"运行模式下无法编辑预制"},"Exception notification":{en:"Error:{0}</br>(Please open 'Developer Tools'->'Console' to see detail.)",zh:"发生报错：{0}</br>（打开开发者工具的 Console 面板查看详细信息。）"}};var ba=qc.editor.Localize=function(a){this.language=a,this.values=qc.editor.Language};ba.prototype={},ba.prototype.constructor=ba,ba.prototype._=function(a){return this.values[a]&&this.values[a][this.language]?this.values[a][this.language]:a};var ca=qc.editor.SkinManager=function(){var a=this;ga.e.on(ga.e.SKIN_CHANGE,function(b){a.skin=b.newValue})};ca.prototype={},ca.prototype.constructor=ca,ca.prototype.registerProjectIcons=function(){k.setImage("tree_folder",ga.assetPath+"tree_folder.png",16,13),k.setImage("inspector_button.9",ga.assetSkinPath+"inspector_button.9.png"),k.setImage("inspector_button_active.9",ga.assetSkinPath+"inspector_button_active.9.png"),k.setImage("textfield.9",ga.assetSkinPath+"textfield.9.png"),k.setImage("dialog.9",ga.assetSkinPath+"dialog.9.png"),k.setImage("dialog.close.9",ga.assetSkinPath+"dialog.close.9.png"),k.setImage("dialog_button.9",ga.assetSkinPath+"dialog_button.9.png"),k.setImage("dialog_button_active.9",ga.assetSkinPath+"dialog_button_active.9.png"),k.setImage("dialogClose",ga.assetSkinPath+"dialogClose.png",18,18),k.setImage("treeExpand",ga.assetSkinPath+"expand.png",13,9),k.setImage("treeCollapse",ga.assetSkinPath+"collapse.png",9,13)},ca.prototype.registerCodeEditorIcons=function(){k.setImage("inspector_button.9",ga.assetSkinPath+"inspector_button.9.png"),k.setImage("inspector_button_active.9",ga.assetSkinPath+"inspector_button_active.9.png")},ca.prototype.registerIcons=function(){k.setImage("menu.9",ga.assetSkinPath+"menu.9.png"),k.setImage("menu_active.9",ga.assetSkinPath+"menu_active.9.png"),k.setImage("contextmenu.9",ga.assetSkinPath+"contextmenu.9.png"),k.setImage("banner_background.9",ga.assetSkinPath+"banner_background.9.png"),k.setImage("banner_button.9",ga.assetSkinPath+"banner_button.9.png"),k.setImage("banner_button_active.9",ga.assetSkinPath+"banner_button_active.9.png"),k.setImage("banner_button_active_left.9",ga.assetSkinPath+"banner_button_active_left.9.png"),k.setImage("banner_button_active_right.9",ga.assetSkinPath+"banner_button_active_right.9.png"),k.setImage("banner_creator_active.9",ga.assetSkinPath+"banner_creator_active.9.png"),k.setImage("banner_pause.9",ga.assetSkinPath+"banner_pause.9.png"),k.setImage("banner_nextframe.9",ga.assetSkinPath+"banner_nextframe.9.png"),k.setImage("banner_run.9",ga.assetSkinPath+"banner_run.9.png"),k.setImage("dialog.9",ga.assetSkinPath+"dialog.9.png"),k.setImage("dialog.close.9",ga.assetSkinPath+"dialog.close.9.png"),k.setImage("dialog_button.9",ga.assetSkinPath+"dialog_button.9.png"),k.setImage("dialog_button_active.9",ga.assetSkinPath+"dialog_button_active.9.png"),k.setImage("dialogClose",ga.assetSkinPath+"dialogClose.png",18,18),k.setImage("banner_pause_active.9",ga.assetSkinPath+"banner_pause_active.9.png"),k.setImage("banner_nextframe_active.9",ga.assetSkinPath+"banner_nextframe_active.9.png"),k.setImage("banner_run_active.9",ga.assetSkinPath+"banner_run_active.9.png"),k.setImage("preview.9",ga.assetSkinPath+"preview.9.png"),k.setImage("tab.9",ga.assetSkinPath+"tab.9.png"),k.setImage("textfield.9",ga.assetSkinPath+"textfield.9.png"),k.setImage("textfield_active.9",ga.assetSkinPath+"textfield_active.9.png"),k.setImage("addcomponent_active.9",ga.assetSkinPath+"addcomponent_active.9.png"),k.setImage("inspector_button.9",ga.assetSkinPath+"inspector_button.9.png"),k.setImage("inspector_button_active.9",ga.assetSkinPath+"inspector_button_active.9.png"),k.setImage("uncheckIcon",ga.assetSkinPath+"uncheckIcon.png",15,15),k.setImage("checkIcon",ga.assetSkinPath+"checkIcon.png",15,15),k.setImage("panel_title.9",ga.assetSkinPath+"panel_title.9.png"),k.setImage("panel_title_text.9",ga.assetSkinPath+"panel_title_text.9.png"),k.setImage("treeExpand",ga.assetSkinPath+"expand.png",13,9),k.setImage("treeCollapse",ga.assetSkinPath+"collapse.png",9,13),k.setImage("objectpicker",ga.assetSkinPath+"objectpicker.png",15,15),k.setImage("project_add",ga.assetSkinPath+"project_add.png",11,11),k.setImage("project_add.9",ga.assetSkinPath+"project_add.9.png"),k.setImage("pan",ga.assetSkinPath+"pan.png",22,22),k.setImage("pan_active",ga.assetSkinPath+"pan_active.png",22,22),k.setImage("move",ga.assetSkinPath+"move.png",22,22),k.setImage("move_active",ga.assetSkinPath+"move_active.png",22,22),k.setImage("pause",ga.assetSkinPath+"pause.png",17,20),k.setImage("pause_active",ga.assetSkinPath+"pause_active.png",23,27),k.setImage("play",ga.assetSkinPath+"play.png",19,22),k.setImage("play_active",ga.assetSkinPath+"play_active.png",26,28),k.setImage("step",ga.assetSkinPath+"step.png",22,22),k.setImage("step_active",ga.assetSkinPath+"step_active.png",30,30),k.setImage("scale",ga.assetSkinPath+"scale.png",22,22),k.setImage("scale_active",ga.assetSkinPath+"scale_active.png",22,22),k.setImage("transform",ga.assetSkinPath+"transform.png",22,22),k.setImage("transform_active",ga.assetSkinPath+"transform_active.png",22,22),k.setImage("fitContent",ga.assetSkinPath+"fitContent.png",22,22),k.setImage("fitContent_active",ga.assetSkinPath+"fitContent_active.png",22,22),k.setImage("grid",ga.assetSkinPath+"grid.png",22,22),k.setImage("grid_active",ga.assetSkinPath+"grid_active.png",22,22),k.setImage("debug",ga.assetSkinPath+"debug.png",22,22),k.setImage("debug_active",ga.assetSkinPath+"debug_active.png",22,22),k.setImage("project_expand",ga.assetPath+"project_expand.png",23,24),k.setImage("project_collapse",ga.assetPath+"project_collapse.png",23,24),k.setImage("project",ga.assetSkinPath+"project.png",17,14),k.setImage("hierarchy",ga.assetSkinPath+"hierarchy.png",13,11),k.setImage("inspector",ga.assetSkinPath+"inspector.png",16,16),k.setImage("delete",ga.assetPath+"delete.png",15,15),k.setImage("refresh",ga.assetPath+"refresh.png",15,15),k.setImage("tree_link_folder",ga.assetPath+"tree_link_folder.png",16,13),k.setImage("tree_assets_folder",ga.assetPath+"tree_assets_folder.png",16,13),k.setImage("tree_atlas_folder",ga.assetPath+"tree_atlas_folder.png",16,13),k.setImage("tree_css_folder",ga.assetPath+"tree_css_folder.png",16,13),k.setImage("tree_js_folder",ga.assetPath+"tree_js_folder.png",16,13),k.setImage("tree_prefab_folder",ga.assetPath+"tree_prefab_folder.png",16,13),k.setImage("tree_raw_folder",ga.assetPath+"tree_raw_folder.png",16,13),k.setImage("tree_sprite_folder",ga.assetPath+"tree_sprite_folder.png",16,13),k.setImage("tree_audio_folder",ga.assetPath+"tree_audio_folder.png",16,13),k.setImage("tree_excel_folder",ga.assetPath+"tree_excel_folder.png",16,13),k.setImage("tree_font_folder",ga.assetPath+"tree_font_folder.png",16,13),k.setImage("tree_state_folder",ga.assetPath+"tree_state_folder.png",16,13),k.setImage("tree_folder",ga.assetPath+"tree_folder.png",16,13),k.setImage("folder",ga.assetPath+"folder.png"),k.setImage("assets_folder",ga.assetPath+"assets_folder.png"),k.setImage("atlas_folder",ga.assetPath+"atlas_folder.png"),k.setImage("audio_folder",ga.assetPath+"audio_folder.png"),k.setImage("excel_folder",ga.assetPath+"excel_folder.png"),k.setImage("font_folder",ga.assetPath+"font_folder.png"),k.setImage("state_folder",ga.assetPath+"state_folder.png"),k.setImage("css_folder",ga.assetPath+"css_folder.png"),k.setImage("js_folder",ga.assetPath+"js_folder.png"),k.setImage("prefab_folder",ga.assetPath+"prefab_folder.png"),k.setImage("raw_folder",ga.assetPath+"raw_folder.png"),k.setImage("sprite_folder",ga.assetPath+"sprite_folder.png"),k.setImage("link_folder",ga.assetPath+"link_folder.png"),k.setImage("CssIcon",ga.assetPath+"CssIcon.png"),k.setImage("JsIcon",ga.assetPath+"JsIcon.png"),k.setImage("JsonIcon",ga.assetPath+"JsonIcon.png"),k.setImage("FontIcon",ga.assetPath+"FontIcon.png"),k.setImage("SoundIcon",ga.assetPath+"SoundIcon.png"),k.setImage("StateIcon",ga.assetPath+"StateIcon.png"),k.setImage("UnknowIcon",ga.assetPath+"UnknowIcon.png"),k.setImage("alert",ga.assetPath+"alert.png",16,16),k.setImage("inspector_rectTransform",ga.assetPath+"inspector_rectTransform.png",22,22),k.setImage("inspector_button",ga.assetPath+"inspector_button.png",22,22),k.setImage("inspector_image",ga.assetPath+"inspector_image.png",22,22),k.setImage("inspector_toggle",ga.assetPath+"inspector_toggle.png",22,22),k.setImage("inspector_scrollbar",ga.assetPath+"inspector_scrollbar.png",22,22),k.setImage("inspector_scrollview",ga.assetPath+"inspector_scrollview.png",22,22),k.setImage("inspector_progressbar",ga.assetPath+"inspector_progressbar.png",22,22),k.setImage("inspector_node",ga.assetPath+"inspector_node.png",22,22),k.setImage("inspector_text",ga.assetPath+"inspector_text.png",22,22),k.setImage("inspector_sound",ga.assetPath+"inspector_sound.png",22,22),k.setImage("inspector_sprite",ga.assetPath+"inspector_sprite.png",22,22),k.setImage("inspector_slider",ga.assetPath+"inspector_slider.png",22,22),k.setImage("inspector_inputfield",ga.assetPath+"inspector_inputfield.png",22,22),k.setImage("inspector_particle",ga.assetPath+"inspector_particle.png",22,22),k.setImage("inspector_dom",ga.assetPath+"inspector_dom.png",22,22),k.setImage("inspector_tilemap",ga.assetPath+"inspector_tilemap.png",22,22),k.setImage("inspector_title_tilemap",ga.assetPath+"inspector_title_tilemap.png",15,15),k.setImage("inspector_title_tilelayer",ga.assetPath+"inspector_title_tilelayer.png",15,15)},ca.prototype.initTheme=function(){qc.widget.List.prototype._indent=16,qc.widget.Tree.prototype._indent=16,qc.editor.ItemList.prototype._indent=16,qc.widget.Menu.prototype._topGap=3,qc.widget.Menu.prototype._bottomGap=3,qc.widget.Menu.prototype._gap=15,qc.widget.Menu.prototype._labelFont="13px Arial",qc.editor.ItemList.prototype._rowHeight=18,qc.widget.List.prototype._rowHeight=18,qc.widget.List.prototype._labelFont="11px Arial",qc.widget.Tree.prototype._rowHeight=18,qc.widget.Tree.prototype._labelFont="11px Arial",qc.widget.Tree.prototype._expandIcon="treeExpand",qc.widget.Tree.prototype._collapseIcon="treeCollapse",qc.widget.ContextMenu.prototype._rowHeight=22,qc.widget.ContextMenu.prototype._labelFont="13px Arial",qc.widget.ContextMenu.prototype._padding=[5,1,5,1],qc.widget.ContextMenu.prototype._leftGap=15,qc.widget.ContextMenu.prototype._rightGap=15,qc.widget.Tabs.prototype._tabHeight=26,qc.widget.Tabs.prototype._labelFont="13px Arial",qc.editor.Dialog.prototype._contentPadding=[20,10,10,20],qc.editor.Dialog.prototype._borderWidth=0,qc.editor.Dialog.prototype._titleHeight=25,qc.editor.Dialog.prototype._buttonGap=5,qc.editor.Dialog.prototype._buttonFont="14px Arial",qc.editor.Dialog.prototype._htmlFont="16px Arial",qc.widget.TextField.prototype._padding=[1,2,1,2],qc.widget.List.prototype._activable=!0,qc.widget.List.prototype.getSelectBackground=function(){return this===ga.activeView?this._selectBackground:this._inactiveSelectBackground},qc.widget.List.prototype.getLabelColor=function(a){if(a===this.draggingData)return"#fce486";if(this.checkMode){if(this._focusData===a)return this.labelSelectColor}else if(this.isSelected(a))return this.labelSelectColor;return this.labelColor},qc.editor.ComponentsList.prototype.getSelectBackground=function(){return this._selectBackground},qc.editor.ComponentsList.prototype.getLabelColor=function(a){return this.isSelected(a)?this.labelSelectColor:this.labelColor},qc.widget.Tree.prototype._activable=!0,qc.widget.Tree.prototype.getSelectBackground=qc.widget.List.prototype.getSelectBackground,qc.widget.Tree.prototype.getLabelColor=qc.widget.List.prototype.getLabelColor,qc.widget.graph.GraphView.prototype._activable=!0,qc.widget.graph.GraphView.prototype.getLabelColor=function(a){return a===this.draggingData?"#fce486":a.s("label.visible")===!1?"rgba(0, 0, 0, 0)":this.isSelected(a)?this._labelSelectColor:this._labelColor},qc.widget.graph.GraphView.prototype.getLabelBackground=function(a){return this.isSelected(a)&&a.s("label.visible")!==!1&&"list"!==this.layout?this===ga.activeView?this._selectBackground:this._inactiveSelectBackground:null},qc.widget.graph.GraphView.prototype.getLabel2Color=function(a){return a.s("label2.visible")===!1?"rgba(0, 0, 0, 0)":this.isSelected(a)?this._labelSelectColor:this._labelColor},qc.widget.graph.GraphView.prototype.getLabel2Background=function(a){return this.isSelected(a)&&a.s("label2.visible")!==!1?this===ga.activeView?this._selectBackground:this._inactiveSelectBackground:null},qc.widget.Button.prototype.getStateIcon=function(){var a=this,b=a.state;return"active"===b?this.activeIcon||this.icon:this.icon},qc.widget.ToggleButton.prototype.getStateIcon=function(){var a=this,b=a.selected;return b?this.activeIcon||this.icon:this.icon}},ca.prototype.overrideSizeMethod=function(){qc.widget.Default.calculateClientWidth=function(a){return a.width},qc.widget.Default.calculateClientHeight=function(a){return a.height},qc.widget.TextField.prototype.calculateClientWidth=function(){return this.width},qc.widget.TextField.prototype.calculateClientHeight=function(){return this.height},qc.widget.ComboBox.prototype.calculateClientWidth=function(){return this.width-2},qc.widget.ComboBox.prototype.calculateClientHeight=function(){return this.height-2}},b.defineProperties(ca.prototype,{page:{get:function(){return this._page},set:function(a){this._page=a}},skin:{get:function(){return this._skin},set:function(a){this._skin=a;var b=this.skinMap[a+"_"+this.page];b&&b()}},skinMap:{value:{Dark_Editor:f,Light_Editor:i,Dark_Project:d,Light_Project:g,Dark_CodeEditor:e,Light_CodeEditor:h}}});var da=qc.editor.Log=function(){this.enableTrace=!0};da.prototype={},da.prototype.constructor=da,da.prototype.trace=function(){this.enableTrace&&console.log(this.toContent(arguments))},da.prototype.print=function(){console.log(this.toContent(arguments))},da.prototype.important=function(){console.log("%c"+this.toContent(arguments),"color:green")},da.prototype.error=function(){console.log(this.toContent(arguments));for(var a=1;a<arguments.length;a++)if(arguments[a]&&arguments[a].stack)return void console.error(arguments[a].stack);console.trace()},da.prototype.toContent=function(a){for(var b=a[0],c=1;c<a.length;c++){var d=new RegExp("\\{"+(c-1)+"\\}","g");b=b.replace(d,a[c])}return b};var ea=qc.editor.Event=function(){this._emitter=new qc.widget.Emitter,this.SELECT_COMPONENT="selectComponent",this.SELECT_IMAGE="selectImage",this.EDIT_MODE_CHANGE="editModeChange",this.GRID_VISIBLE_CHANGE="gridVisible",this.PLAYING_CHANGE="playingChange",this.PROPERTY_CHANGE="propertyChange",this.DATA_MODEL_CHANGE="dataModelChange",this.ACTIVE_NODE_CHANGE="activeNodeChange",this.ORIENTATION_CHANGE="orientationChange",this.SKIN_CHANGE="skinChange",this.EDITOR_HITAREA_ENABLED_CHANGE="editHitAreaEnabledChange",this.GAME_SIZE_CHANGE="gameSizeChange",this.GAME_CHANGE="gameChange",this.SCENE_LOADED="sceneLoaded",this.SCENE_INITED="sceneInited",this.HIDDEN_SCENE_INITED="hiddenSceneInited",this.HIDDEN_SCENE_LOADED="hiddenSceneLoaded",this.ACTIVE_VIEW_CHANGE="activeViewChange",this.INSPECTOR_VIEW_CLEAR="inspectorViewClear",this.EXPLORE="explore",this.BG_RESOURCE_LOADED="bgResourceLoaded",this.SCENE_RESOURCE_LOADED="sceneResourceLoaded",this.JS_CHANGED="jsChanged",this.INSPECTOR_COMP_VALUE_CHANGE="inspectorCompValueChange",this.SCENE_SAVED="sceneSaved"};ea.prototype={},ea.prototype.constructor=ea,ea.prototype.on=function(a,b,c,d){return this._emitter.on(a,b,c,d)},ea.prototype.off=function(a,b,c){return this._emitter.off(a,b,c)},ea.prototype.emit=function(a,b){return this._emitter.emit(a,b)};var fa=m("qc.editor.Global",null,function(){this.e=new qc.editor.Event,this._jsPath=this.getJsPath(),this._imgScale=1.5>l?"1x":"2x",this.assetPath=this._jsPath+"imgs/"+this._imgScale+"/",this._gamePlugin={postRender:function(){ga.inspector.update(),ga.scene.checkForUpdate()},destroy:function(){}},qc.widget.Default.onViewFocused=function(a){a._activable&&(ga.activeView=a)}});fa.prototype._windowDisabled=!1,fa.prototype.getJsPath=function(){var a=document.scripts;a=a[a.length-1].src;var b=a.substring(0,a.lastIndexOf("/")+1);return b},fa.prototype._hackpp=function(){PIXI.DisplayObjectContainer.prototype.updateTransform=function(){if(this.displayObjectUpdateTransform(),!this._cacheAsBitmap)for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform()},Phaser.Camera.prototype.reset=function(){this.target=null,ga.workable&&ga.scene.editable?(ga.scene.translateX=0,ga.scene.translateY=0):(this.view.x=0,this.view.y=0)}},fa.prototype.shutdown=function(){this.workable&&(qc.widget.Default.hideToolTip(),this.undo.reset(),a.removeEventListener("mouseup",this.game.__onMouseUpGlobal,!0),this.game.shutdown())},fa.prototype.saveEditingPrefab=function(){ga.prefabInfo&&(qc.editor.Operation.SAVE_PREFAB(ga.prefabInfo.prefab,ga.prefabInfo.treeData.id),ga.cancelEditingPrefab(!0))},fa.prototype.cancelEditingPrefab=function(a){if(ga.prefabInfo){var b=function(){var a=ga.prefabInfo.visibleMap;for(var b in a){var d=ga.dataModel.getDataById(b);d&&(d.node.visible=a[b])}var e=[];ga.game.world.children.forEach(function(b){a[b.uuid]===c&&e.push(b)}),e.forEach(function(a){a.destroyImmediately()}),r(ga.prefabInfo.saveDiv),r(ga.prefabInfo.cancelDiv),ga.runBanner.findViewById("play").disabled=!1,ga.prefabInfo=null,ga.undo.reset(),ib(),ga.scene.fitContent(!0)},d=ga.prefabInfo.json,e=JSON.stringify(ga.game.serializer.buildBundle(ga.prefabInfo.prefab,{}));d===e||a?b():nb(ga._("Do you want to save the changes?"),ga._("Confirm"),[{text:ga._("Save"),key:"enter",onClick:function(){this.hide(),qc.editor.Operation.SAVE_PREFAB(ga.prefabInfo.prefab,ga.prefabInfo.treeData.id),b()}},{text:ga._("Don't Save"),onClick:function(){this.hide(),b()}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}])}},fa.prototype.startEditingPrefab=function(a){if(a&&ga.workable){if(ga.playing)return void ga.notification.warn(ga._("It is not allowed to edit prafab in running mode."));var b=ga.game.assets.find(a.resUUID);if(!b)return void ga.notification.warn(ga._("Asset is not loaded, please try later."));if(b.meta.type===this.ASSET_TYPE.ASSET_PREFAB){if(b.hasUnloadedDependence(ga.game))return void ga.notification.warn(ga._("Asset is not loaded, please try later."));ga.prefabInfo&&ga.cancelEditingPrefab();var c=ga.game.add.clone(b),d={};ga.game.world.children.forEach(function(a){a!==c&&(d[a.uuid]=a.visible,a.visible=!1)}),ga.prefabInfo={prefab:c,asset:b,treeData:a,visibleMap:d},ga.game.world.addChild(c),ga.runBanner.findViewById("play").disabled=!0;var e=ga.prefabInfo.saveDiv=ga.scene.createDiv(),f=e.style;f.bottom="10px",f.right="70px",f.width="50px",f.cursor="pointer",f.textAlign="center",e.innerHTML="Save",e.onclick=function(){ga.saveEditingPrefab()};var g=ga.prefabInfo.cancelDiv=ga.scene.createDiv(),f=g.style;f.bottom="10px",f.right="10px",f.width="50px",f.cursor="pointer",f.textAlign="center",g.innerHTML="Cancel",g.onclick=function(){ga.cancelEditingPrefab()},ga.undo.reset(),ib(),ga.scene.focusData(ga.dataModel.getDataById(c.uuid),{finishFunc:function(){ga.prefabInfo.json=JSON.stringify(ga.game.serializer.buildBundle(c,{}))}})}}},b.defineProperties(fa.prototype,{assetSkinPath:{get:function(){return this._jsPath+"imgs/"+this._imgScale+"/"+this.skin+"/"}},activeView:{get:function(){return this._activeView},set:function(a){var b=this._activeView;b&&(b.iv(),b.invalidateSelection&&b.invalidateSelection()),this._activeView=a,a&&(a.iv(),a.invalidateSelection&&a.invalidateSelection()),this.e.emit(this.e.ACTIVE_VIEW_CHANGE,{oldValue:b,newValue:a})}},workable:{get:function(){return this.game&&this.game.phaser.world&&this.game.getWindow()}},editHitAreaEnabled:{get:function(){return this.scene.editHitAreaEnabled},set:function(a){var b=this.scene.editHitAreaEnabled;b!==a&&this.e.emit(this.e.EDITOR_HITAREA_ENABLED_CHANGE,{oldValue:b,newValue:a})}},editMode:{get:function(){return this._editMode},set:function(a){var b=this._editMode;b!==a&&(this._editMode=a,this.e.emit(this.e.EDIT_MODE_CHANGE,{oldValue:b,newValue:a}),ga.storage.set("editMode",a))}},projectPath:{get:function(){return this._projectPath},set:function(a){this._projectPath=a}},windowFocused:{get:function(){return this._windowFocused},set:function(a){this._windowFocused=a}},gridVisible:{get:function(){return this._gridVisible},set:function(a){var b=this._gridVisible;b!==a&&(this._gridVisible=a,this.e.emit(this.e.GRID_VISIBLE_CHANGE,{oldValue:b,newValue:a}),ga.storage.set("gridVisible",a))}},playing:{get:function(){return this._playing},set:function(a){var b=this._playing;if(b!==a){if(ga.prefabInfo)return void ga.notification.warn(ga._("Please first stop to edit prafab."));this._playing=a,this.e.emit(this.e.PLAYING_CHANGE,{oldValue:b,newValue:a}),this.shutdown()}}},orientation:{get:function(){return this._orientation},set:function(a){var b=this._orientation;b!==a&&(ga.windowDisabled=!0,this.shutdown(),this._orientation=a,this.e.emit(this.e.ORIENTATION_CHANGE,{oldValue:b,newValue:a}))}},windowDisabled:{get:function(){return this._windowDisabled},set:function(a){this._windowDisabled!==a&&ga.mainContainer&&(this._windowDisabled=a,a?(ga.mainContainer.setDisabled(!0,ga.assetPath+"loading.gif"),ga.mainContainer.disabledBackground="#333333",ga.mainContainer.requestFocus()):(ga.mainContainer.setDisabled(!1),ga.hierarchy.requestFocus()))}},skin:{get:function(){return this._skin},set:function(a){var b=this._skin;b!==a&&(this._skin=a,this.e.emit(this.e.SKIN_CHANGE,{oldValue:b,newValue:a}))}},gameSize:{get:function(){return this._gameSize},set:function(a){var b=this._gameSize;this._gameSize=a,this.e.emit(this.e.GAME_SIZE_CHANGE,{oldValue:b,newValue:a})}},dataModel:{get:function(){return this._dataModel},set:function(a){var b=this._dataModel;this._dataModel=a,this.e.emit(this.e.DATA_MODEL_CHANGE,{oldValue:b,newValue:a})}},game:{get:function(){return this._game},set:function(b){var c=this._game;c&&(c.plugins.remove(this._gamePlugin),a.removeEventListener("mouseup",c.__onMouseUpGlobal,!0));var d=b.getWindow();a.Phaser=d.Phaser,a.PIXI=d.PIXI;for(var e in d.qc)a.qc[e]=d.qc[e];ga.inspector._nodesMap=[[qc.UIImage,qc.editor.ImagePanel],[qc.Button,qc.editor.ButtonPanel],[qc.UIText,qc.editor.UITextPanel],[qc.Toggle,qc.editor.TogglePanel],[qc.ScrollView,qc.editor.ScrollViewPanel],[qc.ScrollBar,qc.editor.ScrollBarPanel],[qc.Sound,qc.editor.SoundPanel],[qc.ProgressBar,qc.editor.ProgressBarPanel],[qc.Slider,qc.editor.SliderPanel],[qc.Sprite,qc.editor.SpritePanel],[qc.InputField,qc.editor.InputFieldPanel],[qc.Tilemap,qc.editor.TilemapPanel],[qc.TileLayer,qc.editor.TileLayerPanel],[qc.ObjectLayer,qc.editor.ObjectLayerPanel],[qc.Dom,qc.editor.DomPanel],[qc.Graphics,qc.editor.GraphicsPanel]],this._hackpp(),this._game=b,b.canvas.tabIndex=-1,b.plugins.add(this._gamePlugin),b.__onMouseUpGlobal=b.input.mouse._onMouseUpGlobal,a.addEventListener("mouseup",b.input.mouse._onMouseUpGlobal,!0),this.gameDebugger&&this.gameDebugger.destroy(),this.gameDebugger=new qc.editor.GameDebugger(b),this.dataModel=new qc.editor.GameModel(b),this.e.emit(this.e.GAME_CHANGE,{oldValue:c,newValue:b}),d.__iframePointDown||(d.__iframePointDown=function(a){Eb(a.target)||(qc.widget.Default.closePopup(),b.canvas.focus())},d.addEventListener("mousedown",d.__iframePointDown,!0),d.addEventListener("touchstart",d.__iframePointDown,!0)),d.__iframeContextMenu||(d.__iframeContextMenu=function(a){Eb(a.target)||a.preventDefault()},d.addEventListener("contextmenu",d.__iframeContextMenu,!0)),d.__iframeKeydown||(d.__iframeKeydown=function(a){Eb(a.target)||(E(a)?a.preventDefault():P(a)&&a.preventDefault())},d.addEventListener("keydown",d.__iframeKeydown,!1))}}});var ga=a.G=new fa,ha=qc.editor.Clipboard=function(){this.data=null,this.type=""};ha.prototype={},ha.prototype.constructor=ha;var ia=function(){var b=function(a){a.preventDefault()};a.addEventListener("dragenter",b,!1),a.addEventListener("dragexit",b,!1),a.addEventListener("dragover",b,!1),a.addEventListener("drop",b,!1)};ia.prototype={},ia.prototype.constructor=ia,b.defineProperties(ia.prototype,{tip:{get:function(){if(!this._tip){this._tip=p();var a=this.tip.style;a.whiteSpace="nowrap",a.color="white",a.background="rgba(0,0,0,0.5)",a.font=k.labelFont,a.padding="6px",a.borderRadius="4px",a.position="absolute"}return this._tip}}}),ia.prototype.isDragging=function(){var a=this.tip;return a&&a.parentNode?!0:void 0},ia.prototype.showTip=function(a,b){this.tip.innerHTML=a,this.tip.parentNode!==document.body&&document.body.appendChild(this.tip);var c=C(b);this.tip.style.left=c.x+15+"px",this.tip.style.top=c.y+"px"},ia.prototype.hideTip=function(){r(this.tip)},ia.prototype.clearDropView=function(a,b){this._dropView&&(this._dropView.handleCrossDrag(a,"exit",b),this._dropView=null)},ia.prototype.crossDrag=function(a,b){var c=this._dropView,d=this._findDropView(a);c!==d?(c&&c.handleCrossDrag(a,"exit",b),d&&d.handleCrossDrag(a,"enter",b)):d&&d.handleCrossDrag(a,"over",b),this._dropView=d},ia.prototype.crossDrop=function(a,b){this._dropView&&(this._dropView.handleCrossDrag(a,"drop",b),this._dropView=null)},ia.prototype.crossCancel=function(a,b){this._dropView&&(this._dropView.handleCrossDrag(a,"cancel",b),this._dropView=null)},ia.prototype._findDropView=function(a){
for(var b=Bb(a);b&&!b._dropView;)b=b.parentNode;return b?b._dropView:null};var ja=qc.editor.Storage=function(a){this.key=a+"_editor",this.restore()};ja.prototype={},ja.prototype.constructor=ja,ja.prototype.restore=function(){var b=a.localStorage.getItem(this.key);this._data=b?JSON.parse(b):{}},ja.prototype.save=function(){var b=JSON.stringify(this._data);a.localStorage.setItem(this.key,b)},ja.prototype.set=function(a,b){this._data[a]=b,this.save()},ja.prototype.del=function(a){this._data[a]&&delete this._data[a],this.save()},ja.prototype.get=function(a){return this._data[a]};var ka=m("qc.editor.ContextMenu",qc.widget.ContextMenu,function Md(a){var b=this;Md["super"].constructor.call(b,a),b._bindingHide=function(){b.close()}});ka.prototype.registerCloseEvent=function(a){ka["super"].registerCloseEvent.call(this,a),ga.e.on(ga.e.JS_CHANGED,this._bindingHide)},ka.prototype.unregisterCloseEvent=function(a){ka["super"].unregisterCloseEvent.call(this,a),ga.e.off(ga.e.JS_CHANGED,this._bindingHide)};var la=m("qc.editor.ItemNodeUI",qc.widget.graph.NodeUI,function Nd(a,b){var c=this;Nd["super"].constructor.call(c,a,b)});la.prototype.drawBody=function(a){var b=this,c=b.data,d=b.gv,e=c._position,f=c._anchor,g=c._rotation,h=c.width,i=c.height,j=c._scale,l=j.x,m=j.y,n={x:-h*f.x,y:-i*f.y,width:h,height:i};n.x+=e.x,n.y+=e.y;var o=g||1!==l||1!==m;o&&(a.save(),k.gTranslate(a,e.x,e.y),k.gRotate(a,g),a.scale(l,m),k.gTranslate(a,-e.x,-e.y)),"list"===d.layout&&d.isSelected(c)&&(a.beginPath(),a.fillStyle=d===ga.activeView?d._selectBackground:d._inactiveSelectBackground,a.rect(0,n.y,d.viewRect.width,n.height),a.fill()),o&&a.restore(),la["super"].drawBody.call(b,a)};var ma=m("qc.editor.ItemNode",qc.widget.graph.Node,function Od(a){var b=this;Od["super"].constructor.call(b,a),b.s("select.width",0),b.s("pixel.perfect",!1),b.anchor={x:0,y:0}},{_wrapImage:{width:{func:function(a){return a._width||48}},height:{func:function(a){return a._height||48}},clip:!0,comps:{func:function(a){return a.getImageComps()}}}},{},{uiClass:{get:function(){return la}},image:{set:function(a){qc.editor.ItemNode.setSuperProperty(this,"image",a)},get:function(){return this._wrapImage}}});ma.prototype.getImageComps=function(){return[{type:"image",stretch:null,name:{func:function(a,b){var c=a._canvas;if(c)return c;var d=k.getImage(a._image);if(d&&"[object HTMLImageElement]"===d.toString()&&null!=a.a("clipX")){var e=a.width,f=a.height;"list"===b.layout&&(e=f,f=f),c=a._canvas=document.createElement("canvas"),t(c,e,f);var g,h=s(c,0,0,1),i=(a.a("clipX"),a.a("clipY"),a.a("clipWidth")),j=a.a("clipHeight");(i>e||j>f)&&(g=Math.min(e/i,f/j),i*=g,j*=g);var l=Math.round((e-i)/2),m=Math.round((f-j)/2);return h.drawImage(d,a.a("clipX"),a.a("clipY"),a.a("clipWidth"),a.a("clipHeight"),l,m,i,j),h.restore(),c}return d}},rect:{func:function(a,b){var c,d=b._indent;return"tile"===b.layout?b._itemImageRect:c=[b.getListIndent(a),1,d,b._rowHeight-2]}},shadow:{func:function(a,b){return b.isSelected(a)}},shadowOffsetX:0,shadowOffsetY:0,shadowBlur:6}]},ma.prototype._imageRelativeProperties={"a:clipX":!0,"a:clipY":!0,"a:clipWidth":!0,"a:clipHeight":!0,image:!0,width:!0,height:!0},ma.prototype.onPropertyChange=function(a){ma["super"].onPropertyChange.call(this,a);var b=this;b._imageRelativeProperties[a.property]&&(b._canvas=null)};var na=m("qc.editor.ItemList",qc.widget.graph.GraphView,function Pd(a){var b=this;Pd["super"].constructor.call(b);var c=b.dataModel;b.autoMakeVisible=!0,c.indexAdjustable=!1,b.on("viewChange",function(a){b._doLayoutFlag&&("beginValidate"===a.kind?b.doLayout():"endValidate"===a.kind&&(b.translate(0,0),b._doLayoutFlag=!1))}),b.editable=!1,c.on("dataModelChange",function(){b._doLayoutFlag=!0}),b.on("propertyChange",function(a){["width","height","itemWidth","itemHeight","layout","itemGap","visibleFunc"].indexOf(a.property)>=0&&(b._doLayoutFlag=!0),("itemWidth"===a.property||"itemHeight"===a.property)&&b.calcItemImageRect()}),b.calcItemImageRect(),k.initObject(b,a),b.movableFunc=function(){return!1}},{_layout:"tile",_itemWidth:48,_itemHeight:48,_itemGap:16},{properties:["layout","itemWidth","itemHeight","itemGap"]});na.prototype.calcItemImageRect=function(){var a=this;"tile"===a.layout&&(a._itemImageRect=[4,4,a.itemWidth-8,a.itemHeight-8])},na.prototype.adjustTranslateX=function(){return 0},na.prototype.adjustTranslateY=function(a){if(0>a){var b=this.contentRect,c=this.viewRect,d=this.itemGap;if("tile"===this.layout&&b.height+d<=c.height||"list"===this.layout&&b.height<=c.height)return 0;var e=c.height;return"tile"===this.layout&&(e-=d),-a>b.height-e?-b.height+e:a}return 0},na.prototype.setZoomImpl=function(){},na.prototype.handleScroll=function(a,b){this.translate(0,b*(k.isFirefox?40:1),!1),k.preventDefault(a),a.stopPropagation()},na.prototype.getListLabelIndent=function(){var a=this,b=a._indent;return 2*b},na.prototype.getListIndent=function(){var a=this,b=a._indent;return b},na.prototype.calcRightGap=function(){return this.itemGap},na.prototype.doLayout=function(){var a,b=this,c=b.layout,d=b.dataModel,e=[],f=b.itemWidth,g=b.itemHeight,h=b.itemGap,i=b.clientWidth;if(d.datas.forEach(function(a){b.isVisible(a)&&e.push(a)}),"list"===c){g=b._rowHeight;for(var j=0;j<e.length;j++){a=e[j];var k=b.getListLabelIndent(a);a.width=i,a.height=g,a.s("label.position",16),a.s("label.offset.x",k),a.s("label.offset.y",0),a.s("label.max",null),a.x=0,a.y=g*j}}else if("tile"===c){var l=0,m=0,n=0,o=f+h,p=g+h+16;l+=h,m+=h;for(var j=0;j<e.length;j++)a=e[j],a.width=f,a.height=g,a.s("label.position",31),a.s("label.offset.y",1),a.s("label.offset.x",0),a.s("label.max",f),a.x=l,a.y=m,(n+2)*o+b.calcRightGap()>i?(l=h,j!==e.length-1&&(m+=p),n=0):(l+=o,n++)}},b.defineProperty(na.prototype,"scrollRect",{get:function(){var a=this,b=a._viewRect,c=k.unionRect(a.contentRect,b);return c.height+=c.y,c.y=0,c}});var oa=m("qc.editor.EditorTree",qc.widget.Tree,function(a){oa["super"].constructor.call(this,a),this.editable=!0,this.dragToIndexEnabled=!0,this.clearSelectionOnBackgroundClicked=!0,this._lastClickTime=(new Date).getTime(),this.addTopPainter(this.drawDNDState),this.view._dropView=this});b.defineProperties(oa.prototype,{editable:{get:function(){return this._editable},set:function(a){this._editable=a}},topRowOrderSelection:{get:function(){var a=this.selectionModel.topSelection,b={},c=[];return a.forEach(function(a){b[a.uuid]=a}),this.validateImpl(),this.rowDatas.forEach(function(a){b[a.uuid]&&c.push(a)}),c}}}),oa.prototype._clearDragInfo=function(){ga.dragAndDrop.hideTip(),this._dragInfo&&(this._dragInfo=null,this.iv())},oa.prototype._endDrag=function(){},oa.prototype._endCrossDrag=function(){},oa.prototype.drawDNDState=function(a){var b;if(this._dragInfo&&this._dragInfo.inView?b=this._dragInfo:this._crossDragInfo&&(b=this._crossDragInfo),b){var c=this.clientWidth,d=this.rowHeight,e=b.rowIndex,f=b.type;a.beginPath(),a.rect(0,e*d,c,d),a.fillStyle="rgba(0, 0, 0, 0.3)",a.fill(),"up"===f?(a.beginPath(),a.moveTo(0,e*d),a.lineTo(c,e*d)):"down"===f?(a.beginPath(),a.moveTo(0,(e+1)*d),a.lineTo(c,(e+1)*d)):"parent"===f&&(a.beginPath(),k.drawShape(a,"roundRect",{x:1,y:e*d,width:c-2,height:d})),a.lineWidth=2,a.strokeStyle="#507aea",a.stroke()}},oa.prototype._dragging=function(a,b){var c=this.rowHeight,d=this.lp(a),e=d.y/c,f=Math.floor(e);if(f>this.rowDatas.length-1)b.rowIndex=this.rowDatas.length-1,b.type="down";else{b.rowIndex=f;var g=d.y-f*c;b.type=.25*c>g?"up":g>.75*c?"down":"parent"}this.dragToIndexEnabled||(b.type="parent"),this.autoScroll(a),this.iv()},oa.prototype.handleDragAndDrop=function(a,b){if("prepare"===b)return void this._clearDragInfo();if("begin"===b){var c=this.draggingData.name;if(this.isSelected(this.draggingData)){var d=this.selection.length;c+=d>1?" (+"+d+") ":""}this._dragInfo={tip:c,view:this}}var e=this._dragInfo;if(e){if("begin"===b||"between"===b){var f=this.view.contains(Bb(a));return f?(e.inView=!0,this._dragging(a,e),ga.dragAndDrop.clearDropView(a,e)):(e.inView&&this.iv(),e.inView=!1,ga.dragAndDrop.crossDrag(a,e)),void ga.dragAndDrop.showTip(e.tip,a)}return"end"===b?(e.inView?this._endDrag(a,e):ga.dragAndDrop.crossDrop(a,e),void this._clearDragInfo()):"cancel"===b?(e.inView||ga.dragAndDrop.crossCancel(a,e),void this._clearDragInfo()):void 0}},oa.prototype.handleCrossDrag=function(a,b,c){return"exit"===b||"cancel"===b?(this._crossDragInfo=null,void this.iv()):"enter"===b||"over"===b?(this._crossDragInfo||(this._crossDragInfo={}),void this._dragging(a,this._crossDragInfo)):"drop"===b?(this._endCrossDrag(a,c),this._crossDragInfo=null,void this.iv()):void 0},oa.prototype.handleDataDoubleSelect=function(a,b){var c=this;if(c.editable){if(c._pendingEditing)return void(c._pendingEditing="cancel");if(!L(a)){var d=c.getLevel(b);d++,c.getIcon(b)&&d++,c.lp(a).x>d*c.indent&&(c._pendingEditing=!0,setTimeout(function(){c._pendingEditing&&(!k.popup&&"cancel"!==c._pendingEditing&&c.isSelected(b)&&c===ga.activeView&&c.beginEditing(b),delete c._pendingEditing)},700))}}},oa.prototype.beginEditing=function(a){var b=this,c=b.getLevel(a);c++,b.getIcon(a)&&c++;var d=c*b.indent+1,e=b.rowHeight,f=b.getRowIndex(a)*e+this.translateY,g=b.width-d,h=new qc.widget.TextField,i=h.getInput(),j=a.name;b===ga.fileTree&&(h.maskRe=/[^\s\\/'"?\.]/),b._currentEditor=h,b.view.appendChild(h.view),n(h,d,f,g,e),i.style.font=this.getLabelFont(a),i.onblur=function(){b.endEditing()},i.onkeydown=function(a){G(a)?b.endEditing():F(a)&&b.cancelEditing()},h._data=a,h.value=null==j?"":j,i.focus(),U(i.select,i)},oa.prototype.rename=function(a,b){a.name=b},oa.prototype.endEditing=function(){var a=this._currentEditor;a&&(this.rename(a._data,a.value),delete this._currentEditor,r(a.view),this.iv())},oa.prototype.cancelEditing=function(){var a=this._currentEditor;a&&(delete this._currentEditor,r(a.view),this.iv())};var pa=m("qc.editor.DraggableButtonInteractor",b,function(a){var b=this;b._draggableButton=a,b.addListeners()},{clear:function(a){var b=this,c=b.view;"dnd"!==b._state||b._dragCancel||c.handleDragAndDrop(a,"end"),b._state=b._clientPoint=b._dragCancel=null},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){var b=this,c=b.view;b.clear(a),Y(a),c.requestFocus(),b._clientPoint=B(a),N(a)&&(c.handleDragAndDrop&&c.handleDragAndDrop(a,"prepare"),c.state="active",z(b,a))},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){var b=this,c=b.view,d=b._state,e=b._clientPoint,f=B(a);if(d)"dnd"!==d||b._dragCancel||c.handleDragAndDrop(a,"between");else{var g=y(f,e);if(2>g)return;this._dragCancel||(b._state="dnd",c.handleDragAndDrop(a,"begin"))}},handle_mouseenter:function(){var a=this._draggableButton;k.isDragging()||(a.state="hover")},handle_mouseleave:function(){var a=this._draggableButton;a.state="normal"},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(a){var b=this,c=b._draggableButton;c.state=c.view.contains(a.target)?"hover":"normal",c.view.contains(a.target)&&!c._dragInfo&&(c.validate(),c.emit("click",a)),b.clear(a)},handle_keydown:function(a){var b=this,c=b.view;F(a)&&("dnd"!==b._state||b._dragCancel||(c.handleDragAndDrop(a,"cancel"),b._dragCancel=!0))}},{interactor:!0},{view:{get:function(){return this._draggableButton}}}),qa=m("qc.editor.DraggableButton",qc.widget.Button,function(a){var b=this;qc.widget.Button["super"].constructor.call(b,a),b._interactor=new pa(b)});qa.prototype.handleDragAndDrop=function(a,b){if("prepare"===b)return void this._clearDragInfo();"begin"===b&&(this._dragInfo={view:this,tip:this.id.replace("Create","")});var c=this._dragInfo;if(c)return"begin"===b||"between"===b?(ga.dragAndDrop.crossDrag(a,c),void ga.dragAndDrop.showTip(c.tip,a)):"end"===b?(ga.dragAndDrop.crossDrop(a,c),void this._clearDragInfo()):"cancel"===b?(ga.dragAndDrop.crossCancel(a,c),void this._clearDragInfo()):void 0},qa.prototype._clearDragInfo=function(){ga.dragAndDrop.hideTip(),this._dragInfo=null};var ra=(m("qc.editor.Button",qc.widget.Button,function Qd(a){var b=this;Qd["super"].constructor.call(b,a)}),m("qc.editor.InspectorButton",qc.editor.Button,function Rd(a){var b=this;Rd["super"].constructor.call(b,a)}),m("qc.editor.ToggleButton",qc.widget.ToggleButton,function Sd(){var a=this;Sd["super"].constructor.call(a),a.on("propertyChange",function(b){"selected"===b.property&&a.onValueChanged&&a.onValueChanged(a.formattedValue)})}));ra.prototype.formatValue=function(){return!!this.selected},b.defineProperties(ra.prototype,{formattedValue:{get:function(){return this.formatValue()}},onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}}});var sa=m("qc.editor.ButtonGroup",qc.widget.ButtonGroup,function Td(a){var b=this;Td["super"].constructor.call(b,a),b.scrollBarMode="off",b.on("propertyChange",function(a){"value"===a.property&&b.onValueChanged&&b.onValueChanged(b.formattedValue)}),b.eachable=!1});sa.prototype.formatValue=function(a){return a},b.defineProperties(sa.prototype,{onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},formattedValue:{get:function(){return this.formatValue(this.value)}}});var ta=m("qc.editor.CheckBox",qc.widget.CheckBox,function Ud(){var a=this;Ud["super"].constructor.call(a),a.on("propertyChange",function(b){"selected"===b.property&&a.onValueChanged&&a.onValueChanged(a.formattedValue)}),a.align="left"});ta.prototype.formatValue=function(){return!!this.selected},b.defineProperties(ta.prototype,{formattedValue:{get:function(){return this.formatValue()}},onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}}});var ua=m("qc.editor.ColorChooserDropDown",qc.widget.ColorChooserDropDown,function(a){ua["super"].constructor.call(this,a)});ua.prototype.createDialog=function(){var a=new qc.editor.Dialog;return a};var va=m("qc.editor.ColorPicker",qc.widget.ComboBox,function Vd(a){var b=this;a||(a={}),null==a["dropDown.colorChooser.alphaEnabled"]&&(a["dropDown.colorChooser.alphaEnabled"]=!0),Vd["super"].constructor.call(b,a),b.dropDown="qc.editor.ColorChooserDropDown",b._bindingClose=b.close.bind(b),b.on("propertyChange",function(a){"value"===a.property&&b.onValueChanged&&b.onValueChanged(b.formattedValue)})});va.prototype._instant=!0,va.prototype.registerCloseEvent=function(a){var b=this;va["super"].registerCloseEvent.call(b,a),ga.e.on(ga.e.JS_CHANGED,b._bindingClose)},va.prototype.unregisterCloseEvent=function(a){var b=this;va["super"].unregisterCloseEvent.call(b,a),ga.e.off(ga.e.JS_CHANGED,b._bindingClose)},va.prototype.hasFocus=function(){var a=document.activeElement,b=this.view;return b.contains(a)?!0:this.isOpen()?!0:void 0},va.prototype.formatValue=function(a){return a?new qc.Color([a.r,a.g,a.b,a.a/255]):void 0},b.defineProperties(va.prototype,{onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},formattedValue:{get:function(){return this.formatValue(this.value)}},value:{set:function(a){a instanceof qc.Color&&(a=a||new qc.Color(16777215),a=a.toNumber(!0)),"number"==typeof a&&this._componentConfig["colorChooser.alphaEnabled"]===!1&&(a=4278190080|a),va.setSuperProperty(this,"value",a)},get:function(){return va.getSuperProperty(this,"value")}}});var wa=m("qc.editor.DropDownList",qc.widget.DropDownList,function Wd(a){var b=this;Wd["super"].constructor.call(b,a),b._bindingHandleExpand=b.handleExpand.bind(b),b._bindingHandleCollapse=b.handleCollapse.bind(b),b._bindingHandleListKeyPress=b.handleListKeyPress.bind(b),b._bindingHandleListKeyDown=b.handleListKeyDown.bind(b),b._bindingListFilterPainter=b.listFilterPainter.bind(b),b._bindingCollapse=b.collapse.bind(b),b.on("expand",b._bindingHandleExpand),b.on("collapse",b._bindingHandleCollapse),b.on("propertyChange",function(a){"value"===a.property&&b.onValueChanged&&b.onValueChanged(b.formattedValue)})});wa.prototype.hasFocus=function(){var a=document.activeElement,b=this.view;return b.contains(a)?!0:this.isExpanded()?!0:void 0},wa.prototype.registerCloseEvent=function(a){var b=this;wa["super"].registerCloseEvent.call(b,a),ga.e.on(ga.e.JS_CHANGED,b._bindingCollapse)},wa.prototype.unregisterCloseEvent=function(a){var b=this;wa["super"].unregisterCloseEvent.call(b,a),ga.e.off(ga.e.JS_CHANGED,b._bindingCollapse)},wa.prototype.handleExpand=function(a){var b=this,c=a.list;c.addEventListener("keypress",b._bindingHandleListKeyPress),c.addEventListener("keydown",b._bindingHandleListKeyDown),c.addTopPainter(b._bindingListFilterPainter),b._filterStr=""},wa.prototype.handleCollapse=function(a){var b=this,c=a.list;c.removeEventListener("keypress",b._bindingHandleListKeyPress),c.removeEventListener("keydown",b._bindingHandleListKeyDown),c.removeTopPainter(b._bindingListFilterPainter),b._filterStr=""},wa.prototype.handleListKeyDown=function(a){var b=this,c=b._list,d=b._filterStr||"";k.isDelete(a)?d=d.substr(0,d.length-1):k.isEsc(a)&&(""===d?b.collapse():d=""),b._filterStr=d,c.visibleFunc=function(a){return a.name.toLowerCase().indexOf(d.toLowerCase())>=0},a.stopPropagation(),k.preventDefault(a)},wa.prototype.handleListKeyPress=function(a){var b=this,c=b._list,d=b._filterStr||"";d+=String.fromCharCode(a.charCode),b._filterStr=d,c.visibleFunc=function(a){return a.name.toLowerCase().indexOf(d.toLowerCase())>=0},a.stopPropagation(),k.preventDefault(a)},wa.prototype.listFilterPainter=function(a){var b=this,c=b._list,d=c.translateY,e=b._filterStr;if(e){e="S: "+e;var f=k.getTextSize(k.labelFont,e),g=c.clientWidth;a.beginPath(),a.rect(g-f.width,-d,f.width,c.rowHeight),a.fillStyle=b._dropDownBackground,a.fill(),k.drawText(a,e,k.labelFont,b._filterColor,g-f.width,-d,f.width,c.rowHeight,"right","top")}},wa.prototype.formatValue=function(a){return a},b.defineProperties(wa.prototype,{onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},formattedValue:{get:function(){return this.formatValue(this.value)}}});var xa=m("qc.editor.MultiDropDownList",qc.editor.DropDownList,function Xd(a){var b=this;Xd["super"].constructor.call(b,a),b.selectionMode="multiple"});xa.prototype.getLabel=function(a){if(k.isArray(a)){var b="";if(a.length<4)for(var c=0;c<a.length;c++){var d=a[c],e=this._labelMap[d];b+=c===a.length-1?e:e+","}else b="Mixed...";return b}return""},xa.prototype._setValue=function(a){var b=this;if("Nothing"===a)b.value=[];else if("Everything"===a){var c=b.items;a=[];for(var d=2;d<c.length;d++){var e=c[d];e&&a.push(k.isString(e)?e:e.value)}b.value=a}else xa["super"]._setValue.call(this,a)},b.defineProperties(xa.prototype,{items:{set:function(a){a||(a=[]);var b=a[0];k.isString(b)?(k.addArray(a,"Everything",0),k.addArray(a,"Nothing",0)):(k.addArray(a,{label:"Everything",value:"Everything"},0),k.addArray(a,{label:"Nothing",value:"Nothing"},0)),xa.setSuperProperty(this,"items",a)},get:function(){return xa.getSuperProperty(this,"items")}}});var ya=m(null,b,function(a){var b=this;b._text=a,b.addListeners()},{clear:function(){},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){Y(a)},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(){},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(){},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(){}},{interactor:!0},{view:{get:function(){return this._text}}}),za=m("qc.editor.Text",b,function(a){var b=this,c=b._view=k.createDiv();c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("user-select","none",null),c.style.whiteSpace="nowrap",c.style.overflow="hidden",b.cursor="default",new ya(b),k.initObject(b,a)},{_preferredSizeProperties:["text","padding","textFont"],_padding:[0,0,0,0],_align:"left",_textColor:k.Color.labelColor,_textFont:k.labelFont},{view:!0,emitter:!0,toolTip:!0,properties:["text","align","textColor","textFont","background","padding"]});b.defineProperty(za.prototype,"cursor",{get:function(){return this._view.style.cursor},set:function(a){this._view.style.cursor=a}}),b.defineProperty(za.prototype,"textSize",{get:function(){var a=this,b=a.text;return b?k.getTextSize(a.textFont,b):{width:0,height:0}}}),b.defineProperty(za.prototype,"toolTip",{get:function(){return this._toolTip},set:function(a){this.setPropertyValue("toolTip",a),a?this.enableToolTip():this.disableToolTip()}}),za.prototype.addEventListener=function(a,b,c){this._view.addEventListener(a,b,c)},za.prototype.removeEventListener=function(a,b,c){this._view.removeEventListener(a,b,c)},za.prototype.onPropertyChange=function(a){var b=this,c=a.property;("text"===c||"textFont"===c)&&(b._textSize=b.textSize),b.checkChildPreferredSizeChange(c),b.iv()},za.prototype.getToolTipAt=function(){return this.toolTip},za.prototype.getPreferredSize=function(){var a=this,b=a._preferredSize||a._calcdPreferredSize;if(!b){var c=a._textSize||a.textSize,d=a.padding;c={width:c.width,height:c.height},k.isArray(d)?(c.width+=d[1]+d[3],c.height+=d[0]+d[2]):(c.width+=2*d,c.height+=2*d),c.width=Math.round(c.width),c.height=Math.round(c.height),b=a._calcdPreferredSize=c}return b},za.prototype.validateImpl=function(){var a=this,b=a._view,c=a.background,d=a.text,e=a.textColor,f=a.textFont,g=a.padding,h=a.align;b.innerHTML=d||"",null!=e&&(b.style.color=e),null!=f&&(b.style.font=f),null!=h&&(b.style.textAlign=h),null!=c&&(b.style.background=c),null!=g&&(b.style.padding=k.isArray(g)?g[0]+"px "+g[1]+"px "+g[2]+"px "+g[3]+"px":g+"px"),b.style.lineHeight=a.height+"px"};var Aa=m("qc.editor.Label",qc.widget.Label,function Yd(a){var b=this;Yd["super"].constructor.call(b,a),b.align="left"});b.defineProperties(Aa.prototype,{style:{get:function(){return this.view.style}}});var Ba=m("qc.editor.StringInput",qc.widget.TextField,function Zd(a){var b=this;b._autoSelect=!0,Zd["super"].constructor.call(b,a),b.on("propertyChange",function(a){"value"===a.property&&b.onValueChanged&&b.onValueChanged(b.formattedValue)});var c=b.getInput();c.addEventListener("mousedown",function(){b.autoSelect&&!c.contains(document.activeElement)&&setTimeout(function(){c.select()},30)})});Ba.prototype.formatValue=function(a){return a},b.defineProperties(Ba.prototype,{onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},formattedValue:{get:function(){return this.formatValue(this.value)}},autoSelect:{get:function(){return this._autoSelect},set:function(a){this.setPropertyValue("autoSelect",a)}}});var Ca=m("qc.editor.ObjectSelectPane",qc.widget.Container,function $d(a){var b=this;$d["super"].constructor.call(b,a);var c=b.layout=new qc.widget.layout.BorderLayout(b),d=b._searchInput=new qc.editor.StringInput,e=new qc.widget.Container,f=b._assetsList=new qc.editor.ItemList,g=b._descLabel=new qc.widget.Label({align:"left"}),h=b._slider=new qc.widget.Slider;d.input.style.backgroundImage='url("'+ga.assetPath+'magnifying-glass.png")',d.input.style.backgroundRepeat="no-repeat",d.input.style.backgroundSize="17px 17px",d.input.style.backgroundPosition="2px 50%",d.padding=[2,0,2,22],d.onValueChanged=b.filterList.bind(b),c.splitterSize=0,e.layout=new qc.widget.layout.BorderLayout(e),e.layout.splitterSize=0,e.scrollBarMode="off",e.setItems([{region:"center",element:g},{region:"right",element:h,width:70}]),b.setItems([{region:"center",element:f},{region:"top",height:22,element:d},{region:"bottom",element:e,height:22}]),b._initSlider(),b._initList(),f.selectionModel.on("selectionChange",function(){var a=f.selection[0];b._descLabel.text=a?a.a("url")||"":""})});Ca.prototype._initList=function(){var a=this,b=a._assetsList,c=a.objectType;b.onDataDoubleClick=a.onAssetNodeDoubleClick.bind(a);var d=new ma({name:"None",image:null,isNoneNode:!0});if(b.dataModel.add(d),"node"===c)return void ga.project.exploreTree(function(a){var c=new ma;c.image="UnknowIcon",c.name=a.name,c.a("asset",a);for(var d,e=a,f=e.name;(d=e.parent)&&d!==ga.game.world;)f=d.name+"/"+f,e=d;c.a("url",f),b.dataModel.add(c)});var e,f;switch(c){case"bitmapFont":e=ga.ASSET_TYPE.ASSET_FONT;break;case"font":e=ga.ASSET_TYPE.ASSET_WEBFONT,f="FontIcon";break;case"allFont":e=[ga.ASSET_TYPE.ASSET_FONT,ga.ASSET_TYPE.ASSET_WEBFONT],f="FontIcon";break;case"sound":e=ga.ASSET_TYPE.ASSET_SOUND,f="SoundIcon";break;case"textAsset":e=ga.ASSET_TYPE.ASSET_TEXT,f="FontIcon";break;case"js":e=ga.ASSET_TYPE.ASSET_JS,f="JsIcon";break;case"prefab":e=ga.ASSET_TYPE.ASSET_PREFAB,f="UnknowIcon";break;case"excelAsset":e=ga.ASSET_TYPE.ASSET_EXCEL;break;default:e=ga.ASSET_TYPE.ASSET_ATLAS;var g=new ma,h=ga.game.assets.find("__builtin_resource__");g.image=h.img,g.name="builtin",g.a("asset",h.uuid),g.a("url","builtin resource"),b.dataModel.add(g)}var i;if(k.isArray(e)?(i=[],e.forEach(function(a){i=i.concat(ga.project.findByType(a))})):i=ga.project.findByType(e),i&&i.length)for(var j=0,l=i.length;l>j;j++){var h=i[j],g=new ma;f?g.image=f:(e===ga.ASSET_TYPE.ASSET_ATLAS||e===ga.ASSET_TYPE.ASSET_FONT)&&(g.image=ga.project.getImageURLByAtlas(h)),g.name=sb(h.url),g.a("asset",h.uuid),g.a("url",h.url),b.dataModel.add(g)}},Ca.prototype.onAssetNodeDoubleClick=function(a){this.onSelectAssetNode(a)},Ca.prototype.filterList=function(){var a=this,b=a._searchInput,c=a._assetsList,d=b.value;c.visibleFunc=d?function(a){return a.name&&a.name.indexOf(d)>=0?!0:void 0}:null},Ca.prototype._initSlider=function(){var a=this,b=a._slider,c=a._assetsList;b.value=32,b.disableToolTip(),b.onValueChange=function(a){16>=a?1===a?c.layout="list":b.value=1:(c.layout="tile",c.itemWidth=c.itemHeight=40+(.5*a-8))}},b.defineProperties(Ca.prototype,{objectType:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}}});var Da=m("qc.editor.ObjectInput",qc.widget.Container,function _d(a){var b=this;_d["super"].constructor.call(b,a);var c=b.layout=new qc.widget.layout.BorderLayout(b),d=b._objectInput=new qc.editor.StringInput,e=b._picker=new qc.widget.Label({icon:"objectpicker"});c.splitterSize=0,b.setItems([{region:"center",element:d},{region:"right",width:20,element:e}]),a&&null!=a.autoSelect||(b._autoSelect=!1),d.view._dropView=d;var f=d.getInput();f.addEventListener("keydown",function(a){a.preventDefault()}),f.style.cursor="default",d.addEventListener("click",function(){var a=b.associatedViewAndData;zb(a)}),b._bindingHandleDocumentMousedown=b.handleDocumentMousedown.bind(b),e.addEventListener("click",b.handlePickerClick.bind(b)),b.eachable=!1});Da.prototype.hasFocus=function(){var a=document.activeElement,b=this.view;return b.contains(a)?!0:this._dialog?!0:void 0},Da.prototype.resetNinePatchImage=function(){this._objectInput.ninePatchImage="textfield.9",this._objectInput.ninePatchBorder=[8,8,8,8]},Da.prototype.handlePickerClick=function(){var a=this,b=a._dialog;if(!b){b=a._dialog=new qc.editor.Dialog,b.on("close",function(){a.removeDialog()}),b.title=ga._("Select Object");var c=new Ca({objectType:a.objectType});c.onSelectAssetNode=function(c){b.hide();var d=a.objectType;if("prefab"===d||"texture"===d||"allFont"===d||"sound"===d||"font"===d||"textAsset"===d||"node"===d||"bitmapFont"===d||"excelAsset"===d)if(c.isNoneNode)"texture"===a.objectType?a.setTextureObjectValue(null,null,!0):"font"!==d&&"bitmapFont"!==d&&"allFont"!==d&&a.setObjectValue(null,!0);else if("node"===d){var e=c.a("asset");if(!(e instanceof qc.Node))return;a.setObjectValue(e,!0)}else{var f=ga.game.assets.findByUUID(c.a("asset")),g=function(b){"texture"===d?a.setTextureObjectValue(b,null,!0):a.setObjectValue(b,!0)};f?g(f):ga.game.assets.load(c.a("asset"),c.a("url"),function(a){g(a)})}},b.content=c,b.contentPadding=2;var d=Cb(700,500);b.width=d.width,b.height=d.height}b.isInDOM()?b.hide():(b.show(),c._searchInput.input.focus(),document.addEventListener("mousedown",a._bindingHandleDocumentMousedown))},Da.prototype.setTextureObjectValue=function(a,b,c){var d,e,f=this,g=f._objectInput,h=f.target,i=f.targetField,j=f.arrIndex,k=!1;if(i.indexOf("/")>0&&(d=i.substring(i.indexOf("/")+1),i=i.substring(0,i.indexOf("/"))),null!=j)e=h[i]||[],k=e[j]==a,e[j]=a;else{e=a;var l=h[i];if(d){var m=h[d];l==e&&(null==m&&null==b||m===b)&&(k=!0)}else l===e&&(k=!0)}c&&!k&&(h[i]=e,d&&(h[d]=b));var n;n=a?a.url:"Empty(Atlas)",g.value=n,f.initAssociatedViewAndData(n),k||f.handleValueChange(n)},Da.prototype.setObjectValue=function(a,b){var c,d=this,e=d.objectType,f=d._objectInput,g=d.target,h=d.targetField,i=d.arrIndex,j=!1;if(null!=i)c=g[h]||[],j=c[i]==a,c[i]=a;else{c=a;var l=g[h];l===c&&(j=!0)}if("font"===e){b&&!j&&(g[h]=c);var m;m=a?a.url:"Empty(Font)",f.value=m,d.initAssociatedViewAndData(m),j||d.handleValueChange(m)}if("bitmapFont"===e){b&&!j&&(g[h]=c);var m;m=a?a.url:"Empty(BitmapFont)",f.value=m,d.initAssociatedViewAndData(m),j||d.handleValueChange(m)}else if("allFont"===e){b&&!j&&(g[h]=c);var m;m=a?a.url:"Empty(Font)",f.value=m,d.initAssociatedViewAndData(m),j||d.handleValueChange(m)}else if("sound"===e){b&&!j&&(g[h]=c);var m;m=a?a.url:"Empty(Sound)",f.value=m,"Empty(Sound)"===m?d.initAssociatedViewAndData(m):m&&d.initAssociatedViewAndData(m.lastIndexOf(".bin")===m.length-4?m:m+".bin"),j||d.handleValueChange(m)}else if("textAsset"===e){b&&!j&&(g[h]=c);var m;m=a?a.url:"Empty(TextAsset)",f.value=m,d.initAssociatedViewAndData(m),j||d.handleValueChange(m)}else if("excelAsset"===e){b&&!j&&(g[h]=c);var m;m=a?a.url:"Empty(ExcelAsset)",f.value=m,d.initAssociatedViewAndData(m),j||d.handleValueChange(m)}else if("prefab"===e){b&&!j&&(g[h]=c);var m;m=a?k.isString(a)?a:a.url:"Empty(Prefab)",f.value=m,d.initAssociatedViewAndData(m),j||d.handleValueChange(m)}else if("node"===e){b&&!j&&(g[h]=c);var n;n=a?a.name:"Empty(Node)",f.value=n,d.initAssociatedViewAndData(a),j||d.handleValueChange(n)}},Da.prototype.initAssociatedViewAndData=function(a){var b=this,c=b.objectType,d=b.target;if("texture"===c)if(a&&"__builtin_resource__"!==a&&"Empty(Atlas)"!==a){var e,f=b.targetField;f.indexOf("/")>0?(e=f.substring(f.indexOf("/")+1),b.associatedViewAndData={fileTree:a.substring(0,a.lastIndexOf("/")),fileList:[a,d[e]]}):b.associatedViewAndData={fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}}else b.associatedViewAndData=null;else"font"===c?b.associatedViewAndData=a&&"Empty(Font)"!==a?{fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}:null:"bitmapFont"===c?b.associatedViewAndData=a&&"Empty(BitmapFont)"!==a?{fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}:null:"allFont"===c?b.associatedViewAndData=a&&"Empty(Font)"!==a?{fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}:null:"sound"===c?b.associatedViewAndData=a&&"Empty(Sound)"!==a?{fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}:null:"textAsset"===c?b.associatedViewAndData=a&&"Empty(TextAsset)"!==a?{fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}:null:"excelAsset"===c?a&&"Empty(ExcelAsset)"!==a&&(b.associatedViewAndData={fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}):"node"===c?b.associatedViewAndData=a?{hierarchy:a.uuid}:null:"prefab"===c&&(b.associatedViewAndData=a&&"Empty(Prefab)"!==a?{fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a}:null)},Da.prototype.handleDocumentMousedown=function(a){var b=this,c=b._dialog,d=a.target;c.view.contains(d)||b._picker.view.contains(d)||c.hide()},Da.prototype.removeDialog=function(){delete this._dialog,document.removeEventListener("mousedown",this._bindingHandleDocumentMousedown)},Da.prototype.handleValueChange=function(a){var b=this;b.onValueChanged&&b.onValueChanged(a);var c={property:"value",oldValue:null,newValue:a,source:b};b.emit("propertyChange",c)},b.defineProperties(Da.prototype,{objectInput:{get:function(){return this._objectInput}},arrIndex:{get:function(){return this._arrIndex},set:function(a){this.setPropertyValue("arrIndex",a)}},target:{get:function(){return this._target},set:function(a){this.setPropertyValue("target",a)}},targetField:{get:function(){return this._targetField},set:function(a){this.setPropertyValue("targetField",a)}},value:{get:function(){return this._objectInput.value},set:function(a){this._objectInput.value=a;

}},formattedValue:{get:function(){return this.value}},objectType:{get:function(){return this._objectType},set:function(a){this.setPropertyValue("objectType",a)}},onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},associatedViewAndData:{get:function(){return this._associatedViewAndData},set:function(a){this.setPropertyValue("associatedViewAndData",a)}}});var Ea=m("qc.editor.NumberInput",qc.editor.StringInput,function ae(a){var b=this;ae["super"].constructor.call(b,a),b.maskRe=/[\-\d\.]/;var c=b.input;c.addEventListener("change",function(){b.value=b.finalValue})});Ea.prototype.formatValue=function(a){var b=this.precision;return parseFloat(null==b?a:parseFloat(a).toFixed(b))},Ea.prototype.epc=function(a,b,c){var d=this,e=d.min,f=d.max,g=!0;if("value"===a&&(null!=e||null!=f)){var h=this.formatValue(c);isNaN(h)||(null!=e&&e>h&&(g=!1),null!=f&&h>f&&(g=!1))}g&&Ea["super"].epc.call(d,a,b,c)},Ea.prototype._precision=3,b.defineProperties(Ea.prototype,{finalValue:{get:function(){var a=this,b=a.formatValue(a.input.value),c=a.min,d=a.max;return isNaN(b)||(null!=c&&c>b&&(b=c),null!=d&&b>d&&(b=d)),b}},max:{get:function(){return this._max},set:function(a){this.setPropertyValue("max",a)}},min:{get:function(){return this._min},set:function(a){this.setPropertyValue("min",a)}},precision:{get:function(){return this._precision},set:function(a){this.setPropertyValue("precision",a)}},value:{get:function(){return this._value},set:function(a){var b=this;if(b.input!==document.activeElement){a=b.formatValue(a);var c=b.min,d=b.max;isNaN(a)||(null!=c&&c>a&&(a=c),null!=d&&a>d&&(a=d))}b.setPropertyValue("value",a)}}});var Fa=m("qc.editor.IntInput",qc.editor.NumberInput,function be(a){var b=this;be["super"].constructor.call(b,a)});Fa.prototype._precision=0,Fa.prototype._maskRe=/[\-\d]/;var Ga=m("qc.editor.AngleInput",qc.editor.NumberInput,function ce(a){var b=this;ce["super"].constructor.call(b,a)});Ga.prototype.toGameValue=function(){var a=this,b=a.formattedValue;return b/180*Math.PI},Ga.prototype.toCompValue=function(a){return a/Math.PI*180};var Ha=m("qc.editor.SliderInput",qc.widget.Container,function de(a){var b=this;de["super"].constructor.call(b),a&&(b.bind=a.bind,delete a.bind),b.scrollBarMode="off",b.eachable=!1;var c=b.layout=new qc.widget.layout.BorderLayout(b),d=b._slider=new qc.widget.Slider(a),e=b._input=new qc.editor.NumberInput;e.value=d.value,c.bottomViewExpanded=!1,c.splitterSize=0,d.disableToolTip(),null==d.min&&(d.min=0),b.setItems([{region:"center",element:d},{region:"right",width:50,element:e}]),e.input.addEventListener("blur",function(){e._updating||(e.value=d.value)}),d.on("propertyChange",function(a){var c=a.property;d._updating=!0,"value"===c&&(b.epc("value",a.oldValue,a.newValue),b.onValueChanged&&b.onValueChanged(b.value),e._updating||(e.value=a.newValue)),d._updating=!1}),e.on("propertyChange",function(a){var b=a.property;e._updating=!0;var c=parseFloat(a.newValue);"value"!==b||d._updating||isNaN(c)||(d.value=c),e._updating=!1})});b.defineProperties(Ha.prototype,{min:{get:function(){return this._slider.min},set:function(a){this._slider.min=a}},max:{get:function(){return this._slider.max},set:function(a){this._slider.max=a}},step:{get:function(){return this._slider.step},set:function(a){this._slider.step=a}},value:{get:function(){return this._slider.value},set:function(a){this._slider.value=a}},formattedValue:{get:function(){return this.value}},onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}}});var Ia=m("qc.editor.TextArea",qc.widget.TextArea,function ee(a){var b=this;ee["super"].constructor.call(b,a),b.on("propertyChange",function(a){"value"===a.property&&b.onValueChanged&&b.onValueChanged(b.value)}),b.padding=[1,0,1,0];var c=b.getInput();c.addEventListener("focus",function(){c.select()})});Ia.prototype.formatValue=function(a){return a},b.defineProperties(Ia.prototype,{onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},formattedValue:{get:function(){return this.formatValue(this.value)}}});var Ja=m("qc.editor.TextAreaContainer",qc.widget.Container,function fe(a){var b=this;fe["super"].constructor.call(b),b.scrollBarMode="off",b.eachable=!1;var c=b.layout=new qc.widget.layout.TableLayout(b),d=b._textArea=new qc.editor.TextArea(a),e=b._popupButton=new qc.editor.Button({text:ga._("Edit"),padding:[2,6,2,6]});c.cellPadding=0,c.bottomViewExpanded=!1,c.splitterSize=0,b.setItems([{height:.1,widths:[.1,42],cells:[{element:d},{align:"center",vAlign:"middle",element:e,fill:"none"}]}]),d.onValueChanged=function(a){b.onValueChanged&&b.onValueChanged(a)},d.on("propertyChange",function(a){b.emit("propertyChange",a)}),b._bindingHandleDocumentMousedown=b.handleDocumentMousedown.bind(b),e.on("click",this.showPopupDialog.bind(this))});Ja.prototype.formatValue=function(a){return a},Ja.prototype.showPopupDialog=function(){var a=this,b=a._dialog;if(!b){var b=a._dialog=new qc.editor.Dialog;b.on("close",function(){a.removeDialog()});var c=new qc.editor.TextArea;b.position="center",b.buttons=[{text:ga._("OK"),onClick:function(){b.hide(),a.value=c.value,a.emit("valueChangedFromPopup")}},{text:ga._("Cancel"),onClick:function(){b.hide()}}],b.title=ga._("Edit Text"),b.contentPadding=[5,5,5,5];var d=Cb(800,600);b.width=d.width,b.height=d.height,b.content=c,c.value=a._textArea.value}b.isInDOM()?b.hide():(b.show(),c.input.focus(),document.addEventListener("mousedown",a._bindingHandleDocumentMousedown))},Ja.prototype.handleDocumentMousedown=function(a){var b=this,c=b._dialog,d=a.target;c.view.contains(d)||b._popupButton.view.contains(d)||c.hide()},Ja.prototype.removeDialog=function(){delete this._dialog,document.removeEventListener("mousedown",this._bindingHandleDocumentMousedown)},b.defineProperties(Ja.prototype,{value:{get:function(){return this._textArea.value},set:function(a){this._textArea.value=a}},onValueChanged:{get:function(){return this._onValueChanged},set:function(a){this.setPropertyValue("onValueChanged",a)}},formattedValue:{get:function(){return this.formatValue(this.value)}}});var Ka=m("qc.editor.CodePane",b,function(){var a=this;a.initView(!1)},{},{view:!0,emitter:!0});Ka.prototype.onPropertyChange=function(a){var b=this,c=b._editor,d=a.property;"value"===d&&!b._editorToValue&&c&&(b._valueToEditor=!0,c.setValue(a.newValue),b._valueToEditor=!1)},Ka.prototype._initEditor=function(){var a=this,b=a.value,c=a._interactionDiv,d=a._editor=CodeMirror(c,{lineNumbers:!0,foldGutter:!0,theme:"material",continueComments:{continueLineComment:!1},autoCloseBrackets:!0,matchBrackets:!0,indentUnit:4,keyMap:"sublime",lint:!0,mode:{name:a.mode||"javascript"},gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"]});d.setSize("100%","100%"),d.setValue(b||""),d.on("change",function(){a._valueToEditor||(a._editorToValue=!0,a.value=d.getValue(),a._editorToValue=!1)})},Ka.prototype.validateImpl=function(){var a=this,b=a._editor;b||a._initEditor()},b.defineProperties(Ka.prototype,{value:{get:function(){return this._value},set:function(a){try{var b=JSON.parse(a),c=JSON.stringify(b,null,4);a=c}catch(d){}this.setPropertyValue("value",a)}},mode:{get:function(){return this._mode},set:function(a){this.setPropertyValue("mode",a)}},editor:{get:function(){return this._editor}}});var La=m("qc.widget.CodeViewer",qc.widget.Container,function ge(){ge["super"].constructor.call(this),this.eachable=!1});La.prototype.validateImpl=function(){var a=this;La["super"].validateImpl.call(this),a.view.style.background="rgb(51, 51, 51)",a.view.style.border="1px solid #888"},La.prototype.calculateClientWidth=function(){return this.width-2},La.prototype.calculateClientHeight=function(){return this.height-2};var Ma=m("qc.editor.PanelInteractor",qc.widget.PanelInteractor,function he(a){var b=this;he["super"].constructor.call(b,a)});Ma.prototype.handle_touchstart=function(a){var b=this;Ma["super"].handle_touchstart.call(b,a);var c=b._toolIndex,d=b._panel;if(null==c&&d.titleVisible){var e=B(a),f=d._interactionDiv.getBoundingClientRect(),g=e.x-f.left,h=e.y-f.top,i=d.width,j=d.titleHeight;h>=0&&j>=h&&g>=0&&i>=g&&(b._clientPoint=e,b._titleActive=!0,z(b,a))}},Ma.prototype.handle_touchend=function(a){var b=this;Ma["super"].handle_touchend.call(b,a);var c=b._titleActive,d=b._panel,e=b._clientPoint,f=B(a);if(c&&y(e,f)<2){var g=d._state;d.state="collapse"===g?"normal":"collapse"}},Ma.prototype.handleWindowTouchEnd=function(a){{var b=this;b._panel}Ma["super"].handleWindowTouchEnd.call(b,a),b._titleActive&&(b._clientPoint=null,b._titleActive=!1)},Ma.prototype._calcToolIndex=function(a){var b=this,c=b._panel;a=k.checkTouch(a);var d=c._interactionDiv.getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top,g=c.titleHeight,h=c.checkable,i=c.removable,j=c.refreshable;if(c.titleVisible){if(f>=4&&4+g-8>=f&&2+g-8>e&&e>2)return 0;if(h){var l=c._checkIconRect;if(l&&v(l,{x:e,y:f}))return 1}var m=d.width;if(i){var n={x:m-=24,y:4,width:g-8,height:g-8};if(v(n,{x:e,y:f}))return 2}if(j){var o={x:m-=24,y:4,width:g-8,height:g-8};if(v(o,{x:e,y:f}))return 3}}};var Na=m("qc.editor.Panel",qc.widget.Panel,function(a){var b=this;qc.widget.Panel["super"].constructor.call(b),b.layout=null,b._interactor=new Ma(b),b.target=a;var c=new qc.widget.Container;c.layout=new qc.widget.layout.VBoxLayout(c),c.layout.padding=0,c.layout.gap=0,c.scrollBarMode="off",b.content=c,b.scrollBarModel="off",b.paint(),delete b._invalidateFlag,c.setItems(b._getContainerViews()),b.initChildrenListener(),b.initCompValueChangeListener(),b.on("propertyChange",function(a){"checked"===a.property&&(a.newValue?(b.emit("enable",{source:b}),b.onEnable&&b.onEnable()):(b.emit("disable",{source:b}),b.onDisable&&b.onDisable()))})});Na.prototype.indent=30,Na.prototype.divideColor=14935011,Na.prototype._checkable=!0,Na.prototype._removable=!0,Na.prototype._refreshable=!1,Na.prototype._titleHeight=24,Na.prototype._contentPadding=[2,0,0,0],Na.prototype._titleBackground="rgb(194, 194, 194)",Na.prototype._activeTitleBackground="rgb(155, 155, 155)",Na.prototype._getContainerViews=function(){var a=aa.containers,b=[];if(a)for(var c=0;c<a.length;c++){var d=new qc.widget.Container;d.layout=new qc.widget.layout.TableLayout(d),d.layout.cellPadding=1,d.layout.padding=[0,6,0,0],d.layout.rowHeight=20,d.scrollBarMode="off",d.setItems(a[c]),b.push(d)}return b},Na.prototype.removeSelf=function(){var a=this;kb(ga._("Sure to remove this component?"),ga._("Warning"),function(){var b=a.parent;ga.inspector.propertyView.emit("remove",{source:a}),a.target.destroy(),b.inspect(b.target)},null,{icon:"alert"})},Na.prototype.handleToolClick=function(a,b){var c=this;if(0===a){var d=this.state;c.state="collapse"!==d?"collapse":"normal"}else 1===a?(c.checked=!this.checked,ga.inspector.propertyView.emit("checkChanged",{source:c})):2===a?(c.emit("remove",{source:c}),c.onRemove&&c.onRemove()):3===a&&c.repaint();c.emit("toolClick",{tool:a,event:b})},Na.prototype.drawTitleBackground=function(a,b,c,d,e){var f,g=this,h=this._interactor,i=g.titleNinePatchImage,j=g.titleNinePatchBorder||[],l=g.titleTextNinePatchImage,m=g.titleTextNinePatchBorder||[],n=h._titleActive;if(i)k.drawNinePatchImage(a,i,b,c,d,e,j[0],j[1],j[2],j[3]),l&&k.drawNinePatchImage(a,l,b+e-6,c+2,d,e-4,m[0],m[1],m[2],m[3]);else{f=n?g._activeTitleBackground:g._titleBackground,a.beginPath();var o={x:b,y:c,width:d,height:e};a.fillStyle=f,a.rect(o.x,o.y,o.width,o.height),a.fill()}},Na.prototype.drawTitle=function(a,b,c,d,e){var f=this;f.drawTitleBackground(a,b,c,d,e);var g=f.icon,h=f.title,i=f.titleFont,j=f.titleColor,l=f.checkable,m=f.checked,n=f.removable,o=f.refreshable;a.beginPath(),a.rect(b,c,d,1),a.fillStyle=f._titleLineColor,a.fill(),a.beginPath(),b+=2,this.drawTool(a,"collapse",b,4,e-8,e-8),b+=e-8,g&&(k.drawImage(a,g,null,b+=2,4,e-8,e-8),b+=e-8),l?(f._checkIconRect={x:b+2,y:4,width:e-8,height:e-8},k.drawImage(a,m?"checkIcon":"uncheckIcon",null,b+=2,4,e-8,e-8),b+=e-8):f._checkIconRect=null,h&&k.drawText(a,h,i,j,b,0,0,e);var p=d;n&&k.drawImage(a,"delete",null,p-=24,4,e-8,e-8),o&&k.drawImage(a,"refresh",null,p-=24,4,e-8,e-8)},Na.prototype.drawTool=function(a,b,c,d,e,f){var g=this.state;"collapse"===b&&("collapse"===g?k.drawImage(a,"treeCollapse",null,c,d,e,f):k.drawImage(a,"treeExpand",null,c,d,e,f))},Na.prototype.validate=function(){var a=this;Na["super"].validate.call(a);var b=a._disabledDiv;if(b){var c=a._titleHeight,d=a.clientWidth,e=a.clientHeight;k.layout(b,0,c,d,e-c)}},Na.prototype.paint=function(){},Na.prototype.repaint=function(){var a=this;a._invalidateFlag||(a._invalidateFlag=!0,U(function(){a._invalidateFlag&&(delete a._invalidateFlag,a.target&&(a.content.setItems(null),a.paint(),a.content.setItems(a._getContainerViews()),a.initChildrenListener(),a.initCompValueChangeListener()))}))},Na.prototype.initCompValueChangeListener=function(){var a=this;a.eachChildren(function(b){b instanceof qc.editor.Label||b instanceof qc.editor.Text||b.on&&b.on("propertyChange",function(c){ga.inspector&&!ga.inspector._updating&&(b instanceof qc.widget.ToggleButton?"selected"===c.property&&ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:a.target,field:b.bind}):"value"===c.property&&ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:a.target,field:b.bind}))})})},Na.prototype.initChildrenListener=function(){var a=this;a.eachChildren(function(b){b instanceof qc.editor.Label||b instanceof qc.editor.Text?b["for"]&&!b.disabled&&(b.cursor="ew-resize"):b.bind&&(b.on("propertyChange",a.onChildPropertyChange.bind(a,b)),b instanceof Ba&&(b.input.addEventListener("focus",a.onInputFocus.bind(a,b)),b.input.addEventListener("blur",a.onInputBlur.bind(a,b))))})},Na.prototype.onChildPropertyChange=function(a,b){var c=this;if(!ga.inspector._updating&&("value"===b.property||"selected"===b.property)){var d;if(d=a.toGameValue?a.toGameValue():a.formattedValue,a.syncToGame)a.syncToComp(d);else if(a instanceof Da);else if(a instanceof Ea&&isNaN(d));else{var e=c.target;a.bindTarget&&(e=a.bindTarget),c.setTargetProperty(e,a.bind,d)}}},Na.prototype.createInputUndoFunc=function(a,b,c,d){return function(){a(b,c,d)}},Na.prototype.onInputFocus=function(a){var b=this,c=b.target;a.bindTarget&&(c=a.bindTarget);var d=b.getTargetProperty(c,a.bind);a._undoValue=d;var e=b.createInputUndoFunc,f=b.setTargetProperty;a._undo=e(f,c,a.bind,d)},Na.prototype.onInputBlur=function(a){var b=this;if(a._undo){var c=b.target;a.bindTarget&&(c=a.bindTarget);var d=b.getTargetProperty(c,a.bind);if(d!==a._undoValue){var e=b.createInputUndoFunc,f=b.setTargetProperty,g=e(f,c,a.bind,d);ga.undo.add(a._undo,g)}delete a._undo,delete a._undoValue}},Na.prototype.updateChildrenValue=function(){var a=this;this.eachChildren(function(b){if(b.bind){var c=a.target;b.bindTarget&&(c=b.bindTarget);var d=!1;if(d=b.hasFocus?b.hasFocus():b.view.contains(document.activeElement),c&&!d)if(b instanceof Da){var e=b.bind;if("texture"===b.objectType){var f,g;e.indexOf("/")>0?(f=e.substring(0,e.indexOf("/")),g=e.substring(e.indexOf("/")+1)):f=e,g?b.setTextureObjectValue(c[f],c[g]):b.setTextureObjectValue(c[f])}else b.setObjectValue(c[e])}else{var h=a.getTargetProperty(c,b.bind);b.syncToComp?b.syncToComp(h):b instanceof qc.widget.ToggleButton&&!(b.parent instanceof qc.widget.ButtonGroup)?b.selected=h:b.value=b.toCompValue?b.toCompValue(h):h}}})},Na.prototype.setTargetProperty=function(a,b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++)if(e=e[d[f]],!e)return;e[d[d.length-1]]=c},Na.prototype.getTargetProperty=function(a,b){for(var c=b.split("."),d=a,e=0;e<c.length-1;e++)if(d=d[c[e]],!d)return"";return d[c[c.length-1]]},Na.prototype.eachChildren=function(a,b){var c=this,d=(b||c).children;if(d)for(var e=0;e<d.length;e++){var f=d[e];if(f.eachable!==!1){var g=c.eachChildren(a,f);if(g)return g}if(a(f))return f}},b.defineProperties(Na.prototype,{target:{get:function(){return this._target},set:function(a){this._target=a}},checked:{get:function(){return this._checked},set:function(a){this.setPropertyValue("checked",a)}},checkable:{get:function(){return this._checkable},set:function(a){this.setPropertyValue("checkable",a)}},removable:{get:function(){return this._removable},set:function(a){this.setPropertyValue("removable",a)}},refreshable:{get:function(){return this._refreshable},set:function(a){this.setPropertyValue("refreshable",a)}}});var Oa=m("qc.editor.Dialog",qc.widget.Dialog,function(a){var b=this;b._initLayout(a),b._interactor=new Pa(b),b.on("show",function(){b.handleShow()}),b.on("close",function(){b.handleClose()}),b._bindingHide=b.hide.bind(b)},{_buttonPadding:[2,8,2,8]},{properties:["closeNinePatchImage","closeNinePatchBorder","buttonNinePatchImage","buttonNinePatchBorder","buttonActiveNinePatchImage","buttonActiveNinePatchBorder","buttonFont","buttonColor","buttonPadding"]});Oa.prototype.handleShow=function(){ga.windowFocused&&ga.e.on(ga.e.JS_CHANGED,this._bindingHide)},Oa.prototype.handleClose=function(){ga.e.off(ga.e.JS_CHANGED,this._bindingHide)},Oa.prototype._createButton=function(a){var b=this,c=new qc.widget.Button(a);return c.ninePatchImage=b.buttonNinePatchImage,c.ninePatchBorder=b.buttonNinePatchBorder,c.hoverNinePatchImage=b.buttonNinePatchImage,c.hoverNinePatchBorder=b.buttonNinePatchBorder,c.activeNinePatchImage=b.buttonActiveNinePatchImage,c.activeNinePatchBorder=b.buttonActiveNinePatchBorder,c.padding=b.buttonPadding,c.textFont=b.buttonFont,c.textColor=b.buttonColor,c.borderWidth=0,c},Oa.prototype.drawTool=function(a,b,c,d,e,f,g){if("close"===b){var h=this,i=h.closeNinePatchImage,j=h.closeNinePatchBorder,f=h.titleHeight,g=f;d=h.width-f,e=0,k.drawNinePatchImage(a,i,d,e,f,g,j[0],j[1],j[2],j[3]),k.drawImage(a,this._closeIcon,null,d,e,f,g)}else Oa["super"].drawTool.call(this,a,b,c,d,e,f,g)},Oa.prototype.validateImpl=function(){{var a=this;a._container.layout.bottomView.children}Oa["super"].validateImpl.call(a)};var Pa=m("qc.editor.DialogInteractor","qc.widget.DialogInteractor",function(a){var b=this;Pa["super"].constructor.call(b,a)},{_calcToolIndex:function(a){var b=this,c=b._panel,d=c.tools;if(d&&d.indexOf("close")>=0){a=k.checkTouch(a);var e=c._interactionDiv.getBoundingClientRect(),f=a.clientX-e.left,g=a.clientY-e.top,h=c.titleHeight,i={x:e.width-h,y:0,width:h,height:h};if(k.containsPoint(i,{x:f,y:g}))return 0}}}),Qa=m("qc.editor.LayoutContainer",qc.widget.Container,function ie(a){var b=this;ie["super"].constructor.call(b,a),b.layout=new qc.widget.layout.SplitLayout(b),b.orientation="Landscape",ga.e.on(ga.e.ORIENTATION_CHANGE,function(a){b.orientation=a.newValue})});Qa.TOP_MENU=1,Qa.TOP_LEFT=2,Qa.TOP_RUN=3,Qa.TOP_MIDDLE=4,Qa.TOP_RIGHT=5,Qa.SCENE=6,Qa.HIERARCHY=7,Qa.PROJECT=8,Qa.INSPECTOR=9,Qa.DIALOG=10,b.defineProperties(Qa.prototype,{orientation:{get:function(){return this._orientation},set:function(a){var b=this,c=b.orientation;b.setPropertyValue("orientation",a),c!==a&&("Portrait"===a?b._setPortrait():"Landscape"===a&&b._setLandscape())}}}),Qa.prototype.getRegionContainer=function(a){var b=this,c=b["_container"+a];return c||(c=new qc.widget.Container,c.scrollBarMode="off",b["_container"+a]=c),c},Qa.prototype.add=function(a,b,c){var d=this,e=d["_container"+b];if(c&&!c.isChildOf(e)){c.id=a;var f=e.children;if(f&&0!==f.length){var g=f[0];if(g instanceof qc.widget.Tabs){var h=d._createTab(c);g.tabModel.add(h),g.select(h)}else{var i=new qc.widget.Tabs,j=d._createTab(g),h=d._createTab(c);i.tabModel.add(j),i.tabModel.add(h),i.select(h),e.setItems(i)}}else if(null==c.title)e.setItems(c);else{var i=new qc.widget.Tabs,h=d._createTab(c);i.tabModel.add(h),i.select(h),e.setItems(i)}}},Qa.prototype.find=function(a){return this.findViewById(a)},Qa.prototype.remove=function(a){var b=this;if("string"==typeof a&&(a=b.find(a)),a){for(var c,d=1;8>=d;d++){var e=b["_container"+d];if(a.isChildOf(e)){c=d;break}}c&&b._removeImpl(a,c)}},Qa.prototype._removeImpl=function(a,b){var c=this,d=c["_container"+b],e=d.children;if(e&&e.length>0){var f=e[0];if(f instanceof qc.widget.Tabs)for(var g=f.tabModel._roots,h=0;h<g.length;h++){var i=g[h];if(i.element===a){f.remove(h),0===f.tabModel.length&&d.setItems(null);break}}else a===f&&d.setItems(null)}},Qa.prototype._findComp=function(a,b){var c=a.children[0];if(c instanceof b)return c;if(c instanceof qc.widget.Tabs)for(var d=c.tabModel.datas,e=0;e<d.length;e++){var f=d[e];if(f.element instanceof b)return f.element}},Qa.prototype.serialize=function(){for(var a=this,b=[],c=6;9>=c;c++){var d=a.getRegionContainer(c),e={regionId:c,position:d.parent.layout.position};if(c===Qa.PROJECT){var f=a._findComp(d,qc.editor.Project);e.leftWidth=f.layout.leftWidth}else if(c===Qa.INSPECTOR){var g=a._findComp(d,qc.editor.Inspector);e.bottomHeight=g.layout.bottomHeight}b.push(e)}return JSON.stringify(b)},Qa.prototype.deserialize=function(a){var b=this;k.isString(a)&&(a=JSON.parse(a)),a.forEach(function(a){var c=b.getRegionContainer(a.regionId);if(c.parent.layout.position=a.position,a.regionId===Qa.PROJECT&&null!=a.leftWidth){var d=b._findComp(c,qc.editor.Project);d.layout.leftWidth=a.leftWidth}else if(a.regionId===Qa.INSPECTOR&&null!=a.bottomHeight){var e=b._findComp(c,qc.editor.Inspector);e.layout.bottomHeight=a.bottomHeight}})},Qa.prototype._createTab=function(a){var b=new qc.widget.Tab;return b.name=a.title,b.icon=a.icon,b.element=a,b},Qa.prototype._setLandscape=function(){var a=this,b=a.layout;b.orientation="v",b.position=34,b.minSize=10,b.splitterSize=0,b.positionType="absoluteLeft";var c=a.getRegionContainer("1"),d=a.getRegionContainer("2"),e=a.getRegionContainer("3"),f=a.getRegionContainer("4"),g=a.getRegionContainer("5"),h=a.getRegionContainer("6"),i=a.getRegionContainer("7"),j=a.getRegionContainer("8"),k=a.getRegionContainer("9"),l=new qc.widget.Container;l.layout=new qc.widget.layout.TableLayout(l),l.layout.cellPadding=0,l.scrollBarModel="off",l.setItems([{height:.1,widths:[236,160,.1,180],cells:[{element:d},{element:e},{element:f},{element:g}]}]);var m=new qc.widget.Container;m.layout=new qc.widget.layout.SplitLayout(m),m.layout.position=260,m.layout.positionType="absoluteRight",m.setItems([h,i]);var n=new qc.widget.Container;n.layout=new qc.widget.layout.SplitLayout(n),n.layout.orientation="v",n.layout.position=.65,n.setItems([m,j]);var o=new qc.widget.Container;o.layout=new qc.widget.layout.SplitLayout(o),o.layout.position=280,o.layout.positionType="absoluteRight",o.setItems([n,k]);var p=new qc.widget.Container;p.layout=new qc.widget.layout.SplitLayout(p),p.layout.orientation="v",p.layout.position=34,p.layout.minSize=10,p.layout.splitterSize=0,p.layout.positionType="absoluteLeft",p.setItems([l,o]),b.resetItems([c,p])},Qa.prototype._setPortrait=function(){var a=this,b=a.layout;b.orientation="v",b.position=34,b.minSize=10,b.splitterSize=0,b.positionType="absoluteLeft";var c=a.getRegionContainer("1"),d=a.getRegionContainer("2"),e=a.getRegionContainer("3"),f=a.getRegionContainer("4"),g=a.getRegionContainer("5"),h=a.getRegionContainer("6"),i=a.getRegionContainer("7"),j=a.getRegionContainer("8"),k=a.getRegionContainer("9"),l=new qc.widget.Container;l.layout=new qc.widget.layout.TableLayout(l),l.layout.cellPadding=0,l.scrollBarModel="off",l.setItems([{height:.1,widths:[236,160,.1,180],cells:[{element:d},{element:e},{element:f},{element:g}]}]);var m=new qc.widget.Container;m.layout=new qc.widget.layout.SplitLayout(m),m.layout.position=.36,m.setItems([i,j]);var n=new qc.widget.Container;n.layout=new qc.widget.layout.SplitLayout(n),n.setItems([h,m]);var o=new qc.widget.Container;o.layout=new qc.widget.layout.SplitLayout(o),o.layout.position=280,o.layout.positionType="absoluteRight",o.setItems([n,k]);var p=new qc.widget.Container;p.layout=new qc.widget.layout.SplitLayout(p),p.layout.orientation="v",p.layout.position=34,p.layout.minSize=10,p.layout.splitterSize=0,p.layout.positionType="absoluteLeft",p.setItems([l,o]),b.resetItems([c,p])};var Ra=m("qc.editor.Painter",b,function(){var a=this;a.initView(!1,!0),new qc.editor.PainterInteractor(a)},{_borderWidth:0},{view:!0,emitter:!0,painter:!0});b.defineProperties(Ra.prototype,{background:{get:function(){return this._background},set:function(a){this.setPropertyValue("background",a)}},borderColor:{get:function(){return this._borderColor},set:function(a){this.setPropertyValue("borderColor",a)}},borderWidth:{get:function(){return this._borderWidth},set:function(a){this.setPropertyValue("borderWidth",a)}}}),Ra.prototype.onPropertyChange=function(){this.iv()},Ra.prototype.drawBackground=function(a){var b=this,c=b.background;c&&(a.beginPath(),a.rect(0,0,b.width,b.height),a.fillStyle=c,a.fill())},Ra.prototype.drawBorder=function(){var a,b=this,c=b.borderWidth;a=c?c+"px solid "+b.borderColor:"",b.view.style.border=a},Ra.prototype.validateImpl=function(){this.drawBorder();var a=this,b=a._canvas,c=a.clientWidth,d=a.clientHeight;t(b,c,d);var e=s(b,0,0,1);a.drawBackground(e),a.drawBottomPainters(e),a.drawTopPainters(e)},Ra.prototype.calculateClientWidth=function(){var a=this.borderWidth,b=this.width;return a?b-2*a:b},Ra.prototype.calculateClientHeight=function(){var a=this.borderWidth,b=this.height;return a?b-2*a:b},m("qc.editor.PainterInteractor",b,function(a){this._painter=a,this.addListeners()},{handle_mousewheel:function(a){Y(a)},handle_DOMMouseScroll:function(a){Y(a)}},{interactor:!0},{view:{get:function(){return this._painter}}});var Sa=m("qc.editor.ProgressBar",Ra,function je(){je["super"].constructor.call(this),this.addTopPainter(this.drawImpl)},{_percent:0,_backgroundColor:"rgb(232, 232, 232)",_foregroundColor:"rgb(6, 172, 48)",_textFont:"12px Arial",_textColor:"black"},{properties:["foregroundColor","backgroundColor","percent","text","textFont","textColor"]});Sa.prototype.drawImpl=function(a){var b=this,c=b.clientWidth,d=b.clientHeight,e=b.percent,f=b.text,g=b.textFont,h=b.textColor,i=b.foregroundColor,j=b.backgroundColor;a.beginPath(),a.fillStyle=j,a.rect(0,0,c,d-20),a.fill(),a.beginPath(),a.fillStyle=i,a.rect(0,0,e/100*c,d-20),a.fill(),a.beginPath(),k.drawText(a,f,g,h,0,d-20,c,20,"left")};var Ta=(m("qc.editor.ProgressDialog",Oa,function ke(){ke["super"].constructor.call(this);var a=new qc.widget.Container,b=this.progressBar=new Sa;b.preferredSize={height:50},a.scrollbarMode="off",a.layout=new qc.widget.layout.TableLayout(a),a.setItems([{height:.1,widths:[.1],cells:[{fill:"horizontal",vAlign:"middle",element:b}]}]),a.background="rgb(44, 53, 74)",this.contentPadding=[10,10,10,10],this.content=a}),m("qc.editor.Divider",Ra,function le(){var a=this;le["super"].constructor.call(a),a.view.style.background="rgba(0, 0, 0, 0)",a.view.style.border="0px",a.color=14935011,a.size=1}));b.defineProperties(Ta.prototype,{color:{get:function(){return this._color},set:function(a){this.setPropertyValue("color",a)}},size:{get:function(){return this._size},set:function(a){this.setPropertyValue("size",a)}}}),Ta.prototype.validateImpl=function(){var a=this,b=a._canvas,c=a.clientWidth,d=a.clientHeight,e=a.size;t(b,c,d);var f=s(b,0,0,1);f.beginPath(),f.rect(0,(d-e)/2,c,e),f.fillStyle=this.color,f.fill()},Ta.prototype.calculateClientWidth=function(){return this.width},Ta.prototype.calculateClientHeight=function(){return this.height},k.Vector.gameCurveShape=function(a,b,c,d,e){if(c&&c.curve){var f=c.curve.func(d,e);if(f&&0!==f.keys.length){for(var g=f.keys,h=g[0].time,i=g[g.length-1].time,j=g[0].value,k=g[0].value,l=1/b.width,m=h;(m+=l)<i;){var n=f.evaluate(m);j=Math.min(j,n),k=Math.max(k,n)}var n=f.evaluate(i);j=Math.min(j,n),k=Math.max(k,n),3e-8>k-j&&(k=j);var o=1,p=1,q=b.height/(k===j?1:k-j),r=b.width/(i===h?1:i-h),s=b.height*(k===j?.5:(k-0)/(k-j)),t=-h*r,u=function(a){return t+a*r+o},v=function(a){return s-a*q+p};a.lineWidth=1,s>=0&&s<=b.height&&(a.strokeStyle="rgb(0, 0, 0)",a.beginPath(),a.moveTo(0,s),a.lineTo(b.width,s),a.stroke(),a.closePath()),a.strokeStyle="rgb(0, 255, 0)",a.beginPath();var m=h;for(a.moveTo(u(m),v(f.evaluate(m)));(m+=1/r)<=i;){var w=f.evaluate(m);w=Math.min(k,Math.max(j,w)),a.lineTo(u(m),v(w))}a.lineTo(u(i),v(f.evaluate(i))),a.stroke(),a.closePath()}}};var Ua={width:60,height:60,comps:[{type:"rect",rect:[0,0,60,60],background:{func:function(a,b){return b._imageBackground}}},{type:"gameCurveShape",rect:[1,1,58,58],curve:{func:function(a,b){return b&&b.bezierCurve||null}}},{type:"border",rect:[0,0,60,60],borderWidth:1,borderColor:{func:function(a,b){return b._imageBorderColor}}}]},Va=m("qc.editor.CurveButton",qc.widget.Button,function me(a){var b=this;me["super"].constructor.call(b,a),b.on("click",b.handleClick,b),b._bindingHandleDocumentMousedown=b.handleDocumentMousedown.bind(b);var c="rgba(0, 0, 0, 0)";b.background=c,b.gradientColor=c,b.hoverBackground=c,b.hoverGradientColor=c,b.activeBackground=c,b.activeGradientColor=c,b.preferredSize={width:60,height:60},b.iconWidth=60,b.iconHeight=60,b.borderWidth=0});b.defineProperties(Va.prototype,{icon:{get:function(){return Ua}},bezierCurve:{get:function(){return this._bezierCurve},set:function(a){this.setPropertyValue("bezierCurve",a)}}}),Va.prototype.handleClick=function(){var b=this,c=b._curvePainterDialog,d=b._curvePainter,e=b._curveList;if(!c){c=b._curvePainterDialog=new qc.editor.Dialog,c.on("close",function(){b.removeDialog()}),d=b._curvePainter=new Ya,e=b._curveList=a.liyk=new Wa,e.painter=d;var f=new qc.widget.Container;f.layout=new qc.widget.layout.BorderLayout(f),f.layout.centerView=d,f.layout.bottomView=e,f.layout.splitterSize=0,f.layout.bottomHeight=70,c.title=ga._("Curve Editor"),c.contentPadding=2,c.content=f,d.on("propertyChange",b.handleCurvePainterPropertyChange,b)}if(c.isInDOM())b.removeDialog();else{d.bezierCurve=b.bezierCurve;var g=Cb(610,530);c.width=g.width,c.height=g.height,c.show(),d.adjustCurve(),document.addEventListener("mousedown",b._bindingHandleDocumentMousedown)}},Va.prototype.handleCurvePainterPropertyChange=function(){var a=this;a.iv()},Va.prototype.handleDocumentMousedown=function(a){var b=this,c=b._curvePainterDialog,d=b._curvePainter,e=b._curveList,f=a.target;c.view.contains(f)||b.view.contains(f)||d._contextMenu.view.contains(f)||e._contextMenu.view.contains(f)||b.removeDialog()},Va.prototype.removeDialog=function(){var a=this._curvePainterDialog,b=this._curvePainter;b._contextMenu.dispose(),this._curveList._contextMenu.dispose(),b.off("propertyChange",this.handleCurvePainterPropertyChange,this),a.hide(),delete this._curvePainterDialog,delete this._curvePainter,delete this._curveList,document.removeEventListener("mousedown",this._bindingHandleDocumentMousedown)},Va.prototype.calculateClientWidth=function(){return this.width},Va.prototype.calculateClientHeight=function(){return this.height};var Wa=(m("qc.editor.CurveNode",qc.editor.ItemNode,function ne(a){var b=this;ne["super"].constructor.call(b,a),b.image={width:60,height:60,comps:[{type:"rect",rect:[0,0,60,60],background:{func:function(){return"rgb(30, 30, 30)"}}},{type:"gameCurveShape",rect:[1,1,58,58],curve:{func:function(){return b.curve}}},{type:"border",rect:[0,0,60,60],borderWidth:1,borderColor:{func:function(){return"rgb(10, 10, 10)"}}}]}}),m("qc.editor.CurveList",qc.editor.ItemList,function oe(){var a=this;oe["super"].constructor.call(a),a.pannable=!1,a._initMenu(),a.itemWidth=60,a.itemHeight=60,a.itemGap=5,a.loadCurve()}));Wa.prototype._initMenu=function(){var a=this,b=new qc.editor.ContextMenu([{label:ga._("Save as New Curve"),disabled:function(){return!a.painter||!a.painter.bezierCurve},action:function(){var b=new qc.editor.CurveNode;b.curve=a.painter.bezierCurve.clone(),a.addCurveNode(b),a.saveCurve()}},{label:ga._("Delete Curve"),disabled:function(){return 0===a.selection.length},action:function(){a.handleDelete(),a.saveCurve()}},{label:ga._("Add Default Curves"),action:function(){a.addDefaultCurve(),a.saveCurve()}}]);a._contextMenu=b,b.addTo(a)},Wa.prototype.saveCurve=function(){for(var a=this,b=a.dataModel.datas,c=[],d=0;d<b.length;d++)b[d]&&b[d].curve&&c.push(b[d].curve.toJson());ga.config.editor.curveTemplate=c,qc.editor.Operation.UPDATE_EDITOR_SETTINGS(ga.config.editor)},Wa.prototype.loadCurve=function(){var a=this;
if(ga.config.editor.curveTemplate){for(var b=ga.config.editor.curveTemplate,c=0;c<b.length;c++)if(b[c]){var d=new qc.BezierCurve;d.fromJson(b[c]);var e=new qc.editor.CurveNode;e.curve=d,a.addCurveNode(e)}}else a.addDefaultCurve()},Wa.prototype.handleDelete=function(){var a=this,b=a.selection.slice(0);b.forEach(function(b){a.dataModel.remove(b)})},Wa.prototype.onDataClick=function(a){var b=this.painter.bezierCurve;b._keys=a.curve.clone().keys,this.painter.epc("bezierCurve",0,1)},Wa.prototype.onDataDoubleClick=function(){},Wa.prototype.addCurveNode=function(a){this.dataModel.add(a)},Wa.prototype.addDefaultCurve=function(){var a=new qc.BezierCurve(new qc.Keyframe(0,0,0,0),new qc.Keyframe(1,0,0,0)),b=new qc.editor.CurveNode;b.curve=a,this.addCurveNode(b);var a=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),b=new qc.editor.CurveNode;b.curve=a,this.addCurveNode(b),a=new qc.BezierCurve(new qc.Keyframe(0,0,.5,.5),new qc.Keyframe(1,1,2,2)),b=new qc.editor.CurveNode,b.curve=a,this.addCurveNode(b),a=new qc.BezierCurve(new qc.Keyframe(0,0,2,2),new qc.Keyframe(1,1,.5,.5)),b=new qc.editor.CurveNode,b.curve=a,this.addCurveNode(b),a=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,0,1,1)),b=new qc.editor.CurveNode,b.curve=a,this.addCurveNode(b),a=new qc.BezierCurve(new qc.Keyframe(0,0,0,0),new qc.Keyframe(1,1,0,0)),b=new qc.editor.CurveNode,b.curve=a,this.addCurveNode(b)};var Xa=m("qc.editor.CurvePainterInteractor",b,function(a){var b=this;b._painter=a,b.addListeners(),b._handleDocumentMouseDown=function(b){var c=a._contextMenu;c&&c.view&&!c.view.contains(b.target)&&c.hide()}},{handle_mousedown:function(a){0===a.button&&this.handle_touchstart(a)},handle_touchstart:function(a){Y(a),z(this,a);var b=this,c=b._painter,d=c.lp(a);b.onTouchStart(d,a)},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(a){Y(a),this.onTouchEnd()},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){this.onTouchMove(this._painter.lp(a))},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(a){Y(a),this.onTouchEnd()},handle_contextmenu:function(a){Y(a),this.showContextMenu(this._painter.lp(a),a)},handle_mousewheel:function(a){this.handleScroll(a,(a.wheelDeltaX||0)/40,a.wheelDelta/40)},handle_DOMMouseScroll:function(a){this.handleScroll(a,0,-a.detail)},handleScroll:function(a,b,c){this.view;Y(a),this.onZoom(this._painter.lp(a),b,c)}},{interactor:!0},{view:{get:function(){return this._painter}}});Xa.KEY_HITAREA=36,Xa.LINE_HITAREA=4,Xa.prototype.showContextMenu=function(a,b){for(var c=this,d=c._painter,e=d._contextMenu,f=d.bezierCurve,g=f.keys,h=-1,i=0;i<g.length;++i){var j=d.xPos(g[i].time),k=d.yPos(g[i].value);if(Math.pow(a.x-j,2)*Math.pow(a.y-k,2)<=Xa.KEY_HITAREA){h=i;break}}if(0>h){var k=d.yPos(f.evaluate(d.xPrecisionValue(a.x)));if(Math.abs(k-a.y)<=Xa.LINE_HITAREA)return;e.items=[{label:ga._("Add Key"),action:function(){var b=d.xPrecisionValue(a.x),e=f.evaluateDerivative(b);f.addKey(b,f.evaluate(b),e,e),c._repaintPainter()}},{label:ga._("Reset View"),action:function(){d.adjustCurve(255)}}]}else{var l=g[h];e.items=[{label:ga._("Delete Key"),action:function(){var a=f._downKey===f.keys[h];f.removeKey(h),a&&(f._downKey=null),c._repaintPainter()}},{label:ga._(l.type===qc.Keyframe.AUTO?"√ Auto":"Auto"),action:function(){l.type=qc.Keyframe.AUTO,f.makeKeyframeAuto(h),c._repaintPainter()}},{label:ga._(l.type===qc.Keyframe.FREE_SMOOTH||l.outTangent===l.inTangent?"√ Free Smooth":"Free Smooth"),action:function(){l.type=qc.Keyframe.FREE_SMOOTH,f.makeKeyframeSmooth(h),c._repaintPainter()}},{label:ga._(l.type===qc.Keyframe.FLAT||l.outTangent===l.inTangent&&0===l.inTangent?"√ Flat":"Flat"),action:function(){l.type=qc.Keyframe.FLAT,f.makeKeyframeFlat(h),c._repaintPainter()}},{label:ga._(l.type===qc.Keyframe.BROKEN?"√ Broken":"Broken"),action:function(){l.type=qc.Keyframe.BROKEN,c._repaintPainter()}}]}document.addEventListener("mousedown",c._handleDocumentMouseDown),e.on("hide",function(){document.removeEventListener("mousedown",c._handleDocumentMouseDown)}),e.show(b.pageX,b.pageY)},Xa.prototype.showWrapContextMenu=function(a,b,c){var d=this,e=d._painter,f=e._contextMenu,g=e.bezierCurve,h=c?g.preWrapMode:g.postWrapMode;f.items=[{label:ga._(h===qc.BezierCurve.WRAP_PINGPONG?"√ Ping Pong":"Ping Pong"),action:function(){c?g.preWrapMode=qc.BezierCurve.WRAP_PINGPONG:g.postWrapMode=qc.BezierCurve.WRAP_PINGPONG,d._repaintPainter()}},{label:ga._(h===qc.BezierCurve.WRAP_LOOP?"√ Loop":"Loop"),action:function(){c?g.preWrapMode=qc.BezierCurve.WRAP_LOOP:g.postWrapMode=qc.BezierCurve.WRAP_LOOP,d._repaintPainter()}},{label:ga._(h===qc.BezierCurve.WRAP_CLAMP?"√ Clamp":"Clamp"),action:function(){c?g.preWrapMode=qc.BezierCurve.WRAP_CLAMP:g.postWrapMode=qc.BezierCurve.WRAP_CLAMP,d._repaintPainter()}}],document.addEventListener("mousedown",d._handleDocumentMouseDown),f.on("hide",function(){document.removeEventListener("mousedown",d._handleDocumentMouseDown)}),setTimeout(function(){f.show(b.pageX,b.pageY)},20)},Xa.prototype.onTouchStart=function(a,b){var c=this,d=c._painter,e=d.bezierCurve,f=e.keys,g=(new Date).valueOf();(!c._lastClickTime||c._lastClickTime+300<g)&&(c._clickCount=0),c._clickCount=1+(c._clickCount||0),c._lastClickTime=g;for(var h=0;h<f.length;++h){var i=d.xPos(f[h].time),j=d.yPos(f[h].value);if(Math.pow(a.x-i,2)+Math.pow(a.y-j,2)<=Xa.KEY_HITAREA)return c._editorTarget={type:0,idx:h,offX:a.x-i,offY:a.y-j},c._downKey=f[h],void c._repaintPainter()}for(var h=0;h<f.length;h++){if(0!==h){var k=Math.atan(f[h].inTangent);k=Math.atan2(Math.sin(k)*d.zoomY,Math.cos(k)*d.zoomX);var l=d.controlLength*Math.cos(k),m=d.controlLength*Math.sin(k),i=d.xPos(f[h].time)-l,j=d.yPos(f[h].value)+m;if(Math.pow(a.x-i,2)+Math.pow(a.y-j,2)<=Xa.KEY_HITAREA)return c._editorTarget={type:1,idx:h,offX:a.x-i,offY:a.y-j},void c._repaintPainter()}if(h!==f.length-1){var k=Math.atan(f[h].outTangent);k=Math.atan2(Math.sin(k)*d.zoomY,Math.cos(k)*d.zoomX);var l=d.controlLength*Math.cos(k),m=d.controlLength*Math.sin(k),i=d.xPos(f[h].time)+l,j=d.yPos(f[h].value)-m;if(Math.pow(a.x-i,2)+Math.pow(a.y-j,2)<=Xa.KEY_HITAREA)return c._editorTarget={type:2,idx:h,offX:a.x-i,offY:a.y-j},void c._repaintPainter()}}var j=d.yPos(e.evaluate(d.xPrecisionValue(a.x)));if(Math.abs(j-a.y)<=Xa.LINE_HITAREA){if(c._clickCount>1){var n=d.xPrecisionValue(a.x),o=e.evaluateDerivative(n),p=e.addKey(n,e.evaluate(n),o,o);c._repaintPainter(),c._clickCount=0,c._downKey=e.keys[p]}else c._editorTarget={type:3,preX:a.x,preY:a.y};return void c._repaintPainter()}var q=function(a,b){return b.x>=a.x&&b.y>=a.y&&b.x<=a.x+a.width&&b.y<=a.y+a.height},r=d.drawInfo;if(r)if(q({x:r.hScrollSlider.x-1.5*r.scrollSize,y:r.hScrollSlider.y,width:r.hScrollSlider.width+3*r.scrollSize,height:r.scrollSize},a)){if(c._clickCount>1)return void d.adjustCurve(1);c._editorTarget=a.x<r.hScrollSlider.x-.5*r.scrollSize?{type:5,preX:a.x,preY:a.y,axis:"x",dir:-1}:a.x<r.hScrollSlider.x+r.hScrollSlider.width+.5*r.scrollSize?{type:4,preX:a.x,preY:a.y,axis:"x"}:{type:5,preX:a.x,preY:a.y,axis:"x",dir:1}}else if(q({x:r.vScrollSlider.x,y:r.vScrollSlider.y-1.5*r.scrollSize,width:r.scrollSize,height:r.vScrollSlider.height+3*r.scrollSize},a)){if(c._clickCount>1)return void d.adjustCurve(2);c._editorTarget=a.y<r.vScrollSlider.y-.5*r.scrollSize?{type:5,preX:a.x,preY:a.y,axis:"y",dir:-1}:a.y<r.vScrollSlider.y+r.vScrollSlider.height+.5*r.scrollSize?{type:4,preX:a.x,preY:a.y,axis:"y"}:{type:5,preX:a.x,preY:a.y,axis:"y",dir:1}}var s=d.wrapDrawInfo;s&&(q(s[0],a)?c.showWrapContextMenu(a,b,!0):q(s[1],a)&&c.showWrapContextMenu(a,b,!1)),!c._editorTarget&&q({x:0,y:0,width:r.vScrollSlider.x-5,height:r.hScrollSlider.y-5},a)&&(c._editorTarget={type:9,preX:a.x,preY:a.y})},Xa.prototype._repaintPainter=function(){this._painter.epc("bezierCurve",0,1)},Xa.prototype.onTouchEnd=function(){this._editorTarget=null,this._repaintPainter()},Xa.prototype.getMovingKey=function(){var a=this,b=a._painter,c=a._editorTarget;if(c){var d=b.bezierCurve,e=d.keys;return 0===c.type?[e[c.idx]]:3===c.type?e:[]}},Xa.prototype.onTouchMove=function(a){var b=this,c=b._painter,d=b._editorTarget;if(d){var e=c.bezierCurve,f=e.keys;if(3===d.type){for(var g=c.xPrecisionValue(a.x)-c.xPrecisionValue(d.preX),h=c.xPrecisionValue(d.preY)-c.xPrecisionValue(a.y),i=0;i<f.length;++i)f[i].time+=g,f[i].value+=h;return d.preX=a.x,d.preY=a.y,void b._repaintPainter()}if(0===d.type){var j=f[d.idx];e.removeKey(d.idx),j.time=c.xPrecisionValue(a.x-d.offX),j.value=c.yPrecisionValue(a.y-d.offY),d.idx=e.addKey(j);for(var i=-1;++i<f.length;)f[i].type===qc.Keyframe.AUTO&&e.makeKeyframeAuto(i);return void b._repaintPainter()}if(1===d.type){var j=f[d.idx];if(j.type===qc.Keyframe.AUTO||j.type===qc.Keyframe.FLAT)return;var k=c.xPrecisionValue(a.x-d.offX),l=c.yPrecisionValue(a.y-d.offY),m=Math.atan2(j.value-l,j.time-k);return m=m<-Math.PI/2?-Math.PI/2:m,m=m>Math.PI/2?Math.PI/2:m,j.inTangent=Math.tan(m),j.type===qc.Keyframe.FREE_SMOOTH&&(j.outTangent=j.inTangent),void b._repaintPainter()}if(2===d.type){var j=f[d.idx];if(j.type===qc.Keyframe.AUTO||j.type===qc.Keyframe.FLAT)return;var k=c.xPrecisionValue(a.x-d.offX),l=c.yPrecisionValue(a.y-d.offY),m=Math.atan2(l-j.value,k-j.time);return m=m<-Math.PI/2?-Math.PI/2:m,m=m>Math.PI/2?Math.PI/2:m,j.outTangent=Math.tan(m),j.type===qc.Keyframe.FREE_SMOOTH&&(j.inTangent=j.outTangent),void b._repaintPainter()}if(4===d.type){var n=c.drawInfo,o=d.axis,p=0;if("x"===o&&(p=n.hScrollBounds.width-n.hScrollSlider.width)>0){var q=n.hScrollSlider.x-n.hScrollBounds.x+(a.x-d.preX);q=0>q?0:q>p?p:q;var r=q-n.hScrollSlider.x+n.hScrollBounds.x;0!==r&&(c.offX+=r*(n.bounds.width-n.showRect.width)/p)}else if("y"===o&&(p=n.vScrollBounds.height-n.vScrollSlider.height)>0){var q=n.vScrollSlider.y-n.vScrollBounds.y+(a.y-d.preY);q=0>q?0:q>p?p:q;var r=q-n.vScrollSlider.y+n.vScrollBounds.y;0!==r&&(c.offY+=r*(n.bounds.height-n.showRect.height)/p)}return d.preX=a.x,d.preY=a.y,void b._repaintPainter()}if(5===d.type){var n=c.drawInfo,o=d.axis;return"x"===o?c.changeHScrollInfo(d.dir<0?a.x-d.preX:0,d.dir>0?a.x-d.preX:0):c.changeVScrollInfo(d.dir<0?a.y-d.preY:0,d.dir>0?a.y-d.preY:0),d.preX=a.x,d.preY=a.y,void b._repaintPainter()}return 9===d.type?(c.offX-=a.x-d.preX,c.offY-=a.y-d.preY,d.preX=a.x,d.preY=a.y,void b._repaintPainter()):void 0}},Xa.prototype.onZoom=function(a,b,c){var d=this,e=d._painter,f={x:e.xPrecisionValue(a.x),y:e.yPrecisionValue(a.y)};c>0?(e.zoomX*=1.05,e.zoomY*=1.05):0>c&&(e.zoomX/=1.05,e.zoomY/=1.05),e.offX=e.paddingLeft+e.zeroX+f.x*e.zoomX-a.x,e.offY=e.paddingTop+e.zeroY-f.y*e.zoomY-a.y,d._repaintPainter()};var Ya=m("qc.editor.CurvePainter",qc.editor.Painter,function pe(a){var b=this;b._contextMenu=new qc.editor.ContextMenu,pe["super"].constructor.call(b,a),b.addBottomPainter(b.draw.bind(b)),b.interactor=new qc.editor.CurvePainterInteractor(b),b.paddingTop=20,b.paddingBottom=35,b.paddingLeft=50,b.paddingRight=65,b.background=null,b.scrollSize=10,b.maxZoom=1e4});b.defineProperties(Ya.prototype,{bezierCurve:{get:function(){return this._bezierCurve},set:function(a){this.setPropertyValue("bezierCurve",a)}},curveShowRect:{get:function(){return{x:this.paddingLeft,y:this.paddingTop,width:(this.clientWidth||this.getPreferredSize().width)-this.paddingLeft-this.paddingRight,height:(this.clientHeight||this.getPreferredSize().height)-this.paddingTop-this.paddingBottom}}},zeroX:{get:function(){return isNaN(this._zeroX)?0:this._zeroX},set:function(a){this._zeroX=a}},zeroY:{get:function(){return isNaN(this._zeroY)?this.curveShowRect.height:this._zeroY},set:function(a){this._zeroY=a}},zoomX:{get:function(){var a=isNaN(this._zoomX)?this.curveShowRect.width:this._zoomX;return a},set:function(a){isNaN(a)||a===1/0||a===-(1/0)||0>a||(this._zoomX=a)}},zoomY:{get:function(){var a=isNaN(this._zoomY)?this.curveShowRect.height:this._zoomY;return a},set:function(a){isNaN(a)||a===1/0||a===-(1/0)||0>a||(this._zoomY=a)}},offX:{get:function(){return isNaN(this._offX)?0:this._offX},set:function(a){this._offX=a}},offY:{get:function(){return isNaN(this._offY)?0:this._offY},set:function(a){this._offY=a}},controlLength:{get:function(){return isNaN(this._controlLength)?50:this._controlLength},set:function(a){this._controlLength=a}},drawInfo:{get:function(){return this._drawInfo}},wrapDrawInfo:{get:function(){return this._wrapDrawInfo}},horScrollBounds:{get:function(){var a=5;return{x:a+1.5*this.scrollSize,y:(this.clientHeight||this.getPreferredSize().height)-a-this.scrollSize,width:Math.max(this.scrollSize,(this.clientWidth||this.getPreferredSize().width)-2*a-4*this.scrollSize),height:this.scrollSize}}},verScrollBounds:{get:function(){var a=5;return{x:(this.clientWidth||this.getPreferredSize().width)-a-this.scrollSize,y:a+1.5*this.scrollSize,width:this.scrollSize,height:Math.max((this.clientHeight||this.getPreferredSize().height)-2*a-4*this.scrollSize,this.scrollSize)}}}}),Ya.prototype._stepCalc=function(a){a=Math.abs(a);for(var b=0;a>10;)a/=10,b++;for(;1>a;)a=10*a,b--;return Math.pow(10,b)},Ya.prototype.getMinStepX=function(){return this._stepCalc(20/this.zoomX)},Ya.prototype.getMinStepY=function(){return this._stepCalc(10/this.zoomY)},Ya.prototype.getPrecisionX=function(){var a=this,b=a.curveShowRect,c=2*Math.abs((a.xValue(b.x+b.width)-a.xValue(b.x))/b.width),d=a._stepCalc(c),e=c/d;return e>5?10*d:e>2?5*d:2*d},Ya.prototype.getPrecisionY=function(){var a=this,b=a.curveShowRect,c=2*Math.abs((a.yValue(b.y+b.height)-a.yValue(b.y))/b.height),d=a._stepCalc(c),e=c/d;return 2>e?d:5>e?2*d:5*d},Ya.prototype.xPos=function(a){var b=this,c=b.paddingLeft+b.zeroX+a*b.zoomX-b.offX;return c},Ya.prototype.yPos=function(a){var b=this,c=b.paddingTop+b.zeroY-a*b.zoomY-b.offY;return c},Ya.prototype.xValue=function(a){var b=this;return(a-b.zeroX-b.paddingLeft+b.offX)/b.zoomX},Ya.prototype.yValue=function(a){var b=this;return(b.paddingTop+b.zeroY-b.offY-a)/b.zoomY},Ya.prototype.xPrecisionValue=function(a){var b=this,c=b.getPrecisionX(),d=(a-b.zeroX-b.paddingLeft+b.offX)/b.zoomX;return Math.round(Math.round(d/c)*c*1e4)/1e4},Ya.prototype.yPrecisionValue=function(a){var b=this,c=b.getPrecisionY(),d=(b.paddingTop+b.zeroY-b.offY-a)/b.zoomY;return Math.round(Math.round(d/c)*c*1e4)/1e4},Ya.prototype.draw=function(a){var b=this,c=b.bezierCurve;c&&(this.drawGrid(a),this.drawWrapCurve(a,c),this.drawCurve(a,c,b.zoomX,b.zoomY,b.xPos.bind(b),b.yPos.bind(b),b.xValue.bind(b),b.yValue.bind(b)),this.drawControl(a,c,b.controlLength,b.zoomX,b.zoomY,b.xPos.bind(b),b.yPos.bind(b),b.xValue.bind(b),b.yValue.bind(b)),this.drawCurveInfo(a,c),this.drawScroll(a))},Ya.prototype.drawGrid=function(a){var b=this.getMinStepX(),c=this.getMinStepY(),d=this.xValue(0),e=this.yValue(0),f=this.xValue(this.clientWidth||this.getPreferredSize().width),g=this.yValue(this.clientHeight||this.getPreferredSize().height);d=Math.floor(d/b)*b,e=Math.floor(e/c)*c,f=Math.ceil(f/b)*b,g=Math.ceil(g/c)*c,a.strokeStyle="rgba(117, 117, 117, 0.3)",a.lineWidth=.3,a.beginPath();for(var h=e;h>=g;h-=c)5===Math.abs(Math.round(h/c%10))&&(a.moveTo(this.xPos(d),this.yPos(h)),a.lineTo(this.xPos(f),this.yPos(h)));for(var i=d;f>=i;i+=b)5===Math.abs(Math.round(i/b%10))&&(a.moveTo(this.xPos(i),this.yPos(e)),a.lineTo(this.xPos(i),this.yPos(g)));a.stroke(),a.closePath(),a.strokeStyle="rgba(117, 117, 117, 0.5)",a.lineWidth=1,a.beginPath();for(var h=e;h>=g;h-=c)0===Math.abs(Math.round(h/c)%10)&&(a.moveTo(this.xPos(d),this.yPos(h)),a.lineTo(this.xPos(f),this.yPos(h)));for(var i=d;f>=i;i+=b)0===Math.abs(Math.round(i/b)%10)&&(a.moveTo(this.xPos(i),this.yPos(e)),a.lineTo(this.xPos(i),this.yPos(g)));a.stroke(),a.closePath(),a.font="12px",a.fillStyle="rgba(117, 117, 117, 0.8)";var j=Math.ceil(25/(c*this.zoomY*5)),k=Math.ceil(50/(b*this.zoomX*5));j=5*(1===j?j:2*Math.ceil(j/2)),k=5*(1===k?k:2*Math.ceil(k/2)),a.textAlign="left",a.textBaseline="bottom";for(var h=e;h>=g;h-=c)0===Math.abs(Math.round(h/c)%j)&&a.fillText(Math.round(1e4*h)/1e4,5,this.yPos(h));for(var i=d;f>=i;i+=b)0===Math.abs(Math.round(i/b)%k)&&a.fillText(Math.round(1e4*i)/1e4,this.xPos(i),(this.clientHeight||this.getPreferredSize().height)-25)},Ya.prototype.drawWrapCurve=function(a,b){if(0!==b.keys.length){var c=0,d=this.xValue(c),e=b.evaluate(d),f=b.totalTime;for(a.strokeStyle="rgb(175, 175, 175)",a.lineWidth=1,a.beginPath(),a.moveTo(this.xPos(d),this.yPos(e));++c<=this.clientWidth;){var g=this.xValue(c),h=(g-b.startTime)%f;h=0>h?h+f:h;var i=(d-b.startTime)%f;i=0>i?i+f:i,i>h&&(d=b.startTime+Math.floor((g-b.startTime)/f)*f,e=b.evaluate(d,!0),a.lineTo(this.xPos(d),this.yPos(e))),d=g,e=b.evaluate(d,!0),a.lineTo(this.xPos(d),this.yPos(e))}a.stroke(),a.closePath()}},Ya.prototype.drawCurve=function(a,b,c,d,e,f){this._curveField=null;var g=1/c,h=b.keys;if(!(h.length<=0)){var i=this.interactor&&this.interactor._editorTarget,j=h[0].time,k=h[h.length-1].time,l=j,m=h[0].value,n=j,o=h[0].value;a.strokeStyle=i&&3===i.type?"rgb(121, 255, 121)":"rgb(0, 200, 0)",a.lineWidth=1,a.beginPath(),a.moveTo(e(j),f(q));for(var p=j;k>p;p+=g){var q=b.evaluate(p);a.lineTo(e(p),f(q)),l=Math.min(p,l),n=Math.max(p,n),m=Math.min(q,m),o=Math.max(q,o)}var q=h[h.length-1].value;l=Math.min(k,l),n=Math.max(k,n),m=Math.min(q,m),o=Math.max(q,o),a.lineTo(e(k),f(q)),a.stroke(),a.closePath(),a.fillStyle="rgb(0, 255, 0)",a.lineWidth=1,a.beginPath();for(var r=0;r<h.length;r++)a.moveTo(e(h[r].time),f(h[r].value)),a.arc(e(h[r].time),f(h[r].value),2,0,2*Math.PI);return a.fill(),a.closePath(),this._curveField=[l,n,m,o],this._curveField}},Ya.prototype.drawControl=function(a,b,c,d,e,f,g){for(var h=b.keys,i=this.interactor&&this.interactor._downKey,j=this.interactor&&this.interactor._editorTarget,k=j&&j.type>=0&&j.type<=2?j.idx:-1,l=j?j.type:-1,m=0;m<h.length;m++)i&&i===h[m]&&(a.fillStyle=k===m?"rgba(230, 230, 230, 1)":"rgba(212, 212, 212, 0.8)",a.lineWidth=1,a.beginPath(),a.moveTo(f(h[m].time),g(h[m].value)),a.arc(f(h[m].time),g(h[m].value),2.5,0,2*Math.PI),a.fill(),a.closePath());for(var m=0;m<h.length;m++)if(i&&i===h[m]&&h[m].type!==qc.Keyframe.AUTO){if(a.strokeStyle=k===m&&1===l?"rgba(230, 230, 230, 1)":"rgba(212, 212, 212, 0.8)",a.lineWidth=1,a.beginPath(),0!==m){a.moveTo(f(h[m].time),g(h[m].value));var n=Math.atan(h[m].inTangent);n=Math.atan2(Math.sin(n)*e,Math.cos(n)*d);var o=c*Math.cos(n),p=c*Math.sin(n);a.lineTo(f(h[m].time)-o,g(h[m].value)+p),a.arc(f(h[m].time)-o,g(h[m].value)+p,1.5,0,2*Math.PI)}if(a.stroke(),a.closePath(),a.strokeStyle=k===m&&2===l?"rgba(230, 230, 230, 1)":"rgba(212, 212, 212, 0.8)",a.beginPath(),m!==h.length-1){a.moveTo(f(h[m].time),g(h[m].value));var n=Math.atan(h[m].outTangent);n=Math.atan2(Math.sin(n)*e,Math.cos(n)*d);var o=c*Math.cos(n),p=c*Math.sin(n);a.lineTo(f(h[m].time)+o,g(h[m].value)-p),a.arc(f(h[m].time)+o,g(h[m].value)-p,1.5,0,2*Math.PI)}a.stroke(),a.closePath()}},Ya.prototype.drawCurveInfo=function(a,b){var c=this,d=c.interactor&&c.interactor.getMovingKey();if(a.fillStyle="rgba(212, 212, 212, 0.8)",a.font="24px",d)for(var e=d.length;e--;){var f=d[e];a.textAlign="center",a.textBaseline="bottom",a.fillText("("+f.time+","+f.value+")",this.xPos(f.time),this.yPos(f.value))}var g=b.keys;if(g.length>0){var h=["Clamp","Loop","PingPong"];a.textAlign="right",a.textBaseline="top",a.fillText(h[b.preWrapMode],this.xPos(g[0].time),this.yPos(g[0].value));var i=a.measureText(h[b.preWrapMode]);a.textAlign="left",a.fillText(h[b.postWrapMode],this.xPos(g[g.length-1].time),this.yPos(g[g.length-1].value));var j=a.measureText(h[b.postWrapMode]);this._wrapDrawInfo=[{x:this.xPos(g[0].time)-i.width,y:this.yPos(g[0].value),width:i.width,height:24},{x:this.xPos(g[g.length-1].time),y:this.yPos(g[g.length-1].value),width:j.width,height:24}]}else this._wrapDrawInfo=null},Ya.prototype.drawScroll=function(a){var b=this,c=this._curveField;if(c){var d=this.scrollSize,e=b.curveShowRect,f=b.horScrollBounds,g=b.verScrollBounds,h={x:Math.min(e.x,this.xPos(c[0])),y:Math.min(e.y,this.yPos(c[3])),width:Math.max(e.x+e.width,this.xPos(c[1]))-Math.min(e.x,this.xPos(c[0])),height:Math.max(e.y+e.height,this.yPos(c[2]))-Math.min(e.y,this.yPos(c[3]))},i={width:f.width*e.width/h.width,height:f.height,x:f.x,y:f.y};if(h.x!==e.x&&h.width>e.width&&i.width<f.width){var j=(e.x-h.x)*(f.width-i.width)/(h.width-e.width);i.x+=Math.max(j,0)}var k={width:g.width,height:g.height*e.height/h.height,x:g.x,y:g.y};if(h.y!==e.y&&h.height>e.height&&k.height<g.height){var l=(e.y-h.y)*(g.height-k.height)/(h.height-e.height);k.y+=Math.max(l,0)}a.fillStyle="rgb(29, 28, 29)",a.fillRect(i.x-.5*d,i.y,i.width+d,i.height),a.fillRect(k.x,k.y-.5*d,k.width,k.height+d),a.fillStyle="rgb(61, 61, 61)",a.lineWidth=1,a.beginPath(),a.moveTo(i.x-d,i.y+d/2),a.arc(i.x-d,i.y+d/2,d/2,0,2*Math.PI),a.rect(i.x-d,i.y,d/2,d),a.moveTo(i.x+i.width+d,i.y+d/2),a.arc(i.x+i.width+d,i.y+d/2,d/2,0,2*Math.PI),a.rect(i.x+i.width+.5*d,i.y,d/2,d),a.moveTo(k.x+d/2,k.y-d),a.arc(k.x+d/2,k.y-d,d/2,0,2*Math.PI),a.rect(k.x,k.y-d,d,d/2),a.moveTo(k.x+d/2,k.y+k.height+d),a.arc(k.x+d/2,k.y+k.height+d,d/2,0,2*Math.PI),a.rect(k.x,k.y+k.height+.5*d,d,d/2),a.fill(),a.closePath(),a.strokeStyle="rgb(15, 15, 15)",a.lineWidth=1,a.beginPath(),a.moveTo(i.x-d,i.y),a.lineTo(i.x+i.width+d,i.y),a.moveTo(i.x-d,i.y+d),a.lineTo(i.x+i.width+d,i.y+d),a.moveTo(i.x-d,i.y+d),a.arc(i.x-d,i.y+d/2,d/2,.5*Math.PI,1.5*Math.PI),a.moveTo(i.x+i.width+d,i.y),a.arc(i.x+i.width+d,i.y+d/2,d/2,-.5*Math.PI,.5*Math.PI),a.moveTo(k.x,k.y-d),a.lineTo(k.x,k.y+k.height+d),a.moveTo(k.x+d,k.y-d),a.lineTo(k.x+d,k.y+k.height+d),a.moveTo(k.x,k.y-d),a.arc(k.x+d/2,k.y-d,d/2,Math.PI,2*Math.PI),a.moveTo(k.x+d,k.y+k.height+d),a.arc(k.x+d/2,k.y+k.height+d,d/2,0,Math.PI),a.stroke(),a.closePath(),this._drawInfo={showRect:e,bounds:h,vScrollBounds:g,hScrollBounds:f,vScrollSlider:k,hScrollSlider:i,scrollSize:d}}},Ya.prototype.changeScroll=function(a,b,c,d,e,f){if(0!==e){if(0>e&&d.start<=c.start)return;if(e>0&&b.start>a.start)b.start=Math.max(b.start-e,a.start),b.len=b.end-b.start;else{if(d.start+=e,d.start=Math.max(d.start,c.start),d.start=Math.min(d.start,d.end),d.start===d.end)return;var g=d.start-c.start,h=c.end-d.end,i=c.len-g-h,j=b.start,k=b.end;j=a.start-a.len*g/i,b.end>=a.end&&(k=a.end+a.len*h/i),b.start=j,b.end=k,b.len=b.end-b.start}}else if(0!==f){if(f>0&&d.end>=c.end)return;if(0>f&&b.end<a.end)b.end=Math.min(b.end-f,a.end),b.len=b.end-b.start;else{if(d.end+=f,d.end=Math.min(d.end,c.end),d.end=Math.max(d.end,d.start),d.end===d.start)return;var g=d.start-c.start,h=c.end-d.end,i=c.len-g-h,j=b.start,k=b.end;k=a.end+a.len*h/i,b.start<a.start&&(j=a.start-a.len*g/i),b.start=j,b.end=k,b.len=b.end-b.start}}return b},Ya.prototype.changeHScrollInfo=function(a,b){var c=this,d=this._curveField;if(d){var e=c.curveShowRect,f=c.horScrollBounds,g=c.drawInfo.hScrollSlider,h={start:e.x,end:e.x+e.width,len:e.width},i={start:f.x,end:f.x+f.width,len:f.width},j={start:g.x,end:g.x+g.width,len:g.width},k={start:this.xPos(d[0]),end:this.xPos(d[1]),len:this.xPos(d[1])-this.xPos(d[0])};if(0!==k.len&&(this.changeScroll(h,k,i,j,a,b),0!==k.len)){var l=k.end-k.start;this.zoomX=3e-9>l?.1/Math.abs(d[1]-d[0]):(k.end-k.start)/Math.abs(d[1]-d[0]),this.offX=this.paddingLeft+this.zeroX+d[0]*this.zoomX-k.start}}},Ya.prototype.changeVScrollInfo=function(a,b){var c=this,d=this._curveField;if(d){var e=c.curveShowRect,f=c.verScrollBounds,g=c.drawInfo.vScrollSlider,h={start:e.y,end:e.y+e.height,len:e.height},i={start:f.y,end:f.y+f.height,len:f.height},j={start:g.y,end:g.y+g.height,len:g.height},k={start:this.yPos(d[3]),end:this.yPos(d[2]),len:this.yPos(d[2])-this.yPos(d[3])};if(0!==k.len&&(this.changeScroll(h,k,i,j,a,b),0!==k.len)){var l=k.end-k.start;this.zoomY=3e-9>l?.1/Math.abs(d[2]-d[3]):(k.end-k.start)/Math.abs(d[2]-d[3]),this.offY=this.paddingTop+this.zeroY-d[3]*this.zoomY-k.start}}},Ya.prototype.adjustCurve=function(a){var b=this,d=b.bezierCurve;if(a=a==c?255:a,d){var e=d.keys;if(0!==e.length){for(var f=e[0].time,g=e[e.length-1].time,h=b.curveShowRect,i=e[0].value,j=e[0].value,k=1/h.width,l=f;(l+=k)<g;){var m=d.evaluate(l);i=Math.min(i,m),j=Math.max(j,m)}var m=d.evaluate(g);i=Math.min(i,m),j=Math.max(j,m),0!==(1&a)&&(b.zoomX=h.width/(3e-9>g-f?1:g-f),b.offX=b.paddingLeft+b.zeroX+f*b.zoomX-b.paddingLeft),0!==(2&a)&&(b.zoomY=h.height/(3e-9>j-i?1:j-i),b.offY=b.paddingTop+b.zeroY-j*b.zoomY-b.paddingTop),b.iv()}}},Ya.prototype.onPropertyChange=function(){this.iv()},Ya.prototype.drawBorder=function(){},Ya.prototype.getPreferredSize=function(){return{width:600,height:400}},Ya.prototype.calculateClientWidth=function(){return this.width},Ya.prototype.calculateClientHeight=function(){return this.height};var Za=m(null,b,function(a){var b=this;b._list=a,b.addListeners()},{clear:function(){},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){var b=this,c=b.view,d=c.lp(a),e=c.getDataAt(a);if(e){var f=c.width-c.rowHeight-8;d.x>=f&&d.x<=f+c.rowHeight-8?c.removable&&c.dataModel.remove(e):c.emit("clickData",e)}else c.focusData=null},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(){}},{interactor:!0},{view:{get:function(){return this._list}}}),$a=m("qc.editor.InspectorList",qc.widget.List,function qe(a){var b=this;qe["super"].constructor.call(b),k.initObject(b,a),new Za(b),b.addTopPainter(b.drawDNDState),b.addBottomPainter(b.drawBackground.bind(b));var c=b.validateImpl;b.validateImpl=function(){b.view.style.border="1px solid "+b._borderColor,c.call(b)};var d=b.drawRow;b.drawRow=function(a,c,e,f,g,h){if(d.call(b,a,c,e,f,g,h),b.removable){a.beginPath(),a.strokeStyle="black";var i={width:h,height:h,comps:[{type:"shape",points:[0,0,h,h],segments:[1,2],borderWidth:2,borderColor:b.labelColor},{type:"shape",points:[0,h,h,0],segments:[1,2],borderWidth:2,borderColor:b.labelColor}]};k.drawImage(a,i,null,g-h-8,f+4,h-8,h-8)}}});$a.prototype.drawBackground=function(a){var b=this,c=b.clientWidth,d=b.clientHeight;a.beginPath(),a.rect(0,-b.translateY,c,d),a.fillStyle=b._background,a.fill()},$a.prototype.drawDNDState=function(a){if(this.dragInfo){var b=this.clientWidth,c=this.rowHeight,d=this.dragInfo.rowIndex,e=this.dragInfo.type;d>=0&&(a.beginPath(),"up"===e?(a.moveTo(0,d*c),a.lineTo(b,d*c)):"down"===e&&(a.moveTo(0,(d+1)*c),a.lineTo(b,(d+1)*c)),a.strokeStyle="#507aea",a.lineWidth=2,a.stroke())}},$a.prototype._clearDragInfo=function(){ga.dragAndDrop.hideTip(),this.dragInfo&&(this.dragInfo=null,this.iv())},$a.prototype._dragging=function(a){var b=this.dragInfo;if(b){var c=this.rowHeight,d=this.lp(a),e=d.y/c,f=Math.floor(e);if(f>this.rowDatas.length-1)b.rowIndex=this.rowDatas.length-1,b.type="down";else{b.rowIndex=f;var g=d.y-f*c;.3*c>g?b.type="up":g>.7*c&&(b.type="down")}this.autoScroll(a),this.iv()}},$a.prototype._endDrag=function(){var a=this.dragInfo;if(a){var b=a.rowIndex,c=a.sourceData;if(!c)return void this._clearDragInfo();this.dataModel.moveTo(c,b),this._clearDragInfo()}},$a.prototype.handleDragAndDrop=function(a,b){if(this._draggable){if("prepare"===b||"cancel"===b)return void this._clearDragInfo();if("begin"===b||"between"===b){if("begin"===b){var c=this.draggingData;c&&(this.focusData=c,this.dragInfo={sourceData:c})}this._dragging(a),ga.dragAndDrop.showTip(this.dragInfo.sourceData.name,a)}else"end"===b&&this._endDrag(a)}},b.defineProperties($a.prototype,{draggable:{get:function(){return this._draggable},set:function(a){this.setPropertyValue("draggable",a)}},removable:{get:function(){return this._removable},set:function(a){this.setPropertyValue("removable",a)}},checkable:{get:function(){return"check"===this.checkMode},set:function(a){this.checkMode=a?"check":null}}}),$a.prototype.calculateClientWidth=function(){return this.width-2},$a.prototype.calculateClientHeight=function(){return this.height-2};var _a=m("qc.editor.ProjectActionPane",qc.widget.Container,function re(a){var b=this;re["super"].constructor.call(b,a),b.layout=new qc.widget.layout.VBoxLayout(b),b.layout.padding=10,b.layout.gap=0,b.initUI()});_a.prototype.initUI=function(){var a=function(a){var b=new qc.widget.ToggleButton;return b.text=a,b.borderWidth=0,b.textFont="20px Arial",b.preferredSize={height:30},b.textColor="#caccd8",b.align="left",b.background=null,b.gradientColor=null,b.activeBackground="#3e4b6b",b.activeGradientColor=null,b.hoverBackground="rgb(72, 72, 72)",b.hoverGradientColor=null,b},b=this,c=a(ga._("Recent Projects")),d=a(ga._("New Project")),e=a(ga._("Open Project")),f=new qc.widget.Radios;c.on("propertyChange",b.handleRecentProjectButtonSelect.bind(b)),d.on("propertyChange",b.handleNewProjectButtonSelect.bind(b)),e.on("propertyChange",b.handleOpenFolderButtonSelect.bind(b)),f.add(c),f.add(d),f.add(e),b.setItems([c,d,e]),U(function(){c.selected=!0})},_a.prototype.handleRecentProjectButtonSelect=function(a){if("selected"===a.property&&a.newValue){var b=new bb;qc.editor.Operation.RECENT_OPEN(function(a){if(a)for(var c=0;c<a.length;c++)b.add(a[c])}),ga.mainLayout.centerView=b}},_a.prototype.handleNewProjectButtonSelect=function(b){if("selected"===b.property&&b.newValue){var c=new ab;ga.mainLayout.centerView=c,c.on("create",function(b){var c=b.path;c?qc.editor.Operation.CREATE_PROJECT(c,function(b,d){b?qc.editor.Operation.OPEN_PROJECT(c,function(b){b?(ga.storage.set("switchProject","1"),a.location.href="./index.html"):ga.notification.error(ga._("Open project failed."))}):ga.notification.error(ga._("Create project failed.")+" Reason:"+d)}):ga.notification.error(ga._("Please choose a folder to create the project"))})}},_a.prototype.handleOpenFolderButtonSelect=function(a){if("selected"===a.property&&a.newValue){var b=new cb;ga.mainLayout.centerView=b}},b.defineProperties(_a.prototype,{});var ab=m("qc.editor.CreateProjectPane",qc.widget.Container,function se(a){var b=this;se["super"].constructor.call(b,a),b.layout=new qc.widget.layout.TableLayout(b),b.initUI()});ab.prototype.initUI=function(){var a=this,b=[{height:50,widths:[a.labelWidth||140,"40+0.1",50],cells:[{colspan:3,elementConfig:{type:"label",textColor:"#caccd8",textFont:"28px Arial",text:ga._("Create a new project")}}]},{cells:[{elementConfig:{type:"label",textColor:"#caccd8",align:"left",textFont:"13px Arial",text:ga._("Project Folder")}},{elementConfig:{type:"textfield",font:"13px Arial",id:"projectDirectory"}},{elementConfig:{type:"button",id:"picker",ninePatchImage:"inspector_button.9",ninePatchBorder:[10,10,10,10],hoverNinePatchImage:"inspector_button.9",hoverNinePatchBorder:[10,10,10,10],activeNinePatchImage:"inspector_button_active.9",activeNinePatchBorder:[10,10,10,10],textColor:"#caccd8",borderWidth:0,textFont:"13px Arial",text:"..."}}]},{cells:[]},{cells:[{fill:"none",align:"right",colspan:3,elementConfig:{type:"button",id:"create",ninePatchImage:"inspector_button.9",ninePatchBorder:[10,10,10,10],hoverNinePatchImage:"inspector_button.9",hoverNinePatchBorder:[10,10,10,10],activeNinePatchImage:"inspector_button_active.9",activeNinePatchBorder:[10,10,10,10],textColor:"#caccd8",preferredSize:{width:100,height:40},borderWidth:0,textFont:"13px Arial",text:ga._("Create")}}]}];k.inflate(b,a);var c=a.findViewById("picker");c.on("click",function(){var b=new db;b.onFolderChoosed=function(b){a.findViewById("projectDirectory").value=b},b.openFolderChooser()});var d=a.findViewById("create");d.on("click",function(){var b=a.findViewById("projectDirectory").value;a.emit("create",{path:b})})},b.defineProperties(ab.prototype,{});var bb=m("qc.editor.RecentProjectPane",qc.widget.Container,function te(a){var b=this;te["super"].constructor.call(b,a),b.layout=new qc.widget.layout.TableLayout(b),b.layout.padding=10,b.initUI()});bb.prototype.add=function(a){var b=this,c=b._list,d=new qc.widget.Data;d.name=a,c.dataModel.add(d)},bb.prototype.initUI=function(){var b=this,c=b._list=new qc.widget.List,d=new qc.widget.Label({text:ga._("Search:"),textColor:"#caccd8",align:"left"}),e=b._txtSearch=new qc.editor.StringInput,f=new qc.widget.Label({text:ga._("Recent Opened Projects"),textFont:"28px Arial",textColor:"#caccd8"});c.rowHeight=30,c.view.addEventListener("click",function(a){var b=c.lp(a),d=c.getDataAt(a),e=c.width;b.x>e-30&&qc.editor.Operation.REMOVE_RECENT_OPEN(d.name,function(a){a.operRet&&(c.dataModel.remove(d),
ga.notification.info(ga._("Project has been removed successfully.")))})}),c.view.addEventListener("dblclick",function(b){var d=c.lp(b),e=c.getDataAt(b),f=c.width;d.x>f-30||qc.editor.Operation.OPEN_PROJECT(e.name,function(b){b?(ga.storage.set("switchProject","1"),a.location.href="./index.html"):ga.notification.error(ga._("Open project failed."))})});var g=c.drawRow,h={width:20,height:20,comps:[{type:"shape",points:[0,0,20,20],segments:[1,2],background:null,borderWidth:2,borderColor:"red"},{type:"shape",points:[0,20,20,0],segments:[1,2],background:null,borderWidth:2,borderColor:"red"}]};c.view.style.background="rgb(65, 65, 65)",c.view.style.border="1px solid rgb(32, 32, 32)",c.calculateClientWidth=function(){return this.width-2},c.calculateClientHeight=function(){return this.height-2},c.drawRowBackground=function(a,b,d,e,f,g){c.isSelected(b)?k.fillRect(a,d,e,f,g,c.getSelectBackground(b)):c._hoverData===b&&k.fillRect(a,d,e,f,g,"rgb(72, 72, 72)")},c.addEventListener("mousemove",function(a){var b=c.getDataAt(a);b!==c._hoverData&&c.iv(),c._hoverData=b}),c.drawRow=function(a,b,d,e,f,i){g.call(c,a,b,d,e,f,i),b===c._hoverData&&k.drawImage(a,h,"centerUniform",f-30,e+7,16,16,b,c)},e.onValueChanged=function(a){c.visibleFunc=a?function(b){return b.name.indexOf(a)>=0?!0:void 0}:null},b.setItems([{height:50,widths:[140,.1],cells:[{colspan:2,element:f}]},{cells:[{element:d},{element:e}]},{height:.1,cells:[{colspan:2,element:c}]}])},b.defineProperties(bb.prototype,{});var cb=m("qc.editor.OpenProjectPane",qc.widget.Container,function ue(a){var b=this;ue["super"].constructor.call(b,a),b.layout=new qc.widget.layout.TableLayout(b),b.initUI()});cb.prototype.initUI=function(){var b=this,c=[{height:50,widths:[140,"40+0.1",50],cells:[{colspan:3,elementConfig:{type:"label",textColor:"#caccd8",textFont:"28px Arial",text:ga._("Open Project")}}]},{cells:[{elementConfig:{type:"label",textColor:"#caccd8",align:"left",textFont:"13px Arial",text:ga._("Project Folder")}},{elementConfig:{type:"textfield",font:"13px Arial",id:"projectDirectory"}},{elementConfig:{type:"button",id:"picker",ninePatchImage:"inspector_button.9",ninePatchBorder:[10,10,10,10],hoverNinePatchImage:"inspector_button.9",hoverNinePatchBorder:[10,10,10,10],activeNinePatchImage:"inspector_button_active.9",activeNinePatchBorder:[10,10,10,10],textColor:"#caccd8",textFont:"13px Arial",borderWidth:0,text:"..."}}]},{cells:[]},{cells:[{fill:"none",align:"right",colspan:3,elementConfig:{type:"button",id:"open",ninePatchImage:"inspector_button.9",ninePatchBorder:[10,10,10,10],hoverNinePatchImage:"inspector_button.9",hoverNinePatchBorder:[10,10,10,10],activeNinePatchImage:"inspector_button_active.9",activeNinePatchBorder:[10,10,10,10],textColor:"#caccd8",preferredSize:{width:100,height:40},borderWidth:0,textFont:"13px Arial",text:ga._("Open")}}]}];k.inflate(c,b);var d=b.findViewById("picker");d.on("click",function(){var a=new db;a.onFolderChoosed=function(a){b.findViewById("projectDirectory").value=a},a.openFolderChooser()});var e=b.findViewById("open");e.on("click",function(){var c=b.findViewById("projectDirectory").value;c&&qc.editor.Operation.OPEN_PROJECT(c,function(b){b?(ga.storage.set("switchProject","1"),a.location.href="./index.html"):ga.notification.error(ga._("Open project failed."))})})},b.defineProperties(cb.prototype,{});var db=m("qc.editor.FolderChooser",b,function(a){var b=this;db["super"].constructor.call(b,a)});db.prototype.openFolderChooser=function(){var a=this;if($){var b=require("remote"),c=b.require("dialog"),d=c.showOpenDialog({properties:["openDirectory"]});k.isArray(d)&&(d=d[0]),a.onFolderChoosed&&d&&a.onFolderChoosed(d)}else{var c=new Oa;c.contentPadding=[2,2,2,2];var e=new qc.widget.Tree;c.title=ga._("Double click to choose the folder");var f=Cb(700,500);c.width=f.width,c.height=f.height,c.content=e,c.modal=!0,e.onDataDoubleClick=function(){c.hide();var b=e.selectionModel.selection[0];b&&a.onFolderChoosed&&a.onFolderChoosed(b.path),c.hide()},e.loader={load:function(b){a.inflateDir(b.path,e,b)},isLoaded:function(a){return a.hasChildren?a.isLoaded:!0}},a.inflateDir("",e),c.show()}},db.prototype.inflateDir=function(a,b,c){var d=this;c&&(c.isLoaded=!0),qc.editor.Operation.LIST_DIR(a,function(a){var e=0;a.sub.forEach(function(f){var g=new qc.widget.Data;g.icon="tree_folder",g.name=f,g.path=c?a.path+"/"+f:a.path+f,g.hasChildren=a.hasChildren[e],c&&(g.parent=c),b.dataModel.add(g),e++;var h=ga.projectPath||ga._defaultProjectPath;if(h){var i,j;k.isMac?(i=g.path.split("/"),j=h.split("/")):(i=g.path.split("//"),j=h.split("\\"));for(var l=!0,m=0;m<i.length;m++)if(i[m]!==j[m]){l=!1;break}l&&U(i.length===j.length-1?function(){b.selectionModel.selection=g,b.expand(g)}:function(){d.inflateDir(g.path,b,g)})}})})},b.defineProperties(db.prototype,{});var eb=function(a,b,c){return a instanceof qc.Node?a===a.game.world?!1:!b&&a._bone?!1:!c&&a instanceof qc.UIRoot?!1:!0:!1},fb=function(a){return!(!a||a instanceof qc.UIText||a instanceof qc.Sprite||a._bone)},gb=function(){var a=ga.hierarchy.activeNode;return a&&fb(a)?a:ga.dataModel.getDataById(ga.prefabInfo.prefab.uuid).node},hb=function(a){if(ga.prefabInfo)return gb();var b=ga.hierarchy.activeNode;if(fb(b))return b;if(!a)return ga.game.world;if(b)for(;b!=ga.game.world&&!(b instanceof qc.UIRoot);)b=b.parent;if(b instanceof qc.UIRoot)return b;for(var c=ga.dataModel.datas,d=0;d<c.length;d++)if(b=c[d].node,b instanceof qc.UIRoot)return b;return new qc.UIRoot(ga.game)},ib=function(){var a;a=ga.prefabInfo?ga.prefabInfo.treeData.name:ga.config.editor.currScene,a+="|"+ga.config.project.gameName+"|"+ga.projectPath,document.title=a},jb=function(){ga.workable&&null!=ga.config.project.backgroundColor&&(ga.game.stage.backgroundColor=new qc.Color(ga.config.project.backgroundColor))},kb=function(a,b,c,d,e){nb(a,b,[{text:ga._("OK"),key:"enter",onClick:function(){this.hide(),c&&c()}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide(),d&&d()}}],e)},lb=function(a,b,c,d,e){var f=new qc.widget.Container;f.layout.content=a,f.layout.htmlFont="13px Arial",f.layout.htmlColor="#caccd8";var g=f.getPreferredSize(280),h=new qc.widget.TextField;h.value=b,h.preferredSize={width:50,height:20};var i=new qc.editor.Dialog;i.title=ga._("Prompt"),i.width=300,i.height=110+g.height,i.contentPadding=[10,10,10,10],i.modal=!0,i._container.layout.bottomView.layout.padding=[0,0,0,0];var j=new qc.widget.Container;if(j.layout=new qc.widget.layout.TableLayout(j),j.layout.padding=0,j.layout.cellPadding=0,j.scrollbarMode="off",j.setItems([{height:g.height,widths:[.1],cells:[{fill:"fill",element:f}]},{height:.1,cells:[{fill:"h",vAlign:"middle",element:h}]}]),i.content=j,i.tools=[],i.buttons=[{text:ga._("OK"),onClick:function(){i.hide(),c&&c(h.value)}},{text:ga._("Cancel"),onClick:function(){i.hide(),d&&d()}}],h.input.addEventListener("keydown",function(a){G(a)?(i.hide(),c&&c(h.value)):F(a)&&(i.hide(),d&&d())},!1),e)for(var k in e)i[k]=e[k];i.show(),h.input.focus()},mb=function(a){var c=function(){return this.hide(),ga.playing?void ga.notification.warn(ga._("Quit running mode first")):ga.prefabInfo?void ga.notification.warn(ga._("Stop editing prefab first")):void(ga.config.editor.currScene&&"unsavedScene"!=ga.config.editor.currScene?(qc.editor.Operation.SAVE_SCENE(ga.config.editor.currScene),a()):lb(ga._("Enter the new scene name"),"",function(c){if(c){ga.config.editor.currScene=c,qc.editor.Operation.SAVE_SCENE(c),qc.editor.Operation.UPDATE_EDITOR_SETTINGS(ga.config.editor);var d=b.keys(ga.config.scene.scene);d.push(c),qc.editor.Operation.UPDATE_SCENE_SETTINGS(d),ib(),a()}else a()},function(){a()}))};ga.sceneManager.unsaved||ga.sceneManager.dirty?nb(ga._("Do you want to save the scene?"),ga._("Confirm"),[{text:ga._("Save"),key:"enter",onClick:c},{text:ga._("Don't Save"),onClick:function(){this.hide(),a()}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}]):a()},nb=function(a,b,c,d){var e=new qc.editor.Dialog({title:b,content:a,buttons:c,modal:!0,width:300,tools:[],dialogContentPadding:[0,0,10,0]});if(d)for(var f in d)e[f]=d[f];e.show();var g,h;return c&&c.forEach(function(a){"enter"===a.key?g=a:"esc"===a.key&&(h=a)}),e.view.addEventListener("keydown",function(a){G(a)&&g?g.onClick.call(e):F(a)&&h&&h.onClick.call(e)},!1),e.requestFocus(),e},ob=function(a){var b=a.rect;return[a.toGlobal({x:b.x,y:b.y}),a.toGlobal({x:b.x+b.width,y:b.y}),a.toGlobal({x:b.x+b.width,y:b.y+b.height}),a.toGlobal({x:b.x,y:b.y+b.height})]},pb=function(a,b){if(!eb(a))return!1;var c=a.rect,d=ob(a),e=d[0],f=d[1],g=d[2],h=d[3];return v(b,e)||v(b,f)||v(b,g)||v(b,h)||w(e,f,b)||w(f,g,b)||w(g,h,b)||w(h,e,b)?!0:(e=a.toLocal({x:b.x,y:b.y}),f=a.toLocal({x:b.x+b.width,y:b.y}),g=a.toLocal({x:b.x+b.width,y:b.y+b.height}),h=a.toLocal({x:b.x,y:b.y+b.height}),v(c,e)||v(c,f)||v(c,g)||v(c,h)||w(e,f,c)||w(f,g,c)||w(g,h,c)||w(h,e,c)?!0:!1)},qb=function(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y,h=c.x,i=c.y,j={},k=f-d,l=g-e,m=Math.sqrt(k*k+l*l),n=k/m,o=l/m,p=(-d+h)*n+(-e+i)*o;return 0>=p?(j.x=d,j.y=e):p>=m?(j.x=f,j.y=g):(j.x=d+p*n,j.y=e+p*o),k=h-j.x,l=i-j.y,j.z=Math.sqrt(k*k+l*l),j},rb=function(a){var b,c=new Uint8Array(a);try{b=String.fromCharCode.apply(null,c)}catch(d){b="";for(var e=0;e<c.length;e++)b+=String.fromCharCode(c[e])}return b},sb=function(a){var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return a.slice(Math.max(b,c)+1)},tb=function(a){var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return a.slice(0,Math.max(b,c))},ub=function(a){var b=a.lastIndexOf(".");return a.slice(b).toLowerCase()},vb=function(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y,h=c.x,i=c.y,j={},k=f-d,l=g-e,m=Math.sqrt(k*k+l*l),n=k/m,o=l/m,p=(-d+h)*n+(-e+i)*o;return j.x=d+p*n,j.y=e+p*o,k=h-j.x,l=i-j.y,j.z=Math.sqrt(k*k+l*l),j},wb=function(a,b,c){var d={x:a.x-b.x,y:a.y-b.y};if(c){var e=Math.sqrt(d.x*d.x+d.y*d.y);d.x/=e,d.y/=e}return d},xb=function(a){return null==a?a:parseFloat(a.toFixed(3))},yb=function(a,b,c){for(var d=a.length/2,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[2*f],i=a[2*f+1],j=a[2*g],k=a[2*g+1];(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e},zb=function(a){for(var b in a){var c=a[b];if(null!=c){var d=ga.mainContainer.findViewById(b),e=d.dataModel.getDataById(k.isString(c)?c:c[0]);if("fileTree"===b&&(d.selectionModel.selection=e),"fileList"===b&&k.isArray(c)&&e.followers){for(var f,g=e.followers,h=0;h<g.length;h++){var i=g[h];if(i.name==c[1]){f=i;break}}f&&(e.expand=!0,ga.fileList.validate(),e=f)}"fileList"===b?U(function(){d.makeVisible(e),d.blink(e)}):(d.makeVisible(e),d.blink(e))}}},Ab=function(a){a.strokeStyle="rgba(0,0,0,0.15)",a.lineWidth=2,a.stroke(),a.strokeStyle="white",a.lineWidth=1,a.stroke()},Bb=function(a){if(k.isMouseEvent(a)||!document.elementFromPoint)return a.target;var b=C(a);return document.elementFromPoint(b.x,b.y)},Cb=function(a,b){var c=k.getWindowInfo(),d=c.width,e=c.height;if(a>d||b>e){var f=Math.min(d/a,e/b);a*=f,b*=f}return{width:a,height:b}},Db=function(a,b,c){return b>a?b:a>c?c:a},Eb=function(a){if(!a)return!1;var b=a.tagName;return"INPUT"===b||"TEXTAREA"===b||"SELECT"===b},Fb=function(a){var b=arguments;return b.length<=1?a:a.replace(/\{(\d+)\}/g,function(a,c){return b[parseInt(c)+1]})},Gb=function(b){var c=Fb(ga._("Exception notification"),b);ga.notification?ga.notification.error(c):a.alert(c)},Hb=m("qc.editor.GameModel",qc.widget.DataModel,function(a){var b=this;b.game=a,Hb["super"].constructor.call(b),b._addNode(a.world),b.selectionModel.selectableFunc=function(b){return b.node!==a.world},a.world.onModelChange.add(this.handleWorldModelChange,b)});b.defineProperties(Hb.prototype,{lastEditableNode:{get:function(){for(var a=this.selectionModel.selection,b=a.length-1;b>=0;b--){var c=a[b].node;if(eb(c))return c}return null}}}),Hb.prototype.handleWorldModelChange=function(a){var b=a.type,c=a.target,d=c.parent,e=this.getDataById(c.uuid);if(e){if("name"===b)e.name=e.node.name;else if("destroy"===b)c===this.game.world?e.children.slice().forEach(this.remove,this):this.remove(e);else if("removeChildren"===b)e.children.slice().forEach(this.remove,this);else if("parent"===b)if(d){var f=this.getDataById(d.uuid);e.parent!==f&&(e.parent=f),this.moveTo(e,d.getChildIndex(c))}else this.remove(e)}else"parent"===b&&this._addNode(c)},Hb.prototype._createData=function(a){var b=new qc.widget.Data;return b.node=a,b.id=a.uuid,b.cache={},b.name=a.name,b},Hb.prototype._addNode=function(a){if(a.phaser.stage){var b=this._createData(a),c=a.parent;if(c instanceof qc.Node){var d=c.getChildIndex(a);this.getDataById(c.uuid).addChild(b,d)}this.add(b),a.children.forEach(this._addNode,this)}},Hb.prototype.getTopEditableSelection=function(a,b,c){var d=[],e=this.selectionModel.selection;if(a){e=e.slice();for(var f=e.length-1;f>=0;f--)a.isDescendantOf(e[f].node)&&e.splice(f,1)}var g={};return e.forEach(function(a){g[a.uuid]=!0}),e.forEach(function(a){if(eb(a.node,b,c)){for(var e=a.parent;e&&eb(e.node,b,c);){if(g[e.uuid]){a=null;break}e=e.parent}a&&d.push(a)}},this),d},Hb.prototype.moveSelection=function(a,b){this.getTopEditableSelection().forEach(function(c){var d=c.node,e=d.getWorldPosition();e.x+=a,e.y+=b,e=d.parent.toLocal(e),d.x=e.x,d.y=e.y}),ga.sceneManager.dirty=!0},Hb.prototype.createRenameUndoFunc=function(a){var b=this,c=a.name;return function(){b.getDataById(a.uuid)&&(a.name=c)}},Hb.prototype.createMoveUndoFunc=function(a,b){var c=this;if(b){var d=a.x,e=a.y;return function(){c.getDataById(a.uuid)&&(a.x=d,a.y=e)}}var f=c.getTopEditableSelection(),g=[],h=[];return f.forEach(function(a){var b=a.node;h.push(b),g.push({x:b.x,y:b.y})}),function(){for(var a=0;a<h.length;a++){var b=h[a];c.getDataById(b.uuid)&&(b.x=g[a].x,b.y=g[a].y)}}},Hb.prototype.createScaleUndoFunc=function(a,b){var c=this;if(b){var d=a.scaleX,e=a.scaleY;return function(){c.getDataById(a.uuid)&&(a.scaleX=d,a.scaleY=e)}}var f=c.getTopEditableSelection(a),g=[],h=[];return f.forEach(function(a){var b=a.node;h.push(b),g.push({scaleX:b.scaleX,scaleY:b.scaleY})}),function(){for(var a=0;a<h.length;a++){var b=h[a];c.getDataById(b.uuid)&&(b.scaleX=g[a].scaleX,b.scaleY=g[a].scaleY)}}},Hb.prototype.createRotationUndoFunc=function(a,b){var c=this;if(b){var d=a.rotation;return function(){c.getDataById(a.uuid)&&(a.rotation=d)}}var e=[],f=[],g=c.getTopEditableSelection(a);return g.forEach(function(a){var b=a.node;f.push(b),e.push(b.rotation)}),function(){for(var a=0;a<f.length;a++){var b=f[a];c.getDataById(b.uuid)&&(b.rotation=e[a])}}},Hb.prototype.createPivotUndoFunc=function(a){var b=this,c={pivotX:a.pivotX,pivotY:a.pivotY,x:a.x,y:a.y};return function(){b.getDataById(a.uuid)&&(a.pivotX=c.pivotX,a.pivotY=c.pivotY,a.x=c.x,a.y=c.y)}},Hb.prototype.createResizeUndoFunc=function(a){var b=this,c={x:a.x,y:a.y,width:a.width,height:a.height};return function(){b.getDataById(a.uuid)&&(a.x=c.x,a.y=c.y,a.width=c.width,a.height=c.height)}},Hb.prototype.createAnchorUndoFunc=function(a){var b=this,c={minX:a.minAnchor.x,minY:a.minAnchor.y,maxX:a.maxAnchor.x,maxY:a.maxAnchor.y,pivotX:a.pivotX,pivotY:a.pivotY,anchoredX:a.anchoredX,anchoredY:a.anchoredY,left:a.left,right:a.right,top:a.top,bottom:a.bottom,width:a.width,height:a.height};return function(){b.getDataById(a.uuid)&&(a._minAnchor=new qc.Point(c.minX,c.minY),a._maxAnchor=new qc.Point(c.maxX,c.maxY),a.phaser.anchor=new qc.Point(c.pivotX,c.pivotY),a._anchoredX=c.anchoredX,a._anchoredY=c.anchoredY,a._minAnchor.x<a._maxAnchor.x?(a._left=c.left,a._right=c.right):a.setWidth(c.width),a._minAnchor.y<a._maxAnchor.y?(a._top=c.top,a._bottom=c.bottom):a.setHeight(c.height),a.relayout())}},Hb.prototype.createParentUndoFunc=function(a){var b=this,c=b.createParentInfo(a);return function(){b.restoreParentInfo(c)}},Hb.prototype.createParentInfo=function(a){return{node:a,x:a.x,y:a.y,rotation:a.rotation,scaleX:a.scaleX,scaleY:a.scaleY,parent:a.parent,index:a.parent.getChildIndex(a)}},Hb.prototype.restoreParentInfo=function(a){var b=a.node,c=a.parent,d=a.index;this.getDataById(b.uuid)&&this.getDataById(c.uuid)&&(b.switchParent(c),d>=0&&d<=c.children.length&&c.setChildIndex(b,d),b.x=a.x,b.y=a.y,b.rotation=a.rotation,b.scaleX=a.scaleX,b.scaleY=a.scaleY,b._calcAnchoredX(),b._calcAnchoredY(),b._calcMargin())},Hb.prototype.deleteDatasForUndo=function(a){if(a&&0!==a.length){ga.sceneManager.dirty=!0,ga.undo.clearRedo();var b=this,c=[],d=[],e=[],f=a.length,g=[];a.forEach(function(a){var b=a.node;c.push(b),d.push(b.parent),e.push(b.parent.getChildIndex(b)),g.push(b.visible),b.visible&&(b.visible=!1),b.parent=null});var h=function(){for(var a=f-1;a>=0;a--){var h=c[a],i=d[a],j=e[a];b.getDataById(i.uuid)&&(h._destroy||(j>i.children.length?(console.log(h.name+"原先位置："+j+"，当前插入到："+i.children.length),i.addChild(h)):i.addChildAt(h,j),h.visible=g[a]))}},i=function(){for(var a=0;f>a;a++){var b=c[a];b._destroy||(b.visible=!1,b.parent=null)}},j=function(){for(var a=f-1;a>=0;a--){var b=c[a];b.parent||b._destroy||(console.log("销毁节点："+b.name),b.destroyImmediately())}};ga.undo.add(h,i,j)}},Hb.prototype.addNodeForUndo=function(a){this.addDatasForUndo([this.getDataById(a.uuid)])},Hb.prototype.addDatasForUndo=function(a){if(a&&0!==a.length){ga.sceneManager.dirty=!0;var b=this,c=[],d=[],e=[],f=a.length;a.forEach(function(a){var b=a.node;c.push(b),d.push(b.parent),e.push(b.parent.getChildIndex(b))});var g=function(){for(var a=f-1;a>=0;a--){var b=c[a];b._destroy||(b.parent=null)}},h=function(){for(var a=0;f>a;a++){var g=c[a],h=d[a],i=e[a];b.getDataById(h.uuid)&&(g._destroy||(i>h.children.length?(console.log(g.name+"原先位置："+i+"，当前插入到："+h.children.length),h.addChild(g)):h.addChildAt(g,i)))}},i=function(){for(var a=f-1;a>=0;a--){var b=c[a];b.parent||b._destroy||(console.log("销毁节点："+b.name),b.destroyImmediately())}};ga.undo.add(g,h,i)}};var Ib=qc.editor.GameDebugger=function(a){var b=this;b.game=a,b.dataModel=new qc.widget.DataModel,b._colorIndex=0;var d=b.tickData={};d.lastStart=0,d.start=0,d.ms=0;var e=a.phaser,f=e.update;e.update=function(){if(ga.scene.debugEnabled){var a=X(),g=d.start,h=a-g,i=Math.round(1e3/h),j=f.apply(this,arguments);if(!j)return;b.dataModel.forEach(function(a){a.hasValue&&(a.newValue?(a.a("value",a.newValue),a.a("label",a.newValue.toFixed(1))):(a.a("value",0),a.a("label","0.0")),a.newValue=0)}),d.lastStart=g,d.start=a,d.fps=i,d.interval=h;var k=e.renderer.renderSession.drawCount,l=X()-a;d.ms=l,d.lastUpdate?a-d.lastUpdate>=1e3?(d.averageFps=(d.sumFps/d.count).toFixed(1),d.averageMs=(d.sumMs/d.count).toFixed(1),d.sumFps=i,d.sumMs=l,d.count=1,d.lastUpdate=a):(d.sumFps+=i,d.sumMs+=l,d.count++):(d.averageFps=i.toFixed(1),d.averageMs=l.toFixed(1),d.sumFps=i,d.sumMs=l,d.count=1,d.lastUpdate=a),b.debugDiv.innerHTML="fps:"+d.averageFps+"<br>ms:"+d.averageMs+"<br>dc:"+(k===c?"(N/A)":k)+"<br>n:"+ga.dataModel.length,b._debugDialog&&b._debugDialog.visible&&b.statistics.updateFrame(d)}else f.apply(this,arguments)},b._createData("preUpdate"),b._wrap("physics","preUpdate"),b._wrap("state","preUpdate"),b._wrap("plugins","preUpdate"),b._wrap("stage","preUpdate"),b._createData("update"),b._wrap("state","update"),b._wrap("stage","update"),b._wrap("tweens","update"),b._wrap("sound","update"),b._wrap("input","update"),b._wrap("physics","update"),b._wrap("particles","update"),b._wrap("plugins","update"),b._createData("postUpdate"),b._wrap("stage","postUpdate"),b._wrap("plugins","postUpdate"),b._createData("preRender"),b._wrap("state","preRender"),b._createData("render"),b._wrap("renderer","render"),b._wrap("plugins","render"),b._wrap("state","render"),b._createData("postRender"),b._wrap("plugins","postRender")};Ib.prototype._colors=["#058DC7","#50B432","#ED561B","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4","#2b908f","#90ee7e","#f45b5b","#7798BF","#aaeeee","#ff0066","#eeaaee","#55BF3B","#DF5353","#7798BF","#aaeeee"],Ib.prototype._createData=function(a,b){var c=new qc.widget.Data;return c.name=a,c.id=b||a,this.dataModel.add(c),c},Ib.prototype._wrap=function(a,b){var c=this,d=c._createData(a,a+"."+b);d.parent=c.dataModel.getDataById(b),d.a("value",0),d.a("label","0.0"),d.hasValue=!0,d.color=this._colors[this._colorIndex++],d.icon="rect-color";var e=c.game.phaser[a],f=e[b];e[b]=function(){if(c._debugDialog&&c._debugDialog.visible){var a=X();f.apply(e,arguments),d.newValue=X()-a}else f.apply(e,arguments)}},Ib.prototype.destroy=function(){this._debugDiv&&r(this._debugDiv),this._debugDialog&&this._debugDialog.hide()},b.defineProperties(Ib.prototype,{debugDiv:{get:function(){var a=this;if(!a._debugDiv){var b=a._debugDiv=ga.scene.createDiv(),c=b.style;c.top="10px",c.right="10px",c.width="50px",c.cursor="pointer",b.onclick=function(){a.debugDialog.visible?a.debugDialog.hide():a.debugDialog.show()}}return a._debugDiv}},debugDialog:{get:function(){if(!this._debugDialog){var a=this.tree=new qc.widget.Tree(this.dataModel);a.getLabel=function(a){return a.hasValue?a.a("label")+" - "+a.name:a.name},a.expandAll();var b=this.statistics=new Jb(this.dataModel),c=new qc.widget.Container;c.layout=new qc.widget.layout.SplitLayout(c),c.layout.orientation="v",c.layout.position=.7,c.setItems([a,b]);var d=this._debugDialog=new qc.editor.Dialog;d.title="Performance Statistics",d.width=260,d.height=300,d.content=c,d.contentPadding=2}return this._debugDialog}}}),k.setImage("rect-color",{width:10,height:10,comps:[{type:"rect",rect:[0,0,10,10],background:{func:function(a){return a.color}}}]});var Jb=m(null,b,function(a){this.dataModel=a,this.initView(!1,!0),this._bufferCanvas=q(),this._div30=this._createDiv("&nbsp;33ms (30fps)"),this._div60=this._createDiv("&nbsp;16ms (60fps)"),this.iv()},{},{properties:["maxValue","frameWidth"],view:!0,emitter:!0});Jb.prototype._maxValue=50,Jb.prototype._frameWidth=1,Jb.prototype._lastWidth=-1,Jb.prototype._lastHeight=-1,Jb.prototype._lastMaxValue=-1,Jb.prototype._lastFrameWidth=-1,Jb.prototype.onPropertyChange=function(){this.iv()},Jb.prototype._createDiv=function(a){var b=p(!1,this.view),c=b.style;return c.position="absolute",c.color="rgba(200, 200, 200, 0.6)",c.background="rgba(200, 200, 200, 0.7)",c.font=k.labelFont,c.left="0px",c.height="1px",c.cursor="default",b.innerHTML=a,b},Jb.prototype.validateImpl=function(){var a=this.clientWidth,b=this.clientHeight;if(a!==this._lastWidth||b!==this._lastHeight||this.maxValue!==this._lastMaxValue||this.frameWidth!==this._lastFrameWidth){this._lastWidth=a,this._lastHeight=b,this._lastMaxValue=this.maxValue,this._lastFrameWidth=this.frameWidth,this._unit=b/this.maxValue,t(this._canvas,a,b),t(this._bufferCanvas,a-this.frameWidth,b),s(this._canvas,0,0,1,{x:0,y:0,width:a,height:b}).restore();var c=Math.round(33*this._unit),d=Math.round(16*this._unit),e=this._div30.style;e.top=b-c+"px",e.width=a+"px",e=this._div60.style,e.top=b-d+"px",e.width=a+"px"}},Jb.prototype.updateFrame=function(a){var b=this,c=b._lastWidth,d=b._lastHeight,e=b.frameWidth,f=c-e,g=b._canvas,h=b._bufferCanvas;s(h,0,0,1,{x:0,y:0,width:f,height:d}).restore();var i=s(h,0,0,1);i.drawImage(g,e,0,f,d,0,0,f,d),i.restore(),i=s(g,0,0,1,{x:0,y:0,width:c,height:d}),i.drawImage(h,0,0);var j=d;b.dataModel.forEach(function(a){var c=a.color;if(c){var d=a.a("value");if(d>0){var g=b._unit*d;i.beginPath(),i.fillStyle=c,i.fillRect(f,j-g,e,g),j-=g}}}),i.beginPath(),i.fillStyle="rgb(0,255,0)",i.fillRect(f,d-b._unit*a.interval,e,1),i.restore()};var Kb=qc.editor.Undo=function(){this.reset()};Kb.prototype={},Kb.prototype.constructor=Kb,Kb.prototype._limit=30,Kb.prototype._checkLimit=function(){for(;this.length>0&&this.length>this.limit;){var a=this._events.splice(0,1)[0];a.destroy&&a.destroy(),this._position>=0&&this._position--}},Kb.prototype.reset=function(){if(this._events)for(var a=0;a<this._events.length;a++){var b=this._events[a];b.destroy&&b.destroy()}this._events=[],this._position=-1},Kb.prototype.canUndo=function(){return this._position>=0},Kb.prototype.canRedo=function(){return this._position<this.length-1},Kb.prototype.undo=function(){if(this.canUndo()){var a=this._events[this._position--];this._isUndoRedoing=!0,a.undo(),this._isUndoRedoing=!1}},Kb.prototype.redo=function(){if(this.canRedo()){var a=this._events[++this._position];this._isUndoRedoing=!0,a.redo(),this._isUndoRedoing=!1}},Kb.prototype.clearRedo=function(){for(;this.canRedo();){var a=this._events.splice(this.length-1,1)[0];a.destroy&&a.destroy()}this._position=this.length-1},Kb.prototype.add=function(a,b,c){this._isUndoRedoing||(this.clearRedo(),this._events.push({undo:a,redo:b,destroy:c}),this._position=this.length-1,this._checkLimit())},b.defineProperties(Kb.prototype,{position:{get:function(){return this._position}},length:{get:function(){return this._events.length}},limit:{get:function(){return this._limit},set:function(a){this._limit=a,this._checkLimit()}}});var Lb=qc.editor.Extend=function(){this._menus={},this._inspectors={}};Lb.prototype={},Lb.prototype.constructor=Lb,Lb.prototype.menu=function(a,b){this._menus[a]=b},Lb.prototype.deleteMenu=function(a){delete this._menus[a],ga.menu.deleteItem(a)},Lb.prototype.inspector=function(a,b){this._inspectors[a]=b},Lb.prototype.findInspector=function(a){return this._inspectors[a]},Lb.prototype.init=function(){for(var a in this._menus)ga.menu.addItem(a,this._menus[a])};var Mb=qc.editor.TexturePacker=function(){this.canvas=document.createElement("canvas")};Mb.prototype={},Mb.prototype.constructor=Mb,Mb.prototype.pack=function(a,b,c,d){var e,f,g=this,h=b.length,i=new Array(h);if(!/^\w*$/.test(a))return ga.log.trace("atlas name 不合法，期望字母跟数字组成。"),!1;for(g.option=c||{},g.option.border=g.option.border||1,f=0;h>f;f++){if(e=b[f],!e||!e.img||!e.img.complete)return ga.log.trace("frame {0} 无效，无法进行打包",b[f]),!1;i[f]={w:e.img.width+g.option.border+2,h:e.img.height+g.option.border+2,frame:e}}for(i.sort(g.sortBySize),g.fit(i),f=0;h>f;f++)if(e=i[f],!e.fit)return ga.log.trace("frame {0} 无法被塞入，打包失败",e.frame.url),!1;g.snapAndSave(a,i,d)},Mb.prototype.packAll=function(){var a=this,c={},d=0,e=0;ga.project.exploreTree(function(a){if(!(a.id.indexOf("@atlas")<0)&&a.assetType===ga.ASSET_TYPE.ASSET_ATLAS){var b=a.id;c[b]={url:b}}},ga.fileTree.dataModel._roots[0]);var f=function(){var d,e,f,g={};ga.notification.info(ga._("Images downloaded, Start to pack atlas."));for(var h in c)f=c[h],d=h.match(/([^\\\/]*)@atlas/),!d||d.length<2||(e=d[1],g[e]||(g[e]=[]),g[e].push(f));for(var h in c)ga.hiddenGame.assets.unload("tp@"+h,h);var i=b.keys(g),j=0,k=function(){var b=i[j];a.pack(b,g[b],{pot:!0},function(){return j++,j>=i.length?void ga.notification.info(ga._("All atlases has been packed.")):void k()})};k()};e=b.keys(c).length;for(var g in c)!function(a){ga.hiddenGame.assets.load("tp@"+a,a,function(b){c[a]=b,++d>=e&&f()},!0)}(g);ga.notification.info(ga._("Start to download images, count: ")+e)},Mb.prototype.snapAndSave=function(a,b,c){var d=this,e=d.canvas,f=d.option.border,g=d.root.w-f,h=d.root.h-f;d.option.pot&&(g=d.nextPowerOfTwo(g),h=d.nextPowerOfTwo(h)),e.setAttribute("width",g),e.setAttribute("height",h);var i,j,k,l,m=e.getContext("2d"),n={frames:{},meta:{app:"QCEngine",version:"1.0",image:a,format:"RGBA8888",size:{w:g,h:h},scale:"1"}},o=b.length,p=n.frames;for(i=0;o>i;i++)j=b[i],k=j.w-f-2,l=j.h-f-2,m.drawImage(j.frame.img,0,0,k,1,j.fit.x+1,j.fit.y,k,1),m.drawImage(j.frame.img,0,l-1,k,1,j.fit.x+1,j.fit.y+l+1,k,1),m.drawImage(j.frame.img,0,0,1,l,j.fit.x,j.fit.y+1,1,l),m.drawImage(j.frame.img,k-1,0,1,l,j.fit.x+k+1,j.fit.y+1,1,l),m.drawImage(j.frame.img,j.fit.x+1,j.fit.y+1,k,l),p[sb(ga.project.getImageURLByAtlas(j.frame))]={frame:{x:j.fit.x+1,y:j.fit.y+1,w:k,h:l},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:k,h:l},sourceSize:{w:k,h:l}};var q=e.toDataURL();qc.editor.Operation.SAVE_ATLAS(a,q,n,c),m.clearRect(0,0,g,h),e.setAttribute("width",1),e.setAttribute("height",1)},Mb.prototype.sortBySize=function(a,b){var c,d=Math.max(a.w,a.h),e=Math.max(b.w,b.h);if(c=e-d)return c;var f=Math.min(a.w,a.h),g=Math.min(b.w,b.h);return(c=g-f)?c:(c=b.h-a.h,c?c:b.w-a.w)},Mb.prototype.fit=function(a){var b,c,d=a.length,e=d>0?a[0].w:0,f=d>0?a[0].h:0;this.root={x:0,y:0,w:e,h:f};for(var g=0;d>g;g++)c=a[g],c.fit=(b=this.findNode(this.root,c.w,c.h))?this.spliteNode(b,c.w,c.h):this.growNode(c.w,c.h)},Mb.prototype.findNode=function(a,b,c){if(!a.used)return b<=a.w&&c<=a.h?a:null;var d=a.right,e=a.down,f=this.findNode(d,b,c)||this.findNode(e,b,c);if(f)return f;if(!d.used&&!e.used&&d.x+d.w===e.x+e.w&&d.y+d.h===e.y){var g=d.h,h=e.w;if(d.h=d.h+e.h,e.w=e.w-d.w,f=this.findNode(d,b,c)||this.findNode(e,b,c))return f;d.h=g,e.w=h}},Mb.prototype.spliteNode=function(a,b,c){return a.used=!0,a.down={x:a.x,y:a.y+c,w:a.w,h:a.h-c},a.right={x:a.x+b,y:a.y,w:a.w-b,h:c},a},Mb.prototype.nextPowerOfTwo=function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a},Mb.prototype.growNode=function(a,b){var c,d,e=this,f=e.root.h,g=e.root.w,h=f>=b,i=g>=a;if(e.option.pot){var j=e.option.border,k=e.nextPowerOfTwo(g)+j,l=e.nextPowerOfTwo(f)+j,m=g+a,n=f+b;c=h&&(k===l&&(f>=m||n>l&&k>=m)||k>l&&k>=m&&k-g>=l-f||l>k&&(n>l||k-g>=l-f)),d=i&&(k===l&&(g>=n||m>k&&l>=n)||k>l&&(m>k||l-f>=k-g)||l>k&&l>=n&&l-f>=k-g)}else c=h&&f>=g+a,d=i&&g>=f+b;return c?e.growRight(a,b):d?e.growDown(a,b):h?e.growRight(a,b):i?e.growDown(a,b):void 0},Mb.prototype.growRight=function(a,b){var c=this;c.root={used:!0,x:0,y:0,w:c.root.w+a,h:c.root.h,down:c.root,right:{x:c.root.w,y:0,w:a,h:c.root.h}};var d;return(d=c.findNode(c.root,a,b))?c.spliteNode(d,a,b):null},Mb.prototype.growDown=function(a,b){var c=this;c.root={used:!0,x:0,y:0,w:c.root.w,h:c.root.h+b,down:{x:0,y:c.root.h,w:c.root.w,h:b},right:c.root};var d;return(d=c.findNode(c.root,a,b))?c.spliteNode(d,a,b):null};var Nb=m(null,b,function(a){var b=this;b.initView(),b._view.style.background="#1a1d23",b._scene=a,b._interactionDiv.appendChild(a.view),this._hRuler=q(),this._vRuler=q(),b.iv(),ga.e.on(ga.e.GRID_VISIBLE_CHANGE,function(){b.checkEnabled()}),ga.e.on(ga.e.PLAYING_CHANGE,function(){b.checkEnabled()}),a.on("propertyChange",function(){b.iv()})},{},{properties:["enabled","color","guideColor","guideBackground","rulerSize","borderColor"],view:!0,emitter:!0});Nb.prototype._enabled=!1,Nb.prototype._lastEnabled=-1,Nb.prototype._lastWidth=-1,Nb.prototype._lastHeight=-1,Nb.prototype._lastRulerSize=-1,Nb.prototype._color="#caccd8",Nb.prototype._guideColor="#3ae3ff",Nb.prototype._guideBackground="#292a3a",Nb.prototype._borderColor="#656567",Nb.prototype._rulerSize=22,Nb.prototype.onPropertyChange=function(){this.iv()},Nb.prototype.checkEnabled=function(){this.enabled=!ga.playing&&ga.gridVisible?!0:!1},Nb.prototype.validateImpl=function(){var a=this._rulerSize,b=this.clientWidth,c=this.clientHeight,d=this.enabled;if(b!==this._lastWidth||c!==this._lastHeight||a!==this._lastRulerSize||d!==this._lastEnabled)if(this._lastWidth=b,this._lastHeight=c,this._lastRulerSize=a,this._lastEnabled=d,d){this._hRuler.parentNode||(this._interactionDiv.appendChild(this._hRuler),this._interactionDiv.appendChild(this._vRuler));var e=Math.max(0,b-a),f=Math.max(0,c-a);n(this._hRuler,a,0,e,a),n(this._vRuler,0,a,a,f),n(this._scene,a,a,e,f),t(this._hRuler,e,a),t(this._vRuler,a,f)}else this._hRuler.parentNode&&(r(this._hRuler),r(this._vRuler)),n(this._scene,0,0,b,c);this.drawRuler()},Nb.prototype.drawRuler=function(){if(ga.workable&&this.enabled){var a,b,c,d,e,f,g=this._rulerSize,h=this._scene,i=h.zoom,j=Math.log(i)/Math.log(10),k=Math.floor(j),l=100,m=10,n=l*i/Math.pow(10,k),o=n/m,p=k>1?40+10*(k-1):40,q=Math.round(h.translateX),r=Math.round(h.translateY),t={x:-q,y:-r,width:h.view.clientWidth,height:h.view.clientHeight},u=Math.floor(t.x/n),v=Math.ceil((t.x+t.width)/n),w=Math.floor(t.y/n),x=Math.ceil((t.y+t.height)/n);for(s(this._hRuler,0,0,1,{x:0,y:0,width:t.width,height:g}).restore(),d=s(this._hRuler,q,0,1),d.lineWidth=1,d.strokeStyle=this.color,d.beginPath(),a=u;v>=a;a++)e=a*n,f=k>1?(e/i).toFixed(k-1):Math.round(e/i),e=Math.round(e),d.moveTo(e,g),d.lineTo(e,0),S(d,f,null,this.color,e,0,1,g,"left");for(d.stroke(),d.beginPath(),a=u;v>=a;a++)for(c=1;m>c;c++)e=a*n+c*o,f=k>1?(e/i).toFixed(k-1):Math.round(e/i),e=Math.round(e),d.moveTo(e,g),5===c?(d.lineTo(e,g-11),S(d,f,null,this.color,e,0,1,g,"left")):(d.lineTo(e,g-5),o>p&&S(d,f,null,this.color,e,0,1,g,"left"));for(d.stroke(),d.restore(),s(this._vRuler,0,0,1,{x:0,y:0,width:g,height:t.height}).restore(),
d=s(this._vRuler,0,r,1),d.lineWidth=1,d.strokeStyle=this.color,d.beginPath(),b=w;x>=b;b++)e=b*n,f=k>1?(e/i).toFixed(k-1):Math.round(e/i),e=Math.round(e),d.moveTo(g,e),d.lineTo(0,e),this.drawVerticalText(d,f,e);for(d.stroke(),d.beginPath(),b=w;x>=b;b++)for(c=1;m>c;c++)e=b*n+c*o,f=k>1?(e/i).toFixed(k-1):Math.round(e/i),e=Math.round(e),d.moveTo(g,e),5===c?(d.lineTo(g-11,e),this.drawVerticalText(d,f,e)):(d.lineTo(g-5,e),o>p&&this.drawVerticalText(d,f,e));d.stroke(),d.restore()}},Nb.prototype.drawVerticalText=function(a,b,c){a.save(),a.translate(11,c+11),a.rotate(-Math.PI/2),S(a,b,null,this.color,11,-11,0,this.rulerSize,"right"),a.restore()};var Ob=m("qc.editor.Notification",null,function(){this._showings=[]});Ob.prototype.easing=function(a){return(a-=1)*a*(2.70158*a+1.70158)+1},Ob.prototype.info=function(){this.show(ga.log.toContent(arguments),"#78C5E7","white",4e3)},Ob.prototype.warn=function(){this.show(ga.log.toContent(arguments),"#FFEDA4","rgb(130, 98, 0)",5e3)},Ob.prototype.error=function(){this.show(ga.log.toContent(arguments),"#FF8181","white",6e3)},Ob.prototype.show=function(a,b,c,d){var e=this,f=e._showings[e._showings.length-1],g=p(),h=g.style;h.font=k.labelFont,h.padding="6px",h.borderRadius="2px",h.position="absolute",h.width="300px",h.background=b,h.color=c,document.body.appendChild(g),g.innerHTML=a;var i=g.clientHeight,j=f?f.bottom+5:5;h.top=j+"px",h.right="-300px",f=g._showing={div:g,bottom:j+i},this._showings.push(f),W({duration:300,easing:e.easing,finishFunc:function(){h.cursor="pointer",g.onclick=function(){e._hide(g)},setTimeout(function(){e._hide(g)},d)},action:function(a){g.style.right=-300+305*a+"px",g.style.opacity=Db(a,0,1)}})},Ob.prototype._hide=function(a){var b=this;a._hide||(a._hide=!0,W({duration:300,finishFunc:function(){var c=b._showings.indexOf(a._showing);b._showings.splice(c,1),r(a)},action:function(b){a.style.right=5+-305*b+"px",a.style.opacity=Db(1-b,0,1)}}))},a.onerror=function(a){Gb(a)};var Pb=m("qc.editor.Preference",null,function(){this.restore()});Pb.prototype.restore=function(){var b=a.localStorage.getItem("QICI Engine");this._data=b?JSON.parse(b):{}},Pb.prototype.query=function(a){return this._data[a]},Pb.prototype.set=function(b,c){this._data[b]=c;var d=JSON.stringify(this._data);a.localStorage.setItem("QICI Engine",d)};var Qb=qc.editor.SceneManager=function(){this._dirty=!1,this._unsaved=!1;var a=this;a._saveSceneInterval=ga.preference.query("saveSceneInterval")||10,console.log("saveSceneInterval",a._saveSceneInterval),this._timer=setInterval(function(){qc.editor.Operation.SAVE_CURR_SCENE()},1e3*a._saveSceneInterval),ga.inspector.propertyView.on(ga.e.INSPECTOR_COMP_VALUE_CHANGE,function(b){if(!ga.prefabInfo&&ga.scene.editable){var c=b.node;(c instanceof qc.Node||c instanceof qc.Behaviour)&&(console.log(ga.e.INSPECTOR_COMP_VALUE_CHANGE,b),a._dirty=!0)}}),ga.inspector.propertyView.on("checkChanged",function(b){ga.prefabInfo||ga.scene.editable&&(console.log("checkChanged",b.source),a._dirty=!0)}),ga.inspector.propertyView.on("remove",function(b){ga.prefabInfo||ga.scene.editable&&(console.log("remove",b.source),a._dirty=!0)}),ga.inspector.propertyView.on("addComponent",function(b){ga.prefabInfo||ga.scene.editable&&(console.log("addComponent",b),a._dirty=!0)})};Qb.prototype={},Qb.prototype.constructor=Qb,b.defineProperties(Qb.prototype,{dirty:{get:function(){return this._dirty},set:function(a){a&&ga.prefabInfo||(!a||ga.scene.editable)&&(this._dirty=a)}},unsaved:{get:function(){return this._unsaved},set:function(a){this._unsaved=a}}}),Qb.prototype.resetTimer=function(a){this._saveSceneInterval!=a&&(clearInterval(this._timer),this._timer=setInterval(function(){qc.editor.Operation.SAVE_CURR_SCENE()},1e3*a))};var Rb=m("qc.editor.HierarchySelectionInteractor",b,function(a){var b=this;b._hierarchy=a,b.addListeners()},{clearFileListSelection:function(){ga.fileList.selectionModel.clearSelection()},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){var b=this,c=b._hierarchy;if(b._isOnExpandIcon=null,b._startPoint=null,c.isCloseToVScrollBar(a));else{var d=c.getDataAt(a);d?(b._startPoint=B(a),b._isOnExpandIcon=c.isOnToggleIcon(a)):b.clearFileListSelection()}},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(a){var b=this,c=b._startPoint,d=B(a);!b._isOnExpandIcon&&c&&y(c,d)<2&&b.clearFileListSelection(),b._startPoint=null,b._isOnExpandIcon=null}},{interactor:!0},{view:{get:function(){return this._hierarchy}}}),Sb=m("qc.editor.Hierarchy",oa,function(){var a=this;Sb["super"].constructor.call(a),ga.e.on(ga.e.DATA_MODEL_CHANGE,function(b){var c=b.oldValue,d=b.newValue;c&&c.selectionModel.off("selectionChange",a._updateActiveNode,a),d.selectionModel.on("selectionChange",a._updateActiveNode,a),a.dataModel=d,a.rootData=a.dataModel.getDataById(a.game.world.uuid),a.rootVisible=!1,a._updateActiveNode()}),new Rb(a),a._initMenu(),a.toggleOnDoubleClick=!1});b.defineProperties(Sb.prototype,{game:{get:function(){return this.dataModel.game}},activeNode:{get:function(){return this._activeNode},set:function(a){this.selection=a?this.dataModel.getDataById(a.uuid):null}}}),Sb.prototype._updateActiveNode=function(){var a=this.dataModel.lastEditableNode;if(!a){var b=this.dataModel.selectionModel.lastData;b&&(a=b.node)}var c=this._activeNode;c!==a&&(this._activeNode=a,ga.e.emit(ga.e.ACTIVE_NODE_CHANGE,{oldValue:c,newValue:a}))},Sb.prototype.blink=function(a){var b=this;if(b._anim&&(b._anim.finishFunc=function(){b._blinkData.s("blink.background",null),b._anim=null,b._blinkData=null},b._anim.stop()),a){b._blinkData=a;var c=0,d=function(){4>c?(c++,b._anim=W({duration:400,finishFunc:d,action:e})):(a.s("blink.background",null),b._anim=null,b._blinkData=null)},e=function(b){c%2===0&&(b=1-b),a.s("blink.background","rgba(255, 255, 0, "+b+")")};d()}},Sb.prototype.clearHighlight=function(){var a=this,b=a.dataModel;b.datas.forEach(function(a){a.s("blink.background",null)})},Sb.prototype.drawRowBackground=function(a,b,c,d,e,f){var g=this;Sb["super"].drawRowBackground.call(g,a,b,c,d,e,f);var h=b.s("blink.background");h&&(a.beginPath(),k.drawShape(a,"roundRect",{x:c,y:d,width:e,height:f}),a.fillStyle=h,a.fill())},Sb.prototype.getLabelColor=function(a){var b=a.node;return b._bone||!b.worldVisible?"rgb(126,126,126)":b._prefab?"rgb(73,116,190)":Sb["super"].getLabelColor.call(this,a)},Sb.prototype.onDataDoubleClick=function(a){ga.scene.focusData(a,!0)},Sb.prototype.rename=function(a,b){if(b){var c=a.node,d=this.dataModel.createRenameUndoFunc(c);b!=c.name&&(ga.sceneManager.dirty=!0),c.name=b;var e=this.dataModel.createRenameUndoFunc(c);ga.undo.add(d,e)}},Sb.prototype.isVisible=function(a){return ga.prefabInfo&&ga.prefabInfo.visibleMap[a.id]!==c?!1:this.visibleFunc?this.visibleFunc(a):!0},Sb.prototype.handleCrossDrag=function(a,b,c){(c.view instanceof qc.editor.DraggableButton||c.view===ga.fileList)&&Sb["super"].handleCrossDrag.call(this,a,b,c)},Sb.prototype.handleCrossDrag=function(a,b,c){if("enter"===b){var d,e=c.view;if(e instanceof qc.editor.DraggableButton)d="draggableButton";else if(e===ga.fileList){var f=e.draggingData,g=f.master?f.master:f;if(!g.treeData)return;if(f.name.lastIndexOf(".js")===f.name.length-3)d="js";else{var h=ga.game.assets.find(g.treeData.resUUID);if(!h)return;h.meta.type===ga.ASSET_TYPE.ASSET_PREFAB?d="prefab":h.meta.type===ga.ASSET_TYPE.ASSET_ATLAS&&(d="atlas")}}d&&(Sb["super"].handleCrossDrag.call(this,a,b,c),this._crossDragInfo.crossDataType=d)}else Sb["super"].handleCrossDrag.call(this,a,b,c)},Sb.prototype._dragging=function(a,b){var c=this.rowHeight,d=this.lp(a),e=d.y/c,f=Math.floor(e),g=b.inView,h=b.crossDataType;if(g||"draggableButton"===h||"prefab"===h||"atlas"===h){if(f>this.rowDatas.length-1)b.rowIndex=this.rowDatas.length-1,b.type="down";else{var i=d.y-f*c,j=this.rowDatas[f];b.type=fb(j.node)?.25*c>i?"up":i>.75*c?"down":"parent":.5*c>i?"up":"down",b.rowIndex=f}ga.prefabInfo&&0===b.rowIndex&&"parent"!==b.type&&(b.type="parent"),this.autoScroll(a),this.iv()}else"js"===h&&this.rowDatas.length&&(b.rowIndex=f>this.rowDatas.length-1?this.rowDatas.length-1:f,b.type="parent",this.autoScroll(a),this.iv())},Sb.prototype._endCrossDrag=function(a,b){if(this._crossDragInfo){var c,d,e=b.view,f=this._crossDragInfo.type,g=this.rowDatas[this._crossDragInfo.rowIndex];if(g)if(d=g.node,"parent"===f)c=d.children.length;else{if(c=d.parent.getChildIndex(d),d=d.parent,!fb(d))return;"down"===f&&(c+=1)}else d=this.game.world,c=d.children.length;var h=null;if(e instanceof qc.editor.DraggableButton){var i=b.tip;"EmptyNode"===i?h=ga.menu.createNode(d):"Image"===i?h=ga.menu.createImage(d):"Sprite"===i?h=ga.menu.createSprite(d):"Text"===i?h=ga.menu.createText(d):"Button"===i?h=ga.menu.createButton(d):"Toggle"===i?h=ga.menu.createToggle(d):"ScrollBar"===i?h=ga.menu.createScrollBar(d):"ScrollView"===i?h=ga.menu.createScrollView(d):"Slider"===i?h=ga.menu.createSlider(d):"Dom"===i?h=ga.menu.createDom(d):"ProgressBar"===i?h=ga.menu.createProgressBar(d):"InputField"===i?h=ga.menu.createInputField(d):"Sound"===i?h=ga.menu.createSound(d):"Tilemap"===i&&(h=ga.menu.createTilemap(d))}else{if(e!==ga.fileList)return;var j=e.draggingData,k=j.master||j;if(!k.treeData)return;if(j.name.lastIndexOf(".js")===j.name.length-3){var l=j.treeData.id;return void qc.editor.Operation.SOURCE(l,function(a){var b=a.source,c=b.match(/qc.defineBehaviour[\(\s]*['"](.*)['"]/);c&&(c=c[1],qc._userScripts[c]&&"parent"===f&&d&&d.addScript(c)&&(ga.inspector.propertyView.emit("addComponent",c),ga.notification.info(ga._("Script added."))))})}var m=ga.game.assets.find(k.treeData.resUUID);if(!m)return;if(m.meta.type===ga.ASSET_TYPE.ASSET_PREFAB){if(m.hasUnloadedDependence(ga.game))return void ga.notification.warn(ga._("Asset is not loaded, please try later."));h=this.game.add.clone(m,d)}else m.meta.type===ga.ASSET_TYPE.ASSET_ATLAS&&(h=ga.menu.createImage(d),h.texture=m,j.master&&(h.frame=j.name))}h&&(d.setChildIndex(h,c),ga.dataModel.addNodeForUndo(h),ga.hierarchy.activeNode=h)}},Sb.prototype._endDrag=function(a,b){var c=b.rowIndex,d=b.type,e=this.rowDatas[c];if(e){var f=e.node;if("parent"===d){if(!fb(f))return}else if(!fb(f.parent))return;var g=[],h=[];this.isSelected(this.draggingData)?this.topRowOrderSelection.forEach(function(a){this._dropData(d,a,e,g,h)},this):this._dropData(d,this.draggingData,e,g,h);var i=g.length;if(i){var j=this.dataModel,k=function(){for(var a=i-1;a>=0;a--)j.restoreParentInfo(g[a])},l=function(){for(var a=0;i>a;a++)j.restoreParentInfo(h[a])};ga.undo.add(k,l)}}},Sb.prototype._dropData=function(a,b,c,d,e){var f,g,h=this.dataModel,i=b.node,j=c.node;if(eb(i,!1,!0)){if("parent"===a)try{f=h.createParentInfo(i),i.switchParent(j),g=h.createParentInfo(i),this.expand(c)}catch(k){console.error("不合法的父子切换：",k),Gb(k.message)}else if(j!==this.game.world){var l=c.parent.node;try{f=h.createParentInfo(i),i.parent!==l&&i.switchParent(l);var m=l.getChildIndex(j),n=l.getChildIndex(i);"down"===a&&m++,m>n&&m--,l.setChildIndex(i,m),g=h.createParentInfo(i)}catch(k){console.error("不合法的父子切换：",k),Gb(k.message)}}f&&g&&(d.push(f),e.push(g))}},Sb.prototype._initMenu=function(){var a=this,b=new qc.editor.ContextMenu([{label:ga._("Cut"),func:"handleCut",disabled:function(){if(0===a.selection.length)return!0;if(ga.prefabInfo&&a.activeNode)for(var b=a.selectionModel.selection,c=0;c<b.length;c++){var d=b[c];if(d.id===ga.prefabInfo.prefab.uuid)return!0}}},{label:ga._("Copy"),func:"handleCopy",disabled:function(){if(0===a.selection.length)return!0;if(ga.prefabInfo&&a.activeNode)for(var b=a.selectionModel.selection,c=0;c<b.length;c++){var d=b[c];if(d.id===ga.prefabInfo.prefab.uuid)return!0}}},{label:ga._("Paste"),func:"handlePaste"},{type:"-"},{label:ga._("Create"),items:[{label:ga._("Empty Node"),func:function(){ga.menu.createNode()}},{label:ga._("Image"),func:function(){ga.menu.createImage()}},{label:ga._("Sprite"),func:function(){ga.menu.createSprite()}},{label:ga._("Text"),func:function(){ga.menu.createText()}},{label:ga._("Button"),func:function(){ga.menu.createButton()}},{label:ga._("Toggle"),func:function(){ga.menu.createToggle()}},{label:ga._("ScrollBar"),func:function(){ga.menu.createScrollBar()}},{label:ga._("ScrollView"),func:function(){ga.menu.createScrollView()}},{label:ga._("ProgressBar"),func:function(){ga.menu.createProgressBar()}},{label:ga._("Slider"),func:function(){ga.menu.createSlider()}},{label:ga._("Input Field"),func:function(){ga.menu.createInputField()}},{label:ga._("Sound"),func:function(){ga.menu.createSound()}},{label:ga._("Dom"),func:function(){ga.menu.createDom()}},{label:ga._("Graphics"),func:function(){ga.menu.createGraphics()}},{label:ga._("Tilemap"),func:function(){ga.menu.createTilemap()}}]},{label:ga._("Duplicate"),func:"handleDuplicate",disabled:function(){if(0===a.selection.length)return!0;if(ga.prefabInfo&&a.activeNode)for(var b=a.selectionModel.selection,c=0;c<b.length;c++){var d=b[c];if(d.id===ga.prefabInfo.prefab.uuid)return!0}}},{label:ga._("Delete"),func:"handleDelete",disabled:function(){if(0===a.selection.length)return!0;if(ga.prefabInfo&&a.activeNode)for(var b=a.selectionModel.selection,c=0;c<b.length;c++){var d=b[c];if(d.id===ga.prefabInfo.prefab.uuid)return!0}}},{label:ga._("Rename"),func:"handleRename",disabled:function(){return 1!==a.selection.length}},{type:"-"},{label:ga._("Expand"),func:"handleExpand"},{label:ga._("Collapse"),func:"handleCollapse"},{label:ga._("Show Retainers"),func:"showRetainers"}]);b.on("action",function(b){b.item.func&&("function"==typeof b.item.func?b.item.func():a[b.item.func](b))}),b.addTo(a)},Sb.prototype.handleExpand=function(){var a=this.selectionModel.lastData;this.expandAll(a)},Sb.prototype.handleCollapse=function(){var a=this.selectionModel.lastData;this.collapseAll(a)},Sb.prototype.handleCopy=function(){var a=this.dataModel.getTopEditableSelection(null,!1,!0),b=[];return a.forEach(function(a){var c={},d=ga.game.serializer.buildBundle(a.node,c);d.dependences=ga.game.serializer.combineDependence(c),b.push(d)}),b.length&&(ga.clipboard.data=b,ga.clipboard.type="node"),a},Sb.prototype.handlePaste=function(){if("node"===ga.clipboard.type){var a=[],b=ga.hierarchy.activeNode?ga.hierarchy.activeNode.parent:null;ga.clipboard.data.forEach(function(c){var d=ga.game.serializer.restoreBundle(c,b);a.push(this.dataModel.getDataById(d.uuid))},this),this.selection=a,this.dataModel.addDatasForUndo(a)}},Sb.prototype.handleDuplicate=function(){var a=[];this.dataModel.getTopEditableSelection(null,!1,!0).forEach(function(b){var c=b.node;c=ga.game.add.clone(c,c.parent),a.push(this.dataModel.getDataById(c.uuid))},this),this.selection=a,this.dataModel.addDatasForUndo(a)},Sb.prototype.handleRename=function(){var a=this.selectionModel.lastData;a&&this.beginEditing(a)},Sb.prototype.handleCut=function(){var a=this.handleCopy();this.dataModel.deleteDatasForUndo(a)},Sb.prototype.handleDelete=function(){var a=this.dataModel,b=a.getTopEditableSelection(null,!1,!0),c=b.length;if(0!==c){if(ga.prefabInfo)for(var d=0;d<b.length;d++){var e=b[d];if(e.node.uuid===ga.prefabInfo.prefab.uuid)return void ga.notification.info(ga._("Prefab cannot be removed"))}kb(ga._("Sure to remove this node?"),ga._("Warning"),function(){a.deleteDatasForUndo(b)},null,{icon:"alert"})}},Sb.prototype.showRetainers=function(){var a=this.selectionModel.lastData;if(a){var b=a.node,c=[],d=function(a){for(var e=a.children,f=0;f<e.length;f++){var g=e[f],h=g.getMeta();for(var i in h)18===h[i]&&g[i]===b?c.push({node:g,property:i}):19===h[i]&&g[i]&&g[i].indexOf(b)>=0&&c.push({node:g,property:i});for(var j=g.scripts,k=0;k<j.length;k++){var l=j[k];h=l.getMeta();for(var i in h)18===h[i]&&l[i]===b?c.push({node:g,script:l,property:i}):19===h[i]&&l[i]&&l[i].indexOf(b)>=0&&c.push({node:g,script:l,property:i})}d(g)}},e=ga.game.world;d(e),ga.inspector.propertyView.inspect(b,"Panel:ReferencePanel",c)}};var Tb=m("qc.editor.Scene",b,function(){var a=this;a.initView(),a._view.style.background="#272727",a._activable=!0;var b=a._iframe=document.createElement("iframe");k.setBorder(b,null,0),b.style.position="absolute",b.style.width="100%",b.style.height="100%",a._interactionDiv.appendChild(b),a._editorCanvas=q(),a._interactionDiv.appendChild(a._editorCanvas),a._interactionState={},ga.e.on(ga.e.EDIT_MODE_CHANGE,function(b){a.editMode=b.newValue}),ga.e.on(ga.e.EDITOR_HITAREA_ENABLED_CHANGE,function(b){a.editHitAreaEnabled=b.newValue}),ga.e.on(ga.e.DATA_MODEL_CHANGE,function(b){a.dataModel=b.newValue}),ga.e.on(ga.e.GAME_SIZE_CHANGE,this._handleGameSizeAndOrientationChange,a),ga.e.on(ga.e.ORIENTATION_CHANGE,this._handleGameSizeAndOrientationChange,a),ga.e.on(ga.e.GRID_VISIBLE_CHANGE,function(){a.iv()}),ga.e.on(ga.e.PLAYING_CHANGE,function(a){a.newValue?ga.workable?qc.editor.Operation.SAVE_CURR_SCENE(function(){ga.scene.editable=!1,ga.playing&&ga.scene.play("StartGame.html")}):ga.scene.play("StartGame.html"):(ga.scene.editable=!0,ga.scene.play("StartScene.html"))})},{},{properties:["editParentEnabled","editRotationEnabled","editScaleEnabled","editPivotEnabled","editCornerEnabled","editEdgeEnabled","editMoveEnabled","editRectTransformEnabled","editHitAreaEnabled"],view:!0,emitter:!0});Tb.prototype._debugEnabled=!1,Tb.prototype._handleGameSizeAndOrientationChange=function(){var a;if(ga.gameSize){var b=Math.min(ga.gameSize.width,ga.gameSize.height),c=Math.max(ga.gameSize.width,ga.gameSize.height);a="Portrait"===ga.orientation?{width:b,height:c}:{width:c,height:b}}this.gameSize=a},Tb.prototype.setTranslate=function(a,b,c){if(ga.workable){var d=this;if(c=V(c)){d._translateAnim&&d._translateAnim.stop(!0);var e=d.translateX,f=d.translateY;c.action=function(c){d.setTranslate(e+(a-e)*c,f+(b-f)*c)},c.innerFunc=function(){delete d._translateAnim},d._translateAnim=W(c)}else d.translateX=a,d.translateY=b}},Tb.prototype.play=function(a){ga.windowDisabled=!0,this._iframe.src=a},Tb.prototype.reload=function(){ga.shutdown(),this.play(this._iframe.src)},Tb.prototype.handleDelete=function(){ga.hierarchy.handleDelete()},Tb.prototype.handleCut=function(){ga.hierarchy.handleCut()},Tb.prototype.handleCopy=function(){ga.hierarchy.handleCopy()},Tb.prototype.handlePaste=function(){ga.hierarchy.handlePaste()},Tb.prototype.handleDuplicate=function(){ga.hierarchy.handleDuplicate()},Tb.prototype.reset=function(a){var b=this;b.editable&&ga.workable&&(a?b.setZoom(1,{finishFunc:function(){b.setTranslate(0,0,a)}}):(b.setZoom(1),b.setTranslate(0,0)))},Tb.prototype.fitContent=function(a){var b=this;if(b.editable&&ga.workable){var c=b.game.world.rect,d=c.x+c.width/2,e=c.y+c.height/2,f=b.clientWidth,g=b.clientHeight,h=Math.min(f/(c.width+4),g/(c.height+4)),i=-d*b.zoom+f/2,j=-e*b.zoom+g/2;a?b.setTranslate(i,j,{finishFunc:function(){b.setZoom(h,a)}}):(b.setTranslate(i,j),b.setZoom(h))}},Tb.prototype.focusData=function(a,b){var c=this;if(c.editable&&ga.workable){var d=c.game.world,e=ob(a.node);e[0]=d.toLocal(e[0]),e[1]=d.toLocal(e[1]),e[2]=d.toLocal(e[2]),e[3]=d.toLocal(e[3]);var f=u(e);f.width||(f.width=50),f.height||(f.height=50);var g=f.x+f.width/2,h=f.y+f.height/2,i=c.clientWidth,j=c.clientHeight,k=Math.min(i/(2.5*f.width),j/(2.5*f.height)),l=-g*c.zoom+i/2,m=-h*c.zoom+j/2;b?c.setTranslate(l,m,{finishFunc:function(){c.setZoom(k,b)}}):(c.setTranslate(l,m),c.setZoom(k))}},Tb.prototype.validateImpl=function(){if(ga.workable){var a=this.game.phaser.scale,b=this.clientWidth,c=this.clientHeight;if((this._lastClientWidth!==b||this._lastClientHeight!==c)&&(this._lastClientWidth=b,this._lastClientHeight=c,this.editable||this._resetPlayScaleMode(),this.game.updateScale()),this.editable){var d=this._editorCanvas;(b!==d.clientWidth||c!==d.clientHeight)&&(t(d,b,c),this._resetEditScaleMode());var e=s(d,0,0,1,{x:0,y:0,width:b,height:c});e.restore(),e=s(d,a.margin.left,a.margin.top,a.scaleFactorInversed.x),this.interactors&&this.interactors.forEach(function(a){a.draw(e)}),e.restore()}}},Tb.prototype.createDiv=function(){var a=p(),b=a.style;return b.color="white",b.background="rgba(0,0,0,0.3)",b.font=k.labelFont,b.padding="6px",b.borderRadius="4px",b.position="absolute",this._interactionDiv.appendChild(a),a},b.defineProperties(Tb.prototype,{dataModel:{get:function(){return this._dataModel},set:function(a){var b=this;if(!(a instanceof Hb))throw Error("dataModel对象必须是qc.editor.GameModel类型");b._dataModel&&b._dataModel.selectionModel.off("selectionChange",b.updateEditorCanvas,b),b._dataModel=a,a.selectionModel.on("selectionChange",b.updateEditorCanvas,b),b.editable=b.editable,b.gameSize=b.gameSize,b.debugEnabled=b.debugEnabled}},selectionModel:{get:function(){return this.dataModel.selectionModel}},game:{get:function(){return this.dataModel?this.dataModel.game:null}},gameSize:{get:function(){return this._gameSize},set:function(a){var b=this._gameSize;if(this._gameSize=a,ga.workable&&!this._editable&&this._resetPlayScaleMode(),this.epc("gameSize",b,a),ga.workable&&this._editable){var d=this.game.world;d._editorWidth=a?a.width:c,d._editorHeight=a?a.height:c,d.relayout()}}},translateX:{get:function(){return-this.game.camera.x},set:function(a){if(this.editable&&ga.workable){var b=this.translateX;this.game.camera.x=-a,this.game.world.x=a,this.epc("translateX",b,a)}}},translateY:{get:function(){return-this.game.camera.y},set:function(a){if(this.editable&&ga.workable){var b=this.translateY;this.game.camera.y=-a,this.game.world.y=a,this.epc("translateY",b,a)}}},debugEnabled:{get:function(){return this._debugEnabled},set:function(a){this._debugEnabled=a;var b=ga.gameDebugger;b&&(a?b.debugDiv.parentNode||this._interactionDiv.appendChild(b.debugDiv):(b.debugDiv.parentNode&&r(b.debugDiv),b._debugDialog&&b._debugDialog.hide()))}}}),Tb.prototype._editable=!0,Tb.prototype._editParentEnabled=!0,Tb.prototype._editRotationEnabled=!0,Tb.prototype._editScaleEnabled=!0,Tb.prototype._editPivotEnabled=!0,Tb.prototype._editCornerEnabled=!0,Tb.prototype._editEdgeEnabled=!0,Tb.prototype._editMoveEnabled=!0,Tb.prototype._editRectTransformEnabled=!0,Tb.prototype._editHitAreaEnabled=!1,Tb.prototype._editSelectionEnabled=!0,Tb.prototype._resetEditScaleMode=function(){var a=this.game.phaser.scale;a.scaleMode=Phaser.ScaleManager.NO_SCALE;var b=this.clientWidth||1,c=this.clientHeight||1;a.setGameSize(b,c);var d=this.game.camera;d.bounds.setTo(-(1/0),-(1/0),1/0,1/0),d.view.width=b/this.zoom,d.view.height=c/this.zoom},Tb.prototype._resetPlayScaleMode=function(){var a=this.game.phaser.scale;a.scaleMode=Phaser.ScaleManager.SHOW_ALL;var b=this.gameSize,c=this.clientWidth||1,d=this.clientHeight||1,e=b?b.width:c,f=b?b.height:d,g=e/f;c/d>g?a.setGameSize(d*g,d):a.setGameSize(c,c/g)},b.defineProperties(Tb.prototype,{interactors:{get:function(){return this._interactors},set:function(a){var b=this._interactors;b&&b.forEach(function(a){a.tearDown()}),this._interactors=a,a&&a.forEach(function(a){a.setUp()})}},editable:{get:function(){return this._editable},set:function(a){var b=this,c=b.game;if(ga.workable){var d=c.phaser.scale;this.dataModel.selectionModel.clearSelection(),b.translateX=0,b.translateY=0,b.zoom=1,d.pageAlignHorizontally=!0,d.pageAlignVertically=!0,d.minWidth=null,d.minHeight=null,d.maxWidth=null,d.maxHeight=null,a?(b._resetEditScaleMode(),c.canvas.style.position="absolute",c.canvas.style.margin=0,c.input.enable=!1,this.interactors=[new Yb(b),new Zb(b),new Wb(b),new Xb(b),new Vb(b)],b._editorCanvas.style.display="block"):(b._resetPlayScaleMode(),c.input.enable=!0,b.interactors=null,b._editorCanvas.style.display="none")}var e=b._editable;b._editable=a,b.epc("editable",e,a),b.updateEditorCanvas()}},editMode:{get:function(){return this._editMode},set:function(a){ga.editHitAreaEnabled=!1,this._editMode=a,this.editParentEnabled=!1,this.editRotationEnabled=!1,this.editScaleEnabled=!1,this.editPivotEnabled=!1,this.editCornerEnabled=!1,this.editEdgeEnabled=!1,this.editMoveEnabled=!1,this.editRectTransformEnabled=!1,this.editSelectionEnabled=!1,"pan"===a||("default"===a?(this.editRotationEnabled=!0,this.editPivotEnabled=!0,this.editMoveEnabled=!0,this.editSelectionEnabled=!0):"scale"===a?(this.editParentEnabled=!0,this.editScaleEnabled=!0,this.editPivotEnabled=!0,this.editMoveEnabled=!0,this.editSelectionEnabled=!0):"rectTransform"===a&&(this.editCornerEnabled=!0,this.editEdgeEnabled=!0,this.editRectTransformEnabled=!0,this.editSelectionEnabled=!0))}}}),Tb.prototype._zoom=1,Tb.prototype._minZoom=1e-5,Tb.prototype._maxZoom=1e8,Tb.prototype.scrollZoomIn=function(a){this._setZoomImpl(1.05*this.zoom,a)},Tb.prototype.scrollZoomOut=function(a){this._setZoomImpl(this.zoom/1.05,a)},Tb.prototype.pinchZoomIn=function(a){this._setZoomImpl(1.08*this.zoom,a)},Tb.prototype.pinchZoomOut=function(a){this._setZoomImpl(this.zoom/1.08,a)},Tb.prototype.adjustZoom=function(a){return a<this.minZoom?this.minZoom:a>this.maxZoom?this.maxZoom:a},Tb.prototype.setZoom=function(a,b,c){var d=this;if(d.editable&&ga.workable)if(b=V(b)){d._zoomAnim&&d._zoomAnim.stop(!0);var e=d.zoom;b.action=function(b){d._setZoomImpl(e+(a-e)*b,c)},b.innerFunc=function(){delete d._zoomAnim},d._zoomAnim=W(b)}else d._setZoomImpl(a,c)},Tb.prototype._setZoomImpl=function(a,b){var c=this;if(c.editable&&ga.workable){var d=c.zoom;if(a=c.adjustZoom(a),a!==d&&0!==a&&!isNaN(a)){b&&(b=c.game.world.toLocal(b));var e=c.zoom,f=c.game.camera.view,g={x:f.x/e,y:f.y/e,width:f.width,height:f.height};b=b?b:{x:g.x+g.width/2,y:g.y+g.height/2},c.translateX=(b.x-g.x)*d-b.x*a,c.translateY=(b.y-g.y)*d-b.y*a,c.game.world.scaleX=a,c.game.world.scaleY=a,c._resetEditScaleMode(),c.epc("zoom",d,a)}}},b.defineProperties(Tb.prototype,{zoom:{get:function(){return this.game.world.scaleX},set:function(a){this._setZoomImpl(a)}},maxZoom:{get:function(){return this._maxZoom},set:function(a){var b=this._maxZoom;this._maxZoom=a,this.epc("maxZoom",b,a),this._setZoomImpl(a)}},minZoom:{get:function(){return this._minZoom},set:function(a){var b=this._minZoom;this._minZoom=a,this.epc("minZoom",b,a),this._setZoomImpl(a)}}}),Tb.prototype.onPropertyChange=function(){this.updateEditorCanvas()},Tb.prototype.updateEditorCanvas=function(){this.editable&&this.iv()},Tb.prototype.checkForUpdate=function(){if(this.editable){var a=this.dataModel.selectionModel.selection,b=a.length;if(b>30)this.iv();else{for(var c=this._checkCurrentEditNode(),d=0;b>d;d++){var e=a[d],f=e.node,g=e.cache,h=f.phaser.worldTransform;c||(g.a!==h.a||g.b!==h.b||g.c!==h.c||g.d!==h.d||g.tx!==h.tx||g.ty!==h.ty||g.width!==f.width||g.height!==f.height||g.pivotX!==f.pivotX||g.pivotY!==f.pivotY)&&(c=!0),c&&(g.a=h.a,g.b=h.b,g.c=h.c,g.d=h.d,g.tx=h.tx,g.ty=h.ty,g.width=f.width,g.height=f.height,g.pivotX=f.pivotX,g.pivotY=f.pivotY)}c&&this.iv()}this.validate()}},Tb.prototype._checkCurrentEditNode=function(){var a=!1,b=ga.currentEditNode;if(!b)return a;var c=this.dataModel.getDataById(b.uuid);if(!c)return a;var d=c.cache;if(a||(d.minAnchorX!==b.minAnchor.x||d.minAnchorY!==b.minAnchor.y||d.maxAnchorX!==b.maxAnchor.x||d.maxAnchorY!==b.maxAnchor.y)&&(a=!0),a&&(d.minAnchorX=b.minAnchor.x,d.minAnchorY=b.minAnchor.y,d.maxAnchorX=b.maxAnchor.x,d.maxAnchorY=b.maxAnchor.y),ga.editHitAreaEnabled){var e=d.hitArea,f=b.hitArea;a||(!e&&f?a=!0:e&&!f?a=!0:e&&f&&(e.x!==f.x||e.y!==f.y||e.width!==f.width||e.height!==f.height||e["class"]!==f["class"])&&(a=!0)),a&&(d.hitArea=f?{x:f.x,y:f.y,width:f.width,height:f.height,"class":f["class"]}:null)}return a};var Ub=m(null,b,function(a){this._scene=a},{draw:function(){},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()},toData:function(a){return a?this.dataModel.getDataById(a.uuid):null}},{interactor:!0},{view:{get:function(){return this.scene._interactionDiv}},game:{get:function(){return this.scene.game}},dataModel:{get:function(){return this.scene.dataModel}},selectionModel:{get:function(){return this.dataModel.selectionModel}},scene:{get:function(){return this._scene}},interactionState:{get:function(){return this.scene._interactionState}}});Ub.prototype.toGlobal=function(a){var b,c,d=this.game.phaser.scale.scaleFactor,e=this.view.getBoundingClientRect();return 2===arguments.length?(b=arguments[0],c=arguments[1]):(a=this._checkTouch(a),b=a.clientX,c=a.clientY),{x:(b-e.left)*d.x,y:(c-e.top)*d.y}},Ub.prototype._iterateChildren=function(a,b){b.visible&&!b._bone&&(b instanceof qc.UIRoot||a.push(b),b.children.forEach(function(b){this._iterateChildren(a,b)},this))},Ub.prototype.getNodeAt=function(a){var b=this,c=this.toGlobal(a),d=[];this.game.world.children.forEach(function(a){b._iterateChildren(d,a)});for(var e=d.length-1;e>=0;e--){var f=d[e],g=f.toLocal(c),h=f.width*-f.pivotX,i=f.height*-f.pivotY,j=f.width,k=f.height;0>j&&(j=-j,h-=j),0>k&&(k=-k,i-=k);var l=new Phaser.Rectangle(h,i,j,k);if(l.contains(g.x,g.y))return f}return null},Ub.prototype._checkTouch=function(a){if(!this._isMouseEvent(a)){var b=a.touches[0];if(b)return b;if(b=a.changedTouches,b&&b[0])return b[0]}return a},Ub.prototype._isMouseEvent=function(a){return a instanceof MouseEvent||0===a.type.indexOf("mouse")};var Vb=m(null,Ub,function(a){Vb["super"].constructor.call(this,a)},{handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){a.preventDefault(),this.scene.requestFocus(),M(a)>1||this.interactionState.editing||this.scene.editSelectionEnabled&&this.getNodeAt(a)||N(a)&&!P(a)&&(this.translateX=this.scene.translateX,this.translateY=this.scene.translateY,this.lastGlobalPoint=this.toGlobal(a),z(this,a))},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(){this.interactionState.panning&&delete this.interactionState.panning,this.translateX=this.translateY=this.lastGlobalPoint=null},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){this.interactionState.panning=!0;var b=this.toGlobal(a);this.scene.setTranslate(this.translateX+b.x-this.lastGlobalPoint.x,this.translateY+b.y-this.lastGlobalPoint.y)},handle_mousewheel:function(a){this.handleScroll(a,a.wheelDelta)},handle_DOMMouseScroll:function(a){2===a.axis&&this.handleScroll(a,-a.detail)},handleScroll:function(a,b){a.preventDefault(),b>0?this.scene.scrollZoomIn(this.toGlobal(a)):0>b&&this.scene.scrollZoomOut(this.toGlobal(a))},handle_keydown:function(a){if(Y(a),D(a))this.selectionModel.selectAll();else if(E(a))ga.hierarchy.handleDelete();else if(J(a)||K(a)||H(a)||I(a)){var b=0,c=0;H(a)?b=-1:I(a)?b=1:J(a)?c=-1:K(a)&&(c=1),this.dataModel.moveSelection(b,c)}}}),Wb=m(null,Ub,function(a){Wb["super"].constructor.call(this,a)},{clearFileListSelection:function(){ga.fileList.selectionModel.clearSelection()},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){var b=this;if(delete b.downPoint,this.scene.editSelectionEnabled&&!(M(a)>1||b.interactionState.editing)){b.clearFileListSelection();var c=b.selectionModel,d=b.getNodeAt(a),e=b.toData(d);e?(ga.editHitAreaEnabled=!1,P(a)?c.isSelected(e)?c.removeSelection(e):c.appendSelection(e):c.isSelected(e)||(c.selection=e)):P(a)?N(a)&&(P(a)||c.clearSelection(),b.interactionState.selecting=!0,b.startGlobalPoint=b.toGlobal(a),z(b,a)):b.downPoint=B(a)}},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(a){this.downPoint&&(y(this.downPoint,B(a))<=1&&(this.selectionModel.clearSelection(),ga.editHitAreaEnabled=!1),delete this.downPoint)},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(){this.downPoint=null,this.startGlobalPoint&&(this.mask&&r(this.mask),this.startGlobalPoint=this.mask=this.oldSelection=null,delete this.interactionState.selecting)},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){var b=this;b.mask||(b.oldSelection=b.selectionModel.selection.slice(),b.mask=p(!1,b.view),b.mask.style.border="rgba(255,255,255,0.7) solid 1px",b.mask.style.background="rgba(200,200,255,0.3)");var c=u(b.startGlobalPoint,b.toGlobal(a));n(b.mask,c);var d={};b.dataModel.forEach(function(a){pb(a.node,c)&&(d[a.uuid]=a)});var e=[];b.oldSelection.forEach(function(a){d[a.uuid]?delete d[a.uuid]:e.push(a)});for(var f in d)e.push(d[f]);b.selectionModel.selection=e}}),Xb=m(null,Ub,function(a){Xb["super"].constructor.call(this,a);

},{handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){if(!(M(a)>1||!N(a)||this.interactionState.editing)){var b=this.getNodeAt(a);b&&(this.lastGlobalPoint=this.toGlobal(a),z(this,a))}},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(){this.undo&&ga.undo.add(this.undo,this.dataModel.createMoveUndoFunc()),this.undo=this.interactionState.moving=this.lastGlobalPoint=this.globalPoint=null,this.scene.updateEditorCanvas()},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){var b=this.toGlobal(a),c=b.x-this.lastGlobalPoint.x,d=b.y-this.lastGlobalPoint.y;return(!this.interactionState.moving||"pending"===this.interactionState.moving)&&Math.abs(c)<=2&&Math.abs(d)<=2?void(this.interactionState.moving="pending"):(this.interactionState.moving=!0,this.undo||(this.undo=this.dataModel.createMoveUndoFunc()),this.dataModel.moveSelection(c,d),void(this.lastGlobalPoint=b))}}),Yb=m(null,Ub,function(a){Yb["super"].constructor.call(this,a)},{handle_touchstart:function(a){if(2===M(a)){a.preventDefault(),z(this,a);var b={x:a.touches[0].clientX,y:a.touches[0].clientY},c={x:a.touches[1].clientX,y:a.touches[1].clientY};this.lastDistance=y(b,c)}},handleWindowTouchEnd:function(){self.lastDistance=null},handleWindowTouchMove:function(a){if(2===M(a)){var b={x:event.touches[0].clientX,y:event.touches[0].clientY},c={x:event.touches[1].clientX,y:event.touches[1].clientY},d=y(b,c),e=this.toGlobal((b.x+c.x)/2,(b.y+c.y)/2);this.lastDistance<d?this.scene.pinchZoomIn(e):this.scene.pinchZoomOut(e),this.lastDistance=d}}}),Zb=m(null,Ub,function(a){Zb["super"].constructor.call(this,a)},{RESIZE_TYPE_MAP:{resize:!0,left:!0,top:!0,bottom:!0,right:!0},ANCHOR_TYPE_MAP:{A0:!0,A1:!0,A2:!0,A3:!0,A:!0},handle_mousemove:function(a){this.handle_touchmove(a)},handle_touchmove:function(a){!A()&&N(a)&&this.checkEdit(a)},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){N(a)&&this.checkEdit(a)&&(z(this,a),this.isDragging=!0)},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(){var a=this.dataModel,b=this.editInfo;if(b){var c,d=b.type,e=b.node,f=b.undo;if(f)this.RESIZE_TYPE_MAP[d]?c=a.createResizeUndoFunc(e):this.ANCHOR_TYPE_MAP[d]?c=a.createAnchorUndoFunc(e):"move"===d||"axisX"===d||"axisY"===d?c=a.createMoveUndoFunc(e):"pivot"===d?c=a.createPivotUndoFunc(e):"rotation"===d?c=a.createRotationUndoFunc(e):("scaleX"===d||"scaleY"===d)&&(c=a.createScaleUndoFunc(e)),c&&ga.undo.add(f,c);else if("parent"===d){var g=b.targetNode;if(fb(g))try{f=a.createParentUndoFunc(e),b.node.switchParent(g),c=a.createParentUndoFunc(e),ga.undo.add(f,c),this.selectionModel.clearSelection(),this.selectionModel.selection=this.toData(b.node)}catch(h){console.error("不合法的父子切换：{0}",h),Gb(h.message)}}}this.cursor="",delete this.editInfo,delete this.isDragging,delete this.interactionState.editing,this.scene.updateEditorCanvas()},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){this.handleEdit(a)},draw:function(a){this.drawEdit(a)}});Zb.prototype.drawEdit=function(a){this.node=this.resizePoints=this.position=this.parentPoint=this.rotationPoint=this.axisXPoint=this.axisYPoint=this.movePoints=this.anchorInfo=this.hitPoints=null,this.drawGrid(a),this.drawGameBounds(a),this.drawEdges(a),this.node=ga.currentEditNode=this.dataModel.lastEditableNode,this.node&&(this.position=this.node.getWorldPosition(),this.resizePoints=ob(this.node),this.drawRectTransform(a),this.scene.editHitAreaEnabled?this.drawHitArea(a):(this.drawResizeCorner(a),this.drawAxisX(a),this.drawAxisY(a),this.drawMoveRect(a),this.drawPivot(a),this.drawChangingParent(a)))},Zb.prototype.drawGameBounds=function(a){var b=this.game.world,c=b.rect,d=b.toGlobal({x:0,y:0}),e=b.toGlobal({x:c.width,y:c.height});a.beginPath(),a.rect(Math.round(d.x),Math.round(d.y),Math.round(e.x-d.x),Math.round(e.y-d.y)),Ab(a)},Zb.prototype.drawHitArea=function(a){var b=this.node,c=b.hitArea;if(c){if(!(c instanceof qc.Rectangle||c instanceof qc.Ellipse))return void console.error("hitArea只支持qc.Rectangle和qc.Ellipse类型，不支持：{0}",c);var d=c.x,e=c.y,f=c.width,g=c.height,h=b.worldTransform;a.save();var i=l;a.setTransform(h.a*i,h.b*i,h.c*i,h.d*i,h.tx*i,h.ty*i),a.beginPath(),c instanceof qc.Ellipse?T(a,d+f/2,e+g/2,0,j,f/2,g/2,!1):a.rect(d,e,f,g),a.closePath(),a.fillStyle="rgba(0,255,0,0.3)",a.fill(),a.restore(),this.hitPoints=[b.toGlobal({x:d+f/2,y:e}),b.toGlobal({x:d+f,y:e+g/2}),b.toGlobal({x:d+f/2,y:e+g}),b.toGlobal({x:d,y:e+g/2})],a.fillStyle="#00FF00",a.strokeStyle="white",a.lineWidth=1,this.hitPoints.forEach(function(b){a.beginPath(),a.arc(b.x,b.y,3,0,j,!0),a.fill(),a.stroke()})}},Zb.prototype.drawPivot=function(a){this.scene.editPivotEnabled?(a.beginPath(),a.arc(this.position.x,this.position.y,4,0,j,!0),a.strokeStyle="white",a.lineWidth=5,a.stroke(),a.strokeStyle="#3498DB",a.lineWidth=3,a.stroke()):(a.fillStyle="#FF0000",a.strokeStyle="white",a.lineWidth=1,a.beginPath(),a.arc(this.position.x,this.position.y,2,0,j,!0),a.fill(),a.stroke())},Zb.prototype.drawEdges=function(a){this.dataModel.selectionModel.forEach(function(b){var c=b.node;if(eb(c,!0,!0)){var d=ob(c);a.beginPath(),a.moveTo(d[0].x,d[0].y),a.lineTo(d[1].x,d[1].y),a.lineTo(d[2].x,d[2].y),a.lineTo(d[3].x,d[3].y),a.closePath(),a.strokeStyle=c._bone?"#7A7A7A":"#FFFC3A",a.lineWidth=1,a.stroke()}},this)},Zb.prototype.drawResizeCorner=function(a){this.scene.editCornerEnabled&&(a.fillStyle="#3498DB",a.strokeStyle="white",a.lineWidth=1,this.resizePoints.forEach(function(b){a.beginPath(),a.arc(b.x,b.y,4,0,j,!0),a.fill(),a.stroke()}))},Zb.prototype.drawAxisX=function(a){var b=this.node,c=this.position,d=b.parent.toGlobal({x:b.x+Math.cos(b.rotation),y:b.y+Math.sin(b.rotation)}),e=y(c,d);if(e){var f={x:(d.x-c.x)/e,y:(d.y-c.y)/e};if(this.scene.editMoveEnabled){var g=this.scene.editPivotEnabled?4:1;a.beginPath(),a.moveTo(c.x+f.x*g,c.y+f.y*g),a.lineTo(c.x+80*f.x,c.y+80*f.y),a.lineWidth=2,a.strokeStyle="red",a.stroke()}d=this.axisXPoint={x:c.x+80*f.x,y:c.y+80*f.y},a.save(),a.translate(d.x,d.y),a.rotate(Math.atan2(f.y,f.x)),a.fillStyle="red",a.beginPath(),this.scene.editScaleEnabled?(a.rect(-3,-5,6,10),a.strokeStyle="white",a.lineWidth=1,a.fill(),a.stroke()):this.scene.editMoveEnabled&&(a.moveTo(-10,-5),a.lineTo(10,0),a.lineTo(-10,5),a.closePath(),a.fill()),a.restore(),this.scene.editRotationEnabled&&(d=this.rotationPoint={x:c.x+40*f.x,y:c.y+40*f.y},a.beginPath(),a.arc(d.x,d.y,4,0,j,!0),a.fillStyle="red",a.strokeStyle="white",a.lineWidth=1,a.fill(),a.stroke())}},Zb.prototype.drawAxisY=function(a){var b=this.node,c=this.position,d=b.parent.toGlobal({x:b.x-Math.sin(b.rotation),y:b.y+Math.cos(b.rotation)}),e=y(c,d);if(e){var f={x:(d.x-c.x)/e,y:(d.y-c.y)/e};if(this.scene.editMoveEnabled){var g=this.scene.editPivotEnabled?4:1;a.beginPath(),a.moveTo(c.x+f.x*g,c.y+f.y*g),a.lineTo(c.x+80*f.x,c.y+80*f.y),a.lineWidth=2,a.strokeStyle="#00FF00",a.stroke()}d=this.axisYPoint={x:c.x+80*f.x,y:c.y+80*f.y},a.save(),a.translate(d.x,d.y),a.rotate(Math.atan2(f.y,f.x)),a.beginPath(),a.fillStyle="#00FF00",this.scene.editScaleEnabled?(a.rect(-3,-5,6,10),a.strokeStyle="white",a.lineWidth=1,a.fill(),a.stroke()):this.scene.editMoveEnabled&&(a.moveTo(-10,-5),a.lineTo(10,0),a.lineTo(-10,5),a.closePath(),a.fill()),a.restore(),this.scene.editParentEnabled&&(d=this.parentPoint={x:c.x+40*f.x,y:c.y+40*f.y},a.save(),a.translate(d.x,d.y),a.rotate(Math.atan2(f.y,f.x)),a.beginPath(),a.moveTo(4,0),a.lineTo(-4,5),a.lineTo(-4,-5),a.closePath(),a.fillStyle="#3498DB",a.strokeStyle="white",a.lineWidth=1,a.fill(),a.stroke(),a.restore())}},Zb.prototype.drawMoveRect=function(a){if(this.scene.editMoveEnabled&&this.axisYPoint&&this.axisYPoint){var b=this.position,c={x:b.x+(this.axisXPoint.x-b.x)/4,y:b.y+(this.axisXPoint.y-b.y)/4},d={x:b.x+(this.axisYPoint.x-b.x)/4,y:b.y+(this.axisYPoint.y-b.y)/4},e={x:(c.x+d.x)/2,y:(c.y+d.y)/2},f={x:b.x+2*(e.x-b.x),y:b.y+2*(e.y-b.y)};a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.lineTo(f.x,f.y),a.lineTo(d.x,d.y),a.closePath(),a.fillStyle="rgba(0, 0, 255, 0.2)",a.strokeStyle="#0F78FF",a.lineWidth=1,a.fill(),a.stroke(),this.movePoints=[b.x,b.y,c.x,c.y,f.x,f.y,d.x,d.y,b.x,b.y]}},Zb.prototype.drawChangingParent=function(a){var b=this.editInfo;if(b&&"parent"===b.type){if(b.targetNode){var c=ob(b.targetNode);a.beginPath(),a.moveTo(c[0].x,c[0].y),a.lineTo(c[1].x,c[1].y),a.lineTo(c[2].x,c[2].y),a.lineTo(c[3].x,c[3].y),a.closePath(),a.fillStyle="rgba(0,0,0,0.3)",a.fill(),a.strokeStyle="white",a.lineWidth=1,a.stroke()}a.beginPath(),a.moveTo(b.sourcePoint.x,b.sourcePoint.y),a.lineTo(b.targetPoint.x,b.targetPoint.y),a.lineWidth=3,a.strokeStyle="white",a.stroke(),a.lineWidth=1,a.strokeStyle="#3498DB",a.stroke()}},Zb.prototype.drawGrid=function(a){if(ga.gridVisible){var b,c,d,e,f=this.scene,g=f.zoom,h=Math.log(g)/Math.log(10),i=Math.floor(h),j=100,k=10,m=Math.pow(10,i),n=j*g/m,o=n/k,p=Math.round(f.translateX),q=Math.round(f.translateY),r={x:-p,y:-q,width:f.view.clientWidth,height:f.view.clientHeight},s=Math.floor(r.x/n),t=Math.ceil((r.x+r.width)/n),u=Math.floor(r.y/n),v=Math.ceil((r.y+r.height)/n);a.lineWidth=1,a.save();var w=l;for(a.setTransform(w,0,0,w,p*w,q*w),a.beginPath(),b=s;t>=b;b++)e=Math.round(b*n),a.moveTo(e,u*n),a.lineTo(e,v*n);for(c=u;v>=c;c++)e=Math.round(c*n),a.moveTo(s*n,e),a.lineTo(t*n,e);for(a.strokeStyle="rgba(120,120,120,0.7)",a.stroke(),a.beginPath(),b=s;t>=b;b++)for(d=1;k>d;d++)e=Math.round(b*n+d*o),a.moveTo(e,u*n),a.lineTo(e,v*n);for(c=u;v>=c;c++)for(d=1;k>d;d++)e=Math.round(c*n+d*o),a.moveTo(s*n,e),a.lineTo(t*n,e);var x=(g-m)/(Math.pow(10,i+1)-m);a.strokeStyle="rgba(120,120,120,"+x+")",a.stroke(),a.restore()}},Zb.prototype.drawRectTransform=function(a){if(this.scene.editRectTransformEnabled){var b=this.node,c=b.parent,d=b.minAnchor,e=b.maxAnchor,f=ob(c),g=f[0],h=f[1],i=f[2],j=f[3],k={x:g.x+(j.x-g.x)*d.y,y:g.y+(j.y-g.y)*d.y},l={x:h.x+(i.x-h.x)*d.y,y:h.y+(i.y-h.y)*d.y},m={x:g.x+(j.x-g.x)*e.y,y:g.y+(j.y-g.y)*e.y},n={x:h.x+(i.x-h.x)*e.y,y:h.y+(i.y-h.y)*e.y},o={x:g.x+(h.x-g.x)*d.x,y:g.y+(h.y-g.y)*d.x},p={x:j.x+(i.x-j.x)*d.x,y:j.y+(i.y-j.y)*d.x},q={x:g.x+(h.x-g.x)*e.x,y:g.y+(h.y-g.y)*e.x},r={x:j.x+(i.x-j.x)*e.x,y:j.y+(i.y-j.y)*e.x},s={x:o.x+(p.x-o.x)*d.y,y:o.y+(p.y-o.y)*d.y},t={x:q.x+(r.x-q.x)*d.y,y:q.y+(r.y-q.y)*d.y},u={x:q.x+(r.x-q.x)*e.y,y:q.y+(r.y-q.y)*e.y},v={x:o.x+(p.x-o.x)*e.y,y:o.y+(p.y-o.y)*e.y};if(a.beginPath(),a.moveTo(g.x,g.y),a.lineTo(h.x,h.y),a.lineTo(i.x,i.y),a.lineTo(j.x,j.y),a.closePath(),Ab(a),this.interactionState.moving||this.isDragging){Q(a,[4]);var w=b.rect,x=c.toGlobal({x:w.x+b.x,y:w.y+b.y}),y=c.toGlobal({x:w.x+w.width+b.x,y:w.y+b.y}),z=c.toGlobal({x:w.x+w.width+b.x,y:w.y+w.height+b.y}),A=c.toGlobal({x:w.x+b.x,y:w.y+w.height+b.y});a.beginPath(),a.moveTo(x.x,x.y),a.lineTo(y.x,y.y),a.lineTo(z.x,z.y),a.lineTo(A.x,A.y),a.closePath(),Ab(a),(this.interactionState.moving||this.RESIZE_TYPE_MAP[this.editInfo.type]||this.ANCHOR_TYPE_MAP[this.editInfo.type])&&(a.beginPath(),a.moveTo(k.x,k.y),a.lineTo(l.x,l.y),a.moveTo(m.x,m.y),a.lineTo(n.x,n.y),a.moveTo(o.x,o.y),a.lineTo(p.x,p.y),a.moveTo(q.x,q.y),a.lineTo(r.x,r.y),Ab(a),b.minAnchor.x===b.maxAnchor.x?this.drawLineText(a,b.anchoredX,this.position,i,j,q,r):(this.drawLineText(a,b.left,{x:(x.x+A.x)/2,y:(x.y+A.y)/2},i,j,o,p),this.drawLineText(a,b.right,{x:(y.x+z.x)/2,y:(y.y+z.y)/2},i,j,q,r)),b.minAnchor.y===b.maxAnchor.y?this.drawLineText(a,b.anchoredY,this.position,g,j,k,l):(this.drawLineText(a,b.top,{x:(x.x+y.x)/2,y:(x.y+y.y)/2},g,j,k,l),this.drawLineText(a,b.bottom,{x:(z.x+A.x)/2,y:(z.y+A.y)/2},g,j,m,n))),R(a,[4])}this.anchorInfo={},this.drawAnchorTriangle(a,"A0",s,o,p,k,l),this.drawAnchorTriangle(a,"A1",t,q,r,l,k),this.drawAnchorTriangle(a,"A2",u,n,m,r,q),this.drawAnchorTriangle(a,"A3",v,m,n,p,o),d.x===e.x&&d.y===e.y&&(this.anchorInfo.A=s)}},Zb.prototype.drawAnchorTriangle=function(a,b,c,d,e,f,g){var h=wb(d,e,!0),i=wb(f,g,!0),j={x:(h.x+i.x)/2,y:(h.y+i.y)/2},k=Math.atan2(j.y,j.x);a.save(),a.translate(c.x,c.y),a.rotate(k),a.beginPath(),a.moveTo(0,0),a.lineTo(12,5),a.lineTo(12,-5),a.closePath(),Ab(a),a.restore(),j=wb(j,{x:0,y:0},!0),j.x*=8,j.y*=8,j.x+=c.x,j.y+=c.y,this.anchorInfo[b]=j},Zb.prototype.drawLineText=function(a,b,c,d,e,f,g){var h=x(f.x,f.y,g.x,g.y,c.x,c.y,c.x+e.x-d.x,c.y+e.y-d.y);if(h){var i=c.x,j=c.y,k=h[0],l=h[1];a.beginPath(),a.moveTo(i,j),a.lineTo(k,l),Ab(a);var m=(i+k)/2,n=(j+l)/2;a.save(),a.translate(m,n),a.rotate(k>i?Math.atan2(l-j,k-i):Math.atan2(j-l,i-k)),a.translate(-m,-n),S(a,xb(b),null,"black",m+1,n+1,0,0,"center","middle"),S(a,xb(b),null,"white",m,n,0,0,"center","middle"),a.restore()}},Zb.prototype.checkEdit=function(a){if(this.cursor="",delete this.editInfo,delete this.interactionState.editing,this.node){var b=this.toGlobal(a);if(this.scene.editHitAreaEnabled){if(this.checkHitArea(b))return!0}else{if(this.checkPivot(b))return!0;if(this.checkRotation(b))return!0;if(this.checkParent(b))return!0;if(this.checkScale(b))return!0;if(this.checkOnAxis(b))return!0;if(this.checkResize(b))return!0}if(this.checkAnchor(b))return!0}return!1},Zb.prototype.checkHitArea=function(a){if(this.hitPoints){for(var b=this.hitPoints.length-1;b>=0;b--)if(y(a,this.hitPoints[b])<=6)return this.editInfo={node:this.node,type:"hitAreaResize",index:b},this.cursor="crosshair",this.interactionState.editing=!0,!0;var c=this.node.toLocal(a);if(isNaN(c.x)||isNaN(c.y))return;if(this.node.hitArea.contains(c.x,c.y))return this.editInfo={node:this.node,type:"hitAreaMove",localPoint:c},this.cursor="move",this.interactionState.editing=!0,!0}return!1},Zb.prototype.checkPivot=function(a){return this.scene.editPivotEnabled&&this.position&&y(a,this.position)<=6?(this.editInfo={node:this.node,type:"pivot"},this.cursor="crosshair",this.interactionState.editing=!0,!0):!1},Zb.prototype.checkRotation=function(a){return this.rotationPoint&&y(a,this.rotationPoint)<=6?(this.editInfo={node:this.node,type:"rotation"},this.cursor="crosshair",this.interactionState.editing=!0,!0):!1},Zb.prototype.checkParent=function(a){return this.parentPoint&&y(a,this.parentPoint)<=6?(this.editInfo={node:this.node,type:"parent",sourcePoint:this.parentPoint,targetPoint:a},this.cursor="crosshair",this.interactionState.editing=!0,!0):!1},Zb.prototype.checkScale=function(a){var b=this.node;return this.scene.editScaleEnabled&&this.axisXPoint&&y(a,this.axisXPoint)<=6?(this.editInfo={node:b,type:"scaleX",scaleX:b.scaleX,position:b.getWorldPosition()},this.cursor="crosshair",this.interactionState.editing=!0,!0):this.scene.editScaleEnabled&&this.axisYPoint&&y(a,this.axisYPoint)<=6?(this.editInfo={node:b,type:"scaleY",scaleY:b.scaleY,position:b.getWorldPosition()},this.cursor="crosshair",this.interactionState.editing=!0,!0):!1},Zb.prototype.checkOnAxis=function(a){if(this.scene.editMoveEnabled){if(this.movePoints&&yb(this.movePoints,a.x,a.y))return this.editInfo={node:this.node,type:"move",lastGlobalPoint:a},this.cursor="move",this.interactionState.editing=!0,!0;if(this.axisXPoint&&qb(this.position,this.axisXPoint,a).z<3)return this.editInfo={node:this.node,type:"axisX",lastGlobalPoint:a},this.cursor="move",this.interactionState.editing=!0,!0;if(this.axisYPoint&&qb(this.position,this.axisYPoint,a).z<3)return this.editInfo={node:this.node,type:"axisY",lastGlobalPoint:a},this.cursor="move",this.interactionState.editing=!0,!0}return!1},Zb.prototype.checkResize=function(a){var b=this.resizePoints;if(b){if(this.scene.editCornerEnabled)for(var c=b.length-1;c>=0;c--)if(y(a,b[c])<=6)return this.editInfo={node:this.node,type:"resize",index:c},this.cursor="crosshair",this.interactionState.editing=!0,!0;if(this.scene.editEdgeEnabled){var d;if(qb(b[0],b[1],a).z<3?d="top":qb(b[1],b[2],a).z<3?d="right":qb(b[2],b[3],a).z<3?d="bottom":qb(b[3],b[0],a).z<3&&(d="left"),d)return this.editInfo={node:this.node,type:d},this.cursor="crosshair",this.interactionState.editing=!0,!0}}return!1},Zb.prototype.checkAnchor=function(a){var b=this.anchorInfo;if(b){var c;if(b.A&&y(b.A,a)<4?c="A":y(b.A0,a)<=8?c="A0":y(b.A1,a)<=8?c="A1":y(b.A2,a)<=8?c="A2":y(b.A3,a)<=8&&(c="A3"),c)return this.editInfo={node:this.node,type:c},this.cursor="A"===c?"move":"crosshair",this.interactionState.editing=!0,!0}return!1},Zb.prototype.handleEdit=function(a){this.scene.updateEditorCanvas();var b=this.editInfo;if(b){ga.sceneManager.dirty=!0;var c=this.dataModel,d=b.node,e=b.type,f=this.toGlobal(a);if("scaleX"===e)return b.undo||(b.undo=c.createScaleUndoFunc(d)),void this.handleScaleX(a,f,d);if("scaleY"===e)return b.undo||(b.undo=c.createScaleUndoFunc(d)),void this.handleScaleY(a,f,d);if("parent"===e)return void this.handleParent(a,f,d);if("move"===e)return b.undo||(b.undo=c.createMoveUndoFunc(d)),void this.handleMove(a,f);if("axisX"===e||"axisY"===e)return b.undo||(b.undo=c.createMoveUndoFunc(d)),void this.handleAxis(a,f,d);var g=d.toLocal(f);if(!isNaN(g.x)&&!isNaN(g.y))return"pivot"===e?(b.undo||(b.undo=c.createPivotUndoFunc(d)),void this.handlePivot(a,f,d,g)):"rotation"===e?(b.undo||(b.undo=c.createRotationUndoFunc(d)),void this.handleRotation(a,f,d,g)):this.RESIZE_TYPE_MAP[e]?(b.undo||(b.undo=c.createResizeUndoFunc(d)),void this.handleResize(a,f,d,g)):this.ANCHOR_TYPE_MAP[e]?(b.undo||(b.undo=c.createAnchorUndoFunc(d)),void this.handleAnchor(a,f,d)):"hitAreaResize"===e?void this.handleHitAreaResize(a,f,d,g):"hitAreaMove"===e?void this.handleHitAreaMove(a,f,d,g):void 0}},Zb.prototype.handleScaleX=function(a,b,c){if(c.scaleX){var d=this.position,e=this.axisXPoint.x-d.x,f=this.axisXPoint.y-d.y,g=b.x-d.x,h=b.y-d.y,i=e*g+f*h,j=this.editInfo.scaleX*i/6400/c.scaleX;this.dataModel.getTopEditableSelection(c).forEach(function(b){b.node.scaleX*=j,O(a)&&(b.node.scaleY*=j)})}},Zb.prototype.handleScaleY=function(a,b,c){if(c.scaleY){var d=this.position,e=this.axisYPoint.x-d.x,f=this.axisYPoint.y-d.y,g=b.x-d.x,h=b.y-d.y,i=e*g+f*h,j=this.editInfo.scaleY*i/6400/c.scaleY;this.dataModel.getTopEditableSelection(c).forEach(function(b){b.node.scaleY*=j,O(a)&&(b.node.scaleX*=j)})}},Zb.prototype.handleParent=function(a,b,c){this.editInfo.targetPoint=b;var d=this.getNodeAt(a);this.editInfo.targetNode=!d||d===c||d.isDescendantOf(c)?null:d},Zb.prototype.handleAxis=function(a,b){var c=this.editInfo,d="axisX"===c.type?this.axisXPoint:this.axisYPoint,e=b.x-c.lastGlobalPoint.x,f=b.y-c.lastGlobalPoint.y;this.dataModel.getTopEditableSelection().forEach(function(a){var b=a.node,c=b.getWorldPosition();c.x+=e,c.y+=f;var g=b.getWorldPosition(),h={x:g.x+d.x-this.position.x,y:g.y+d.y-this.position.y};c=vb(g,h,c),c=b.parent.toLocal(c),b.x=c.x,b.y=c.y},this),c.lastGlobalPoint=b},Zb.prototype.handleMove=function(a,b){var c=b.x-this.editInfo.lastGlobalPoint.x,d=b.y-this.editInfo.lastGlobalPoint.y;this.dataModel.moveSelection(c,d),this.editInfo.lastGlobalPoint=b},Zb.prototype.handlePivot=function(a,b,c,d){var e=c.rect;if(e.width&&e.height){c.pivotX=(d.x-e.x)/e.width,c.pivotY=(d.y-e.y)/e.height;var f=c.parent.toLocal(b);c.x=f.x,c.y=f.y}},Zb.prototype.handleRotation=function(a,b,c,d){var c=this.node,e=Math.atan2(d.y*c.scaleY,d.x*c.scaleX);this.dataModel.getTopEditableSelection(c).forEach(function(a){a.node.rotation+=e})},Zb.prototype.handleResize=function(a,b,c,d){var e,f,g=this.editInfo.type,h=this.editInfo.index,i=c.rect,j=i.x,k=i.y,l=i.width,m=i.height;"resize"===g?0===h?(e=Math.max(j+l-d.x,0),f=Math.max(k+m-d.y,0),j=j+l-e,k=k+m-f):1===h?(e=Math.max(d.x-j,0),f=Math.max(k+m-d.y,0),k=k+m-f):2===h?(e=Math.max(d.x-j,0),f=Math.max(d.y-k,0)):3===h&&(e=Math.max(j+l-d.x,0),f=Math.max(d.y-k,0),j=j+l-e):"left"===g?(e=Math.max(j+l-d.x,0),f=m,j=j+l-e):"right"===g?(e=Math.max(d.x-j,0),f=m):"top"===g?(e=l,f=Math.max(k+m-d.y,0),k=k+m-f):"bottom"===g&&(e=l,f=Math.max(d.y-k,0));var n=c.parent.toLocal(c.toGlobal({x:j+c.pivotX*e,y:k+c.pivotY*f}));c.x=n.x,c.y=n.y,c.width=e,c.height=f},Zb.prototype.handleHitAreaResize=function(a,b,c,d){var e,f,g=this.editInfo.index,h=this.node.hitArea,i=h.x,j=h.y,k=h.width,l=h.height;0===g?(e=k,f=Math.max(j+l-d.y,0),j=j+l-f):1===g?(e=Math.max(d.x-i,0),f=l):2===g?(e=k,f=Math.max(d.y-j,0)):3===g&&(e=Math.max(i+k-d.x,0),f=l,i=i+k-e),h.x=i,h.y=j,h.width=e,h.height=f,this.node.hitArea=h},Zb.prototype.handleHitAreaMove=function(a,b,c,d){var e=c.hitArea;e.x+=d.x-this.editInfo.localPoint.x,e.y+=d.y-this.editInfo.localPoint.y,this.node.hitArea=e,this.editInfo.localPoint=d},Zb.prototype.handleAnchor=function(a,b,c){var d=this.editInfo.type,e=c.parent.toLocal(b),f=c.parent.rect,g=c.minAnchor,h=c.maxAnchor,i=(e.x-f.x)/f.width,j=(e.y-f.y)/f.height,k=!O(a);"A"===d?c.setAnchor(new qc.Point(i,j),new qc.Point(i,j),k):"A0"===d?(i>h.x&&(i=h.x),j>h.y&&(j=h.y),c.setAnchor(new qc.Point(i,j),h,k)):"A1"===d?(i<g.x&&(i=g.x),j>h.y&&(j=h.y),c.setAnchor(new qc.Point(g.x,j),new qc.Point(i,h.y),k)):"A2"===d?(i<g.x&&(i=g.x),j<g.y&&(j=g.y),c.setAnchor(g,new qc.Point(i,j),k)):"A3"===d&&(i>h.x&&(i=h.x),j<g.y&&(j=g.y),c.setAnchor(new qc.Point(i,g.y),new qc.Point(h.x,j),k))};var $b=[{id:"editMode",type:"buttongroup",children:[{value:"pan",type:"togglebutton",background:null,hoverBackground:null,activeNinePatchImage:"banner_button_active_left.9",activeNinePatchBorder:[8,8,8,8],preferredSize:{width:32},borderWidth:0,icon:"pan",activeIcon:"pan_active",iconWidth:null,iconHeight:null,toolTip:"Pan Mode"},{value:"default",type:"togglebutton",background:null,hoverBackground:null,activeNinePatchImage:"banner_button_active.9",activeNinePatchBorder:[8,8,8,8],preferredSize:{width:32},borderWidth:0,icon:"move",activeIcon:"move_active",iconWidth:null,iconHeight:null,toolTip:"Move Mode"},{value:"scale",type:"togglebutton",background:null,hoverBackground:null,activeNinePatchImage:"banner_button_active.9",activeNinePatchBorder:[8,8,8,8],preferredSize:{width:32},borderWidth:0,icon:"scale",activeIcon:"scale_active",iconWidth:null,iconHeight:null,toolTip:"Scale Mode"},{value:"rectTransform",type:"togglebutton",background:null,hoverBackground:null,activeNinePatchImage:"banner_button_active_right.9",activeNinePatchBorder:[8,8,8,8],preferredSize:{width:32},borderWidth:0,icon:"transform",activeIcon:"transform_active",iconWidth:null,iconHeight:null,toolTip:"Transform Mode"}]},{id:"sceneHandler",type:"toolbar",layout:{type:"hbox",padding:0,gap:0},children:[{id:"fitContent",type:"button",icon:"fitContent",activeIcon:"fitContent_active",iconWidth:null,iconHeight:null,background:null,hoverBackground:null,padding:0,activeNinePatchImage:"banner_button_active_left.9",activeNinePatchBorder:[8,8,8,8],preferredSize:{width:32},borderWidth:0,toolTip:"Fit Content"},{id:"grid",type:"togglebutton",icon:"grid",activeIcon:"grid_active",iconWidth:null,iconHeight:null,background:null,hoverBackground:null,padding:0,activeNinePatchImage:"banner_button_active.9",activeNinePatchBorder:[8,8,8,8],preferredSize:{width:32},borderWidth:0,toolTip:"Show/Hide Grid"}]}],_b=(m("qc.editor.LeftBanner",qc.widget.Container,function ve(a){var b=this;ve["super"].constructor.call(b,a),b.layout=new qc.widget.layout.HBoxLayout(b),o($b,b),b.layout.padding=5,b.layout.gap=20,b.scrollBarMode="off",b.findViewById("sceneHandler").children.forEach(function(a){a.toolTip=ga._(a.toolTip),a.enableToolTip()});var c=b.findViewById("editMode");c.children.forEach(function(a){a.toolTip=ga._(a.toolTip),a.enableToolTip()}),c.on("propertyChange",function(a){"value"===a.property&&(ga.editMode=a.newValue)}),ga.e.on(ga.e.EDIT_MODE_CHANGE,function(a){c.value=a.newValue});var d=b.findViewById("fitContent");d.on("click",function(){ga.scene.fitContent(!0)});var e=b.findViewById("grid");e.on("propertyChange",function(a){"selected"===a.property&&(ga.gridVisible=a.newValue)}),ga.e.on(ga.e.GRID_VISIBLE_CHANGE,function(a){e.selected=a.newValue});var f=new qc.widget.Mousetrap;f.bind("q",function(){c.value="pan"}),f.bind("w",function(){c.value="default"}),f.bind("e",function(){c.value="scale"}),f.bind("r",function(){c.value="rectTransform"}),f.bind("t",function(){d.emit("click",null)}),f.bind("y",function(){e.selected=!e.selected}),f.bind("u",function(){})},{},{properties:[]},{}),[{id:"CreateEmptyNode",type:"qc.editor.DraggableButton",background:null,hoverBackground:null,activeBackground:null,activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},icon:"inspector_node",toolTip:"Empty Node",iconWidth:null,iconHeight:null},{id:"CreateImage",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_image",toolTip:"Image",iconWidth:null,iconHeight:null},{id:"CreateSprite",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_sprite",toolTip:"Sprite",iconWidth:null,iconHeight:null},{id:"CreateText",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_text",toolTip:"Text",iconWidth:null,iconHeight:null},{id:"CreateInputField",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_inputfield",toolTip:"Input Field",iconWidth:null,iconHeight:null},{id:"CreateToggle",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_toggle",toolTip:"Toggle",iconWidth:null,iconHeight:null},{id:"CreateButton",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_button",toolTip:"Button",iconWidth:null,iconHeight:null},{id:"CreateScrollBar",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_scrollbar",toolTip:"ScrollBar",iconWidth:null,iconHeight:null},{id:"CreateScrollView",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_scrollview",toolTip:"ScrollView",iconWidth:null,iconHeight:null},{id:"CreateProgressBar",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_progressbar",toolTip:"ProgressBar",iconWidth:null,iconHeight:null},{id:"CreateSlider",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_slider",toolTip:"Slider",iconWidth:null,iconHeight:null},{id:"CreateDom",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_dom",toolTip:"Dom",iconWidth:null,iconHeight:null},{id:"CreateSound",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_sound",toolTip:"Sound",iconWidth:null,iconHeight:null},{id:"CreateTilemap",type:"qc.editor.DraggableButton",activeNinePatchImage:"banner_creator_active.9",activeNinePatchBorder:[10,10,10,10],preferredSize:{width:32},background:null,hoverBackground:null,activeBackground:null,icon:"inspector_tilemap",toolTip:"Tilemap",iconWidth:null,iconHeight:null}]),ac=m("qc.editor.MiddleBanner",qc.widget.ButtonGroup,function we(a){var b=this;we["super"].constructor.call(b,a),b.layout=new qc.widget.layout.HBoxLayout(b),o(_b,b),b.layout.padding=[5,5,5,10],b.layout.gap=0,b.scrollBarMode="off",b.initCreatorHandler()},{},{properties:[]},{});ac.prototype.initCreatorHandler=function(){var a=this;a.children.forEach(function(a){a.toolTip=ga._(a.toolTip),a.enableToolTip()});var b=ga.menu;a.findViewById("CreateEmptyNode").on("click",function(){b.createNode()}),a.findViewById("CreateImage").on("click",function(){b.createImage()}),a.findViewById("CreateSprite").on("click",function(){b.createSprite()}),a.findViewById("CreateText").on("click",function(){b.createText()}),a.findViewById("CreateButton").on("click",function(){b.createButton()}),a.findViewById("CreateToggle").on("click",function(){b.createToggle()}),a.findViewById("CreateScrollBar").on("click",function(){b.createScrollBar()}),a.findViewById("CreateScrollView").on("click",function(){b.createScrollView()}),a.findViewById("CreateProgressBar").on("click",function(){b.createProgressBar()}),a.findViewById("CreateSlider").on("click",function(){b.createSlider()}),a.findViewById("CreateInputField").on("click",function(){b.createInputField()}),a.findViewById("CreateDom").on("click",function(){b.createDom()}),a.findViewById("CreateSound").on("click",function(){b.createSound()}),a.findViewById("CreateTilemap").on("click",function(){b.createTilemap()})};var bc=[{id:"gameSize",type:"qc.editor.DropDownList",background:null,ninePatchImage:null,textColor:"#caccd8",items:[{label:"Free Aspect",value:"Free Aspect"},{label:"iPhone 4 (640x960)",value:"iPhone 4 (640x960)",size:{width:640,height:960}},{label:"iPhone 5 (640x1136)",value:"iPhone 5 (640x1136)",size:{width:640,height:1136}},{label:"iPhone 6 (750x1334)",value:"iPhone 6 (750x1334)",size:{width:750,height:1334}},{label:"iPhone 6 Plus (1242x2208)",value:"iPhone 6 Plus (1242x2208)",size:{width:1242,height:2208}},{label:"iPad Mini (768x1024)",value:"iPad Mini (768x1024)",size:{width:768,height:1024}},{label:"iPad Air(1536x2048)",value:"iPad Air(1536x2048)",size:{width:1536,height:2048}},{label:"iPad Pro (2048x2732)",value:"iPad Pro (2048x2732)",size:{width:2048,height:2732}}],value:"Free Aspect"}];m("qc.editor.RightBanner",qc.widget.ButtonGroup,function xe(a){var b=this;xe["super"].constructor.call(b,a),o(bc,b),b.layout.align="right",b.layout.padding=5,b.findViewById("gameSize").on("propertyChange",function(a){if("value"===a.property){var b=a.source.items;ga.gameSize=b[a.source._map[a.newValue]].size,ga.storage.set("gameSize",ga.gameSize),ga.storage.set("gameSizeValue",a.newValue),ga.scene.fitContent(!0)}})},{},{properties:[]},{}),b.defineProperty(qc.editor.RightBanner.prototype,"gameSize",{get:function(){return ga.gameSize},set:function(a){ga.gameSize=a.size,this.findViewById("gameSize").value=a.value}});var cc=[{id:"play",value:"play",type:"togglebutton",icon:"play",ninePatchImage:"banner_run.9",ninePatchBorder:[10,10,10,10],activeNinePatchImage:"banner_run_active.9",activeNinePatchBorder:[8,8,8,10],hoverNinePatchImage:"banner_run.9",hoverNinePatchBorder:[10,10,10,10],background:null,hoverBackground:null,activeBackground:null,borderWidth:0,preferredSize:{width:52},activeIcon:"play_active",iconWidth:null,iconHeight:null,toolTip:"Play"},{id:"pause",value:"pause",type:"togglebutton",icon:"pause",ninePatchImage:"banner_pause.9",ninePatchBorder:[8,8,8,8],activeNinePatchImage:"banner_pause_active.9",activeNinePatchBorder:[8,8,8,8],hoverNinePatchImage:"banner_pause.9",hoverNinePatchBorder:[8,8,8,8],background:null,hoverBackground:null,activeBackground:null,borderWidth:0,preferredSize:{width:52},activeIcon:"pause_active",iconWidth:null,iconHeight:null,toolTip:"Pause"},{id:"step",value:"step",type:"button",icon:"step",ninePatchImage:"banner_nextframe.9",ninePatchBorder:[10,10,10,10],activeNinePatchImage:"banner_nextframe_active.9",activeNinePatchBorder:[10,10,10,10],
hoverNinePatchImage:"banner_nextframe.9",hoverNinePatchBorder:[10,10,10,10],background:null,hoverBackground:null,activeBackground:null,borderWidth:0,preferredSize:{width:52},activeIcon:"step_active",iconWidth:null,iconHeight:null,toolTip:"Next Frame"}];m("qc.editor.RunBanner",qc.widget.ButtonGroup,function ye(a){var b=this;ye["super"].constructor.call(b,a),o(cc,b),b.layout.align="center",b.layout.padding=1,b.selectionMode="multiple",b.children.forEach(function(a){a.toolTip=ga._(a.toolTip),a.enableToolTip()});var c=b.findViewById("play"),d=b.findViewById("pause"),e=b.findViewById("step");ga.e.on(ga.e.PLAYING_CHANGE,function(a){var e=a.newValue;b._updatingFromGlobal=!0,c.selected=e,d.selected=!1,b._updatingFromGlobal=!1}),c.on(ga.e.PROPERTY_CHANGE,function(a){"selected"!==a.property||b._updatingFromGlobal||(ga.playing=a.newValue)}),d.on(ga.e.PROPERTY_CHANGE,function(a){if(ga.workable){var c=a.newValue;"selected"!==a.property||b._updatingFromGlobal||b._updatingStep||(ga.game.paused=c),c||ga.game.disableStep()}}),e.on("click",function(){ga.workable&&(b._updatingStep=!0,d.selected=!0,ga.game.paused=!1,ga.game.stepping?ga.game.step():ga.game.enableStep(),b._updatingStep=!1)})},{},{properties:[]},{});var dc=[{region:"top",elementConfig:{type:"container",layout:"table",children:[{widths:[.1,105],cells:[{elementConfig:{type:"container",layout:"hbox",children:[{type:"button",text:"Clear"},{type:"button",text:"Collapse"},{type:"button",text:"Clear on play"},{type:"button",text:"Error pause"}]}},{elementConfig:{type:"container",layout:{type:"hbox",align:"right"},children:[{type:"togglebutton",text:"0",icon:ga.assetPath+"info.png"},{type:"togglebutton",text:"0",icon:ga.assetPath+"warn.png"},{type:"togglebutton",text:"0",icon:ga.assetPath+"error.png"}]}}]}]}},{region:"center",elementConfig:{type:"textarea"}}];m("qc.editor.Console",qc.widget.Container,function ze(a){var b=this;ze["super"].constructor.call(b,a),b.layout=new qc.widget.layout.BorderLayout(b),o(dc,b),b.layout.topToggleVisible=!1,b.layout.topResizable=!1,b.layout.splitterSize=1},{_background:"rgb(255, 255, 255)",_gradientColor:"rgb(211, 211, 211)"},{properties:[]},{});var ec=[{widths:[.1],height:22,cells:[{elementConfig:{type:"qc.editor.StringInput",id:"filter",padding:[2,0,2,22]}}]},{height:22,cells:[{elementConfig:{type:"label",text:"Components",id:"compsTitle",preferredSize:{width:200,height:26}}}]},{height:.1,cells:[{elementConfig:{type:"qc.editor.ComponentsList",id:"compsList"}}]}],fc=m("qc.editor.ComponentsList",qc.widget.List,function Ae(a){var b=this;Ae["super"].constructor.call(b,a),b.selectionModel.selectionMode="single",b.view.addEventListener("mousemove",function(a){var c=b.getDataAt(a);c&&(b.selectionModel.selection=c)});var c=b.drawRowBackground;b.drawRowBackground=function(a,d,e,f,g,h){c.call(b,a,d,e,f,g,h);var i=d.a("item"),j=b.selectionModel;if(i.items){var l={width:16,height:16,comps:[{type:"triangle",rect:[4,4,10,8],background:j.isSelected(d)?"white":"#868686",rotation:Math.PI/2}]};k.drawImage(a,l,"centerUniform",b.width-24,f,16,b.rowHeight,null,b)}},b.on("propertyChange",function(a){"items"===a.property&&b.switchToRoot()})});fc.prototype.forEach=function(a,b,c){var d=this,e=c?c.items:d._items;if(e)for(var f=0;f<e.length;f++){var g=e[f];a.call(b||d,g),d.forEach(a,b,g)}},fc.prototype.findParent=function(a){var b,c=this;return c.forEach(function(c){c&&c.items&&c.items.indexOf(a)>=0&&(b=c)}),b},fc.prototype.switchToFilter=function(a){var b=this,c=[];a&&(a=a.toLowerCase(),b.forEach(function(b){b.label.toLowerCase().indexOf(a)>=0&&!b.items&&c.push(b)}),b._switchItems(c),this._displayedItem="filter")},fc.prototype.switchToRoot=function(){this._switchItems(this.items),this._displayedItem="root"},fc.prototype.switchToItem=function(a){var b=this;a&&(b._switchItems(a.items),this._displayedItem=a)},fc.prototype._switchItems=function(a){var b=this,c=b.dataModel;if(c.clear(),a)for(var d=0;d<a.length;d++){var e=a[d],f=new qc.widget.Data;f.name=e.label,f.icon=e.icon,f.a("item",e),c.add(f)}},b.defineProperties(fc.prototype,{items:{get:function(){return this._items},set:function(a){var b=this;b.setPropertyValue("items",a)}},displayedItem:{get:function(){return this._displayedItem}}});var gc=m("qc.editor.ComponentsPanel",qc.widget.Container,function Be(a){var b=this;Be["super"].constructor.call(b,a),b.scrollBarMode="off";var c=new qc.widget.layout.TableLayout(b);b.layout=c,c.cellPadding=0,o(ec,b);var d=b.findViewById("filter"),e=d.getInput().style;e.backgroundImage='url("'+ga.assetPath+'magnifying-glass.png")',e.backgroundRepeat="no-repeat",e.backgroundSize="17px 17px",e.backgroundPosition="2px 50%",d.addEventListener("keydown",b.handleFilterKeydown.bind(b)),d.onValueChanged=b.filterList.bind(b);var f=b.findViewById("compsTitle");f.addEventListener("click",b.handleCompsTitleClick.bind(b)),f.background=b._titleBackground,f.gradientColor=null,f._oldDrawBackground=f.drawBackground,f.drawBackground=b.drawCompsTitleBackground.bind(b);var g=b.findViewById("compsList");g.switchToRoot(),g.addEventListener("click",b.handleCompsListClick.bind(b)),b.view.style.background=b._background,b.view.style.border="1px solid "+b._borderColor});gc.prototype.filterList=function(){var a=this,b=a.findViewById("filter"),c=a.findViewById("compsList"),d=a.findViewById("compsTitle"),e=b.value;e?(d.text="Search",c.switchToFilter(e)):(d.text="Component",c.switchToRoot())},gc.prototype.handleCompsTitleClick=function(){var a=this,b=a.findViewById("compsList"),c=a.findViewById("compsTitle"),d=b.displayedItem;if("root"!==d&&"filter"!==d){var e=b.findParent(d);e?(b.switchToItem(e),c.text=e.label):(c.text=ga._("Components"),b.switchToRoot())}},gc.prototype.drawCompsTitleBackground=function(a,b,c,d,e){var f=this,g=f.findViewById("compsList"),h=f.findViewById("compsTitle"),i=g.displayedItem;if(h._oldDrawBackground.call(h,a,b,c,d,e),a.beginPath(),"root"!==i&&"filter"!==i){var j={width:16,height:16,comps:[{type:"triangle",rect:[4,4,10,8],background:"#868686",rotation:-Math.PI/2}]};k.drawImage(a,j,"centerUniform",5,0,16,h.height,null,f)}},gc.prototype.handleFilterKeydown=function(a){var b,c=this,d=(c.findViewById("filter"),c.findViewById("compsTitle")),e=c.findViewById("compsList"),f=e.selectionModel,g=e.checkMode;if(b=g?e.focusData:f.lastData,k.isUp(a)||k.isDown(a)){a.preventDefault();var h=e.rowDatas;if(b&&e.getRowIndex(b)>=0){var i=e.getRowIndex(b);k.isUp(a)?0!==i&&(b=h[i-1],g?e.focusData=b:f.selection=b):i!==h.length-1&&(b=h[i+1],g?e.focusData=b:f.selection=b)}else h.length&&(b=h[0],g?e.focusData=b:f.selection=b)}else if(k.isEnter(a)){if(b){var j=b.a("item");j.items?(e.switchToItem(j),d.text=b.name):(j.action&&j.action.call(c,j,a),c.emit(ga.e.SELECT_COMPONENT,j))}}else k.isDelete(a)&&c.handleCompsTitleClick(a)},gc.prototype.handleCompsListClick=function(a){var b=this,c=b.findViewById("compsList"),d=b.findViewById("compsTitle"),e=c.getDataAt(a);if(e){var f=e.a("item");f.items?(c.switchToItem(f),d.text=e.name):(f.action&&f.action.call(b,f,a),b.emit(ga.e.SELECT_COMPONENT,f))}},b.defineProperties(gc.prototype,{preferredSize:{get:function(){return{width:212,height:252}}},items:{get:function(){return this.findViewById("compsList").items},set:function(a){var b=this.findViewById("compsList");b.items=a}}}),gc.prototype.calculateClientWidth=function(){return this.width-2},gc.prototype.calculateClientHeight=function(){return this.height-2};var hc=m("qc.editor.AddComponentButton",qc.widget.Button,function Ce(a){var b=this;Ce["super"].constructor.call(b,a),b._bindingHandleDocumentMousedown=b.handleDocumentMousedown.bind(b),b._bindingHandleEscKey=b.handleEscKey.bind(b),b._bindingRemovePopPanel=function(){b.removePopPanel()},b.text=ga._("Add Component"),b.disableToolTip(),b.on("click",b.handleClick,b)});hc.prototype.handleEscKey=function(a){if(27===a.keyCode){var b=this,c=b._componentsPanel;c&&c.isInDOM()&&b.removePopPanel()}},hc.prototype.handleClick=function(){var a=this,b=a.view.getBoundingClientRect(),c=a._componentsPanel;if(c||(c=a._componentsPanel=new gc,c.on(ga.e.SELECT_COMPONENT,function(b){a.removePopPanel(),a.emit(ga.e.SELECT_COMPONENT,b)})),c.isInDOM())a.removePopPanel();else{var d=c.preferredSize,e=qc.widget.Default.getWindowInfo(),f=(d.width,d.height),g=b.left,h=b.top+b.height;h+f>e.height&&(h=h-f-b.height),c.addToDOM({x:g,y:h,width:a.width,height:f}),c.items=this.items,c.findViewById("filter").input.focus(),document.addEventListener("mousedown",a._bindingHandleDocumentMousedown),document.addEventListener("keydown",a._bindingHandleEscKey),ga.e.on(ga.e.JS_CHANGED,a._bindingRemovePopPanel)}},hc.prototype.handleDocumentMousedown=function(a){var b=this,c=b._componentsPanel,d=a.target;c.view.contains(d)||b.view.contains(d)||b.removePopPanel()},hc.prototype.removePopPanel=function(){var a=this._componentsPanel;a.dispose(),delete this._componentsPanel,document.removeEventListener("mousedown",this._bindingHandleDocumentMousedown),document.removeEventListener("keydown",this._bindingHandleEscKey),ga.e.off(ga.e.JS_CHANGED,this._bindingRemovePopPanel)},hc.prototype._findItemByLabel=function(a,b){if(a)for(var c=0;c<a.length;c++){var d=a[c];if(d.label===b)return d}},hc.prototype.addItem=function(a,b,c){for(var d=this,e=a.split("/"),f=d,g=f.items,h=0;h<e.length;h++){var i=e[h];if(g||(g=f.items=[]),f=d._findItemByLabel(g,i),!f){if(h===e.length-1){if(f={label:i,action:b},c)for(var j in c)f[j]=c[j]}else f={label:i};g.push(f)}g=f.items}d.epc("items",null,d.items)},hc.prototype.dispose=function(){},b.defineProperties(hc.prototype,{items:{get:function(){return this._items},set:function(a){this.setPropertyValue("items",a)}}});var ic={width:32,height:32,comps:{func:function(a,b){var c=[],d={type:"border",rect:[17,1,1],relative:!0,borderWidth:1,borderColor:"rgb(159, 159, 159)"},e={type:"border",rect:{func:function(a,b){var c=[.25,.25,.5,.5];if(b instanceof mc&&b.altDown){var d=a.id;/left/i.test(d)?c[0]=0:/right/i.test(d)?c[0]=.5:/hStretch/i.test(d)&&(c[0]=0,c[2]=1),/top/i.test(d)?c[1]=0:/bottom/i.test(d)?c[1]=.5:/vStretch/i.test(d)&&(c[1]=0,c[3]=1)}return c}},relative:!0,borderWidth:1,borderColor:"rgb(97, 97, 97)"},f={type:"rect",rect:[0,0,1,32],background:"rgb(200, 84, 84)",borderWidth:0,gradient:""},g={type:"rect",rect:[15.5,0,1,32],background:"rgb(200, 84, 84)",borderWidth:0,gradient:""},h={type:"rect",rect:[31,0,1,32],background:"rgb(200, 84, 84)",borderWidth:0,gradient:""},i={type:"rect",rect:[0,0,32,1],background:"rgb(200, 84, 84)",borderWidth:0,gradient:""},j={type:"rect",rect:[0,15.5,32,1],background:"rgb(200, 84, 84)",borderWidth:0,gradient:""},k={type:"rect",rect:[0,31,32,1],background:"rgb(200, 84, 84)",borderWidth:0,gradient:""},l=[{type:"shape",points:{func:function(a,b){var c=[12,13,9,16,12,19,20,13,23,16,20,19];if(b instanceof mc&&b.altDown){var d=a.id;/hStretch/i.test(d)&&(c[0]=c[0]-8,c[2]=c[2]-8,c[4]=c[4]-8,c[6]=c[6]+8,c[8]=c[8]+8,c[10]=c[10]+8,/top/i.test(d)?(c[1]=c[1]-8,c[3]=c[3]-8,c[5]=c[5]-8,c[7]=c[7]-8,c[9]=c[9]-8,c[11]=c[11]-8):/bottom/i.test(d)&&(c[1]=c[1]+8,c[3]=c[3]+8,c[5]=c[5]+8,c[7]=c[7]+8,c[9]=c[9]+8,c[11]=c[11]+8))}return c}},segments:[1,2,2,5,1,2,2,5],background:"rgb(0, 153, 204)"},{type:"rect",rect:{func:function(a,b){var c=[8,15.5,16,1];if(b instanceof mc&&b.altDown){var d=a.id;/hStretch/i.test(d)&&(c[0]=0,c[2]=32,/top/i.test(d)?c[1]-=8:/bottom/i.test(d)&&(c[1]+=8))}return c}},background:"rgb(0, 153, 204)"}],m=[{type:"shape",points:{func:function(a,b){var c=[13,12,16,9,19,12,13,20,16,23,19,20];if(b instanceof mc&&b.altDown){var d=a.id;/vStretch/i.test(d)&&(c[1]=c[1]-8,c[3]=c[3]-8,c[5]=c[5]-8,c[7]=c[7]+8,c[9]=c[9]+8,c[11]=c[11]+8,/left/i.test(d)?(c[0]=c[0]-8,c[2]=c[2]-8,c[4]=c[4]-8,c[6]=c[6]-8,c[8]=c[8]-8,c[10]=c[10]-8):/right/i.test(d)&&(c[0]=c[0]+8,c[2]=c[2]+8,c[4]=c[4]+8,c[6]=c[6]+8,c[8]=c[8]+8,c[10]=c[10]+8))}return c}},segments:[1,2,2,5,1,2,2,5],background:"rgb(0, 153, 204)"},{type:"rect",rect:{func:function(a,b){var c=[15.5,8,1,16];if(b instanceof mc&&b.altDown){var d=a.id;/vStretch/i.test(d)&&(c[1]=0,c[3]=32,/left/i.test(d)?c[0]-=8:/right/i.test(d)&&(c[0]+=8))}return c}},background:"rgb(0, 153, 204)"}],n={type:"circle",rect:{func:function(a,b){var c=[0,0,0,0],d=a.id;return/custom/i.test(d)?void 0:(b.shiftDown&&(c=[14,14,4,4]),/left/i.test(d)?(c[0]-=7,b.altDown&&(c[0]-=8)):/right/i.test(d)&&(c[0]+=7,b.altDown&&(c[0]+=8)),/top/i.test(d)?(c[1]-=7,b.altDown&&(c[1]-=8)):/bottom/i.test(d)&&(c[1]+=7,b.altDown&&(c[1]+=8)),c)}},background:"rgb(0, 153, 204)"},o={type:"rect",rect:{func:function(a,b){var c;return c=b instanceof kc?b._strValue:a.id,/leftTop/i.test(c)?[-1.5,-1.5,4,4]:/centerTop/i.test(c)?[14,-1.5,4,4]:/rightTop/i.test(c)?[29.5,-1.5,4,4]:/hStretch/i.test(c)?[0,0,0,0]:/leftMiddle/i.test(c)?[-1.5,14,4,4]:/centerMiddle/i.test(c)?[14,14,4,4]:/rightMiddle/i.test(c)?[29.5,14,4,4]:/leftBottom/i.test(c)?[-1.5,29.5,4,4]:/centerBottom/i.test(c)?[14,29.5,4,4]:/rightBottom/i.test(c)?[29.5,29.5,4,4]:void 0}},background:"rgb(153, 102, 0)",borderWidth:0,gradient:""},p=[{type:"rect",rect:{func:function(a,b){var c;return c=b instanceof kc?b._strValue:a.id,/top/i.test(c)?[31,-1.5,2,4]:/middle/i.test(c)?[31,14,2,4]:/bottom/i.test(c)?[31,29.5,2,4]:/left/i.test(c)?[-1.5,31,4,2]:/center/i.test(c)?[14,31,4,2]:/right/i.test(c)?[29.5,31,4,2]:void 0}},background:"rgb(153, 102, 0)",borderWidth:0,gradient:""},{type:"rect",rect:{func:function(){return/top/i.test(s)?[-1,-1.5,2,4]:/middle/i.test(s)?[-1,14,2,4]:/bottom/i.test(s)?[-1,29.5,2,4]:/left/i.test(s)?[-1.5,-1,4,2]:/center/i.test(s)?[14,-1,4,2]:/right/i.test(s)?[29.5,-1,4,2]:void 0}},background:"rgb(153, 102, 0)",borderWidth:0,gradient:""}],q=[],r=[[-1,-1,2,2],[31,31,2,2],[31,-1,2,2],[-1,31,2,2]];r.forEach(function(a){q.push({type:"rect",rect:a,background:"rgb(153, 102, 0)",borderWidth:0,gradient:""})}),c.push(d),c.push(e);var s;return s=b instanceof kc?b._strValue:a.id,/left/i.test(s)&&c.push(f),/center/i.test(s)&&c.push(g),/right/i.test(s)&&c.push(h),/top/i.test(s)&&c.push(i),/middle/i.test(s)&&c.push(j),/bottom/i.test(s)&&c.push(k),/hStretch/i.test(s)&&(c=c.concat(l)),/vStretch/i.test(s)&&(c=c.concat(m)),/content/i.test(s)&&(/hStretch/i.test(s)&&/vStretch/i.test(s)?c=c.concat(q):/hStretch/i.test(s)||/vStretch/i.test(s)?c=c.concat(p):c.push(o),c.push(n)),c}}},jc={width:60,height:60,comps:[{type:"text",rect:[10,0,50,10],text:{func:function(a,b){var c=b._strValue;if(c)for(var d=["left","right","center","hStretch"],e=0;e<d.length;e++){var f=d[e];if(c.indexOf(f)>=0)return"hStretch"===f?"stretch":f}return"custom"}},align:"top",color:{func:function(a,b){return b._labelColor}},font:"10px Arial"},{type:"text",rect:[0,10,10,50],text:{func:function(a,b){var c=b._strValue;if(c)for(var d=["top","bottom","middle","vStretch"],e=0;e<d.length;e++){var f=d[e],g=f;if(/custom/i.test(c)||(g=g.substr(0,1).toUpperCase()+g.substr(1)),c.indexOf(g)>=0)return"vStretch"===f?"stretch":f}return"custom"}},rotation:-Math.PI/2,align:"top",color:{func:function(a,b){return b._labelColor}},font:"10px Arial"},{type:"rect",rect:[10,10,50,50],background:{func:function(a,b){return b._imageBackground}}},{type:"border",rect:[10,10,50,50],borderWidth:1,borderColor:"rgb(129, 129, 129)"},{type:"image",name:ic,rect:[10,10,50,50]}]},kc=m("qc.editor.AnchorButton",qc.widget.Button,function De(a){var b=this;De["super"].constructor.call(b,a),b.on("click",b.handleClick,b),b._bindingHandleDocumentMousedown=b.handleDocumentMousedown.bind(b),b._bindingHandleDocumentKeydown=b.handleDocumentKeydown.bind(b),b._bindingRemovePopPanel=function(){b.removePopPanel()},b.disableToolTip();var c="rgba(0, 0, 0, 0)";b.background=c,b.gradientColor=c,b.hoverBackground=c,b.hoverGradientColor=c,b.activeBackground=c,b.activeGradientColor=c,b.preferredSize={width:60,height:60},b.iconWidth=60,b.iconHeight=60,b.borderWidth=0,b.on("propertyChange",function(a){"value"===a.property&&b.onValueChanged&&b.onValueChanged(a.newValue)})});kc.prototype.isSameAnchor=function(a,b){if(a===b)return!0;if(a&&b){var c="",d="";for(var e in a)c+=e+a[e];for(var e in b)d+=e+b[e];return c===d}},b.defineProperties(kc.prototype,{strValueMap:{get:function(){return{leftTop:[0,0,0,0],centerTop:[.5,0,.5,0],rightTop:[1,0,1,0],hStretchTop:[0,0,1,0],leftMiddle:[0,.5,0,.5],centerMiddle:[.5,.5,.5,.5],rightMiddle:[1,.5,1,.5],hStretchMiddle:[0,.5,1,.5],leftBottom:[0,1,0,1],centerBottom:[.5,1,.5,1],rightBottom:[1,1,1,1],hStretchBottom:[0,1,1,1],leftVStretch:[0,0,0,1],centerVStretch:[.5,0,.5,1],rightVStretch:[1,0,1,1],hStretchVStretch:[0,0,1,1]}}},icon:{get:function(){return jc}},value:{get:function(){return this._value},set:function(a){var b=this.value;this.isSameAnchor(b,a)||(this._strValue=this.valueToStr(a),this.setPropertyValue("value",a))}}}),kc.prototype.valueToStr=function(a){if(a){var c;c=Array.isArray(a)?a:[a.minAnchorX,a.minAnchorY,a.maxAnchorX,a.maxAnchorY];for(var d=this.strValueMap,e=b.keys(d),f=0;f<e.length;f++){var g=e[f];if(d[g].join()===c.join())return g}return 0===a.minAnchorX&&0===a.maxAnchorX?"leftCustom":.5===a.minAnchorX&&.5===a.maxAnchorX?"centerCustom":1===a.minAnchorX&&1===a.maxAnchorX?"rightCustom":0===a.minAnchorX&&1===a.maxAnchorX?"hStretchCustom":0===a.minAnchorY&&0===a.maxAnchorY?"topCustom":.5===a.minAnchorY&&.5===a.maxAnchorY?"middleCustom":1===a.minAnchorY&&1===a.maxAnchorY?"bottomCustom":0===a.minAnchorY&&1===a.maxAnchorY?"vStretchCustom":"custom"}},kc.prototype.strToValue=function(a,b){var c=this.strValueMap[a];return c?c:b?(b={minAnchorX:b.minAnchorX,minAnchorY:b.minAnchorY,maxAnchorX:b.maxAnchorX,maxAnchorY:b.maxAnchorY},"leftCustom"===a?(b.minAnchorX=0,b.maxAnchorX=0):"centerCustom"===a?(b.minAnchorX=.5,b.maxAnchorX=.5):"rightCustom"===a?(b.minAnchorX=1,b.maxAnchorX=1):"hStretchCustom"===a?(b.minAnchorX=0,b.maxAnchorX=1):"topCustom"===a?(b.minAnchorY=0,b.maxAnchorY=0):"middleCustom"===a?(b.minAnchorY=.5,b.maxAnchorY=.5):"bottomCustom"===a?(b.minAnchorY=1,b.maxAnchorY=1):"vStretchCustom"===a&&(b.minAnchorY=0,b.maxAnchorY=1),[b.minAnchorX,b.minAnchorY,b.maxAnchorX,b.maxAnchorY]):void 0},kc.prototype.handleClick=function(){var a=this,b=a.view.getBoundingClientRect(),c=a._anchorPresetsPanel;if(c||(c=a._anchorPresetsPanel=new mc,c.on("propertyChange",a.handleAnchorPresetsPanelPropertyChange,a)),c.isInDOM())a.removePopPanel();else{var d=c.preferredSize,e={x:b.left+10,y:b.top+b.height,width:d.width,height:d.height},f=k.getWindowInfo();e.x+e.width>f.width&&(e.x=f.width-e.width),e.y+e.height>f.height&&(e.y=f.height-e.height),c.addToDOM(e),c.value=this._strValue,c.requestFocus(),c.on("doubleClick",a._bindingRemovePopPanel),document.addEventListener("mousedown",a._bindingHandleDocumentMousedown),document.addEventListener("keydown",a._bindingHandleDocumentKeydown),ga.e.on(ga.e.JS_CHANGED,a._bindingRemovePopPanel),a.onPopPanelShown&&a.onPopPanelShown()}},kc.prototype.handleDocumentKeydown=function(a){var b=this,c=b._anchorPresetsPanel;c&&F(a)&&b.removePopPanel()},kc.prototype.handleDocumentMousedown=function(a){var b=this,c=b._anchorPresetsPanel,d=a.target;c.view.contains(d)||b.view.contains(d)||b.removePopPanel()},kc.prototype.removePopPanel=function(){var a=this._anchorPresetsPanel;a.off("propertyChange",this.handleAnchorPresetsPanelPropertyChange,this),a.dispose(),delete this._anchorPresetsPanel,document.removeEventListener("mousedown",this._bindingHandleDocumentMousedown),document.removeEventListener("keydown",this._bindingHandleDocumentKeydown),ga.e.off(ga.e.JS_CHANGED,this._bindingRemovePopPanel),this.onPopPanelHidden&&this.onPopPanelHidden()},kc.prototype.handleAnchorPresetsPanelPropertyChange=function(a){if("value"===a.property){var b,c,d=a.newValue;/altDown/.test(d)&&(d=d.replace(":altDown",""),b=!0),/shiftDown/.test(d)&&(d=d.replace(":shiftDown",""),c=!0);var e=this.strToValue(d,this._value),f={minAnchorX:e[0],minAnchorY:e[1],maxAnchorX:e[2],maxAnchorY:e[3]};b&&(f.position=d),c&&(f.pivot=d),this.value=f}};var lc=m("qc.editor.AnchorPresetsViewInteractor",null,function Ee(a){var b=this;b._view=a,Ee["super"].constructor.call(b,a),b.addListeners()},{handle_mousewheel:function(a){Y(a)},handle_DOMMouseScroll:function(a){Y(a)}},{interactor:!0},{view:{get:function(){return this._view}}}),mc=m("qc.editor.AnchorPresetsView",qc.widget.graph.GraphView,function Fe(a){var b=this;Fe["super"].constructor.call(b,a),b.interactors=[],b.scrollBarMode="off",b.loadDataModel(),b.view.addEventListener("mousedown",function(a){Y(a)}),b.view.addEventListener("click",b.handleClick.bind(b)),b.forEach(function(a){a.s("select.color","white"),a.s("select.padding",4)}),b.addEventListener("keydown",b.handleKeyEvent.bind(b)),b.addEventListener("keyup",b.handleKeyEvent.bind(b)),b.addBottomPainter(function(a){a.beginPath(),a.rect(0,0,b.width,b.height),a.fillStyle=b._background,a.fill()});var c=b.validateImpl;b.validateImpl=function(){b.view.style.border="1px solid "+b._borderColor,c.call(b)},new lc(b)});mc.prototype.handleKeyEvent=function(a){var b=this;b.altDown=a.altKey?!0:!1,b.shiftDown=a.shiftKey?!0:!1},mc.prototype.invalidateData=function(a){this._redrawAll=1,qc.widget.graph.GraphView.prototype.invalidateData.call(this,a)},mc.prototype.handleClick=function(a){var b=this;if(k.isDoubleClick(a))b.emit("doubleClick");else{for(var c,d=b.dataModel,e=d._datas,f=b.lp(a),g=0;g<e.length;g++){var h=e[g],i=h.id;if(i&&v(h.rect,f)){c=h;break}}c&&b.handleDataClick(c)}},mc.prototype.handleDataClick=function(a){var b=this,c=b.dataModel,d=c.getDataById("customContent");if(a&&a!==d){var e,f=a.category;if(/header/i.test(f)){b.selectHeader(a);var g,h,i=b.selectedColumnHeader,j=b.selectedRowHeader;i&&(g=i.id.replace(/header/i,"")),j&&(h=j.id.replace(/header/i,"")),i&&j?(h=h.substr(0,1).toUpperCase()+h.substr(1),e=g+h):i?e=g+"Custom":j&&(e=h+"Custom")}else"content"===a.category&&(e=a.id.replace(/content/i,""));e&&(b.altDown&&(e+=":altDown"),b.shiftDown&&(e+=":shiftDown"),b.value=e)}},mc.prototype.selectHeader=function(a){var b=this,c=b.dataModel,d=c.selectionModel,e=d.selection,f=a.category;if(e&&e.length>0)if("columnHeader"===f)for(var g=0;g<e.length;g++){var h=e[g];"columnHeader"===h.category&&d.removeSelection(h)}else if("rowHeader"===f&&e.length>=1)for(var g=0;g<e.length;g++){var h=e[g];"rowHeader"===h.category&&d.removeSelection(h)}d.appendSelection(a)},mc.prototype.handleValueChange=function(a){var b=this,c=b.dataModel,d=c.selectionModel,e=c.getDataById("customContent");if(d.clearSelection(),/custom/i.test(a))e.s("visible",!0),e.s("label.visible",!0),e.s("label2.visible",!0),d.selection=e,["left","right","center","hStretch"].forEach(function(b){0===a.indexOf(b)&&(f=b,d.appendSelection(c.getDataById(b+"Header")),e.s("label.visible",!1))}),["top","middle","bottom","vStretch"].forEach(function(b){0===a.indexOf(b)&&(d.appendSelection(c.getDataById(b+"Header")),e.s("label2.visible",!1))});else{e.s("visible",!1),a=a.replace(":altDown",""),a=a.replace(":shiftDown",""),d.selection=c.getDataById(a+"Content");var f;["left","right","center","hStretch"].forEach(function(b){0===a.indexOf(b)&&(f=b,d.appendSelection(c.getDataById(b+"Header")))}),["Top","Middle","Bottom","VStretch"].forEach(function(b){a.indexOf(b)>0&&(b=b.substr(0,1).toLowerCase()+b.substr(1),d.appendSelection(c.getDataById(b+"Header")))})}},b.defineProperties(mc.prototype,{altDown:{get:function(){return this._altDown},set:function(a){this.setPropertyValue("altDown",a)}},shiftDown:{get:function(){return this._shiftDown},set:function(a){this.setPropertyValue("shiftDown",a)}},preferredSize:{get:function(){return{width:262,height:302}}},selectedColumnHeader:{get:function(){var a=this.dataModel.selectionModel.selection;if(a)for(var b=0;b<a.length;b++){var c=a[b];if("columnHeader"===c.category)return c}}},selectedRowHeader:{get:function(){var a=this.dataModel.selectionModel.selection;if(a)for(var b=0;b<a.length;b++){var c=a[b];if("rowHeader"===c.category)return c}}},customed:{get:function(){var a=this.dataModel.getDataById("customContent");return this.isSelected(a)}},value:{get:function(){return this._value},set:function(a){var b=this,c=b.orientation;b.setPropertyValue("value",a),c!==a&&b.handleValueChange(a)}}}),mc.prototype.loadDataModel=function(){var a=this,b=new qc.widget.graph.Node;a.dataModel.add(b),b.setAnchor(0,0),b.setPosition(0,0),b.image={width:260,height:36,comps:[{type:"rect",rect:[0,0,260,36],background:{func:function(a,b){return b._titleBackground}},borderWidth:0,gradient:""},{type:"text",text:"Anchor Presets",color:{func:function(a,b){return b._labelColor}},align:"center",font:"bold 11px Arial",rect:[0,3,107,12]},{type:"text",text:"Shift: Also set pivot",color:{func:function(a,b){return b._labelColor}},align:"center",font:"10px Arial",rect:[0,21,107,7]},{type:"text",text:"Alt: Also set position",color:{func:function(a,b){return b._labelColor}},align:"center",font:"11px Arial",rect:[115,21,107,7]},{type:"rect",background:{func:function(a,b){return b._borderColor}},rect:[0,35,260,1]}]};var c=new qc.widget.graph.Node;c.image={width:10,height:10,comps:[{type:"rect",background:{func:function(a,b){return b._borderColor}},rect:[17,1,1],relative:!0}]},c.setAnchor(0,0),c.setPosition(0,97),c.setSize(260,1),a.dataModel.add(c);var d=new qc.widget.graph.Node;d.image={width:10,height:10,comps:[{type:"rect",background:{func:function(a,b){return b._borderColor}},rect:[17,1,1],relative:!0}]},d.setAnchor(0,0),d.setPosition(61,36),d.setSize(1,264),a.dataModel.add(d);var e=new qc.widget.graph.Node;e.image={width:100,height:100,comps:[{type:"rect",rect:[17,1,1],relative:!0,background:{func:function(a,b){return b._titleBackground}}}]},e.setAnchor(1,1),e.setPosition(260,300),e.setSize(198,202),a.dataModel.add(e);var f=new qc.widget.graph.Node;f.setAnchor(0,0),f.setPosition(21,58),f.image=ic,f.s("label","custom"),f.s("label.font","10px Arial"),f.s("label.position",3),f.s("label.offset.y",-3),f.s("label2","custom"),f.s("label2.font","10px Arial"),f.s("label2.position",14),f.s("label2.offset.x",6),f.s("label2.rotation",-Math.PI/2),f.id="customContent",f.category="content",a.dataModel.add(f);var g=new qc.widget.graph.Node;g.name="left",g.s("label.font","10px Arial"),g.s("label.position",3),g.s("label.offset.y",-3),g.setAnchor(0,0),g.setPosition(78,58),g.image=ic,g.id="leftHeader",g.category="columnHeader",a.dataModel.add(g);var h=new qc.widget.graph.Node;h.name="center",h.s("label.font","10px Arial"),h.s("label.position",3),h.s("label.offset.y",-3),h.setAnchor(0,0),h.setPosition(121,58),h.id="centerHeader",h.category="columnHeader",h.image=ic,a.dataModel.add(h);var i=new qc.widget.graph.Node;i.name="right",i.s("label.font","10px Arial"),i.s("label.position",3),i.s("label.offset.y",-3),i.setAnchor(0,0),i.id="rightHeader",i.category="columnHeader",i.setPosition(164,58),i.image=ic,a.dataModel.add(i);var j=new qc.widget.graph.Node;j.name="stretch",j.s("label.font","10px Arial"),j.s("label.position",3),j.s("label.offset.y",-3),j.setAnchor(0,0),j.setPosition(222,58),j.image=ic,j.id="hStretchHeader",j.category="columnHeader",a.dataModel.add(j);var k=new qc.widget.graph.Node;k.name="top",k.s("label.font","10px Arial"),k.s("label.position",14),k.s("label.offset.x",-3),k.s("label.rotation",-Math.PI/2),k.setAnchor(0,0),k.setPosition(21,116),k.image=ic,k.id="topHeader",k.category="rowHeader",a.dataModel.add(k);var l=new qc.widget.graph.Node;l.name="middle",l.s("label.font","10px Arial"),l.s("label.position",14),l.s("label.offset.x",6),l.s("label.rotation",-Math.PI/2),l.setAnchor(0,0),l.setPosition(21,159),l.image=ic,l.id="middleHeader",l.category="rowHeader",a.dataModel.add(l);var m=new qc.widget.graph.Node;m.name="bottom",m.s("label.font","10px Arial"),m.s("label.position",14),m.s("label.offset.x",6),m.s("label.rotation",-Math.PI/2),m.setAnchor(0,0),m.setPosition(21,202),m.image=ic,m.id="bottomHeader",m.category="rowHeader",a.dataModel.add(m);var n=new qc.widget.graph.Node;n.name="stretch",n.s("label.font","10px Arial"),n.s("label.position",14),n.s("label.offset.x",6),n.s("label.rotation",-Math.PI/2),n.setAnchor(0,0),n.setPosition(21,260),n.image=ic,n.id="vStretchHeader",n.category="rowHeader",a.dataModel.add(n);var o=new qc.widget.graph.Node;o.setAnchor(0,0),o.setPosition(78,116),o.image=ic,o.id="leftTopContent",o.category="content",a.dataModel.add(o);var p=new qc.widget.graph.Node;p.setAnchor(0,0),p.setPosition(121,116),p.image=ic,p.id="centerTopContent",p.category="content",a.dataModel.add(p);var q=new qc.widget.graph.Node;q.setAnchor(0,0),q.setPosition(164,116),q.image=ic,q.id="rightTopContent",q.category="content",a.dataModel.add(q);var r=new qc.widget.graph.Node;r.setAnchor(0,0),r.setPosition(222,116),r.image=ic,r.id="hStretchTopContent",r.category="content",a.dataModel.add(r);var s=new qc.widget.graph.Node;s.setAnchor(0,0),s.setPosition(78,159),s.image=ic,s.id="leftMiddleContent",s.category="content",a.dataModel.add(s);var t=new qc.widget.graph.Node;t.setAnchor(0,0),t.setPosition(121,159),t.image=ic,t.id="centerMiddleContent",t.category="content",a.dataModel.add(t);var u=new qc.widget.graph.Node;u.setAnchor(0,0),u.setPosition(164,159),u.image=ic,u.id="rightMiddleContent",u.category="content",a.dataModel.add(u);var v=new qc.widget.graph.Node;v.setAnchor(0,0),v.setPosition(222,159),v.image=ic,v.id="hStretchMiddleContent",v.category="content",a.dataModel.add(v);var w=new qc.widget.graph.Node;w.setAnchor(0,0),w.setPosition(78,202),w.image=ic,w.id="leftBottomContent",w.category="content",a.dataModel.add(w);var x=new qc.widget.graph.Node;x.setAnchor(0,0),x.setPosition(121,202),x.image=ic,x.id="centerBottomContent",x.category="content",a.dataModel.add(x);var y=new qc.widget.graph.Node;y.setAnchor(0,0),y.setPosition(164,202),y.image=ic,y.id="rightBottomContent",y.category="content",a.dataModel.add(y);var z=new qc.widget.graph.Node;z.setAnchor(0,0),z.setPosition(222,202),z.image=ic,z.id="hStretchBottomContent",z.category="content",a.dataModel.add(z);var A=new qc.widget.graph.Node;A.setAnchor(0,0),A.setPosition(78,260),A.image=ic,A.id="leftVStretchContent",A.category="content",a.dataModel.add(A);var B=new qc.widget.graph.Node;B.setAnchor(0,0),B.setPosition(121,260),B.image=ic,B.id="centerVStretchContent",B.category="content",a.dataModel.add(B);var C=new qc.widget.graph.Node;C.setAnchor(0,0),C.setPosition(164,260),C.image=ic,C.id="rightVStretchContent",C.category="content",a.dataModel.add(C);var D=new qc.widget.graph.Node;D.setAnchor(0,0),D.setPosition(222,260),D.image=ic,D.id="hStretchVStretchContent",D.category="content",a.dataModel.add(D)},mc.prototype.calculateClientWidth=function(){return this.width-2},mc.prototype.calculateClientHeight=function(){return this.height-2};var nc=qc.editor.InspectorUtil={};nc.redraw=function(a){ga.inspector.propertyView.inspect(a)},nc.makePropertyName=function(a){for(var b=function(a){return a&&a.substring(0,1).toUpperCase()+a.substring(1)},c=[],d=0,e=!1,f=0;f<a.length;++f)if(a[f]>="0"&&a[f]<="9"){if(!e){var g=a.substring(d,f);c.push(b(g)),d=f,e=!0}}else if(a[f]>="A"&&a[f]<="Z"){if(f===d)continue;var g=a.substring(d,f);c.push(b(g)),d=f,e=!1}else if(e){var g=a.substring(d,f);c.push(b(g)),d=f,e=!1}var g=a.substring(d);return c.push(b(g)),c.join(" ")},nc.drawPrefabInput=function(a,b,c){var d;return aa.line([aa.text(b),d=aa.objectInput({objectType:"prefab",target:a,targetField:c,bind:c})]),d},nc.drawTextureInput=function(a,b,c,d,e){c=c||"texture",b=b||nc.makePropertyName(c);var f;return aa.line([aa.text(b),f=aa.objectInput({objectType:"texture",target:a,targetField:c,bind:c,onValueChanged:d,bindTarget:e})]),f},nc.drawSoundInput=function(a,b,c,d){b=b||"Sound",c=c||"sound";var e;return aa.line([aa.text(b),e=aa.objectInput({objectType:"sound",target:a,targetField:c,bind:c,onValueChanged:d})]),e},nc.drawTextAssetInput=function(a,b,c,d){b=b||"Text",c=c||"text";var e;return aa.line([aa.text(b),e=aa.objectInput({objectType:"textAsset",target:a,targetField:c,bind:c,onValueChanged:d})]),e},nc.drawExcelAssetInput=function(a,b,c,d){b=b||"Text",c=c||"text";var e;return aa.line([aa.text(b),e=aa.objectInput({objectType:"excelAsset",target:a,targetField:c,bind:c,onValueChanged:d})]),e},nc.drawColorPicker=function(a,b,c,d,e){b=b||"Color",c=c||"colorTint";var f;if(d)var g=aa.line([aa.empty(),aa.text(b),f=aa.colorPicker({
bind:c,"dropDown.colorChooser.alphaEnabled":e===!1?!1:!0})]);else var g=aa.line([aa.text(b),f=aa.colorPicker({bind:c,"dropDown.colorChooser.alphaEnabled":e===!1?!1:!0})]);return f.value=a[c],g},nc.drawNodeRef=function(a,b,c,d,e){e=e||nc.makePropertyName(b);var f=aa.objectInput({objectType:"node",target:a,targetField:b,bind:b,nodeType:c});if(d)var g=aa.line([aa.empty(),aa.text(e),f]);else var g=aa.line([aa.text(e),f]);return g},nc.drawUserDefines=function(a){var b=a.scripts,c=[];for(var d in b){var e=b[d],f=e["class"];if(!nc.builtinScripts()[f]){var g=new qc.editor.UserDefinePanel(e);c.push(g)}}return c},nc.drawBuiltinComponents=function(a){var b=nc.builtinScripts(),c=a.scripts,d=[];return c&&c.length&&c.forEach(function(a){var c=b[a["class"]];c&&d.push(new c(a))}),d},nc.createBuiltinScripts=function(){return{"qc.TransitionBehaviour":vc,"qc.ScaleAdapter":xc,"qc.ToggleGroup":zc,"qc.NodeMask":Bc,"qc.TableLayout":Pc,"qc.AspectRatioFitter":Rc,"qc.TweenPosition":Xc,"qc.TweenRotation":Zc,"qc.TweenAlpha":Vc,"qc.TweenScale":$c,"qc.TweenColor":Wc,"qc.TweenProperty":Yc,"qc.HorizontalLayout":Nc,"qc.VerticalLayout":Qc,"qc.LayoutElement":Oc,"qc.FilterGroup":Sc,"qc.CacheAsBitmap":oc,"qc.NonexistScript":rc}},nc.builtinScripts=function(){var a=nc._builtinScripts;return a||(a=nc._builtinScripts=nc.createBuiltinScripts()),a},nc.drawPoint=function(a,b){var c=nc.makePropertyName(b);return a[b]||(a[b]=new qc.Point(0,0)),aa.line([aa.text(c,{align:"left"}),aa.text("X",{align:"left"}),aa.numberInput({bind:b+".x"}),aa.text("Y",{align:"left"}),aa.numberInput({bind:b+".y"})])},nc.drawScriptRef=function(a,b){var c,d=b["class"];aa.line([aa.text("Script",{align:"left"}),c=aa.stringInput({readonly:!0})]),c.value=d,c.onValueChanged=function(c){try{a.addScript(c)}catch(d){return console.log(d.stack),void Gb(d.message)}b.destroy(),nc.redraw(a)}},nc.drawAddComponent=function(a,b){if(a instanceof qc.Node){var c=b.getPanelInstance(qc.editor.AddComponentButton,a);c.items=[];var d=nc.builtinScripts();for(var e in d){var f=qc.Util.findClass(e);f&&!f.__hiddenInMenu&&c.addItem(f.__menu?f.__menu:e,null,{icon:"JsIcon",clazz:e})}var g=qc._userScripts;for(var e in g)if(!d[e]){var f=qc.Util.findClass(e);f&&!f.__hiddenInMenu&&c.addItem(f.__menu?f.__menu:"Scripts/"+e,null,{icon:"JsIcon",clazz:e})}c.on(ga.e.SELECT_COMPONENT,function(b){try{ga.inspector.propertyView.emit("addComponent",b.clazz),a.addScript(b.clazz)}catch(c){return console.log(c.stack),void ga.notification.error(ga._("Failed to add component"))}});var h=new qc.widget.Container;return h.layout=new qc.widget.layout.TableLayout(h),h.layout.cellPadding=[5,24,5,24],h.scrollBarMode="off",h.setItems([{height:34,widths:[.1],cells:[{align:"center",element:c}]}]),h.view._dropView=h,h.handleCrossDrag=function(a,b,c){var d=c.view;if(("exit"===b||"cancel"===b)&&(h.ninePatchImage=null),"enter"===b||"over"===b){if(d!==ga.fileList)return;var e=d.draggingData;if(!e.treeData)return;e.name.lastIndexOf(".js")===e.name.length-3&&(h.ninePatchImage="addcomponent_active.9",h.ninePatchBorder=[10,10,10,10])}else if("drop"===b){var f=ga.hierarchy.selectionModel.lastData;if(f&&(f=f.node),"addcomponent_active.9"===h.ninePatchImage&&f){var e=d.draggingData,g=e.treeData.id;qc.editor.Operation.SOURCE(g,function(a){var b=a.source,c=b.match(/qc.defineBehaviour[\(\s]*['"](.*)['"]/);c&&(c=c[1],qc._userScripts[c]&&f&&f.addScript(c)&&(ga.inspector.propertyView.emit("addComponent",c),ga.notification.info(ga._("Script added."))))}),h.ninePatchImage=null}}},h}},nc.drawRectangle=function(a,b){var c,d,e,f,g=aa.titleLine(nc.makePropertyName(b)),h=a[b]||new qc.Rectangle(0,0,0,0);g.add(aa.line([aa.empty(),aa.text("Coord"),aa.text("X",{align:"right"}),c=aa.numberInput(),aa.text("Y",{align:"right"}),d=aa.numberInput()])),g.add(aa.line([aa.empty(),aa.text("Size"),aa.text("W",{align:"right"}),e=aa.numberInput(),aa.text("H",{align:"right"}),f=aa.numberInput()])),c.value=h.x,d.value=h.y,e.value=h.width,f.value=h.height,c.onValueChanged=function(c){c!==h.x&&(h.x=c,a[b]=h)},d.onValueChanged=function(c){c!==h.y&&(h.y=c,a[b]=h)},e.onValueChanged=function(c){c!==h.width&&(h.width=c,a[b]=h)},f.onValueChanged=function(c){c!==h.height&&(h.height=c,a[b]=h)}},nc.drawCircle=function(a,b){var c,d,e,f=a[b]||new qc.Circle(0,0,0),g=aa.titleLine(nc.makePropertyName(b));g.add(aa.line([aa.empty(),aa.text("Coord"),aa.text("X",{align:"right"}),c=aa.numberInput(),aa.text("Y",{align:"right"}),d=aa.numberInput()])),g.add(aa.line([aa.empty(),aa.text("Radius",{colspan:2}),e=aa.numberInput({},{colspan:3})])),c.value=f.x,d.value=f.y,e.value=f.radius,c.onValueChanged=function(c){c!==f.x&&(f.x=c,a[b]=f)},d.onValueChanged=function(c){c!==f.y&&(f.y=c,a[b]=f)},e.onValueChanged=function(c){c!==f.radius&&(f.radius=c,a[b]=f)}},nc.drawEllipse=function(a,b){var c,d,e,f,g=aa.titleLine(nc.makePropertyName(b)),h=a[b]||new qc.Ellipse(0,0,0,0);g.add(aa.line([aa.empty(),aa.text("Coord"),aa.text("X",{align:"right"}),c=aa.numberInput(),aa.text("Y",{align:"right"}),d=aa.numberInput()])),g.add(aa.line([aa.empty(),aa.text("Size"),aa.text("W",{align:"right"}),e=aa.numberInput(),aa.text("H",{align:"right"}),f=aa.numberInput()])),c.value=h.x,d.value=h.y,e.value=h.width,f.value=h.height,c.onValueChanged=function(c){c!==h.x&&(h.x=c,a[b]=h)},d.onValueChanged=function(c){c!==h.y&&(h.y=c,a[b]=h)},e.onValueChanged=function(c){c!==h.width&&(h.width=c,a[b]=h)},f.onValueChanged=function(c){c!==h.height&&(h.height=c,a[b]=h)}},nc.drawArray=function(a,b,c,d){var e,f=b[c]||[],g=aa.titleLine(nc.makePropertyName(c));g.add(aa.line([aa.text("  Length",{align:"right"}),e=aa.intInput()]));var h=f.length;e.value=h,e.input.addEventListener("change",function(){var a=e.value;if(0>a&&(a=0),a!==h){for(var d=[],g=0;a>g;g++)d.push(h>g?f[g]:null);b[c]=d}});for(var i in f)d(i,f[i],g);a._cacheForDetection||(a._cacheForDetection={}),a._cacheForDetection[c]=f.slice(0)},nc.drawGeom=function(a,b,c,d){var e,f=a[c]||new qc.Point(0,0),g=aa.titleLine(b);g.add(aa.line([aa.text("Type",{colspan:2}),e=aa.dropDownList({items:["Point","Rectangle","Circle","Ellipse"]},{colspan:3})]));var h="Point";f instanceof qc.Rectangle?h="Rectangle":f instanceof qc.Circle?h="Circle":f instanceof qc.Ellipse&&(h="Ellipse"),e.value=h,e.onValueChanged=function(b){b!==h&&(h=b,"Point"===b?f=new qc.Point(f.x,f.y):"Rectangle"===b?f=new qc.Rectangle(f.x,f.y,0,0):"Circle"===b?f=new qc.Circle(f.x,f.y,0):"Ellipse"===b&&(f=new qc.Ellipse(f.x,f.y,0)),a[c]=f,d.repaint())};var i,j,k,l;"Point"===h?(g.add(aa.line([aa.empty(),aa.text("X",{align:"right"}),i=aa.numberInput(),aa.text("Y",{align:"right"}),j=aa.numberInput()])),i.value=f.x,j.value=f.y,i.onValueChanged=function(b){b!==f.x&&(f.x=b,a[c]=f)},j.onValueChanged=function(b){b!==f.y&&(f.y=b,a[c]=f)}):"Rectangle"===h||"Ellipse"===h?(g.add(aa.line([aa.text("    Coord"),aa.text("X",{align:"right"}),i=aa.numberInput(),aa.text("Y",{align:"right"}),j=aa.numberInput()])),i.value=f.x,j.value=f.y,i.onValueChanged=function(b){b!==f.x&&(f.x=b,a[c]=f)},j.onValueChanged=function(b){b!==f.y&&(f.y=b,a[c]=f)},g.add(aa.line([aa.text("    Size"),aa.text("W",{align:"right"}),k=aa.numberInput(),aa.text("H",{align:"right"}),l=aa.numberInput()])),k.value=f.width,l.value=f.height,k.onValueChanged=function(b){b!==f.width&&(f.width=b,a[c]=f)},l.onValueChanged=function(b){b!==f.height&&(f.height=b,a[c]=f)}):"Circle"===h&&(g.add(aa.line([aa.text("    Coord"),aa.text("X",{align:"right"}),i=aa.numberInput(),aa.text("Y",{align:"right"}),j=aa.numberInput()])),g.add(aa.line([aa.text("    Radius",{colspan:2}),k=aa.numberInput({},{colspan:3})])),i.value=f.x,j.value=f.y,k.value=f.radius,i.onValueChanged=function(b){b!==f.x&&(f.x=b,a[c]=f)},j.onValueChanged=function(b){b!==f.y&&(f.y=b,a[c]=f)},k.onValueChanged=function(b){b!==f.radius&&(f.radius=b,a[c]=f)})},nc.drawTextures=function(a,b){var c=a.target,d=function(a,d,e){var f;e.add(aa.line([aa.text(""+a,{align:"right"}),f=aa.objectInput({objectType:"texture",target:c,targetField:b,arrIndex:a})])),f.setTextureObjectValue(d,null)};nc.drawArray(a,c,b,d)},nc.drawNodes=function(a,b){var c=a.target,d=function(a,d,e){var f;e.add(aa.line([aa.text(""+a,{align:"right"}),f=aa.objectInput({objectType:"node",target:c,targetField:b,arrIndex:a})])),f.setObjectValue(d)};nc.drawArray(a,c,b,d)};var oc=m("qc.editor.CacheAsBitmapPanel",qc.editor.Panel,function Ge(a){var b=this;Ge["super"].constructor.call(b,a),b.title="CacheAsBitmap",b.checkable=!0,b.removable=!0});oc.prototype.onEnable=function(){this.target.enable=!0},oc.prototype.onDisable=function(){this.target.enable=!1},oc.prototype.onRemove=function(){var a=this;a.removeSelf()},oc.prototype.update=function(){var a=this;a.checked=a.target.enable},oc.prototype.paint=function(){this.target;aa.columnWidths=["90+0.1","60+0.5"],aa.line([aa.text("Cache Type",{align:"left",toolTip:"cacheType"}),aa.dropDownList({bind:"cacheType",items:[{label:"Cache For Screen",value:qc.CacheAsBitmap.CACHE_FOR_SCREEN},{label:"Cache For Self",value:qc.CacheAsBitmap.CAHCE_FOR_SELF}]})]),aa.line([aa.text("Bounds Type",{align:"left",toolTip:"boundsType"}),aa.dropDownList({bind:"boundsType",items:[{label:"Only Self",value:qc.CacheAsBitmap.BOUNDS_SELF},{label:"All Children",value:qc.CacheAsBitmap.BOUNDS_ALL}]})]),aa.line([aa.text("Bounds In Screen"),aa.checkBox({bind:"boundsInScreen"})])};var pc=m("qc.editor.NodePanel",qc.editor.Panel,function He(a){var b=this;He["super"].constructor.call(b,a),b.title=a["class"],b.checkable=!0,b.removable=!1});pc.prototype.onEnable=function(){this.target.visible=!0,ga.hierarchy.iv()},pc.prototype.onDisable=function(){this.target.visible=!1,ga.hierarchy.iv()},pc.prototype.update=function(){var a=this;a.checked=a.target.visible},pc.prototype.paint=function(){var a=this.target;if(aa.columnWidths=["120+0.1","60+0.5"],aa.line([aa.text("Name"),aa.stringInput({bind:"name"})]),a.parent instanceof qc.World&&aa.line([aa.text("Ignore Destroy"),aa.checkBox({bind:"ignoreDestroy"})]),aa.line([aa.text("Alpha"),aa.stringInput({bind:"alpha"})]),a._prefab){var b;aa.line([aa.empty(),b=aa.button(ga._("Apply Prefab"))]),b.on("click",function(){ga.menu.applyPrefab()})}};var rc=m("qc.editor.NonexistScriptPanel",qc.editor.Panel,function Ie(a){var b=this;Ie["super"].constructor.call(b,a),b.title=b.target.script,b.checkable=!1,b.removable=!0});rc.prototype.onRemove=function(){var a=this;a.removeSelf()},rc.prototype.paint=function(){this.target;aa.columnWidths=["90+1"],aa.line([aa.text("The script is not exist.")])};var sc=m("qc.editor.RectTransformPanel",qc.editor.Panel,function Je(a){var b=this;Je["super"].constructor.call(b,a),b.title="Transform",b.icon="inspector_rectTransform",b.checkable=!1,b.removable=!1});sc.prototype.update=function(){var a=this,b=a._anchorButton,d=a.target;b._anchorPresetsPanel||(b.value={minAnchorX:d.minAnchor.x,minAnchorY:d.minAnchor.y,maxAnchorX:d.maxAnchor.x,maxAnchorY:d.maxAnchor.y});var e=document.activeElement;if(a._minAnchorX.view.contains(e)||(a._minAnchorX.value=d.minAnchor.x),a._minAnchorY.view.contains(e)||(a._minAnchorY.value=d.minAnchor.y),a._maxAnchorX.view.contains(e)||(a._maxAnchorX.value=d.maxAnchor.x),a._maxAnchorY.view.contains(e)||(a._maxAnchorY.value=d.maxAnchor.y),a._label1&&(d.minAnchor.x!==d.maxAnchor.x?(a._label1.text="Left",a._input1.bind="left",a._label3.text="Right",a._input3.bind="right"):(a._label1.text="AnchoredX",a._input1.bind="anchoredX",a._label3.text="Width",a._input3.bind="width"),d.minAnchor.y!==d.maxAnchor.y?(a._label2.text="Top",a._input2.bind="top",a._label4.text="Bottom",a._input4.bind="bottom"):(a._label2.text="AnchoredY",a._input2.bind="anchoredY",a._label4.text="Height",a._input4.bind="height")),a._hitAreaCheckBox){a._hitAreaCheckBox.selected=ga.editHitAreaEnabled;var f=a._hitAreaTypeDropDown;if(f)if(d.phaser.hitArea===c)f.value="Fit Target";else{var g=d.hitArea;f.value=g instanceof qc.Rectangle?"Rectangle":g instanceof qc.Ellipse?"Ellipse":"None"}}},sc.prototype.onAnchorPopPanelShown=function(){var a=this,b=a._anchorButton,c=a.target,d=b._undoValue={minAnchorX:c.minAnchor.x,minAnchorY:c.minAnchor.y,maxAnchorX:c.maxAnchor.x,maxAnchorY:c.maxAnchor.y},e=a.createAnchorUndoFunc;b._undo=e(a.setAnchor,c,d)},sc.prototype.createAnchorUndoFunc=function(a,b,c){return function(){a(b,c)}},sc.prototype.onAnchorPopPanelHidden=function(){var a=this,b=a._anchorButton,c=a.target;if(b._undoValue&&b._undo){var d=b._undoValue,e=b._undo,f={minAnchorX:c.minAnchor.x,minAnchorY:c.minAnchor.y,maxAnchorX:c.maxAnchor.x,maxAnchorY:c.maxAnchor.y};if(d.minAnchorX!==f.minAnchorX||d.minAnchorY!==f.minAnchorY||d.maxAnchorX!==f.maxAnchorX||d.maxAnchorY!==f.maxAnchorY){var g=a.createAnchorUndoFunc,h=g(a.setAnchor,c,f);ga.undo.add(e,h)}}delete b._undo,delete b._undoValue},sc.prototype.paint=function(){var a=this,b=this._anchorButton=new qc.editor.AnchorButton,c=[80,20,"40+0.1",20,"40+0.1"];aa.columnWidths=c,a.drawNormalAnchor(b),b.onValueChanged=function(b){ga.inspector._updating||a.setAnchor(a.target,b)},b.onPopPanelHidden=function(){a.onAnchorPopPanelHidden()},b.onPopPanelShown=function(){a.onAnchorPopPanelShown()},aa.columnWidths=[a.indent,80-a.indent,20,"40+0.1",20,"40+0.1"];var d,e,f,g,h=aa.titleLine("Anchors",!0);h.add(aa.line([aa.empty(),aa.text("Min"),aa.text("X",{"for":"rt_minAnchorX",dragStep:.01,align:"center"}),d=a._minAnchorX=aa.numberInput({id:"rt_minAnchorX",precision:5,max:1,min:0}),aa.text("Y",{"for":"rt_minAnchorY",dragStep:.01,align:"center"}),e=a._minAnchorY=aa.numberInput({id:"rt_minAnchorY",precision:5,max:1,min:0})])),h.add(aa.line([aa.empty(),aa.text("Max"),aa.text("X",{"for":"rt_maxAnchorX",dragStep:.01,align:"center"}),f=a._maxAnchorX=aa.numberInput({id:"rt_maxAnchorX",precision:5,max:1,min:0}),aa.text("Y",{"for":"rt_maxAnchorY",dragStep:.01,align:"center"}),g=a._maxAnchorY=aa.numberInput({id:"rt_maxAnchorY",precision:5,max:1,min:0})])),d.onValueChanged=function(b){if(!ga.inspector._updating&&"number"==typeof b&&!isNaN(b)){var c=a.target;a.setTargetProperty(c,"minAnchor.x",b),c._calcAnchoredX(),c._calcAnchoredY(),c._calcMargin()}},e.onValueChanged=function(b){if(!ga.inspector._updating&&"number"==typeof b&&!isNaN(b)){var c=a.target;a.setTargetProperty(c,"minAnchor.y",b),c._calcAnchoredX(),c._calcAnchoredY(),c._calcMargin()}},f.onValueChanged=function(b){if(!ga.inspector._updating&&"number"==typeof b&&!isNaN(b)){var c=a.target;a.setTargetProperty(c,"maxAnchor.x",b),c._calcAnchoredX(),c._calcAnchoredY(),c._calcMargin()}},g.onValueChanged=function(b){if(!ga.inspector._updating&&"number"==typeof b&&!isNaN(b)){var c=a.target;a.setTargetProperty(c,"maxAnchor.y",b),c._calcAnchoredX(),c._calcAnchoredY(),c._calcMargin()}},aa.columnWidths=c,aa.line([aa.text("Pivot"),aa.text("X",{"for":"rt_pivotx",dragStep:.01,align:"center"}),aa.numberInput({bind:"pivotX",id:"rt_pivotx"}),aa.text("Y",{"for":"rt_pivoty",dragStep:.01,align:"center"}),aa.numberInput({bind:"pivotY",id:"rt_pivoty"})]),aa.line([aa.text("Scale"),aa.text("X",{"for":"rt_scaleX",dragStep:.01,align:"center"}),aa.numberInput({bind:"scaleX",id:"rt_scaleX"}),aa.text("Y",{"for":"rt_scaleY",dragStep:.01,align:"center"}),aa.numberInput({bind:"scaleY",id:"rt_scaleY"})]),aa.line([aa.text("Rotation"),aa.text("R",{"for":"rt_rotation",dragStep:1,align:"center"}),aa.angleInput({id:"rt_rotation",bind:"rotation"},{colspan:3})]),this.drawHitArea()},sc.prototype.drawHitArea=function(){var a,b,d=this,e=this.target;aa.columnWidths=[d.indent,80,20,"40+0.1",20,"40+0.1"],aa.line([aa.divider(null,{colspan:6})]);var f=aa.titleLine("Hit Area"),g=e.interactive;f.add(aa.line([aa.empty(),aa.text("Interactive"),d._interactive=aa.checkBox({bind:"interactive"},{colspan:4})])),d._interactive.onValueChanged=function(a){a!==g&&(g=a,d.repaint())},g&&(f.add(aa.line([aa.empty(),aa.text("Editable"),a=d._hitAreaCheckBox=aa.checkBox(null,{colspan:4})])),a.onValueChanged=function(a){ga.editHitAreaEnabled=a},f.add(aa.line([aa.empty(),aa.text("Type"),b=d._hitAreaTypeDropDown=aa.dropDownList({items:["None","Fit Target","Rectangle","Ellipse"]},{colspan:4})])),b.onValueChanged=function(a){if(!ga.inspector._updating){var b=e.hitArea||e.rect,d=[];if(b&&(d=[b.x,b.y,b.width,b.height]),"None"===a)e.hitArea=null;else if("Fit Target"===a)e.hitArea=c;else if("Rectangle"===a){var f=new qc.Rectangle(d[0],d[1],d[2],d[3]);e.hitArea=f}else if("Ellipse"===a){var g=new qc.Ellipse(d[0],d[1],d[2],d[3]);e.hitArea=g}}},f.add(aa.line([aa.empty(),aa.text("Coord"),aa.text("X",{"for":"rt_hitareax"}),aa.numberInput({bind:"hitArea.x",id:"rt_hitareax"}),aa.text("Y",{"for":"rt_hitareay"}),aa.numberInput({bind:"hitArea.y",id:"rt_hitareay"})])),f.add(aa.line([aa.empty(),aa.text("Size"),aa.text("W",{"for":"rt_hitareaw"}),aa.numberInput({bind:"hitArea.width",id:"rt_hitareaw"}),aa.text("H",{"for":"rt_hitareah"}),aa.numberInput({bind:"hitArea.height",id:"rt_hitareah"})])))},sc.prototype.drawNormalAnchor=function(a){var b=this;aa.line([aa.comp(a,null,{rowspan:4,fill:"none",vAlign:"middle",cellPadding:[1,1,1,6]}),b._label1=aa.text("Left",{"for":"rt_left",dragStep:.1},{colspan:2,fill:"none",align:"left"}),b._label2=aa.text("Top",{"for":"rt_top",dragStep:.1},{colspan:2,fill:"none",align:"left"})]),aa.line([b._input1=aa.numberInput({bind:"left",id:"rt_left"},{colspan:2,cellPadding:null}),b._input2=aa.numberInput({bind:"top",id:"rt_top"},{colspan:2})]),aa.line([b._label3=aa.text("Right",{"for":"rt_right",dragStep:.1},{colspan:2,fill:"none",align:"left",cellPadding:null}),b._label4=aa.text("Bottom",{"for":"rt_bottom",dragStep:.1},{colspan:2,fill:"none",align:"left"})]),aa.line([b._input3=aa.numberInput({bind:"right",id:"rt_right"},{colspan:2,cellPadding:null}),b._input4=aa.numberInput({bind:"bottom",id:"rt_bottom"},{colspan:2})])},sc.prototype.setAnchor=function(a,b){if(a.setAnchor(new qc.Point(b.minAnchorX,b.minAnchorY),new qc.Point(b.maxAnchorX,b.maxAnchorY)),b.position){var c,d,e,f,g=b.position,h=a.parent;/left/i.test(g)?c=a.width*a.pivotX:/center/i.test(g)?c=(h.width-a.width)/2+a.width*a.pivotX:/right/i.test(g)?c=h.width-a.width*(1-a.pivotX):/hStretch/i.test(g)&&(e=h.width,c=e*a.pivotX),c-=h.width*h.pivotX,/top/i.test(g)?d=a.height*a.pivotY:/middle/i.test(g)?d=(h.height-a.height)/2+a.height*a.pivotY:/bottom/i.test(g)?d=h.height-a.height*(1-a.pivotY):/vStretch/i.test(g)&&(f=h.height,d=f*a.pivotY),d-=h.height*h.pivotY,null!=c&&(a.x=c),null!=d&&(a.y=d),null!=e&&(a.width=e),null!=f&&(a.height=f)}if(b.pivot){var i,j,k,l,m=b.pivot;/left/i.test(m)?i=0:/center/i.test(m)?i=.5:/right/i.test(m)?i=1:/hStretch/i.test(m)&&(i=.5),/top/i.test(m)?j=0:/middle/i.test(m)?j=.5:/bottom/i.test(m)?j=1:/vStretch/i.test(m)&&(j=.5),null!=i&&(k=a.x+a.width*(i-a.pivotX),a.pivotX=i,a.x=k),null!=j&&(l=a.y+a.height*(j-a.pivotY),a.pivotY=j,a.y=l)}};var tc=m("qc.editor.ImagePanel",qc.editor.Panel,function Ke(a){var b=this;Ke["super"].constructor.call(b,a),b.title="UIImage",b.icon="inspector_image",b.checkable=!1,b.removable=!1});tc.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=[80,"60+0.5"];var c=nc.drawTextureInput(b,"Atlas","texture/frame",function(){a.repaint()}),d=b.texture?b.texture.frameNames:[0];d.indexOf(b.frame)<0&&(b.frame=d[0]);var e;b.frame?aa.line([aa.text("Frame"),e=aa.dropDownList({bind:"frame",items:d})]):b.frame=0,e&&c&&(e.onValueChanged=function(a){var b=c.associatedViewAndData;b&&(b.fileList[1]=a)}),nc.drawColorPicker(b,"ColorTint","colorTint",null,!1),a._drawImageType()},tc.prototype._drawImageType=function(){var a=this,b=this.target;aa.line([aa.text("Image Type"),aa.dropDownList({bind:"imageType",items:[{label:"Simple",value:qc.UIImage.IMAGE_TYPE_SIMPLE},{label:"Sliced",value:qc.UIImage.IMAGE_TYPE_SLICED},{label:"Tiled",value:qc.UIImage.IMAGE_TYPE_TILED}]})]),aa.line([a._setNativeSize=aa.button(ga._("Reset Native Size"),{},{colspan:2})]),a._setNativeSize.on("click",function(){ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:b,field:"size"}),b.resetNativeSize()})};var uc=m("qc.editor.ButtonPanel",qc.editor.Panel,function Le(a){var b=this;Le["super"].constructor.call(b,a),b.title="Button",b.icon="inspector_button",b.checkable=!1,b.removable=!1,this.state=ga.preference.query("collapse.button")===!0?"collapse":""});uc.prototype.paint=function(){var a=this.target;aa.columnWidths=[70,"60+0.5"],nc.drawNodeRef(a,"text",qc.UIText),aa.line([aa.text("State"),aa.dropDownList({bind:"state",items:[{label:"Normal",value:qc.UIState.NORMAL},{label:"Pressed",value:qc.UIState.PRESSED},{label:"Disabled",value:qc.UIState.DISABLED}]})]),aa.columnWidths=[100,"60+0.5"],aa.line([aa.text("Native Click"),aa.checkBox({bind:"supportNativeEvent",selected:a.supportNativeEvent})])};var vc=m("qc.editor.TransitionPanel",qc.editor.Panel,function Me(a){var b=this;Me["super"].constructor.call(b,a),b.title="TransitionBehaviour",b.checkable=!0,b.removable=!0,this.state="collapse"});vc.prototype.onEnable=function(){this.target.enable=!0},vc.prototype.onDisable=function(){this.target.enable=!1},vc.prototype.onRemove=function(){var a=this;a.removeSelf()},vc.prototype.update=function(){var a=this,b=a.target;if(b.transition===qc.Transition.TEXTURE_SWAP){var c=a._texture,d=b.target.texture;if(c!==d)return void a.repaint()}a.checked=a.target.enable},vc.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=[90,"60+0.5"],aa.line([aa.text("Transition"),a._transition=aa.dropDownList({items:[{label:"None",value:qc.Transition.NONE},{label:"Color Tint",value:qc.Transition.COLOR_TINT},{label:"Texture Swap",value:qc.Transition.TEXTURE_SWAP}]})]),a._transition.value=b.transition,a._transition.onValueChanged=function(c){c!==b.transition&&(b.transition=c,a.repaint())},aa.columnWidths=[a.indent,60,"60+0.5"];var c=b.target.texture?b.target.texture.frameNames:[0];a._texture=b.target.texture,b.transition===qc.Transition.TEXTURE_SWAP?(aa.line([aa.divider(null,{colspan:3})]),aa.line([aa.empty(),aa.text("Normal"),aa.dropDownList({bind:"normalTexture",items:c})]),aa.line([aa.empty(),aa.text("Pressed"),aa.dropDownList({bind:"pressedTexture",items:c})]),aa.line([aa.empty(),aa.text("Disabled"),aa.dropDownList({bind:"disabledTexture",items:c})])):b.transition===qc.Transition.COLOR_TINT&&(aa.line([aa.divider(null,{colspan:3})]),nc.drawColorPicker(b,"  Normal","normalColor",!0),nc.drawColorPicker(b,"  Pressed","pressedColor",!0),nc.drawColorPicker(b,"  Disabled","disabledColor",!0))};var wc=m("qc.editor.UserDefinePanel",qc.editor.Panel,function Ne(a){var b=this;Ne["super"].constructor.call(b,a),b.title=a["class"],b.checkable=!0,b.removable=!0});wc.prototype.onEnable=function(){this.target.enable=!0},wc.prototype.onDisable=function(){this.target.enable=!1},wc.prototype.onRemove=function(){var a=this;a.removeSelf()},wc.prototype.update=function(){var a=this;a.checked=a.target.enable},wc.prototype.defaultDraw=function(){var a=this,b=this.target,c=["80+0.1","60+0.5"];aa.columnWidths=c,nc.drawScriptRef(b.gameObject,b);var d=b.getMeta();for(var e in d)if("enable"!==e&&"runInEditor"!==e&&"uuid"!==e){var f=qc.Serializer,g=d[e];switch(g){case f.INT:a.drawCommonField(e,"intInput");break;case f.INTS:a.drawArray(e,function(){return aa.intInput()});break;case f.NUMBER:a.drawCommonField(e,"numberInput");break;case f.NUMBERS:a.drawArray(e,function(){return aa.numberInput()});break;case f.BOOLEAN:a.drawCommonField(e,"checkBox");break;case f.BOOLEANS:a.drawArray(e,function(){return aa.checkBox()});break;case f.STRING:a.drawCommonField(e,"stringInput");break;case f.STRINGS:a.drawArray(e,function(){return aa.stringInput()});break;case f.MAPPING:a.drawMapping(e);break;case f.COLOR:nc.drawColorPicker(b,nc.makePropertyName(e),e);break;case f.COLORS:a.drawColors(e);break;case f.POINT:aa.columnWidths=["60+0.1","15+0.01","30+0.5","15+0.01","30+0.5"],nc.drawPoint(b,e),aa.columnWidths=c;break;case f.POINTS:break;case f.RECTANGLE:aa.columnWidths=[30,"40+0.1","15+0.01","30+0.5","15+0.01","30+0.5"],nc.drawRectangle(b,e),aa.columnWidths=c;break;case f.RECTANGLES:break;case f.CIRCLE:aa.columnWidths=[30,"40+0.1","15+0.01","30+0.5","15+0.01","30+0.5"],nc.drawCircle(b,e),aa.columnWidths=c;break;case f.FONT:aa.line([aa.text(nc.makePropertyName(e)),aa.objectInput({objectType:"allFont",target:b,targetField:e,bind:e})]);break;case f.FONTS:a.drawFonts(e);break;case f.CIRCLES:break;case f.ELLIPSE:aa.columnWidths=[30,"40+0.1","15+0.01","30+0.5","15+0.01","30+0.5"],nc.drawEllipse(b,e),aa.columnWidths=c;break;case f.ELLIPSES:break;case f.GEOM:aa.columnWidths=["40+0.1","15+0.01","30+0.5","15+0.01","30+0.5"],nc.drawGeom(b,nc.makePropertyName(e),e,a),aa.columnWidths=c;break;case f.GEOMS:break;case f.NODE:nc.drawNodeRef(b,e);break;case f.NODES:nc.drawNodes(a,e);break;case f.TEXTURE:nc.drawTextureInput(b,nc.makePropertyName(e),e,null);break;case f.TEXTURES:nc.drawTextures(a,e,nc.makePropertyName(e));break;case f.PREFAB:nc.drawPrefabInput(b,nc.makePropertyName(e),e);break;case f.PREFABS:a.drawPrefabs(e);break;case f.AUDIO:nc.drawSoundInput(b,nc.makePropertyName(e),e);break;case f.AUDIOS:a.drawAudios(e);break;case f.TEXTASSET:nc.drawTextAssetInput(b,nc.makePropertyName(e),e);break;case f.TEXTASSETS:break;case f.EXCELASSET:nc.drawExcelAssetInput(b,nc.makePropertyName(e),e);break;case f.EXCELASSETS:}}},wc.prototype.paint=function(){var a=this.target,b=ga.extend.findInspector(a["class"]);return b?void b.call(this):void this.defaultDraw()},wc.prototype.drawPrefabs=function(a){var b=this,c=b.target,d=function(b,d,e){var f;e.add(aa.line([aa.text(""+b,{align:"right"}),f=aa.objectInput({objectType:"prefab",target:c,targetField:a,arrIndex:b})])),f.setObjectValue(d)};nc.drawArray(b,c,a,d)},wc.prototype.drawFonts=function(a){var b=this,c=b.target,d=function(b,d,e){var f;e.add(aa.line([aa.text(""+b,{align:"right"}),f=aa.objectInput({objectType:"allFont",target:c,targetField:a,arrIndex:b})])),f.setObjectValue(d)};nc.drawArray(b,c,a,d)},wc.prototype.drawAudios=function(a){var b=this,c=b.target,d=function(b,d,e){var f;e.add(aa.line([aa.text(""+b,{align:"right"}),f=aa.objectInput({objectType:"sound",target:c,targetField:a,arrIndex:b})])),f.setObjectValue(d)};nc.drawArray(b,c,a,d)},wc.prototype.drawColors=function(a){var b=this,c=b.target,d=c[a]||[],e=function(c,e,f){var g;f.add(aa.line([aa.text(""+c,{align:"right"}),g=aa.colorPicker()])),e&&(g.value=e.toNumber(!0)),g.onValueChanged=function(e){ga.inspector._updating||(d[c]=e,b.target[a]=d,b._cacheForDetection[a]=d.slice(0))}};nc.drawArray(b,c,a,e)},wc.prototype.drawCommonField=function(a,b){aa.line([aa.text(nc.makePropertyName(a),{align:"left"}),aa[b]({bind:a})])},wc.prototype.drawArrayLength=function(a){var b,c=this,d=c.target,e=d[a]||[],f=aa.titleLine(nc.makePropertyName(a));f.add(aa.line([aa.text("  Length",{align:"right"}),b=aa.intInput()]));var g=e.length;return b.value=g,b.input.addEventListener("change",function(){var d=b.value;if(0>d&&(d=0),d!==g){for(var f=[],h=0;d>h;h++)f.push(g>h?e[h]:null);c.target[a]=f}}),c._cacheForDetection||(c._cacheForDetection={}),c._cacheForDetection[a]=e.slice(0),f},wc.prototype.drawArray=function(a,b){var c=this,d=c.target,e=d[a]||[],f=c.drawArrayLength(a);for(var g in e)c.drawArrayItem(a,g,f,b)},wc.prototype.drawArrayItem=function(a,b,c,d){var e,f=this,g=f.target,h=g[a][b];c.add(aa.line([aa.text(""+b,{align:"right"}),e=d()])),null!==h&&(e instanceof qc.widget.ToggleButton?e.selected=h:e.value=h),e.onValueChanged=function(c){if(!ga.inspector._updating){if(c===h)return;g[a][b]=c,h=c,f._cacheForDetection[a]=g[a].slice(0)}}},wc.prototype.drawMapping=function(a){var c,d=this,e=d.target,f=e[a]||[],g=aa.titleLine(nc.makePropertyName(a));g.add(aa.line([aa.text("  Count",{align:"right"}),c=aa.intInput()]));var h=b.keys(f).length;c.value=h,c.onValueChanged=function(c){if(0>c&&(c=0),c!==h){for(var g=[],i=b.keys(f),j=0;c>j;j++)g.push(h>j?i[j]:ga.game.math.uuid());var k={};for(var j in g)k[g[j]]=f[g[j]]||"";e[a]=k,d.repaint()}};var i=function(a){var b,c;g.add(aa.line([b=aa.stringInput(),c=aa.stringInput()])),b.value=a,c.value=f[a];var d=f[a];b.onValueChanged=function(b){delete f[a],f[b]=d,a=b},c.onValueChanged=function(b){f[a]=b,d=b}};for(var j in f)i(j)};var xc=m("qc.editor.ScaleAdapterPanel",qc.editor.Panel,function Oe(a){var b=this;Oe["super"].constructor.call(b,a),b.title="ScaleAdapter",b.checkable=!0,b.removable=!0});xc.prototype.onEnable=function(){this.target.enable=!0},xc.prototype.onDisable=function(){this.target.enable=!1},xc.prototype.onRemove=function(){var a=this;a.removeSelf()},xc.prototype.update=function(){var a=this;a.checked=a.target.enable},xc.prototype.paint=function(){var a=this,b=(this.target,["90+0.1","60+0.5"]);aa.columnWidths=b,aa.line([aa.text("Manual Type"),aa.dropDownList({bind:"manualType",items:[{label:"None",value:qc.ScaleAdapter.NONE},{label:"Height",value:qc.ScaleAdapter.MANUAL_HEIGHT},{label:"Width",value:qc.ScaleAdapter.MANUAL_WIDTH},{label:"Expand",value:qc.ScaleAdapter.EXPAND},{label:"Shrink",value:qc.ScaleAdapter.SHRINK},{label:"Fill",value:qc.ScaleAdapter.FILL}]})]),aa.columnWidths=[a.indent,20,"30+0.3",20,"30+0.3"];var c=aa.titleLine("Reference Resolution");c.add(aa.line([aa.empty(),aa.text("W",{align:"center"}),aa.intInput({bind:"referenceResolution.x"}),aa.text("H",{align:"center"}),aa.intInput({bind:"referenceResolution.y"})]))};var yc=m("qc.editor.UITextPanel",qc.editor.Panel,function Pe(a){var b=this;Pe["super"].constructor.call(b,a),b.title="UIText",b.icon="inspector_text",b.checkable=!1,b.removable=!1});yc.prototype.paint=function(){var a=this,b=a.target;aa.columnWidths=[70,"60+1"],aa.line([aa.text("Overflow"),aa.checkBox({bind:"overflow"})]),nc.drawColorPicker(b,"Color","color",null,!1),nc.drawColorPicker(b,"ColorTint","colorTint",null,!1),aa.columnWidths=[a.indent,"60+1"];var d=aa.titleLine("Text");d.add(aa.line([aa.empty(),aa.textArea({bind:"text"})],50)),aa.columnWidths=[a.indent,"70+0.1","60+0.5"];var e,d=aa.titleLine("Character",ga.preference.query("collapse.text")===!0),f=["System","Web","Bitmap"];d.add(aa.line([aa.empty(),aa.text("Font Family"),e=aa.dropDownList({items:f})])),e.value=f[b.fontFamily===c?0:b.fontFamily],e.onValueChanged=function(c){var d=f.indexOf(c)||0;a.lastFontEdit||(a.lastFontEdit={}),a.lastFontEdit[b.fontFamily]=b.font,b.fontFamily=d,a.lastFontEdit[d]&&(b.font=a.lastFontEdit[d]),a.repaint()},d.add(b.fontFamily===qc.UIText.SYSTEMFONT?aa.line([aa.empty(),aa.text("Font"),aa.stringInput({bind:"font"})]):aa.line([aa.empty(),aa.text("Font"),aa.objectInput({objectType:b.fontFamily===qc.UIText.BITMAPFONT?"bitmapFont":"font",target:b,targetField:"font",bind:"font"})])),d.add(aa.line([aa.empty(),aa.text("Bold"),aa.checkBox({bind:"bold"})])),d.add(aa.line([aa.empty(),aa.text("Font Size",{align:"left"}),aa.intInput({bind:"fontSize"})])),d.add(aa.line([aa.empty(),aa.text("Line Spacing"),aa.intInput({bind:"lineSpacing"})]));var d=aa.titleLine("Paragraph",ga.preference.query("collapse.text")===!0);d.add(aa.line([aa.empty(),aa.text("AlignH"),aa.buttonGroup([{text:"Left",value:qc.UIText.LEFT},{text:"Center",value:qc.UIText.CENTER},{text:"Right",value:qc.UIText.RIGHT}],{bind:"alignH"})])),d.add(aa.line([aa.empty(),aa.text("AlignV"),aa.buttonGroup([{text:"Top",value:qc.UIText.TOP},{text:"Middle",value:qc.UIText.MIDDLE},{text:"Bottom",value:qc.UIText.BOTTOM}],{bind:"alignV"})])),d.add(aa.line([aa.empty(),aa.text("Wrap"),aa.checkBox({bind:"wrap"})]));var d=aa.titleLine("Stroke",ga.preference.query("collapse.text")===!0);d.add(aa.line([aa.empty(),aa.text("Thickness"),aa.numberInput({bind:"strokeThickness"})])),d.add(nc.drawColorPicker(b,"Color","stroke",!0));var d=aa.titleLine("Shadow",ga.preference.query("collapse.text")===!0);d.add(aa.line([aa.empty(),aa.text("On"),aa.checkBox({bind:"enableShadow"})])),d.add(nc.drawColorPicker(b,"Color","shadowColor",!0)),d.add(aa.line([aa.empty(),aa.text("Blur",{align:"left"}),aa.numberInput({bind:"shadowBlur"})])),d.add(aa.line([aa.empty(),aa.text("OffsetX",{align:"left"}),aa.intInput({bind:"shadowOffsetX"})])),d.add(aa.line([aa.empty(),aa.text("OffsetY",{align:"left"}),aa.intInput({bind:"shadowOffsetY"})]));var d=aa.titleLine("Gradient",ga.preference.query("collapse.text")===!0);d.add(aa.line([aa.empty(),aa.text("On"),aa.checkBox({bind:"gradient"})])),d.add(nc.drawColorPicker(b,"Start","startColor",!0)),
d.add(nc.drawColorPicker(b,"End","endColor",!0));var d=aa.titleLine("Glow",ga.preference.query("collapse.text")===!0);d.add(aa.line([aa.empty(),aa.text("On"),aa.checkBox({bind:"enableGlow"})])),d.add(nc.drawColorPicker(b,"Color","glowColor",!0)),d.add(aa.line([aa.empty(),aa.text("Blur",{align:"left"}),aa.numberInput({bind:"glowBlur"})]))};var zc=m("qc.editor.ToggleGroupPanel",qc.editor.Panel,function Qe(a){var b=this;Qe["super"].constructor.call(b,a),b.title="ToggleGroup",b.checkable=!0,b.removable=!0});zc.prototype.onEnable=function(){this.target.enable=!0},zc.prototype.onDisable=function(){this.target.enable=!1},zc.prototype.onRemove=function(){var a=this;a.removeSelf()},zc.prototype.update=function(){var a=this;a.checked=a.target.enable},zc.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=["70+0.1","60+0.5"],nc.drawNodeRef(b,"toggle"),nc.drawNodes(a,"toggles")};var Ac=m("qc.editor.TogglePanel",qc.editor.Panel,function Re(a){var b=this;Re["super"].constructor.call(b,a),b.title="Toggle",b.icon="inspector_toggle",b.checkable=!1,b.removable=!1});Ac.prototype.paint=function(){var a=this.target;aa.columnWidths=[80,"60+0.5"],nc.drawNodeRef(a,"background"),nc.drawNodeRef(a,"checkMark"),nc.drawNodeRef(a,"text",qc.UIText),aa.line([aa.text("On"),aa.checkBox({bind:"on"})]),aa.line([aa.text("State"),aa.dropDownList({bind:"state",items:[{label:"Normal",value:qc.UIState.NORMAL},{label:"Pressed",value:qc.UIState.PRESSED},{label:"Disabled",value:qc.UIState.DISABLED}]})])};var Bc=m("qc.editor.MaskPanel",qc.editor.Panel,function Se(a){var b=this;Se["super"].constructor.call(b,a),b.title="NodeMask",b.checkable=!0,b.removable=!0,this.state="collapse"});Bc.prototype.onEnable=function(){this.target.enable=!0},Bc.prototype.onDisable=function(){this.target.enable=!1},Bc.prototype.onRemove=function(){var a=this;a.removeSelf()},Bc.prototype.update=function(){var a=this;a.checked=a.target.enable},Bc.prototype.paint=function(){this.target;aa.columnWidths=["90+0.1","60+0.5"],aa.line([aa.text("Check In Field",{align:"left",toolTip:"checkInField"}),aa.checkBox({bind:"checkInField"})]),aa.line([aa.text("Clip Mode",{toolTip:"mode"}),aa.dropDownList({bind:"mode",items:[{label:"Rectangle",value:qc.NodeMask.MODE_DEFAULT},{label:"Pixel",value:qc.NodeMask.MODE_PIXEL}]})])};var Cc=m("qc.editor.ScrollBarPanel",qc.editor.Panel,function Te(a){var b=this;Te["super"].constructor.call(b,a),b.title="ScrollBar",b.icon="inspector_scrollbar",b.checkable=!1,b.removable=!1});Cc.prototype.update=function(){},Cc.prototype.paint=function(){var a=this,b=a.target;delete a._isFixedValue,aa.columnWidths=["70+0.1","60+0.5"],aa.line([aa.text("Direction"),aa.dropDownList({bind:"direction",items:[{label:"Left to Right",value:qc.ScrollBar.LEFT_TO_RIGHT},{label:"Right to Left",value:qc.ScrollBar.RIGHT_TO_LEFT},{label:"Top to Bottom",value:qc.ScrollBar.TOP_TO_BOTTOM},{label:"Bottom to Top",value:qc.ScrollBar.BOTTOM_TO_TOP}]})]),aa.line([aa.text("Value"),aa.numberInput({bind:"value"})]),nc.drawNodeRef(b,"sliders",qc.UIImage),aa.line([aa.text("Size"),aa.numberInput({bind:"size"})]),aa.line([aa.text("Fix Sliders Size"),aa.checkBox({bind:"fixSlidersSize"})]),aa.line([aa.text("Number Of Step"),aa.numberInput({bind:"numberOfStep"})])};var Dc=m("qc.editor.ScrollViewPanel",qc.editor.Panel,function Ue(a){var b=this;Ue["super"].constructor.call(b,a),b.title="ScrollView",b.icon="inspector_scrollview",b.checkable=!1,b.removable=!1});Dc.prototype.update=function(){},Dc.prototype.paint=function(){var a=this,b=this.target,d=["90+0.1","60+0.5"];aa.columnWidths=d,nc.drawNodeRef(b,"content"),aa.columnWidths=[a.indent,"70+0.1","60+0.5"];var e=aa.titleLine("Horizontal Scroll",ga.preference.query("collapse.scrollView")===!0);e.add(aa.line([aa.empty(),aa.text("Horizontal",{toolTip:"canHorizontal"}),aa.checkBox({bind:"canHorizontal"})])),e.add(nc.drawNodeRef(b,"horizontalScrollBar",c,!0,"ScrollBarH")),e.add(aa.line([aa.empty(),aa.text("Value",{toolTip:"horizontalNormalizedPosition"}),aa.numberInput({bind:"horizontalNormalizedPosition"})]));var e=aa.titleLine("Vertical Scroll",ga.preference.query("collapse.scrollView")===!0);e.add(aa.line([aa.empty(),aa.text("Vertical",{toolTip:"canVertical"}),aa.checkBox({bind:"canVertical"})])),e.add(nc.drawNodeRef(b,"verticalScrollBar",c,!0,"ScrollBarV")),e.add(aa.line([aa.empty(),aa.text("Value",{toolTip:"verticalNormalizedPosition"}),aa.numberInput({bind:"verticalNormalizedPosition"})])),aa.columnWidths=d,aa.line([aa.text("Movement Type",{toolTip:"movementType"}),a._moveType=aa.dropDownList({bind:"movementType",items:[{label:"Unrestricted",value:qc.ScrollView.MOVEMENT_UNRESTRICTED},{label:"Elastic",value:qc.ScrollView.MOVEMENT_ELASTIC},{label:"Clamped",value:qc.ScrollView.MOVEMENT_CLAMPED}]})]);var f=b.movementType;a._moveType.onValueChanged=function(b){b!==f&&a.repaint()},b.movementType===qc.ScrollView.MOVEMENT_ELASTIC&&aa.line([aa.text("Elasticity",{align:"left"}),aa.numberInput({bind:"elasticity"})]),aa.line([aa.text("Inertia",{align:"left"}),aa.checkBox({bind:"inertia"})]),aa.line([aa.text("Deceleration Rate",{toolTip:"decelerationRate"}),aa.numberInput({bind:"decelerationRate"})]),aa.line([aa.text("Scroll Sensitivity",{toolTip:"scrollSensitivity"}),aa.numberInput({bind:"scrollSensitivity"})]),aa.line([aa.text("Propagation Scroll",{toolTip:"propagationScroll"}),aa.checkBox({bind:"propagationScroll"})])};var Ec=m("qc.editor.SoundPanel",qc.editor.Panel,function Ve(a){var b=this;Ve["super"].constructor.call(b,a),b.title="Sound",b.icon="inspector_sound",b.checkable=!1,b.removable=!1});Ec.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=["95+0.1","60+0.5"],nc.drawSoundInput(b,"Audio","audio"),aa.line([aa.text("Loop"),aa.checkBox({bind:"loop"})]),aa.line([aa.text("Mute"),aa.checkBox({bind:"mute"})]),aa.line([aa.text("Volume"),aa.numberInput({bind:"volume"})]),aa.line([aa.text("Play On Awake"),aa.checkBox({bind:"playOnAwake"})]),aa.line([aa.text("Destroy When Stop"),aa.checkBox({bind:"destroyWhenStop"})]),aa.line([a.playBtn=aa.button(ga._("Play"),{},{colspan:2})]),a.playBtn.on("click",function(){b.play()}),aa.line([a.stopBtn=aa.button(ga._("Stop"),{},{colspan:2})]),a.stopBtn.on("click",function(){b.stop()})};var Fc=m("qc.editor.ProgressBarPanel",qc.editor.Panel,function We(a){var b=this;We["super"].constructor.call(b,a),b.title="ProgressBar",b.checkable=!1,b.removable=!1});Fc.prototype.update=function(){var a=this;if(a._isFixedValue){var b=a.target.fixedSize>=0;a._isFixedValue._autoUpdate=!0,a._isFixedValue.selected=b,delete a._isFixedValue._autoUpdate}},Fc.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=["70+0.1","60+0.5"],nc.drawNodeRef(b,"sliders",qc.UIImage);var c;aa.line([aa.text("Style"),c=aa.dropDownList({bind:"style",items:[{label:"Horizontal",value:qc.ProgressBar.STYLE_HORIZONTAL},{label:"Vertical",value:qc.ProgressBar.STYLE_VERTICAL},{label:"Circle",value:qc.ProgressBar.STYLE_CIRCLE}]})]),c.onValueChanged=function(c){c!==b.style&&a.repaint()};var d;aa.line([aa.text("Indeterminable"),d=aa.checkBox({selected:b.indeterminable,bind:"indeterminable"})]),d.onValueChanged=function(){a.repaint()};var e,f,g;aa.line([aa.text("Min Value"),e=aa.numberInput({bind:"minValue",max:b.maxValue-1})]),aa.line([aa.text("Max Value"),f=aa.numberInput({bind:"maxValue",min:b.minValue+1})]),aa.line([aa.text("Value"),g=aa.numberInput({bind:"value",min:b.minValue,max:b.maxValue})]),e.addEventListener("change",function(){f.min=e.finalValue+1,g.min=e.finalValue}),f.addEventListener("change",function(){e.max=f.finalValue-1,g.max=f.finalValue});var h=null;b.fixedSize<0?(aa.columnWidths=["70+0.1","60+0.5"],aa.line([aa.text("Fixed Size"),h=a._isFixedValue=aa.checkBox()])):(aa.columnWidths=["70+0.1","30+0.0","60+0.5"],aa.line([aa.text("Fixed Size"),h=a._isFixedValue=aa.checkBox(),aa.sliderInput({bind:"fixedSize",step:0,min:0,max:1})])),h.selected=b.fixedSize>=0,h.onValueChanged=function(c){h._autoUpdate||(b.fixedSize=c?.5:-1),a.repaint()},aa.columnWidths=["70+0.1","60+0.5"],b.indeterminable&&aa.line([aa.text("Loop Time"),aa.intInput({bind:"loopTime"})]),aa.line([aa.text("Clip Sliders"),aa.checkBox({bind:"clipSliders"})]),aa.line([aa.text("Show Mode"),aa.dropDownList({bind:"showMode",items:[{label:"Processed",value:qc.ProgressBar.SHOW_PROCESSED},{label:"Remained",value:qc.ProgressBar.SHOW_REMAINED}]})]),aa.line([aa.text("Reverse"),aa.checkBox({bind:"reverse"})]),b.style===qc.ProgressBar.STYLE_CIRCLE&&(aa.line([aa.text("Start Radian"),aa.numberInput({bind:"startRadian"})]),aa.line([aa.text("End Radian"),aa.numberInput({bind:"endRadian"})]),aa.line([aa.text("Start Angle"),aa.numberInput({bind:"startAngle"})]),aa.line([aa.text("End Angle"),aa.numberInput({bind:"endAngle"})]))};var Gc=m("qc.editor.SliderPanel",qc.editor.Panel,function Xe(a){var b=this;Xe["super"].constructor.call(b,a),b.title="Slider",b.icon="inspector_slider",b.checkable=!1,b.removable=!1});Gc.prototype.update=function(){var a=this;if(a._isFixedValue){var b=a.target.fixedSize>=0;a._isFixedValue._autoUpdate=!0,a._isFixedValue.selected=b,delete a._isFixedValue._autoUpdate}},Gc.prototype.paint=function(){var a=this,b=a.target;delete a._isFixedValue,aa.columnWidths=["70+0.1","60+0.5"],nc.drawNodeRef(b,"sliders",qc.UIImage);var c;aa.line([aa.text("Style"),c=aa.dropDownList({bind:"style",items:[{label:"Horizontal",value:qc.Slider.STYLE_HORIZONTAL},{label:"Vertical",value:qc.Slider.STYLE_VERTICAL},{label:"Circle",value:qc.Slider.STYLE_CIRCLE}]})]),c.onValueChanged=function(c){c!==b.style&&a.repaint()};var d,e,f;aa.line([aa.text("Min Value"),d=aa.intInput({bind:"minValue",max:b.maxValue-1})]),aa.line([aa.text("Max Value"),e=aa.intInput({bind:"maxValue",min:b.minValue+1})]),aa.line([aa.text("Value"),f=aa.numberInput({bind:"value",min:b.minValue,max:b.maxValue})]),d.addEventListener("change",function(){e.min=d.finalValue+1,f.min=d.finalValue}),e.addEventListener("change",function(){d.max=e.finalValue-1,f.max=e.finalValue});var g=null;b.fixedSize<0?(aa.columnWidths=["70+0.1","60+0.5"],aa.line([aa.text("Fixed Size"),g=a._isFixedValue=aa.checkBox()])):(aa.columnWidths=["70+0.1","30+0.0","30+0.5"],aa.line([aa.text("Fixed Size"),g=a._isFixedValue=aa.checkBox(),aa.sliderInput({bind:"fixedSize",step:0,min:0,max:1})])),aa.columnWidths=["70+0.1","60+0.5"],g.selected=b.fixedSize>=0,g.onValueChanged=function(c){g._autoUpdate||(b.fixedSize=c?.5:-1),a.repaint()},aa.line([aa.text("Can Pursue"),aa.checkBox({bind:"canPursue"})]),aa.line([aa.text("Clip Sliders"),aa.checkBox({bind:"clipSliders"})]),b.style===qc.ProgressBar.STYLE_CIRCLE&&(aa.line([aa.text("Start Radian"),aa.numberInput({bind:"startRadian"})]),aa.line([aa.text("End Radian"),aa.numberInput({bind:"endRadian"})]),aa.line([aa.text("Start Angle"),aa.numberInput({bind:"startAngle"})]),aa.line([aa.text("End Angle"),aa.numberInput({bind:"endAngle"})])),aa.line([aa.text("State"),aa.dropDownList({bind:"state",items:[{label:"Normal",value:qc.UIState.NORMAL},{label:"Pressed",value:qc.UIState.PRESSED},{label:"Disabled",value:qc.UIState.DISABLED}]})])};var Hc=m("qc.editor.SpritePanel",qc.editor.Panel,function Ye(a){var b=this;Ye["super"].constructor.call(b,a),b.title="Sprite",b.icon="inspector_sprite",b.checkable=!1,b.removable=!1});Hc.prototype.paint=function(){var a=this,b=a.target;delete a._defaultAnimationDropDown,aa.columnWidths=["60+0.3","60+0.5"];var d=b.animationType===qc.Sprite.DRAGON_BONES||b.animationType===qc.Sprite.FRAME_SAMPLES,e=nc.drawTextureInput(b,"Texture",d?"texture":"texture/frame",function(){delete a._dragonbones,a.repaint()});if(!d){var f=b.texture?b.texture.frameNames:[0];f.indexOf(b.frame)<0&&(b.frame=f[0]);var g;b.frame?aa.line([aa.text("Frame"),g=aa.dropDownList({bind:"frame",items:f})]):b.frame=0,g&&e&&(g.onValueChanged=function(a){var b=e.associatedViewAndData;b&&(b.fileList[1]=a)})}if(nc.drawColorPicker(b,"ColorTint","colorTint",null,!1),b.animationType===qc.Sprite.NONE_ANIMATION||b.animationType===qc.Sprite.FRAME_ANIMATION?(aa.line([a._setNativeSize=aa.button(ga._("Reset Native Size"),{},{colspan:2})]),a._setNativeSize.on("click",function(){ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:b,field:"size"}),b.resetNativeSize()})):a._dragonbones===!1||a._dragonbones===c&&b.animationType===qc.Sprite.FRAME_SAMPLES?(aa.line([aa.empty(),a._revertBtn=aa.button(ga._("Revert"))]),a._revertBtn.on("click",function(){a._revertBtn.enabled=!1,qc.editor.Operation.REVERT_TO_DRAGONBONES(b.texture.url,function(b){b&&(a._dragonbones=!0,a.repaint())})})):(aa.line([aa.empty(),a._sampleBtn=aa.button(ga._("Sampled"))]),a._sampleBtn.on("click",function(){qc.editor.Operation.SAMPLE_DRAGON_BONES(b,function(b){b&&(a._sampleBtn.enabled=!1)},function(){a._dragonbones=!1,a.repaint()})})),b.animationNameList){var h,i=["none"].concat(b.animationNameList);aa.line([aa.text("Default Animation",{toolTip:"defaultAnimation"}),h=a._defaultAnimationDropDown=aa.dropDownList({items:i})]),h.value=i.indexOf(b.defaultAnimation)>=0?b.defaultAnimation:"none",h.onValueChanged=function(){ga.inspector._updating||(b.defaultAnimation="none"===h.value?null:h.value)}}aa.columnWidths=[a.indent,"60+0.5",40,80];var j;if(b.animationType===qc.Sprite.FRAME_ANIMATION?j=aa.titleLine(ga._("Frame Animation"),ga.preference.query("collapse.sprite")===!0):b.animationType===qc.Sprite.DRAGON_BONES?j=aa.titleLine(ga._("DragonBone"),ga.preference.query("collapse.sprite")===!0):b.animationType===qc.Sprite.FRAME_SAMPLES&&(j=aa.titleLine(ga._("DragonBone(Sampled)"),ga.preference.query("collapse.sprite")===!0)),j){var i=b.animationNameList.sort();j.add(aa.line([aa.empty(),aa.text(ga._("Name"),{align:"center"}),aa.text(ga._("Loop"),{align:"center"}),aa.text(ga._("Operation"),{align:"center"})])),j.add(aa.line([aa.divider(null,{colspan:4})]));for(var k in i)a._drawAnimationInfo(i[k],j);j.add(aa.line([aa.divider(null,{colspan:4})]))}},Hc.prototype.update=function(){var a=this,b=a.target;if(a._defaultAnimationDropDown){var c=b.defaultAnimation,d=["none"].concat(b.animationNameList);a._defaultAnimationDropDown.value=d.indexOf(c)>=0?c:"none"}},Hc.prototype._drawAnimationInfo=function(a,b){var c,d=this,e=d.target.getAnimationInfo(a).loop;b.add(aa.line([aa.empty(),aa.text(a,{align:"left"}),aa.text(0===e?"Y":"N",{align:"center"}),c=aa.button(ga._("Play"))])),c.on("click",function(){d.target.playAnimation(a)})};var Ic=m("qc.editor.InputFieldPanel",qc.editor.Panel,function Ze(a){var b=this;Ze["super"].constructor.call(b,a),b.title="InputField",b.icon="inspector_inputfield",b.checkable=!1,b.removable=!1});Ic.prototype.paint=function(){var a=this.target;aa.columnWidths=["80+0.1","60+0.5"],aa.line([aa.text("Text"),aa.stringInput({bind:"text"})]),aa.line([aa.text("Placeholder Text"),aa.stringInput({bind:"placeholderText"})]),aa.line([aa.text("State"),aa.dropDownList({bind:"state",items:[{label:"Normal",value:qc.UIState.NORMAL},{label:"Pressed",value:qc.UIState.PRESSED},{label:"Disabled",value:qc.UIState.DISABLED}]})]),aa.line([aa.text("Character Limit"),aa.intInput({bind:"characterLimit"})]),aa.line([aa.text("Line Type"),aa.dropDownList({bind:"lineType",items:[{label:"Single",value:qc.InputField.SINGLE_LINE},{label:"Multi",value:qc.InputField.MULTI_LINE}]})]),aa.line([aa.text("Content Type"),aa.dropDownList({bind:"contentType",items:[{label:"Standard",value:qc.InputField.STANDARD},{label:"Int",value:qc.InputField.INT},{label:"Number",value:qc.InputField.NUMBER},{label:"Tel",value:qc.InputField.TEL},{label:"Email",value:qc.InputField.EMAIL},{label:"Password",value:qc.InputField.PASSWORD}]})]),nc.drawNodeRef(a,"textComponent",qc.UIText),nc.drawNodeRef(a,"placeholder",qc.UIText)};var Jc=m("qc.editor.EmitterPanel",qc.editor.Panel,function $e(a){var b=this;$e["super"].constructor.call(b,a),b.title="Emitter",b.icon="inspector_particle",b.checkable=!1,b.removable=!1});Jc.prototype.paint=function(){var a=this,b=this.target,d=["100+0.1","70+1"];aa.columnWidths=d,nc.drawTextureInput(b,"Texture","texture",function(){a.repaint()});var e=b.texture;e&&e.frameNames.length>1?a.drawArray("frames",function(){return aa.dropDownList({items:e.frameNames})}):e&&1===e.frameNames.length&&(b.frames=[0]),aa.columnWidths=["100+0.1","30+0.5",10,"30+0.5"],aa.line([aa.text("Max Particles"),aa.intInput({bind:"maxParticles"},{colspan:3})]),aa.columnWidths=[40,20,"30+0.5",10,"30+0.5"];var f=aa.titleLine("Speed",!0);f.add(aa.line([aa.empty(),aa.text("X"),aa.numberInput({bind:"minParticleSpeed.x"}),aa.text("-",{align:"center"}),aa.numberInput({bind:"maxParticleSpeed.x"})])),f.add(aa.line([aa.empty(),aa.text("Y"),aa.numberInput({bind:"minParticleSpeed.y"}),aa.text("-",{align:"center"}),aa.numberInput({bind:"maxParticleSpeed.y"})])),aa.columnWidths=["100+0.1","30+0.5",10,"30+0.5"],aa.line([aa.text("Rotation"),aa.numberInput({bind:"minRotation"}),aa.text("-"),aa.numberInput({bind:"maxRotation"})]),aa.columnWidths=[40,"60+0.1",20,"30+0.5",20,"30+0.5"];var f=aa.titleLine("Scale",!0);f.add(aa.line([aa.empty(),aa.text("From"),aa.text("X"),aa.numberInput({bind:"scaleFrom.x"}),aa.text("Y"),aa.numberInput({bind:"scaleFrom.y"})])),f.add(aa.line([aa.empty(),aa.text("To"),aa.text("X"),aa.numberInput({bind:"scaleTo.x"}),aa.text("Y"),aa.numberInput({bind:"scaleTo.y"})])),f.add(aa.line([aa.empty(),aa.text("Duration"),aa.numberInput({bind:"scaleDuration"},{colspan:4})])),f.add(aa.line([aa.empty(),aa.text("Ease"),aa.dropDownList({bind:"scaleEase",items:a.easing()},{colspan:4})])),f.add(aa.line([aa.empty(),aa.text("Yoyo"),aa.checkBox({bind:"scaleYoyo"},{colspan:4})])),aa.columnWidths=[40,"60+0.1","60+1"];var f=aa.titleLine("Alpha",!0);f.add(aa.line([aa.empty(),aa.text("From"),aa.numberInput({bind:"alphaFrom"})])),f.add(aa.line([aa.empty(),aa.text("To"),aa.numberInput({bind:"alphaTo"})])),f.add(aa.line([aa.empty(),aa.text("Duration"),aa.numberInput({bind:"alphaDuration"})])),f.add(aa.line([aa.empty(),aa.text("Ease"),aa.dropDownList({bind:"alphaEase",items:a.easing()})])),f.add(aa.line([aa.empty(),aa.text("Yoyo"),aa.checkBox({bind:"alphaYoyo"})])),aa.columnWidths=["100+0.1","30+0.5",10,"30+0.5"],aa.line([aa.text("Gravity"),aa.numberInput({bind:"gravity"},{colspan:3})]),aa.columnWidths=["100+0.1",20,"30+0.5",20,"30+0.5"],nc.drawPoint(b,"particleDrag"),nc.drawPoint(b,"bounce"),aa.columnWidths=["110+0.1","30+0.5",10,"30+0.5"],aa.line([aa.text("Angular Drag"),aa.numberInput({bind:"angularDrag"},{colspan:3})]),aa.line([aa.text("Frequency"),aa.numberInput({bind:"frequency"},{colspan:3})]),aa.line([aa.text("Lifespan"),aa.numberInput({bind:"lifespan"},{colspan:3})]),aa.line([aa.text("On"),aa.checkBox({bind:"on"},{colspan:3})]),aa.line([aa.text("Collide"),aa.checkBox({bind:"collide"},{colspan:3})]),aa.line([aa.text("Collide World Bounds"),aa.checkBox({bind:"collideWorldBounds"},{colspan:3})]),aa.line([aa.text("BringToTop"),aa.checkBox({bind:"particleBringToTop"},{colspan:3})]),aa.line([aa.text("SendToBack"),aa.checkBox({bind:"particleSendToBack"},{colspan:3})]),aa.columnWidths=[60,"40+0.4","60+0.1"];var g;b._explodeCount===c&&(b._explodeCount=10),aa.line([aa.text("Count"),aa.intInput({bind:"_explodeCount"}),g=aa.button(ga._("Explode"))]),g.on("click",function(){b.explode(b.lifespan,b._explodeCount)});var h;aa.columnWidths=["100+0.1"],aa.line([h=aa.button(ga._("Rebuild"))]),h.on("click",function(){b.rebuild()})},Jc.prototype.drawArrayLength=function(a){var b,c=this,d=c.target,e=d[a]||[],f=aa.titleLine(nc.makePropertyName(a));f.add(aa.line([aa.text("  length",{align:"right"}),b=aa.intInput()]));var g=e.length;return b.value=g,b.input.addEventListener("change",function(){var d=b.value;if(0>d&&(d=0),d!==g){for(var f=[],h=0;d>h;h++)f.push(g>h?e[h]:null);c.target[a]=f}}),c._cacheForDetection||(c._cacheForDetection={}),c._cacheForDetection[a]=e.slice(0),f},Jc.prototype.drawArray=function(a,b){var c=this,d=c.target,e=d[a]||[],f=c.drawArrayLength(a);for(var g in e)c.drawArrayItem(a,g,f,b)},Jc.prototype.drawArrayItem=function(a,b,d,e){var f,g=this,h=g.target,i=h[a][b];d.add(aa.line([aa.text(""+b,{align:"right"}),f=e()])),null!==i&&i!==c&&(f.value=i),f.onValueChanged=function(c){if(!ga.inspector._updating){if(c===i)return;h[a][b]=c,i=c,g._cacheForDetection[a]=h[a].slice(0)}}},Jc.prototype.easing=function(){return["Linear","Quadratic In","Quadratic Out","Quadratic InOut","Cubic In","Cubic Out","Cubic InOut","Quartic In","Quartic Out","Quartic InOut","Quintic In","Quintic Out","Quintic InOut","Sinusoidal In","Sinusoidal Out","Sinusoidal InOut","Exponential In","Exponential Out","Exponential InOut","Circular In","Circular Out","Circular InOut","Elastic In","Elastic Out","Elastic InOut","Back In","Back Out","Back InOut","Bounce In","Bounce Out","Bounce InOut"]};var Kc=m("qc.editor.ObjectLayerPanel",qc.editor.Panel,function _e(a){var b=this;_e["super"].constructor.call(b,a),b.title="ObjectLayer",b.icon="inspector_button",b.checkable=!1,b.removable=!1});Kc.prototype.paint=function(){var a=this.target;aa.columnWidths=["80+0.1","60+0.5"],nc.drawNodeRef(a,"tilemap"),aa.line([aa.text("Layer Index"),aa.intInput({bind:"layerIndex"})]),aa.line([aa.text("ScrollX Ratio"),aa.numberInput({bind:"scrollXRatio"})]),aa.line([aa.text("ScrollX Ratio"),aa.numberInput({bind:"scrollYRatio"})])};var Lc=m("qc.editor.TileLayerPanel",qc.editor.Panel,function af(a){var b=this;af["super"].constructor.call(b,a),b.title="TileLayer",b.icon="inspector_title_tilelayer",b.checkable=!1,b.removable=!1});Lc.prototype.paint=function(){var a=this.target;aa.columnWidths=["80+0.1","60+0.5"],nc.drawNodeRef(a,"tilemap"),aa.line([aa.text("Layer Index"),aa.intInput({bind:"layerIndex"})]),aa.line([aa.text("ScrollX Ratio"),aa.numberInput({bind:"scrollXRatio"})]),aa.line([aa.text("ScrollX Ratio"),aa.numberInput({bind:"scrollYRatio"})])};var Mc=m("qc.editor.TilemapPanel",qc.editor.Panel,function bf(a){var b=this;bf["super"].constructor.call(b,a),b.title="Tilemap",b.icon="inspector_title_tilemap",b.checkable=!1,b.removable=!1});Mc.prototype.paint=function(){var a,b,c=this,d=c.target;aa.columnWidths=["60+0.1","60+0.5"],nc.drawTextAssetInput(d,"Data","data"),aa.line([aa.text("ScrollX",{"for":"scrollX"}),aa.numberInput({bind:"scrollX",id:"scrollX"})]),aa.line([aa.text("ScrollY",{"for":"scrollY"}),aa.numberInput({bind:"scrollY",id:"scrollY"})]),aa.line([a=aa.button(ga._("Generate Layers"),{},{colspan:2})]),a.on("click",function(){d.generateLayers(function(){c.repaint()})}),aa.line([b=aa.button(ga._("Reset Native Size"),{},{colspan:2})]),b.on("click",function(){ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:d,field:"size"}),d.resetNativeSize()}),nc.drawNodes(this,"layers"),nc.drawTextures(this,"tilesets")};var Nc=m("qc.editor.HorizontalLayoutPanel",qc.editor.Panel,function cf(a){var b=this;cf["super"].constructor.call(b,a),b.title="HorizontalLayout",b.checkable=!0,b.removable=!0});Nc.prototype.onEnable=function(){this.target.enable=!0},Nc.prototype.onDisable=function(){this.target.enable=!1},Nc.prototype.onRemove=function(){var a=this;a.removeSelf()},Nc.prototype.update=function(){var a=this;a.checked=a.target.enable},Nc.prototype.paint=function(){var a=this;a.checked=a.target.enable},Nc.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=[a.indent,120-a.indent,"60+0.5"];var c=aa.titleLine("Padding");c.add(aa.line([aa.empty(),aa.text("Left",{"for":"horLayout_paddingLeft",dragStep:1}),aa.numberInput({bind:"paddingLeft",id:"horLayout_paddingLeft"})])),c.add(aa.line([aa.empty(),aa.text("Right",{"for":"horLayout_paddingRight",dragStep:1}),aa.numberInput({bind:"paddingRight",id:"horLayout_paddingRight"})])),c.add(aa.line([aa.empty(),aa.text("Top",{"for":"horLayout_paddingTop",dragStep:1}),aa.numberInput({bind:"paddingTop",id:"horLayout_paddingTop"})])),c.add(aa.line([aa.empty(),aa.text("Bottom",{"for":"horLayout_paddingBottom",dragStep:1}),aa.numberInput({bind:"paddingBottom",id:"horLayout_paddingBottom"})])),aa.columnWidths=[120,"60+0.5"],aa.line([aa.text("Spacing",{"for":"horLayout_spacing",dragStep:.01}),aa.numberInput({bind:"spacing",id:"horLayout_spacing"})]),aa.line([aa.text("Size Provider"),aa.dropDownList({bind:"contentSizeProvider",items:[{label:"Real Bounds",value:qc.TableLayout.USE_BOUNDS},{label:"RectTransform",value:qc.TableLayout.USE_RECTTRANSFORM}]})]),aa.line([aa.text("Content Alignment"),aa.dropDownList({bind:"contentAlignment",items:[{label:"Left",value:qc.TableLayout.ALIGN_TOP_LEFT},{label:"Center",value:qc.TableLayout.ALIGN_TOP_CENTER},{label:"Right",value:qc.TableLayout.ALIGN_TOP_RIGHT}]})]),aa.line([aa.text("Cell Alignment"),aa.dropDownList({bind:"cellAlignment",items:[{label:"Top",value:qc.TableLayout.ALIGN_TOP_LEFT},{label:"Middle",value:qc.TableLayout.ALIGN_MIDDLE_LEFT},{label:"Bottom",value:qc.TableLayout.ALIGN_BOTTOM_LEFT}]})]),aa.columnWidths=["100"],aa.line([aa.text("Child Force Expand")]),aa.columnWidths=[a.indent,120-a.indent,"60+0.5"],aa.line([aa.empty(),aa.text("Width"),aa.checkBox({bind:"childForceExpandWidth"})]),aa.line([aa.empty(),aa.text("Height"),aa.checkBox({bind:"childForceExpandHeight"})]),aa.columnWidths=[120,"60+0.5"],aa.line([aa.text("Auto Update"),aa.checkBox({bind:"autoUpdate"})]),aa.line([aa.empty(),a._rebuildTable=aa.button(ga._("Relayout"))]),a._rebuildTable.on("click",function(){b.relayout()})};var Oc=m("qc.editor.LayoutElementPanel",qc.editor.Panel,function df(a){var b=this;df["super"].constructor.call(b,a),b.title="LayoutElement",b.checkable=!0,b.removable=!0});Oc.prototype.onEnable=function(){this.target.enable=!0},Oc.prototype.onDisable=function(){this.target.enable=!1},Oc.prototype.onRemove=function(){var a=this;a.removeSelf()},Oc.prototype.update=function(){var a=this;a.checked=a.target.enable},Oc.prototype.paint=function(){var a=this,b=a.target;aa.columnWidths=[a.indent,90-a.indent,"60+0.5"];var c=aa.titleLine("Margin");c.add(aa.line([aa.empty(),aa.text("Left",{"for":"layoutElement_marginLeft",dragStep:1}),aa.numberInput({bind:"marginLeft",id:"layoutElement_marginLeft"})])),c.add(aa.line([aa.empty(),aa.text("Right",{"for":"layoutElement_marginRight",dragStep:1}),aa.numberInput({bind:"marginRight",id:"layoutElement_marginRight"})])),c.add(aa.line([aa.empty(),aa.text("Top",{"for":"layoutElement_marginTop",dragStep:1}),aa.numberInput({bind:"marginTop",id:"layoutElement_marginTop"})])),c.add(aa.line([aa.empty(),aa.text("Bottom",{"for":"layoutElement_marginBottom",dragStep:1}),aa.numberInput({bind:"marginBottom",id:"layoutElement_marginBottom"})])),aa.columnWidths=["90+0.3","60+0.5"],aa.line([aa.text("Ignore Layout",{toolTip:"ignoreLayout"}),aa.checkBox({bind:"ignoreLayout"})]),aa.line([aa.text("Size Provider"),aa.dropDownList({bind:"sizeProvider",items:[{label:"Real Bounds",value:qc.TableLayout.USE_BOUNDS},{label:"RectTransform",value:qc.TableLayout.USE_RECTTRANSFORM}]})]),aa.columnWidths=[110,20,"40+0.5"];var d=[aa.text("Min Width",{"for":"layoutElement_minWidth",dragStep:.01,min:0}),aa.checkBox({bind:"hasMinWidth",selected:b.hasMinWidth})];b.hasMinWidth&&d.push(aa.numberInput({bind:"minWidth",id:"layoutElement_minWidth"})),d[1].onValueChanged=function(){a.repaint()},aa.line(d),d=[aa.text("Min Height",{"for":"layoutElement_minHeight",dragStep:.01,min:0}),aa.checkBox({bind:"hasMinHeight",selected:b.hasMinHeight})],b.hasMinHeight&&d.push(aa.numberInput({bind:"minHeight",id:"layoutElement_minHeight"})),d[1].onValueChanged=function(){a.repaint()},aa.line(d),d=[aa.text("Preferred Width",{"for":"layoutElement_preferredWidth",dragStep:.01,min:0}),aa.checkBox({bind:"hasPreferredWidth",selected:b.hasPreferredWidth})],b.hasPreferredWidth&&d.push(aa.numberInput({bind:"preferredWidth",id:"layoutElement_preferredWidth"})),d[1].onValueChanged=function(){a.repaint()},aa.line(d),d=[aa.text("Preferred Height",{"for":"layoutElement_preferredHeight",dragStep:.01,min:0}),aa.checkBox({bind:"hasPreferredHeight",selected:b.hasPreferredHeight})],b.hasPreferredHeight&&d.push(aa.numberInput({bind:"preferredHeight",id:"layoutElement_preferredHeight"})),d[1].onValueChanged=function(){a.repaint()},aa.line(d),d=[aa.text("Flexible Width",{"for":"layoutElement_flexibleWidth",dragStep:.01,min:0}),aa.checkBox({bind:"hasFlexibleWidth",selected:b.hasFlexibleWidth})],b.hasFlexibleWidth&&d.push(aa.numberInput({bind:"flexibleWidth",id:"layoutElement_flexibleWidth"})),d[1].onValueChanged=function(){a.repaint()},aa.line(d),d=[aa.text("Flexible Height",{"for":"layoutElement_flexibleHeight",dragStep:.01,min:0}),aa.checkBox({bind:"hasFlexibleHeight",selected:b.hasFlexibleHeight})],b.hasFlexibleHeight&&d.push(aa.numberInput({bind:"flexibleHeight",id:"layoutElement_flexibleHeight"})),d[1].onValueChanged=function(){a.repaint()},aa.line(d)};var Pc=m("qc.editor.TableLayoutPanel",qc.editor.Panel,function ef(a){var b=this;ef["super"].constructor.call(b,a),b.title="TableLayout",b.checkable=!0,b.removable=!0});Pc.prototype.onEnable=function(){this.target.enable=!0},Pc.prototype.onDisable=function(){this.target.enable=!1},Pc.prototype.onRemove=function(){var a=this;a.removeSelf()},Pc.prototype.update=function(){var a=this;a.checked=a.target.enable},Pc.prototype.paint=function(){var a=this,b=a.target;aa.columnWidths=[a.indent,120-a.indent,"60+0.5"];var c=aa.titleLine("Padding");c.add(aa.line([aa.empty(),aa.text("Left",{"for":"tableLayout_paddingLeft",dragStep:1}),aa.numberInput({bind:"paddingLeft",id:"tableLayout_paddingLeft"})])),c.add(aa.line([aa.empty(),aa.text("Right",{"for":"tableLayout_paddingRight",dragStep:1}),aa.numberInput({bind:"paddingRight",id:"tableLayout_paddingRight"})])),c.add(aa.line([aa.empty(),aa.text("Top",{"for":"tableLayout_paddingTop",dragStep:1}),aa.numberInput({bind:"paddingTop",id:"tableLayout_paddingTop"})])),c.add(aa.line([aa.empty(),aa.text("Bottom",{"for":"tableLayout_paddingBottom",dragStep:1}),aa.numberInput({bind:"paddingBottom",id:"tableLayout_paddingBottom"})])),aa.columnWidths=[120],aa.line([aa.text("Cell Size")]),aa.columnWidths=[a.indent,120-a.indent,"40+0.1",20,"40+0.1"],aa.line([aa.empty(),aa.text("X",{"for":"tableLayout_cellWidth",dragStep:1}),aa.numberInput({bind:"cellWidth",id:"tableLayout_cellWidth"}),aa.text("Y",{"for":"tableLayout_cellHeight",dragStep:1}),aa.numberInput({bind:"cellHeight",id:"tableLayout_cellHeight"})]),aa.columnWidths=[120],aa.line([aa.text("Spacing Size")]),aa.columnWidths=[a.indent,120-a.indent,"40+0.1",20,"40+0.1"],aa.line([aa.empty(),aa.text("X",{"for":"tableLayout_spacingX",dragStep:.01}),aa.numberInput({bind:"spacingX",id:"tableLayout_spacingX"}),aa.text("Y",{"for":"tableLayout_spacingY",dragStep:.01}),aa.numberInput({bind:"spacingY",id:"tableLayout_spacingY"})]),aa.columnWidths=[120,"60+0.5"],aa.line([aa.text("Style"),aa.dropDownList({bind:"style",items:[{label:"Wrap Element",value:qc.TableLayout.STYLE_WRAP_ELEMENT},{label:"Resize Element",value:qc.TableLayout.STYLE_RESIZE_ELEMENT}]})]),aa.line([aa.text("Size Provider"),aa.dropDownList({bind:"contentSizeProvider",items:[{label:"Real Bounds",value:qc.TableLayout.USE_BOUNDS},{label:"RectTransform",value:qc.TableLayout.USE_RECTTRANSFORM}]})]),aa.line([aa.text("Start Corner"),aa.dropDownList({bind:"startCorner",items:[{label:"Top Left",value:qc.TableLayout.CORNER_TOP_LEFT},{label:"Top Right",value:qc.TableLayout.CORNER_TOP_RIGHT},{label:"Bottom Left",value:qc.TableLayout.CORNER_BOTTOM_LEFT},{label:"Bottom Right",value:qc.TableLayout.CORNER_BOTTOM_RIGHT}]})]),aa.line([aa.text("Start Axis"),aa.dropDownList({bind:"startAxis",items:[{label:"Horizontal",value:qc.TableLayout.AXIS_HORIZONTAL},{label:"Vertical",value:qc.TableLayout.AXIS_VERTICAL}]})]),aa.line([aa.text("Content Alignment"),aa.dropDownList({bind:"contentAlignment",items:[{label:"Top Left",value:qc.TableLayout.ALIGN_TOP_LEFT},{label:"Top Center",value:qc.TableLayout.ALIGN_TOP_CENTER},{label:"Top Right",value:qc.TableLayout.ALIGN_TOP_RIGHT},{label:"Middle Left",value:qc.TableLayout.ALIGN_MIDDLE_LEFT},{label:"Middle Center",value:qc.TableLayout.ALIGN_MIDDLE_CENTER},{label:"Middle Right",value:qc.TableLayout.ALIGN_MIDDLE_RIGHT},{label:"Bottom Left",value:qc.TableLayout.ALIGN_BOTTOM_LEFT},{label:"Bottom Center",value:qc.TableLayout.ALIGN_BOTTOM_CENTER},{label:"Bottom Right",value:qc.TableLayout.ALIGN_BOTTOM_RIGHT
}]})]),aa.line([aa.text("Cell Alignment"),aa.dropDownList({bind:"cellAlignment",items:[{label:"Top Left",value:qc.TableLayout.ALIGN_TOP_LEFT},{label:"Top Center",value:qc.TableLayout.ALIGN_TOP_CENTER},{label:"Top Right",value:qc.TableLayout.ALIGN_TOP_RIGHT},{label:"Middle Left",value:qc.TableLayout.ALIGN_MIDDLE_LEFT},{label:"Middle Center",value:qc.TableLayout.ALIGN_MIDDLE_CENTER},{label:"Middle Right",value:qc.TableLayout.ALIGN_MIDDLE_RIGHT},{label:"Bottom Left",value:qc.TableLayout.ALIGN_BOTTOM_LEFT},{label:"Bottom Center",value:qc.TableLayout.ALIGN_BOTTOM_CENTER},{label:"Bottom Right",value:qc.TableLayout.ALIGN_BOTTOM_RIGHT}]})]);var d,e=b.constraint;aa.line([aa.text("Constraint"),d=aa.dropDownList({bind:"constraint",items:[{label:"Flexible",value:qc.TableLayout.CONSTRAINT_FLEXIBLE},{label:"Fix Column Count",value:qc.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT},{label:"Fix Row Count",value:qc.TableLayout.CONSTRAINT_FIX_ROW_COUNT}]})]),d.onValueChanged=function(b){e!==b&&(e=b,a.repaint())},e!==qc.TableLayout.CONSTRAINT_FLEXIBLE&&aa.line([aa.text(e===qc.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT?"Column Count":"Row Count",{"for":"tableLayout_stride",dragStep:1}),aa.numberInput({bind:"stride",id:"tableLayout_stride"})]),aa.line([aa.text("Ignore X pos"),aa.checkBox({bind:"ignoreX"})]),aa.line([aa.text("Ignore Y pos"),aa.checkBox({bind:"ignoreY"})]),aa.line([aa.text("Auto Update"),aa.checkBox({bind:"autoUpdate"})]),aa.line([aa.empty(),a._rebuildTable=aa.button(ga._("Relayout"))]),a._rebuildTable.on("click",function(){b.relayout()})};var Qc=m("qc.editor.VerticalLayoutPanel",qc.editor.Panel,function ff(a){var b=this;ff["super"].constructor.call(b,a),b.title="VerticalLayout",b.checkable=!0,b.removable=!0});Qc.prototype.onEnable=function(){this.target.enable=!0},Qc.prototype.onDisable=function(){this.target.enable=!1},Qc.prototype.onRemove=function(){var a=this;a.removeSelf()},Qc.prototype.update=function(){var a=this;a.checked=a.target.enable},Qc.prototype.paint=function(){var a=this;a.checked=a.target.enable},Qc.prototype.paint=function(){var a=this,b=a.target;aa.columnWidths=[a.indent,120-a.indent,"60+0.5"];var c=aa.titleLine("Padding");c.add(aa.line([aa.empty(),aa.text("Left",{"for":"verLayout_paddingLeft",dragStep:1}),aa.numberInput({bind:"paddingLeft",id:"verLayout_paddingLeft"})])),c.add(aa.line([aa.empty(),aa.text("Right",{"for":"verLayout_paddingRight",dragStep:1}),aa.numberInput({bind:"paddingRight",id:"verLayout_paddingRight"})])),c.add(aa.line([aa.empty(),aa.text("Top",{"for":"verLayout_paddingTop",dragStep:1}),aa.numberInput({bind:"paddingTop",id:"verLayout_paddingTop"})])),c.add(aa.line([aa.empty(),aa.text("Bottom",{"for":"verLayout_paddingBottom",dragStep:1}),aa.numberInput({bind:"paddingBottom",id:"verLayout_paddingBottom"})])),aa.columnWidths=[120,"60+0.5"],aa.line([aa.text("Spacing",{"for":"verLayout_spacing",dragStep:.01}),aa.numberInput({bind:"spacing",id:"verLayout_spacing"})]),aa.line([aa.text("Size Provider"),aa.dropDownList({bind:"contentSizeProvider",items:[{label:"Real Bounds",value:qc.TableLayout.USE_BOUNDS},{label:"RectTransform",value:qc.TableLayout.USE_RECTTRANSFORM}]})]),aa.line([aa.text("Content Alignment"),aa.dropDownList({bind:"contentAlignment",items:[{label:"Top",value:qc.TableLayout.ALIGN_TOP_LEFT},{label:"Middle",value:qc.TableLayout.ALIGN_MIDDLE_LEFT},{label:"Bottom",value:qc.TableLayout.ALIGN_BOTTOM_LEFT}]})]),aa.line([aa.text("Cell Alignment"),aa.dropDownList({bind:"cellAlignment",items:[{label:"Left",value:qc.TableLayout.ALIGN_TOP_LEFT},{label:"Center",value:qc.TableLayout.ALIGN_TOP_CENTER},{label:"Right",value:qc.TableLayout.ALIGN_TOP_RIGHT}]})]),aa.columnWidths=["100"],aa.line([aa.text("Child Force Expand")]),aa.columnWidths=[a.indent,120-a.indent,"60+0.5"],aa.line([aa.empty(),aa.text("Width"),aa.checkBox({bind:"childForceExpandWidth"})]),aa.line([aa.empty(),aa.text("Height"),aa.checkBox({bind:"childForceExpandHeight"})]),aa.columnWidths=[120,"60+0.5"],aa.line([aa.text("Auto Update"),aa.checkBox({bind:"autoUpdate"})]),aa.line([aa.empty(),a._rebuildTable=aa.button(ga._("Relayout"))]),a._rebuildTable.on("click",function(){b.relayout()})};var Rc=m("qc.editor.AspectRatioFitterPanel",qc.editor.Panel,function gf(a){var b=this;gf["super"].constructor.call(b,a),b.title="Aspect Ratio Fitter",b.checkable=!0,b.removable=!0});Rc.prototype.onEnable=function(){this.target.enable=!0},Rc.prototype.onDisable=function(){this.target.enable=!1},Rc.prototype.onRemove=function(){var a=this;a.removeSelf()},Rc.prototype.update=function(){var a=this;a.checked=a.target.enable},Rc.prototype.paint=function(){var a=this,b=a.target;aa.columnWidths=["60+0.1","60+0.5",60],aa.line([aa.text("Mode"),aa.dropDownList({bind:"mode",items:[{label:"None",value:qc.AspectRatioFitter.NONE},{label:"Width Controls Height",value:qc.AspectRatioFitter.WIDTH_CONTROLS_HEIGHT},{label:"Height Controls Width",value:qc.AspectRatioFitter.HEIGHT_CONTROLS_WIDTH},{label:"Fit In Parent",value:qc.AspectRatioFitter.FIT_IN_PARENT},{label:"Envelope Parent",value:qc.AspectRatioFitter.ENVELOPE_PARENT}]},{colspan:2})]);var c;aa.line([aa.text("Ratio"),aa.numberInput({bind:"ratio"}),c=aa.button(ga._("Calculate"))]),c.on("click",function(){var a=ga.hierarchy.activeNode;if(a){var c=a.texture,d=a.frame;if(c)if(c.frameNames&&c.frameNames.indexOf(d)>=0){var e=c.frames[c.frameNames.indexOf(d)].width,f=c.frames[c.frameNames.indexOf(d)].height;b.ratio=e/f}else c.img&&(b.ratio=c.img.width/c.img.height)}})};var Sc=m("qc.editor.FilterGroupPanel",qc.editor.Panel,function hf(a){var b=this;hf["super"].constructor.call(b,a),b.title="FilterGroup",b.checkable=!0,b.removable=!0});Sc.prototype.onEnable=function(){this.target.enable=!0},Sc.prototype.onDisable=function(){this.target.enable=!1},Sc.prototype.onRemove=function(){var a=this;a.removeSelf()},Sc.prototype.update=function(){var a=this;a.checked=a.target.enable},Sc.prototype.paint=function(){var a=this,b=this.target,c=[95,20,"30+0.3",20,"30+0.3"];aa.columnWidths=[90,"60+0.5"],aa.line([aa.text("Inherited"),aa.checkBox({bind:"inherited"})]);var d=new qc.editor.AddComponentButton;d.text=ga._("Add Filter"),d.items=[];var e=qc.Filter.filters;for(var f in e){var g=qc.Util.findClass(f);g&&d.addItem(f,null,{icon:"UnknowIcon",clazz:f})}d.on(ga.e.SELECT_COMPONENT,function(c){ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:b,field:"filter"}),b.addFilter(c.clazz),a.repaint()}),aa.line([aa.comp(d,{},{colspan:2})]);var h=new Tc({draggable:!0,removable:!0}),e=b.filters;if(e.forEach(function(a){h.addItem(a)}),a._currentFilter=a._currentFilter||(e.length>0?e[0]:null),h.select(a._currentFilter),h.selectionModel.on("selectionChange",function(){var b=h.selection[0];a._currentFilter=b&&b.filter,a.repaint()}),h.dataModel.on("dataModelChange",function(a){"remove"===a.kind&&(ga.inspector.propertyView.emit(ga.e.INSPECTOR_COMP_VALUE_CHANGE,{node:b,field:"filter"}),b.removeFilter(a.data.filter))}),h.dataModel.on("hierarchyChange",function(){var a=[];h.dataModel.roots.forEach(function(b){a.push(b.filter)}),b.filters=a}),aa.line([aa.comp(h,{},{colspan:2})],100),a._currentFilter){aa.columnWidths=c;var i=a._currentFilter.getExtraUniforms();for(var j in i){var k=i[j];this.drawUniform(a,a._currentFilter,j,k)}}},Sc.prototype.drawUniform=function(a,b,c,d){var e=this,f=qc.Filter,g=this.target;switch(aa.columnWidths=[95,20,"30+0.3",20,"30+0.3"],d){case f.F1:case f.I1:return void aa.line([aa.text(nc.makePropertyName(c)),aa.numberInput({bind:c,bindTarget:b},{colspan:4})]);case f.I2V:case f.F2V:return b[c]||(b[c]=[0,0]),void aa.line([aa.text(nc.makePropertyName(c)),aa.text("X"),aa.numberInput({bind:"0",bindTarget:b[c]}),aa.text("Y"),aa.numberInput({bind:"1",bindTarget:b[c]})]);case f.I3V:case f.F3V:return b[c]||(b[c]=[0,0,0]),aa.columnWidths=[95,20,"20+0.3",20,"20+0.3",20,"20+0.3"],void aa.line([aa.text(nc.makePropertyName(c)),aa.text("X"),aa.numberInput({bind:"0",bindTarget:b[c]}),aa.text("Y"),aa.numberInput({bind:"1",bindTarget:b[c]}),aa.text("Z"),aa.numberInput({bind:"2",bindTarget:b[c]})]);case f.I4V:case f.F4V:return b[c]||(b[c]=[0,0,0,0]),aa.line([aa.text(nc.makePropertyName(c)),aa.text("X"),aa.numberInput({bind:"0",bindTarget:b[c]}),aa.text("Y"),aa.numberInput({bind:"1",bindTarget:b[c]})]),void aa.line([aa.text(nc.makePropertyName(c)),aa.text("Z"),aa.numberInput({bind:"2",bindTarget:b[c]}),aa.text("W"),aa.numberInput({bind:"3",bindTarget:b[c]})]);case f.MAT2:return b[c]||(b[c]=[1,0,0,1]),aa.columnWidths=[95,"20+0.3","20+0.3"],aa.line([aa.text(nc.makePropertyName(c))]),aa.line([aa.empty(),aa.numberInput({bind:"0",bindTarget:b[c]}),aa.numberInput({bind:"1",bindTarget:b[c]})]),void aa.line([aa.empty(),aa.numberInput({bind:"2",bindTarget:b[c]}),aa.numberInput({bind:"3",bindTarget:b[c]})]);case f.MAT3:return b[c]||(b[c]=[1,0,1,0,1,1,0,0,1]),aa.columnWidths=[95,"20+0.3","20+0.3","20+0.3"],aa.line([aa.text(nc.makePropertyName(c))]),aa.line([aa.empty(),aa.numberInput({bind:"0",bindTarget:b[c]}),aa.numberInput({bind:"1",bindTarget:b[c]}),aa.numberInput({bind:"2",bindTarget:b[c]})]),aa.line([aa.empty(),aa.numberInput({bind:"3",bindTarget:b[c]}),aa.numberInput({bind:"4",bindTarget:b[c]}),aa.numberInput({bind:"5",bindTarget:b[c]})]),void aa.line([aa.empty(),aa.numberInput({bind:"6",bindTarget:b[c]}),aa.numberInput({bind:"7",bindTarget:b[c]}),aa.numberInput({bind:"8",bindTarget:b[c]})]);case f.MAT4:return b[c]||(b[c]=[1,0,0,1,0,1,0,1,0,0,1,1,0,0,0,1]),aa.columnWidths=[95,"20+0.3","20+0.3","20+0.3","20+0.3"],aa.line([aa.text(nc.makePropertyName(c))]),aa.line([aa.empty(),aa.numberInput({bind:"0",bindTarget:b[c]}),aa.numberInput({bind:"1",bindTarget:b[c]}),aa.numberInput({bind:"2",bindTarget:b[c]}),aa.numberInput({bind:"3",bindTarget:b[c]})]),aa.line([aa.empty(),aa.numberInput({bind:"4",bindTarget:b[c]}),aa.numberInput({bind:"5",bindTarget:b[c]}),aa.numberInput({bind:"6",bindTarget:b[c]}),aa.numberInput({bind:"7",bindTarget:b[c]})]),aa.line([aa.empty(),aa.numberInput({bind:"8",bindTarget:b[c]}),aa.numberInput({bind:"9",bindTarget:b[c]}),aa.numberInput({bind:"10",bindTarget:b[c]}),aa.numberInput({bind:"11",bindTarget:b[c]})]),void aa.line([aa.empty(),aa.numberInput({bind:"12",bindTarget:b[c]}),aa.numberInput({bind:"13",bindTarget:b[c]}),aa.numberInput({bind:"14",bindTarget:b[c]}),aa.numberInput({bind:"15",bindTarget:b[c]})]);case f.I2:case f.F2:return b[c]||(b[c]={x:0,y:0}),void aa.line([aa.text(nc.makePropertyName(c)),aa.text("X"),aa.numberInput({bind:"x",bindTarget:b[c]}),aa.text("Y"),aa.numberInput({bind:"y",bindTarget:b[c]})]);case f.I3:case f.F3:return b[c]||(b[c]={x:0,y:0,z:0}),aa.columnWidths=[95,20,"20+0.3",20,"20+0.3",20,"20+0.3"],void aa.line([aa.text(nc.makePropertyName(c)),aa.text("X"),aa.numberInput({bind:"x",bindTarget:b[c]}),aa.text("Y"),aa.numberInput({bind:"y",bindTarget:b[c]}),aa.text("Z"),aa.numberInput({bind:"z",bindTarget:b[c]})]);case f.I4:case f.F4:return b[c]||(b[c]={x:0,y:0,z:0,w:0}),aa.line([aa.text(nc.makePropertyName(c)),aa.text("X"),aa.numberInput({bind:"x",bindTarget:b[c]}),aa.text("Y"),aa.numberInput({bind:"y",bindTarget:b[c]})]),void aa.line([aa.empty(),aa.text("Z"),aa.numberInput({bind:"z",bindTarget:b[c]}),aa.text("W"),aa.numberInput({bind:"w",bindTarget:b[c]})]);case f.SAMPLER2D:aa.columnWidths=[95,"60+0.5"];var h=b[c];h||(h=b[c]=new qc.Filter.FilterTexture(g.gameObject.game));var i=nc.drawTextureInput(h,nc.makePropertyName(c),"texture/frame",function(){e.repaint()},b[c]),j=h.texture?h.texture.frameNames:[0];j.indexOf(h.frame)<0&&(h.frame=j[0]);var k;return h.frame?aa.line([aa.text("Frame"),k=aa.dropDownList({bind:"frame",items:j,bindTarget:b[c]})]):h.frame=0,void(k&&i&&(k.onValueChanged=function(a){var b=i.associatedViewAndData;b&&(b.fileList[1]=a)}))}};var Tc=m("qc.editor.FilterList",qc.editor.InspectorList,function jf(a){var b=this;jf["super"].constructor.call(b,a)});Tc.prototype.addItem=function(a){var b=new qc.widget.Data;b.name=a["class"],b.filter=a,this.dataModel.add(b)},Tc.prototype.select=function(a){for(var b,c=this.dataModel.datas,d=0;d<c.length;d++){var e=c[d];if(e.filter===a){b=e;break}}this.selection=b};var Uc=qc.editor.TweenUtil=function(){};Uc.paintTweenBase=function(a,b){var c=a,d=[70,20,"30+1",20,"30+1"];aa.columnWidths=[c.indent,120-c.indent,"60+0.5"];var e=aa.titleLine("Tween",ga.preference.query("collapse.tween")===!0);e.add(aa.line([aa.empty(),aa.text("Play Style"),aa.dropDownList({bind:"style",items:[{label:"Once",value:qc.Tween.STYLE_ONCE},{label:"Loop",value:qc.Tween.STYLE_LOOP},{label:"PingPong",value:qc.Tween.STYLE_PINGPONG}]})])),e.add(aa.line([aa.empty(),aa.text("Curve"),c._curveButton=aa.curveButton({})],60)),c._curveButton.bezierCurve=b.curve,e.add(aa.line([aa.empty(),aa.text("Duration"),aa.numberInput({bind:"duration"})])),e.add(aa.line([aa.empty(),aa.text("Start Delay"),aa.numberInput({bind:"delay"})])),e.add(aa.line([aa.empty(),aa.text("Tween Group"),aa.numberInput({bind:"tweenGroup"})])),e.add(aa.line([aa.empty(),aa.text("Flag"),aa.stringInput({bind:"flag"})])),aa.columnWidths=d,aa.line([aa.empty(),c.btn=aa.button(ga._("Play/Stop"),{},{colspan:4})]),c.btn.on("click",function(){b.canRunInEditor?b.stop():(b.resetToBeginning(),b.play())}),aa.line([aa.empty(),c.resetBtn=aa.button(ga._("Reset To Begin"),{},{colspan:4})]),c.resetBtn.on("click",function(){b.canRunInEditor&&b.stop(),b.resetToBeginning()}),aa.line([aa.empty(),c.btn=aa.button(ga._("Play/Stop Group"),{},{colspan:4})]),c.btn.on("click",function(){b.canRunInEditor?b.stopGroup():(b.resetGroupToBeginning(),b.playGroup())}),aa.line([aa.empty(),c.resetBtn=aa.button(ga._("Reset Group to Begin"),{},{colspan:4})]),c.resetBtn.on("click",function(){b.canRunInEditor&&b.stopGroup(),b.resetGroupToBeginning()})},Uc.paintTween=function(a,b){var c=a,d=[70,20,"30+1",20,"30+1"];aa.columnWidths=d,aa.line([aa.empty(),c.btnSetCurrToStart=aa.button(ga._("Set Curr To Start"),{},{colspan:4})]),c.btnSetCurrToStart.on("click",function(){b.setCurrToStartValue(),c.iv()}),aa.line([aa.empty(),c.btnSetCurrToEnd=aa.button(ga._("Set Curr To End"),{},{colspan:4})]),c.btnSetCurrToEnd.on("click",function(){b.setCurrToEndValue(),c.iv()}),aa.columnWidths=[120,"50+1"],aa.line([aa.text("Play On Awake"),aa.checkBox({bind:"playOnAwake"})]),Uc.paintTweenBase(a,b)};var Vc=m("qc.editor.TweenAlphaPanel",qc.editor.Panel,function kf(a){var b=this;kf["super"].constructor.call(b,a),b.title="TweenAlpha",b.icon="inspector_text",b.checkable=!0,b.removable=!0});Vc.prototype.onEnable=function(){this.target.enable=!0},Vc.prototype.onDisable=function(){this.target.enable=!1},Vc.prototype.onRemove=function(){var a=this;a.removeSelf()},Vc.prototype.update=function(){var a=this;a.checked=a.target.enable},Vc.prototype.paint=function(){var a=this,b=this.target,c=[70,"60+1"];aa.columnWidths=c,aa.line([aa.text("From"),aa.numberInput({bind:"from"})]),aa.line([aa.text("To"),aa.numberInput({bind:"to"})]),qc.editor.TweenUtil.paintTween(a,b)};var Wc=m("qc.editor.TweenColorPanel",qc.editor.Panel,function(a){var b=this;Wc["super"].constructor.call(b,a),b.title="TweenColor",b.icon="inspector_text",b.checkable=!0,b.removable=!0});Wc.prototype.onEnable=function(){this.target.enable=!0},Wc.prototype.onDisable=function(){this.target.enable=!1},Wc.prototype.onRemove=function(){var a=this;a.removeSelf()},Wc.prototype.update=function(){var a=this;a.checked=a.target.enable},Wc.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=[70,"60+1"],nc.drawColorPicker(b,"From","from"),nc.drawColorPicker(b,"To","to"),qc.editor.TweenUtil.paintTween(a,b)};var Xc=m("qc.editor.TweenPositionPanel",qc.editor.Panel,function lf(a){var b=this;lf["super"].constructor.call(b,a),b.title="TweenPosition",b.icon="inspector_text",b.checkable=!0,b.removable=!0});Xc.prototype.onEnable=function(){this.target.enable=!0},Xc.prototype.onDisable=function(){this.target.enable=!1},Xc.prototype.onRemove=function(){var a=this;a.removeSelf()},Xc.prototype.update=function(){var a=this;a.checked=a.target.enable},Xc.prototype.paint=function(){var a=this,b=this.target,c=[70,20,"30+1",20,"30+1"];aa.columnWidths=["70+0.1","60+0.5"],aa.line([aa.text("Move Axis"),a._moveType=aa.dropDownList({bind:"moveAxis",items:[{label:"X,Y",value:qc.TweenPosition.BOTH},{label:"Only X",value:qc.TweenPosition.ONLY_X},{label:"Only Y",value:qc.TweenPosition.ONLY_Y}]})]),aa.columnWidths=c,nc.drawPoint(b,"from"),nc.drawPoint(b,"to"),qc.editor.TweenUtil.paintTween(a,b)};var Yc=m("qc.editor.TweenPropertyPanel",qc.editor.Panel,function mf(a){var b=this;mf["super"].constructor.call(b,a),b.title="TweenProperty",b.icon="inspector_text",b.checkable=!0,b.removable=!0});Yc.prototype.onEnable=function(){this.target.enable=!0},Yc.prototype.onDisable=function(){this.target.enable=!1},Yc.prototype.onRemove=function(){var a=this;a.removeSelf()},Yc.prototype.update=function(){var a=this;a.checked=a.target.enable},Yc.prototype.paint=function(){var a=this,b=this.target,c=[90,"60+1"];aa.columnWidths=c,aa.line([aa.text("Property"),aa.stringInput({bind:"property"})]),aa.line([aa.text("From"),aa.numberInput({bind:"from"})]),aa.line([aa.text("To"),aa.numberInput({bind:"to"})]),qc.editor.TweenUtil.paintTween(a,b)};var Zc=m("qc.editor.TweenRotationPanel",qc.editor.Panel,function nf(a){var b=this;nf["super"].constructor.call(b,a),b.title="TweenRotation",b.icon="inspector_text",b.checkable=!0,b.removable=!0});Zc.prototype.onEnable=function(){this.target.enable=!0},Zc.prototype.onDisable=function(){this.target.enable=!1},Zc.prototype.onRemove=function(){var a=this;a.removeSelf()},Zc.prototype.update=function(){var a=this;a.checked=a.target.enable},Zc.prototype.paint=function(){var a=this,b=this.target,c=[70,"60+1"];aa.columnWidths=c,aa.line([aa.text("From"),aa.angleInput({bind:"from"})]),aa.line([aa.text("To"),aa.angleInput({bind:"to"})]),qc.editor.TweenUtil.paintTween(a,b)};var $c=m("qc.editor.TweenScalePanel",qc.editor.Panel,function of(a){var b=this;of["super"].constructor.call(b,a),b.title="TweenScale",b.icon="inspector_text",b.checkable=!0,b.removable=!0});$c.prototype.onEnable=function(){this.target.enable=!0},$c.prototype.onDisable=function(){this.target.enable=!1},$c.prototype.onRemove=function(){var a=this;a.removeSelf()},$c.prototype.update=function(){var a=this;a.checked=a.target.enable},$c.prototype.paint=function(){var a=this,b=this.target,c=[70,20,"30+1",20,"30+1"];aa.columnWidths=c,nc.drawPoint(b,"from"),nc.drawPoint(b,"to"),qc.editor.TweenUtil.paintTween(a,b)};var _c=m("qc.editor.AtlasNodePanel",qc.editor.Panel,function pf(a,b){var d=this;pf["super"].constructor.call(d),d.title=ga._("UI Atlas"),d.checkable=!1,d.removable=!1,ga.atlasNodePanel=d,d.uuid=a,d.target=ga.project.findByUUID(a),d.targetKey=d.target?d.target.url:"",d.image=c,d.defaultFrame=b,d.target&&(d.image=d.target.img,d.repaint())});ga.e.on(ga.e.BG_RESOURCE_LOADED,function(a){var b=ga.atlasNodePanel;if(b&&b.targetKey===a.key){var c=ga.inspector.propertyView.children;c&&c.length&&b===c[0]&&(b.target=a,b.image=b.target.img,b.repaint())}}),_c.prototype.paint=function(){var a=this,c=a.target;if(c&&a.image){var d,e,f;if(c.json&&0!==b.keys(c.json).length?(f=c.meta.animationType)?1===f?(d="frameAnimation",e=ga._("Frame Animation")):2===f?(d="dragonBones",e=ga._("DragonBone")):3===f&&(d="frameSamples",e=ga._("DragonBone(Sampled)")):(d="atlas",e=ga._("Atlas")):(d="normal",e=ga._("Normal Texture")),aa.columnWidths=["100+0.5","120+0.1"],aa.line([aa.text(e,{textFont:"bold 12px Arial"},{colspan:2})]),"atlas"===d||"frameAnimation"===d){var g;aa.line([aa.text(sb(c.url),{}),g=aa.button(ga._("Edit Frame Animation"))]),g.on("click",function(){ga.inspector.propertyView.inspect(null,"frameAnimation",{uuid:a.uuid,previousPanel:"AtlasNodePanel"})})}else if("frameSamples"===d){var h;aa.line([aa.text(sb(c.url),{}),h=aa.button(ga._("Revert"))]),h.on("click",function(){a.revertToDragonbones()})}else if("dragonBones"===d){var i;aa.line([aa.text(sb(c.url),{}),i=aa.button(ga._("Sampled"))]),i.on("click",function(){a.sampleCurrentAnimation()})}else aa.line([aa.text(sb(c.url),{},{colspan:2})]);var j,l=150,m=144,n=ga.project.getImageURLByAtlas(c);aa.line([j=aa.painter({borderWidth:1,tileSize:m,preferredSize:{width:l,height:l}},{fill:"none",align:"center",colspan:2})],l),j.addTopPainter(function(a){k.drawImage(a,n,"uniform",(l-m)/2,(l-m)/2,m,m)}),"dragonBones"===d?a.drawAtlasAnimations(!0):"frameSamples"===d?a.drawAtlasAnimations(!1):"frameAnimation"===d?(a.drawAtlasFrames(),a.drawAtlasAnimations(!1)):"atlas"===d?a.drawAtlasFrames():"normal"===d&&a.drawNormalImage()}},_c.prototype.revertToDragonbones=function(){var a=this,b=a.target;return b&&b.json&&b.meta&&3===b.meta.animationType?void qc.editor.Operation.REVERT_TO_DRAGONBONES(b.url):void ga.log.trace("当前目标不是帧采样动画，无法恢复。")},_c.prototype.sampleCurrentAnimation=function(){var a=this,b=a.target;return b&&b.json&&b.meta&&2===b.meta.animationType?void qc.editor.Operation.SAMPLE_DRAGON_BONES(b):void ga.log.trace("当前目标不是 dragonbones，不进行 sample 化。")},_c.prototype.drawAtlasAnimations=function(a){var c,d=this;c=a?d.target.animation.data.armature[0].animation:d.target.animation.data.animations||d.target.animation.data.samples,aa.columnWidths=[d.indent,"60+0.5",40,80];var e=aa.titleLine(ga._("Animations List"));e.add(aa.line([aa.empty(),aa.text(ga._("Name"),{align:"left"}),aa.text(ga._("Loop"),{align:"center"}),aa.text(ga._("Operation"),{align:"center"})])),e.add(aa.line([aa.divider(null,{colspan:4})]));var f=c?b.keys(c).sort():[];for(var g in f)!function(b){var f=c[b];a&&(b=f.name);var g,h=f.loop;e.add(aa.line([aa.empty(),aa.text(b,{align:"left"}),aa.text(a&&0===h||!a&&h===!0?"Y":"N",{align:"center"}),g=aa.button(ga._("Play"))])),g.on("click",function(){d.playAnimation(b)})}(f[g]);e.add(aa.line([aa.divider(null,{colspan:4})]))},_c.prototype.playAnimation=function(a){var b=this,c=b.target;if(c){var d="playAniNode",e=ga.hiddenGame,f=e.world.find(d);f||(f=e.add.sprite(),f.name=d),f.texture!==c&&(f.texture=c);var g=160,h=160;if((ga.hiddenGame.width!==g||ga.hiddenGame.height!==h)&&ga.hiddenGame.phaser.scale.setGameSize(g,h),b.calcNodeScale(f,a),f.animationNameList&&!(f.animationNameList.indexOf(a)<0)){f.playAnimation(a),f.animationType===qc.Sprite.FRAME_ANIMATION&&f.resetNativeSize();var i=ga.inspector.previewView.content;if(!i||i.atlas!==c||!i.parent){i=aa.painter({background:null}),i._zoom=i._cacheZoom=1,b.adjustNodePos(f),ga.hiddenGame.phaser.updateRender(),i.atlas=c,ga.inspector.previewView.content=i;var j=new qc.widget.Slider;j.view.style.right="5px",j.view.style.top="5px",j.background="rgb(63, 76, 106)",j.forecolor="rgb(139, 151, 172)",j.min=.5,j.max=2,j.step=.1,j.value=1,j.width=70,j.height=12,j.disableToolTip(),j.on("propertyChange",function(a){"value"===a.property&&(ga.inspector.previewView.content._zoom=a.newValue)}),i.view.appendChild(j.view),j.iv(),i.addTopPainter(function(a){var b=Math.min(i.width,i.height);a.drawImage(ga.hiddenGame.canvas,0,0,ga.hiddenGame.canvas.width,ga.hiddenGame.canvas.height,.5*(i.width-b),.5*(i.height-b),b,b)});var k=setInterval(function(){return i.parent?(i._zoom!==i._cacheZoom&&(i._cacheZoom=i._zoom,b.adjustNodePos(f,i._zoom)),void i.iv()):void clearInterval(k)},33)}}}},_c.prototype.calcNodeScale=function(a,b){if(!a.texture._aniPlayInfo){var c=a.game.width,d=a.game.height,e=this.getSpriteBox(a,b),f=c/(1.6*e.width),g=d/(1.6*e.height);f>1&&g>1&&(f=1,g=1);var h=Math.min(f,g);a.texture._aniPlayInfo={scale:h,box:e}}},_c.prototype.adjustNodePos=function(a,b){if(a.texture){var c=a.texture._aniPlayInfo;if(c){var d=c.scale*(b||1),e=c.box;a.scaleX=d,a.scaleY=d;var f=a.game.width,g=a.game.height;a.x=.5*f-(.5*e.width+e.x)*d,a.y=.5*g-(.5*e.height+e.y)*d}}},_c.prototype.getSpriteBox=function(a,b){var c,d=a.animationType;if(d===qc.Sprite.FRAME_ANIMATION){var e=a._animation[b].frames[0],f=a.texture.getFrame(e);c=new qc.Rectangle(0,0,f.width,f.height)}else if(d===qc.Sprite.DRAGON_BONES){var g=a.width,h=a.height;a.width=0,a.height=0;var i,j,k;a.children.length&&(i=a.children[0],j=i.width,k=i.height,i.width=0,i.height=0),a.playAnimation(b),a._armature.advanceTime(0),c=qc.Bounds.getBox(a,0,!0,-1,a),a.stop(),a.width=g,a.height=h,i&&(i.width=j,i.height=k)}else if(d===qc.Sprite.FRAME_SAMPLES){var l=a.phaser.texture.baseTexture.width,m=a.phaser.texture.baseTexture.height,n=a._animation[b],o=0,p=n.frames[o],q=a.texture.animation.data,r=q.uvs;q.convert||(q.convert={});for(var s=(q.convert[b]||{})[o],t=1/0,u=1/0,v=-(1/0),w=-(1/0),x=function(a,b){t=Math.min(a,t),v=Math.max(a,v),u=Math.min(b,u),w=Math.max(b,w)},y=0,z=p.length/10;z>y;y++){var A=10*y,B=4*p[A];if(s)x(p[A+1],p[A+2]),x(p[A+3],p[A+4]),x(p[A+5],p[A+6]),x(p[A+7],p[A+8]);else{var C=p[A+1],D=p[A+2],E=p[A+3],F=p[A+4],G=p[A+5],H=p[A+6],I=p[A+7],J=p[A+8],K=(r[B+2]-r[B])*l,L=(r[B+3]-r[B+1])*m,M=K*-I,N=L*-J,O=K*(1-I),P=L*(1-J);x(C*M+E*N+G,D*M+F*N+H),x(C*O+E*N+G,D*O+F*N+H),x(C*O+E*P+G,D*O+F*P+H),x(C*M+E*P+G,D*M+F*P+H)}}c=new qc.Rectangle(t,u,v-t,w-u)}return c},_c.prototype.drawAtlasFrames=function(){var a,c=this,d=b.keys(c.target.json.frames).sort();if(aa.columnWidths=["60+0.01","40+0.5"],aa.line([aa.text(ga._("Frames")),a=aa.dropDownList({items:d})]),c.ninePaddingConf)a.value=c.ninePaddingConf.frameKey;else{var e;e=c.defaultFrame||d[0],a.value=e,c.selectFrame(e)}a.onValueChanged=function(a){c.selectFrame(a,!0)},c.drawImage()},_c.prototype.selectFrame=function(a,b){var c,d,e,f,g=this;if(!((c=this.target)&&(d=c.json)&&(e=d.frames)&&(f=e[a])))return!1;var h=f.frame;return g.ninePaddingConf={frameKey:a,frame:h},b&&g.repaint(),!0},_c.prototype.drawNormalImage=function(){var a=this;a.ninePaddingConf={frameKey:0,frame:{x:0,y:0,w:a.target.img.width,h:a.target.img.height}},a.drawImage()},_c.prototype.drawImage=function(){var a,b=this;aa.columnWidths=["15+0.0","35+0.1","12+0.5","35+0.1","12+0.5"];var c,d,e,f,g=aa.titleLine(ga._("Nine Patch Padding")),h=function(c,d,e,f,g){if(ga.inspector.previewView.content!==a&&(ga.inspector.previewView.content=a),g){var h=b.target.meta.padding,i=b.ninePaddingConf.frameKey;h||(b.target.meta.padding=h={}),h[i]||(h[i]=[0,0,0,0]),h[i][0]=parseFloat(c),h[i][1]=parseFloat(d),h[i][2]=parseFloat(e),h[i][3]=parseFloat(f),qc.editor.Operation.SAVE_PADDING(b.target.url,i,h[i])}a.paddingData=[parseFloat(c),parseFloat(d),parseFloat(e),parseFloat(f)],a.iv()},i=function(a){var c=b.target.meta.padding;if(!c)return 0;var d=b.ninePaddingConf.frameKey;return c[d]?c[d][a]:0};g.add(aa.line([aa.empty(),aa.text("Left",{"for":"ninePaddingLeft",dragStep:.1,align:"center"}),c=aa.numberInput({id:"ninePaddingLeft",value:i(0)}),aa.text("Right",{"for":"ninePaddingRight",dragStep:.1,align:"center"}),e=aa.numberInput({id:"ninePaddingRight",value:i(2)})])),g.add(aa.line([aa.empty(),aa.text("Top",{"for":"ninePaddingTop",dragStep:.1,align:"center"}),d=aa.numberInput({id:"ninePaddingTop",value:i(1)}),aa.text("Bottom",{"for":"ninePaddingBottom",dragStep:.1,align:"center"}),f=aa.numberInput({id:"ninePaddingBottom",value:i(3)})]));var j;g.add(aa.line([j=aa.button(ga._("Save"),{preferredSize:{width:60,height:18}},{colspan:5,fill:"none",align:"right"})])),j.on("click",function(){h(c.finalValue,d.finalValue,e.finalValue,f.finalValue,!0)}),c.onValueChanged=d.onValueChanged=e.onValueChanged=f.onValueChanged=function(){h(c.finalValue,d.finalValue,e.finalValue,f.finalValue)},a=aa.painter({background:null}),a.paddingData=[i(0),i(1),i(2),i(3)],ga.inspector.previewView.content=a;b.target.json.frames;a.addTopPainter(function(c){var d=b.ninePaddingConf.frame,e=a.width,f=a.height,g=d.w,h=d.h,i=1;(g>e||h>f)&&(i=Math.min(e/g,f/h));var j=g*i,l=h*i,m=function(a){return a*i+(e-j)/2},n=function(a){return a*i+(f-l)/2};c.drawImage(b.image,d.x,d.y,g,h,m(0),n(0),j,l),c.strokeStyle="lime";var o,p,q=!1;p=this.paddingData[0],p>0&&(q=!0,c.beginPath(),c.moveTo(m(p),n(0)),c.lineTo(m(p),n(h)),c.stroke()),p=this.paddingData[1],p>0&&(q=!0,c.beginPath(),c.moveTo(m(0),n(p)),c.lineTo(m(g),n(p)),c.stroke()),p=this.paddingData[2],p>0&&(q=!0,o=g-p,c.beginPath(),c.moveTo(m(o),n(0)),c.lineTo(m(o),n(h)),c.stroke()),p=this.paddingData[3],p>0&&(q=!0,o=h-p,c.beginPath(),c.moveTo(m(0),n(o)),c.lineTo(m(g),n(o)),c.stroke()),q&&(c.strokeStyle="black",h>g?(c.beginPath(),c.moveTo(m(0),n(0)),c.lineTo(m(0),n(h)),c.stroke(),c.beginPath(),c.moveTo(m(g),n(0)),c.lineTo(m(g),n(h)),c.stroke()):g>h&&(c.beginPath(),c.moveTo(m(0),n(0)),c.lineTo(m(g),n(0)),c.stroke(),c.beginPath(),c.moveTo(m(0),n(h)),c.lineTo(m(g),n(h)),c.stroke()));var r="12px Arial";c.font=r;var s=d.w+" * "+d.h,t=k.getTextSize(r,s);t.width+=6;var u=(e-t.width)/2,v=f-16;c.beginPath(),c.rect(u,v,t.width,16),c.fillStyle="rgb(19, 19, 19)",c.fill(),c.beginPath(),k.drawText(c,s,r,"white",u,v,t.width,16,"center")})};var ad=m("qc.editor.JSNodePanel",qc.editor.Panel,function qf(a){var b=this;b.uuid=a.resUUID;var c={name:a._name,fullPath:a._id,uuid:a.resUUID,dependences:a.dependences||[]};qf["super"].constructor.call(b,c),b.treeData=a,b.title=ga._("JavaScript Dependence Management"),b.checkable=!1,b.removable=!1,0===b.target.fullPath.indexOf("Editor")?(b.target.isEditorScript=!0,b._isEntry=!1,b.repaint()):qc.editor.Operation.IS_SCRIPT_ENTRY(b.uuid,function(a){a.operRet===!0&&(b._isEntry=a.isEntry,b.repaint())})});ad.prototype.paint=function(){this._isEntry!==c&&(aa.columnWidths=[70,"60+0.5"],this.drawJSInfo(),this.drawCode())},ad.prototype.drawJSInfo=function(){var a,b,c,d=this,e=d.target,f=e.fullPath;aa.line([aa.text(ga._("Script")),d.label(e.name,f)]),aa.line([aa.text(ga._("Path")),d.label(f,f)]),d.target.isEditorScript||(aa.line([aa.text(ga._("Entry")),a=aa.checkBox()]),a.selected=!!d._isEntry,a.onValueChanged=function(a){qc.editor.Operation.SET_SCRIPT_ENTRY(a?d.uuid:"",function(b){b&&b.operRet===!0&&(d._isEntry=a),d.repaint()})});var g=new $a({removable:!0});g.view._dropView=d,g.addTopPainter(function(a){0===g.dataModel.length&&k.drawText(a,ga._("Drop JavaScript File Here"),"20px serif","rgb(100, 128, 163)",0,0,g.width,g.height,"center")}),g.dataModel.on("dataModelChange",function(a){if("remove"===a.kind){var b=a.data;qc.editor.Operation.REMOVE_DEPENDENCE(d.uuid,b.a("uuid"),d.receiveDependence.bind(d))}}),g.on("clickData",function(a){d.blinkUrl(a.name)}),aa.line([aa.text(ga._("Dependence List"),{},{colspan:2})]),aa.line([aa.comp(g,{},{colspan:2})],120);var h=d.target.dependences;if(h&&h.length)for(c=h.length,b=0;c>b;b++){var i=h[b],j=ga.project.findFileNodeByUUID(i);if(!j)return;var l=new qc.widget.Data;l.name=j._id,l.a("uuid",i),g.dataModel.add(l)}},ad.prototype.drawCode=function(){var a=this.target.fullPath,b=new La;aa.line([aa.text(ga._("Code Preview"),null,{colspan:2})]),aa.line([aa.comp(b,{},{colspan:2})],300),qc.editor.Operation.SOURCE(a,function(a){if(a){var c=a.source;c=c.replace(/</g,"&lt;"),c=c.replace(/>/g,"&gt;"),b.layout.content='<pre class="prettyprint linenums">'+c+"</pre>",U(function(){prettyPrint(null,b.view)})}})},ad.prototype.receiveDependence=function(a){var b=this;if(a&&a.deps){var c=ga.project.findFileNodeByUUID(b.uuid);c&&(c.dependences=a.deps),b.target.dependences=a.deps,b.repaint()}},ad.prototype.blinkUrl=function(a){var b,c={fileTree:a.substring(0,a.lastIndexOf("/")),fileList:a};for(b in c){var d=c[b],e=ga.mainContainer.findViewById(b),f=e.dataModel.getDataById(d);"fileTree"===b&&(e.selectionModel.selection=f),e.makeVisible(f),e.blink(f)}},ad.prototype.label=function(a,b){var c=this,d=aa.label(a,{borderColor:"rgb(221, 221, 221)"});return d.addEventListener("click",function(){c.blinkUrl(b)}),d},ad.prototype.handleCrossDrag=function(a,b,c){if("drop"===b){var d=c.view;if(d instanceof Dd){var e=c.view.draggingData;if(!e){var f=c.view.selection;e=f[0]}if(e&&e instanceof qc.editor.FileNode){var g=e.treeData;if(g&&g.assetType===ga.ASSET_TYPE.ASSET_JS){var h=this;return g.resUUID===h.uuid?void ga.log.trace("自身无法成为自身的依赖。"):void qc.editor.Operation.ADD_DEPENDENCE(h.uuid,g.resUUID,h.receiveDependence.bind(h))}}}}};var bd=m("qc.editor.ReferencePanel",qc.editor.Panel,function rf(a){var b=this;b.nodeObjs=a,rf["super"].constructor.call(b),b.checkable=!1,b.removable=!1,b.title=ga._("Retainers")});bd.prototype.paint=function(){var a=this,b=a.nodeObjs;if(aa.columnWidths=[.1],b.length>0){var c=1;b.forEach(function(b){
var d,e=b.node,f=c++ +".  "+a.getFullPath(e);b.script?f+='<span style="color: rgb(199, 146, 234)">['+b.script["class"]+'<span style="color: rgb(128, 203, 174)">#'+b.property+"</span>]</span>":b.property&&(f+='<span style="color: rgb(128, 203, 174)">#'+b.property+"</span>"),aa.line([d=aa.text(f,{textFont:"13px Arial"})]),d.view.addEventListener("click",function(){for(var a=ga.hierarchy.dataModel.datas,b=0;b<a.length;b++){var c=a[b];if(c.id===e.uuid){ga.hierarchy.makeVisible(c),ga.hierarchy.blink(c);break}}})})}else aa.line([aa.text(ga._("No retainer"),{textFont:"13px Arial"})])},bd.prototype.getFullPath=function(a){for(var b,c=a.name;(b=a.parent)&&b!==ga.game.world;)c=b.name+"/"+c,a=b;return c};var cd=m("qc.editor.ScenePanel",qc.editor.Panel,function sf(a){var b=this,c=a._name;c=c.slice(0,c.lastIndexOf("."));var d={name:c,fullPath:a._id,uuid:a.resUUID};sf["super"].constructor.call(b,d),ga.scenePanel=b,b.title=ga._("Scene Management"),b.checkable=!1,b.removable=!1,b.target=d,b.updateHistory()});ga.e.on(ga.e.SCENE_SAVED,function(a){var b=ga.scenePanel;if(b){var c=ga.inspector.propertyView.children;c&&c.length&&b===c[0]&&b.target&&b.target.name===a&&b.updateHistory()}}),cd.prototype.updateHistory=function(){var a=this,b=a.target.name;delete a.histories,qc.editor.Operation.GET_SCENE_BACKUP_LIST(b,function(b){b.operRet===!0&&(a.histories=(b.list||[]).sort(),a.repaint())})},cd.prototype.paint=function(){if(this.histories){aa.columnWidths=["100+0.08","60+0.5"],aa.titleLine(ga._("Scene History"));var a=ga.sceneList=new qc.editor.InspectorList({});aa.line([aa.comp(a,null,{colspan:2})],500);for(var b,c=this.histories,d=c.length;d--;){var b=c[d],e=new qc.widget.Data;e.fileName=b;var f=b.slice(-10);e.name=f.slice(0,2)+"/"+f.slice(2,4)+", "+f.slice(4,6)+":"+f.slice(6,8)+" "+(parseInt(f.slice(4,6))<12?"AM":"PM"),a.dataModel.add(e)}var g=this;a.view.addEventListener("dblclick",function(b){var c=a.getDataAt(b),d=c.fileName;return ga.config.editor.currScene!==g.target.name?void ga.notification.warn(ga._("Current Scene is not {0}, can not revert.").replace("{0}",g.target.name)):void mb(function(){qc.editor.Operation.REVERT_SCENE_TO_REVISION(g.target.name,d,function(a){return a.operRet!==!0?void ga.notification.warn(ga._("Revert Failed.")):void ga.service.request("SWITCH_SCENE",g.target.name,function(){ga.storage.set("switchScene","1"),ga.config.editor.currScene=g.target.name,ga.scene.reload(),ib(),g.updateHistory()})})})})}};var dd=m("qc.editor.WebFontNodePanel",qc.editor.Panel,function tf(a){var b=this,c={};"string"==typeof a&&ga.project.findByUUID(a)&&(b.uuid=a,b.wfont=ga.project.findByUUID(a),c.name=sb(b.wfont.url).slice(0,-4),c.url=b.wfont._fontUrl.join("\n")),tf["super"].constructor.call(b,c),b.title=ga._("Web Font"),b.checkable=!1,b.removable=!1});dd.prototype.paint=function(){var a=this,b=a.target;aa.columnWidths=["50+0.1","60+0.5"],aa.line(a.wfont?[aa.text(ga._("Font Name")),aa.text(b.name)]:[aa.text(ga._("Font Name")),aa.stringInput({bind:"name"})]),aa.columnWidths=[a.indent,"60+1"];var c,d=aa.titleLine(ga._("Font URLs (One URL per line)"));d.add(aa.line([c=aa.textArea({bind:"url"},{colspan:2})],100));var e;aa.line([e=aa.button(ga._("Save"),{},{colspan:2})],26),e.on("click",function(){a.save()})},dd.prototype.save=function(){var a=this,b=a.target;if(!b.url||!b.url.length)return void ga.notification.error(ga._("Font URLs are invalid"));var c,d,e,f,g=b.url.replace(/\\/g,"/"),h=g.split("\n"),i=[],j=h.length;for(c=0;j>c;c++)d=h[c],d&&i.indexOf(d)<0&&i.push(d);if(!i.length)return void ga.notification.error(ga._("Font URLs are invalid"));if(a.wfont)f=a.wfont.url.slice(0,-4)+".wfont";else{if(e=b.name,!e||!/^(\w)*$/.test(e))return void ga.notification.error(ga._("Name must be digital or letter"));f=ga.fileList.currentDir+"/"+e+".wfont"}qc.editor.Operation.UPLOAD(f,JSON.stringify({url:i}),function(){ga.notification.info(ga._("Web font is saved to: ")+f),b.url!==g&&(b.url=g)})};var ed=m("qc.editor.PluginManagerEditor",qc.editor.Panel,function(a){var b=this;ed["super"].constructor.call(b,a),b.title=ga._("Plugin Manager"),b.checkable=!1,b.removable=!1,b.target=ga.pluginInfo,qc.editor.Operation.QUERY_PLUGIN_INFO(function(a){ga.pluginInfo=a,b.target=ga.pluginInfo,b.repaint()})});ed.prototype.paint=function(){aa.columnWidths=["40+0.08","80+0.5"];var a=this;aa.line([aa.text(ga._("Plugin List"),{},{colspan:2})]);var b=new $a({checkable:!0});aa.line([aa.comp(b,{},{colspan:2})],150);var c=ga.pluginInfo&&ga.pluginInfo.plugins,d=ga.pluginInfo&&ga.pluginInfo.effective;if(c){for(var e in d){var f,g=new qc.widget.Data;g.name=(f=c[e]&&c[e].name)?f:e,g.type=1,g.key=e,b.dataModel.add(g),b.selectionModel.appendSelection(g)}for(var e in c)if(!d[e]){var g=new qc.widget.Data;g.name=c[e].name,g.type=2,g.key=e,b.dataModel.add(g)}}if(b.selectionModel.on("selectionChange",function(c){var e=c.datas;if(1===e.length){var f=e[0];if(1===f.type){if(b.selectionModel.isSelected(f))return;a.invalidatePlugin(f.key),delete d[f.key],a.repaint(),a.savePluginInfo()}else{if(!b.selectionModel.isSelected(f))return;a.validatePlugin(f.key),d[f.key]={},a.repaint(),a.savePluginInfo()}}}),a._currentSelectionKey)for(var h=0;h<b.dataModel.length;h++){var g=b.dataModel.datas[h];if(g.key===a._currentSelectionKey){b.focusData=g;break}}b.on("propertyChange",function(b){"focusData"===b.property&&a._currentSelectionKey!==(b.newValue&&b.newValue.key)&&(a._currentSelectionKey=b.newValue&&b.newValue.key,a.repaint())});do{if(!a._currentSelectionKey)break;var i=c[a._currentSelectionKey];if(!i||!d[a._currentSelectionKey])break;var j=d[a._currentSelectionKey].variable=d[a._currentSelectionKey].variable||{};for(var e in i.variable)j[e]||(j[e]=i.variable["default"]||"");for(var e in j)a.drawPluginVariable(a,j,e,a._currentSelectionKey)}while(!1)},ed.prototype.drawPluginVariable=function(a,b,c,d){var e=this,f=null;aa.columnWidths=[95,20,"30+0.3",20,"30+0.3"],aa.line([aa.text(nc.makePropertyName(c)),f=aa.stringInput({bind:c,bindTarget:b},{colspan:4})]),f.addEventListener("change",function(){e.savePluginInfo();var a=ga.game.getWindow()._pluginVariables_[d]||(ga.game.getWindow()._pluginVariables_[d]={});a[c]=b[c],e.validatePlugin(d),this.gameStart=!1,this.gameEnd&&e.change(function(){this.keyword="test plugins"})})},ed.prototype._findScriptElement=function(a,b){for(var c=a.children.length;c--;){var d=a.children[c];if(d.getAttribute("src")===b)return d}},ed.prototype.removeScript=function(a,b){for(var c=a.children.length;c--;){var d=a.children[c];d.getAttribute("plugin_id")===b&&a.removeChild(d)}},ed.prototype.invalidatePlugin=function(a){{var b=this;ga.pluginInfo&&ga.pluginInfo.effective}qc.editor.Operation.QUERY_PLUGIN_SCRIPT(a,function(c){for(var d=c.editor,e=(c.script,document.getElementsByTagName("head")[0]),f=d.length;f--;){var g=b._findScriptElement(e,d[f]);g&&e.removeChild(g)}var h;ga.workable&&ga.game&&(h=ga.game.getWindow())&&(e=h.document.getElementsByTagName("head")[0],b.removeScript(e,a),h._pluginVariables_&&delete h._pluginVariables_[a])})},ed.prototype.validatePlugin=function(a){var b=this;qc.editor.Operation.QUERY_PLUGIN_SCRIPT(a,function(c){var d=ga.pluginInfo&&ga.pluginInfo.effective,e=(d[a]||(d[a]={}))&&(d[a].variable||(d[a].variable={})),f=c.editor,g=c.script,h=c.external;for(var i in c.variable)e[i]||(e[i]=c.variable[i]["default"]||"");var j=document.getElementsByTagName("head")[0];b.removeScript(j,a);for(var k=f.length;k--;){var l=b._findScriptElement(j,f[k]);l||(l=document.createElement("script"),l.setAttribute("type","text/javascript"),l.setAttribute("src",f[k]),j.appendChild(l))}var m;if(ga.workable&&ga.game&&(m=ga.game.getWindow())){for(j=m.document.getElementsByTagName("head")[0],b.removeScript(j,a),k=g.length;k--;){var l=b._findScriptElement(j,"../"+g[k]);l||(l=m.document.createElement("script"),l.setAttribute("type","text/javascript"),l.setAttribute("src","../"+g[k]),l.setAttribute("plugin_id",a),j.appendChild(l))}for(k=h?h.length:0;k--;){var n=b.formatString(h[k],e),l=b._findScriptElement(j,n);l||(l=m.document.createElement("script"),l.setAttribute("type","text/javascript"),l.setAttribute("src",n),l.setAttribute("plugin_id",a),j.appendChild(l))}var o=m._pluginVariables_||(m._pluginVariables_={});o[a]||(o[a]={})}})},ed.prototype.savePluginInfo=function(){qc.editor.Operation.SAVE_PLUGIN_INFO(ga.pluginInfo.effective)},ed.prototype.formatString=function(a,b){var c=a;for(var d in b){var e=new RegExp("\\{"+d+"\\}","g");c=c.replace(e,b[d])}return c};var fd=m("qc.editor.ProjectSettingPanel",qc.editor.Panel,function uf(a){var b=this;uf["super"].constructor.call(b,a),b.title=ga._("Project Settings"),b.checkable=!1,b.removable=!1});fd.prototype.paint=function(){aa.columnWidths=["100+0.08","60+0.5"];var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p;aa.line([aa.text(ga._("Project Name")),a=aa.stringInput({},{})]),aa.line([aa.text(ga._("Game Name")),c=aa.stringInput({},{})]),aa.line([aa.text(ga._("Company")),d=aa.stringInput({},{})]),aa.line([aa.text(ga._("Identifier")),e=aa.stringInput({},{})]),aa.line([aa.text(ga._("Instance")),f=aa.stringInput({},{})]),aa.line([aa.text(ga._("Version")),g=aa.stringInput({},{})]),i=nc.drawPrefabInput({loading:ga.config.project.loading},ga._("Loading Prefab"),"loading"),aa.columnWidths=["30+0","70+0.08","60+0.5"];var q=aa.titleLine(ga._("Frame Rate"),!1);q.add(aa.line([aa.empty(),aa.text("Mobile"),j=aa.intInput()])),q.add(aa.line([aa.empty(),aa.text("Desktop"),k=aa.intInput()])),aa.columnWidths=["100+0.08","60+0.5"],aa.line([aa.text(ga._("Background Color")),l=aa.colorPicker({"dropDown.colorChooser.alphaEnabled":!1})]),aa.line([aa.text(ga._("Transparent")),o=aa.checkBox({selected:ga.config.project.transparent})]),aa.line([aa.text(ga._("Renderer")),p=aa.dropDownList({items:[{value:"Auto",label:ga._("Auto")},{value:"WebGL",label:"WebGL"},{value:"Canvas",label:"Canvas"}]})]),aa.line([aa.text(ga._("Run in Background")),m=aa.checkBox({selected:ga.config.project.runInBackground})]),aa.line([aa.text(ga._("Antialias")),n=aa.checkBox({selected:ga.config.project.antialias})]),aa.line([aa.text(ga._("Developer Mode")),h=aa.checkBox({selected:ga.config.project.developerMode})]),a.value=ga.config.project.projectName,c.value=ga.config.project.gameName,d.value=ga.config.project.companyName,e.value=ga.config.project.bundleIdentifier,f.value=ga.config.project.gameInstance,p.value=ga.config.project.renderer,g.value=ga.config.project.version,g.maskRe=/[\d\.]/,k.value=ga.config.project.frameRate.desktop,j.value=ga.config.project.frameRate.mobile,l.value=ga.game.stage.backgroundColor;var r;aa.line([r=aa.button(ga._("Apply"),{},{colspan:2})]),r.on("click",function(){ga.config.project.projectName=a.value,ga.config.project.gameName=c.value,ga.config.project.companyName=d.value,ga.config.project.bundleIdentifier=e.value,ga.config.project.gameInstance=f.value,ga.config.project.version=g.value,ga.config.project.loading=i.value,ga.config.project.runInBackground=m.selected,ga.config.project.frameRate={mobile:j.value,desktop:k.value},ga.config.project.antialias=n.selected,ga.config.project.transparent=o.selected,ga.config.project.renderer=p.value,ga.config.project.developerMode=h.selected,"Empty(Prefab)"===ga.config.project.loading&&(ga.config.project.loading="");var b=l.value;ga.config.project.backgroundColor=new qc.Color([b.r,b.g,b.b]).toNumber(),qc.editor.Operation.UPDATE_PROJECT_SETTINGS(ga.config.project),ib(),jb(),ga.game.time.applyFrameRate(ga.config.project.frameRate),ga.game.runInBackground=ga.config.project.runInBackground,ga.game.transparent=ga.config.project.transparent,ga.notification.info(ga._("Operation completed"))});var s=aa.titleLine(ga._("Scene List")),t=ga.sceneList=new qc.editor.InspectorList({checkable:!0,draggable:!0});s.add(aa.line([aa.comp(t,null,{colspan:2})],200));for(var u=[],v=ga.project.findByType(ga.ASSET_TYPE.ASSET_SCENE,"name"),w=0;w<v.length;w++)ga.fileTree.dataModel.getDataById(v[w])&&u.push(sb(v[w].substr(0,v[w].length-4)));var x=b.keys(ga.config.scene.scene),y=[];for(var w in x){var z=x[w];if(!(u.indexOf(z)<0||"scene_editor"===z)){var A=new qc.widget.Data;A.name=z,y.push(A),t.dataModel.add(A)}}t.selectionModel.selection=y;for(var w in u){var z=u[w];if(!(x.indexOf(z)>=0||"scene_editor"===z)){var A=new qc.widget.Data;A.name=z,t.dataModel.add(A)}}t.selectionModel.on("selectionChange",function(){var a=t.dataModel.roots,b=[];for(var c in a)t.isSelected(a[c])&&b.push(a[c].name);qc.editor.Operation.UPDATE_SCENE_SETTINGS(b)}),t.dataModel.on("hierarchyChange",function(){var a=t.dataModel.roots,b=[];for(var c in a)t.isSelected(a[c])&&b.push(a[c].name);qc.editor.Operation.UPDATE_SCENE_SETTINGS(b)})};var gd=m("qc.editor.PreferencePanel",qc.editor.Panel,function vf(a){var b=this;vf["super"].constructor.call(b,a),b.title=ga._("Preference"),b.checkable=!1,b.removable=!1,b.target={},qc.editor.Operation.QUERY_EDITORSERVICE_SETTING("stateHistorySize",function(a){a.operRet===!0&&(b.stateHistorySize=a.stateHistorySize,b.repaint())})});gd.prototype.paint=function(){if(this.stateHistorySize!==c){aa.columnWidths=[30,"90+0.1","60+0.5"];var a,b,d,e,f,g=aa.titleLine(ga._("Collapse"));g.add(aa.line([aa.empty(),aa.text("Text"),a=aa.checkBox({selected:ga.preference.query("collapse.text")})])),g.add(aa.line([aa.empty(),aa.text("Sprite"),b=aa.checkBox({selected:ga.preference.query("collapse.sprite")})])),g.add(aa.line([aa.empty(),aa.text("Button"),e=aa.checkBox({selected:ga.preference.query("collapse.button")})])),g.add(aa.line([aa.empty(),aa.text("ScrollView"),f=aa.checkBox({selected:ga.preference.query("collapse.scrollView")})])),g.add(aa.line([aa.empty(),aa.text("Tween"),d=aa.checkBox({selected:ga.preference.query("collapse.tween")})]));var h,i,j,k=parseInt(this.stateHistorySize);g=aa.titleLine(ga._("State History Size")),g.add(aa.line([aa.empty(),aa.text("Size"),i=aa.numberInput({value:k})])),g=aa.titleLine(ga._("Save Scene Interval")),g.add(aa.line([aa.empty(),aa.text("Interval(second)"),j=aa.numberInput({value:ga.preference.query("saveSceneInterval")||10})]));var l,m=[ga._("Double Click"),ga._("Shift + Double Click")],n=ga.preference.query("JSEditor")||m[1];g=aa.titleLine(ga._("Use System Editor for JavaScript")),g.add(aa.line([aa.empty(),aa.text("Open Mode"),l=aa.dropDownList({items:m})])),l.value=n;var o;aa.line([o=aa.button(ga._("Apply"),{},{colspan:3})]),o.on("click",function(){ga.preference.set("collapse.text",a.selected),ga.preference.set("collapse.sprite",b.selected),ga.preference.set("collapse.button",e.selected),ga.preference.set("collapse.tween",d.selected),ga.preference.set("collapse.scrollView",f.selected),ga.preference.set("JSEditor",l.value),ga.preference.set("saveSceneInterval",parseInt(j.value)),ga.sceneManager.resetTimer(parseInt(j.value)),h=parseInt(i.value),console.log(h),h!==k?qc.editor.Operation.SAVE_EDITORSERVICE_SETTING("stateHistorySize",h,function(a){a.operRet===!0&&(i.value=a.stateHistorySize),ga.notification.info(ga._("Operation completed"))}):ga.notification.info(ga._("Operation completed"))})}};var hd=m("qc.editor.CheckForUpdatesEditor",qc.editor.Panel,function(a){var b=this,c=qc.editor.version;hd["super"].constructor.call(b,a),b.title=ga._("Check for Updates"),b.checkable=!1,b.removable=!1,b.target=c.latestVersion,b.queryLatestVersion(!0)});hd.prototype.queryLatestVersion=function(a){var b=this;qc.editor.Operation.CHECK_FOR_UPDATES(a,function(a){b.target=a,b.repaint()})},hd.prototype.paint=function(){var a=qc.editor.version;aa.columnWidths=["80+0.08"];var c=this;if(aa.line([aa.text(ga._("Version Info"))]),aa.line([aa.text(ga._("Local Editor Version: ")+qc.editor.VERSION)]),aa.line([aa.text(ga._("Latest Editor Version: ")+(c.target&&c.target.editor))]),a.versionCompare(qc.editor.VERSION,c.target&&c.target.editor)<0){var d;aa.line([d=aa.button(ga._("Update"))]),d.on("click",function(){qc.editor.version.updateVersion()});var e=ga.storage.get("language"),f=c.target.description&&b.keys(c.target.description)&&c.target.description[e];if(!f)for(var g in c.target.description)if(f=c.target.description[g])break;aa.columnWidths=[c.indent,"60+1"];var h=aa.titleLine(ga._("Version Description: ")),i=new Ia;h.add(aa.line([aa.empty(),aa.comp(i)],300)),f&&(f=f.replace("\\n","\n")),i.value=f,i.readonly=!0}else aa.line([aa.text(ga._("You are using the latest version."),{textColor:"rgb(0,255,0)"})])};var id=m("qc.editor.DomPanel",qc.editor.Panel,function wf(a){var b=this;wf["super"].constructor.call(b,a),b.title=a["class"],b.checkable=!1,b.removable=!1});id.prototype.paint=function(){var a=this,b=this.target;aa.columnWidths=["90+0.1","60+0.5"],aa.line([aa.text("Pos"),aa.dropDownList({bind:"pos",items:[{label:"BACK",value:0},{label:"FRONT",value:1}]})]),aa.columnWidths=[30,"90+0.1","60+1"];var c,d=aa.titleLine("InnerHTML");d.add(aa.line([aa.empty(),aa.text("Serializable"),c=aa.checkBox({bind:"serializable"})])),d.add(aa.line([aa.empty(),aa.textArea({bind:"innerHTML",disabled:!b.serializable},{colspan:2})],100));var e=a.target.serializable;c.onValueChanged=function(b){b!==e&&a.repaint()},d.add(aa.line([aa.empty(),aa.text("Overflow"),aa.dropDownList({bind:"overflow",items:["auto","visible","hidden","scroll"]})])),d.add(aa.line([aa.empty(),aa.text("ZIndex"),aa.intInput({bind:"zIndex"})])),d.add(aa.line([aa.empty(),aa.text("ClassName"),aa.stringInput({bind:"className"})]))};var jd=m("qc.editor.GraphicsPanel",qc.editor.Panel,function xf(a){var b=this;xf["super"].constructor.call(b,a),b.title=a["class"],b.checkable=!1,b.removable=!1});jd.prototype.paint=function(){this.target;aa.columnWidths=["90+0.1","60+0.5"]};var kd=m("qc.editor.ImportResourceEditor",qc.editor.Panel,function(){var a=this;kd["super"].constructor.call(a),a.title=ga._("Import Assets"),a.checkable=!1,a.removable=!1});kd.prototype._getDataResolvedName=function(a){var b=a.resolvedName;if(b!==c)return b;var d=a.name;if(d.indexOf(".json")>=0){var e=rb(a.fileContent);if(e)try{var f=JSON.parse(e);f.armature&&f.frameRate&&(b=d.replace(".json",".ani"))}catch(g){console.error("Resource Data parse error：",g),Gb(g.message)}}return b===c&&(b=d),a.resolvedName=b,b},kd.prototype._getDataAnimationType=function(a){var b=a.animationType;if(b!==c)return b;var d=rb(a.fileContent);if(d)try{var e=JSON.parse(d);b=e&&e.animations?1:e&&e.samples?3:2}catch(f){console.error("Resource Data parse error：",f),Gb(f.message)}return b===c&&(b=2),a.animationType=b,b},kd.prototype.getDefaultPath=function(){var a=ga.fileTree.dataModel._roots[0];return a.name+"/Assets"},kd.prototype.paint=function(){var a=this;aa.columnWidths=["80+0.08","50+0.5",26];var b;aa.line([aa.text(ga._("Asset Name")),b=aa.stringInput({},{colspan:2})]);var c;aa.line([aa.text(ga._("Asset Path")),a._txtPath=aa.stringInput(),c=aa.button("...")]),a._txtPath.value=a.getDefaultPath(),c.on("click",a.pickFolder.bind(a)),aa.line([aa.text(ga._("Asset Type")),a._txtResourceType=aa.text("",{},{colspan:2})]),aa.line([aa.text(ga._("List of Files"),{},{colspan:3})]);var d=new rd;d.dataModel.on("dataModelChange",function(c){if("add"===c.kind&&!b.value){var e=c.data;b.value=e.name.substring(0,e.name.lastIndexOf("."))}d.redraw();var f=[];d.dataModel.forEach(function(b){f.push(a._getDataResolvedName(b))}),qc.editor.Operation.ASSET_TYPE(f,function(b){var c,e=b.type,g=b.source;if(3===e)switch(g.length){case 2:c=ga._("Atlas");break;case 3:d.dataModel.forEach(function(b){var d=a._getDataResolvedName(b);if(!(d.indexOf(".ani")<0)){var e=a._getDataAnimationType(b);switch(e){case 2:c=ga._("DragonBone");break;case 3:c=ga._("DragonBone(Sampled)");break;default:c=ga._("Frame Animation")}}});break;default:c=ga._("Image")}else c=5===e?ga._("BitmapFont"):6===e?ga._("Sound"):7===e?ga._("Excel"):8===e?ga._("WebFont"):0===f.length?"":ga._("Invalid asset");a._txtResourceType.text=c;var h=[];if(g&&g.length>0)for(var i=0;i<g.length;i++)for(var j=0;j<d.dataModel.length;j++){var k=d.dataModel.datas[j],l=a._getDataResolvedName(k);if(h.indexOf(k)<0&&l.indexOf(g[i])===l.length-g[i].length){h.push(k);break}}d.dataModel.forEach(function(a){h.indexOf(a)>=0?a.s("useless",!1):a.s("useless",!0)})})}),aa.line([aa.comp(d,{},{colspan:3})],160);var e;aa.line([e=aa.button(ga._("Import"),{},{colspan:3})],26),e.on("click",function(){var c=b.value;if(!c)return void ga.notification.error(ga._("The asset name is invalid"));var e=a._txtPath.value;if(!e)return void ga.notification.error(ga._("Asset path is empty"));var f=ga.fileTree.dataModel._roots[0];0===e.indexOf(f.name+"/")?e=e.replace(f.name+"/",""):0===e.indexOf(f.name)&&(e=e.replace(f.name,""));var g=[];if(d.dataModel.forEach(function(a){a.s("useless")||g.push(a)}),g.length<=0)return void ga.notification.error(ga._("Files is empty"));var h={};g.forEach(function(b){h[a._getDataResolvedName(b)]=b.fileContent}),qc.editor.Operation.IMPORT_RESOURCE(e,c,h,function(c){c&&c.operRet===!0?(ga.notification.info(ga._("Import is done")),a._txtPath.value=a.getDefaultPath(),b.value="",d.dataModel.clear()):ga.notification.error(ga._("Import failed:")+(c&&c.reason)?"，"+c.reason:"")})})},kd.prototype.pickFolder=function(){var a=this,b=new qc.widget.Tree,c=ga.fileTree,d=new qc.widget.graph.Serializer(c.dataModel);d.isSerializable=function(a){return c.isVisible(a)?!0:!1};var e=d.serialize(),f=new qc.widget.graph.Serializer(b.dataModel);f.deserialize(e),b.expand(b.dataModel.roots[0]),b.onDataDoubleClick=function(c){g.hide();var d=b.dataModel.roots[0];a._txtPath.value=c!==d?d.name+"/"+c.id:d.name};var g=new qc.editor.Dialog;g.modal=!0,g.contentPadding=[2,2,2,2],g.title=ga._("Double click to select the folder"),g.content=b,g.width=300,g.height=350,g.show()};var ld=m("qc.editor.FrameAnimationEditor",qc.editor.Panel,function(a){a=a||{};var b,c=this;a.uuid&&(b=c.findAtlasByUUID(a.uuid)),c.frameAnimationEditor=!0,c.previousPanel=a.previousPanel,ld["super"].constructor.call(c,b),c.title=ga._("Frame Animation Editor"),c.checkable=!1,c.removable=!1});ld.prototype.verifyAtlas=function(a){return a?a.meta&&a.meta.type===ga.ASSET_TYPE.ASSET_ATLAS?2===a.meta.animationType?ga._("DragonBone cannot be modified."):a.json&&a.json.frames?!0:ga._("File must be texture atlas"):ga._("File must be texture atlas"):void 0},ld.prototype.findAtlasByUUID=function(a){var b=this,c=ga.project.findByUUID(a);return b.verifyAtlas(c)===!0?c:void 0},ld.prototype.trySetAtlasByUUID=function(a){var b=this,c=b.findAtlasByUUID(a);c&&(b.target=b.findAtlasByUUID(a),b.repaint())},ld.prototype.paint=function(){aa.columnWidths=["90+0.08","50+0.5"];var a=this;if(delete a.toPlayFrames,delete a.toPlayRate,delete a.frameList,delete a._valueChanged,!a.target){var c,d=200;return aa.line([c=aa.painter({borderWidth:1},{fill:"fill",colspan:2})],d),a._handleAtlasCrossDrop(c),void c.addTopPainter(function(a){var b="20px Arial",d="rgb(100, 128, 163)",e=c.width,f=c.height;k.drawText(a,ga._("Drop Atlas File Here"),b,d,0,0,e,f,"center")})}if(a.drawAnimationDropDownList(),a.target.animation&&b.keys(a.target.animation.data.animations).length)a.drawAnimationInfo();else{var e,f;aa.line([f=aa.button(ga._(" Back "),null,{cellPadding:[0,5,0,5]}),e=aa.button(ga._(" New "),null,{cellPadding:[0,0,0,0]})]),a.previousPanel?f.on("click",function(){ga.inspector.propertyView.inspect(null,"atlas",[a.target.uuid,null])}):f.on("click",function(){ga.inspector.propertyView.inspect(null,"frameAnimation")}),e.on("click",a.handleNewButtonClick.bind(a))}U(function(){a.drawPreview()})},ld.prototype.drawAnimationDropDownList=function(){var a,c=this,d=c.target,e=d.animation?b.keys(d.animation.data.animations):[];aa.line([aa.text(ga._("Animation")),a=aa.dropDownList({items:e})]),aa.line([aa.divider(null,{colspan:2})]);var f=c.currentAnimation;a.value=e.indexOf(f)>=0?f:e[0],c.currentAnimation=a.value,a.onValueChanged=function(a){c.currentAnimation=a,c.repaint()}},ld.prototype._handleAtlasCrossDrop=function(a){var b=this;a.view._dropView=a,a.handleCrossDrag=function(a,c,d){if("drop"===c){var e=b._getDragTarget(d);!e.treeData&&e.master&&(e=e.master),e.treeData&&b.trySetAtlasByUUID(e.treeData.resUUID)}}},ld.prototype._getDragTarget=function(a){var b=a.view;if(b instanceof Dd){var c=a.view.draggingData;if(c&&c instanceof Cd)return c}},ld.prototype.handleNewButtonClick=function(){var a,c=this,d=c.target,e=0,f=d.animation?b.keys(d.animation.data.animations):[];do a="newAnimation"+(1===++e?"":e);while(f.indexOf(a)>=0);d.animation||(d.animation={data:{animations:{}}}),d.animation.data.animations[a]={frames:[],rate:10},c.currentAnimation=a,qc.editor.Operation.UPLOAD(d.url.slice(0,-4)+".ani",JSON.stringify(d.animation.data)),c.repaint()},ld.prototype.drawAnimationInfo=function(){var a,b,c,d,e=this,f=e.target,g=e.currentAnimation,h=f.animation?f.animation.data.animations[g]:{};aa.line([aa.text("Name"),a=aa.stringInput()]),a.value=g,a.on("propertyChange",function(a){"value"===a.property&&(e._valueChanged=!0)}),aa.line([aa.text("Rate"),b=aa.intInput()]),h&&null!=h.rate&&(b.value=h.rate),e.toPlayRate=b.value,b.onValueChanged=function(a){e._valueChanged=!0,e.toPlayRate=a},aa.line([aa.text("Loop"),c=aa.checkBox()]),h&&null!=h.loop&&(c.selected=!!h.loop),c.onValueChanged=function(){e._valueChanged=!0},aa.line([aa.text("Frames",null,{colspan:2})]),d=h&&h.frames?h.frames.slice(0):[],e.toPlayFrames=d;var i=e.frameList=new od;i.enableToolTip(),i.handleCrossDrag=e.handleFrameListCrossDrag.bind(e);for(var j=f.json.frames,k=0,l=d.length;l>k;k++){var m=new md;m.image=f.img,m.name=d[k];var n=j[d[k]].frame;m.toolTip=m.name,m.a("clipX",n.x),m.a("clipY",n.y),m.a("clipWidth",n.w),m.a("clipHeight",n.h);var o=f.url;m.a("associatedViewAndData",{fileTree:o.substring(0,o.lastIndexOf("/")),fileList:[o,m.name]}),i.dataModel.add(m)}aa.line([aa.comp(i,null,{colspan:2})],160),i.dataModel.on("dataModelChange",function(){e._valueChanged=!0;var a=[];i.dataModel.forEach(function(b){a.push(b.name)}),e.toPlayFrames=a,i.redraw()});var p=new qc.widget.Container;p.layout=new qc.widget.layout.HBoxLayout(p),p.layout.align="right";var q=new qc.editor.InspectorButton({text:ga._(" New ")}),r=new qc.editor.InspectorButton({text:ga._(" Save ")}),s=new qc.editor.InspectorButton({text:ga._(" Delete ")}),t=new qc.editor.InspectorButton({text:ga._(" Back ")});p.setItems([t,q,r,s]),e.previousPanel?t.on("click",function(){ga.inspector.propertyView.inspect(null,"atlas",[f.uuid,null])}):t.on("click",function(){ga.inspector.propertyView.inspect(null,"frameAnimation")}),aa.line([aa.comp(p,null,{colspan:2})],30),q.on("click",e.handleNewButtonClick.bind(e)),r.on("click",function(){var d=[];if(i.dataModel.forEach(function(a){d.push(a.name)}),d.length<=0)return void ga.notification.error(ga._("Animation is empty"));if(!a.value.length)return void ga.notification.error(ga._("Animation's name is invalid"));if(!f.animation)return void ga.notification.error(ga._("Please create an animation"));var h=a.value;h!==g&&delete f.animation.data.animations[g],f.animation.data.animations[h]={frames:d,rate:b.value,loop:c.selected},e.currentAnimation=h,qc.editor.Operation.UPLOAD(f.url.slice(0,-4)+".ani",JSON.stringify(f.animation.data)),e.repaint()}),s.on("click",function(){f.animation&&f.animation.data.animations[g]&&(delete f.animation.data.animations[e.currentAnimation],qc.editor.Operation.UPLOAD(f.url.slice(0,-4)+".ani",JSON.stringify(f.animation.data)),e.repaint())})},ld.prototype.handleFrameListCrossDrag=function(a,b,c){var d,e=this,f=e.frameList,g=e._getDragTarget(c);d=ga.project.findByUUID(g.master?g.master.treeData.resUUID:g.treeData.resUUID);var h=e.verifyAtlas(d);if(h){if(k.isString(h))return void ga.notification.error(h);if(d.uuid===e.target.uuid&&c.view===ga.fileList){var i=f._focusData,j=f._focusType;if("exit"===b||"cancel"===b)return void(i&&(f._focusData=null,f._focusType=null,f.redraw()));var l=f.lp(a),m=f.getDataAt(l),n=null,o=f.dataModel,p=f.dataModel.datas,q=p[p.length-1],r=q?f.getDataUI(q).bounds:null;if(q){if(l.y>r.y+r.height||l.y>=r.y&&l.x>r.x+r.width)m=q,n=1;else if(m){var s=m.rect;n=l.x-s.x<=4?-1:0}}else m=1,n=1;if("enter"===b||"over"===b)f.autoScroll(a),(i!==m||j!=n)&&(f._focusData=m,f._focusType=n,f.redraw());else if("drop"===b){if(g&&m){var t,u;if(0===n?(t=m,m.name=g.name):-1===n?(t=new md,u=o.datas.indexOf(m)):1===n&&(t=new md,u=o.datas.indexOf(m)+1),t){t.image=d.img,t.name=g.name,t.a("clipX",g.a("clipX")),t.a("clipY",g.a("clipY")),t.a("clipWidth",g.a("clipWidth")),t.a("clipHeight",g.a("clipHeight")),t.toolTip=t.name;var v=d.url;t.a("associatedViewAndData",{fileTree:v.substring(0,v.lastIndexOf("/")),fileList:[v,t.name]}),o.contains(t)||t.addToDataModel(o,u)}}f._focusData&&(f._focusData=null,f._focusType=null,f.redraw())}}}},ld.prototype.drawPreview=function(){var a=this,b=a.previewPainter=aa.painter({background:null});ga.inspector.previewView.content=b;var c,d=a.target,e=0,f=function(){var d=(new Date).getTime(),g=1;if(c){var h=a.toPlayRate||1,i=1e3/h,j=d-(c+i);0>j?g=0:(j>=i&&(g=Math.floor(j/i),j-=g*i,g+=1),c=d-j)}else c=d;g&&(e+=g,a.toPlayFrames&&a.toPlayFrames.length>0&&(b.iv(),b.validate())),b.isInDOM()&&U(f)};f();var g=d.json.frames;b.addTopPainter(function(c){var f=a.toPlayFrames||[],h=f[e%f.length];if(g[h]){var i=g[h].frame,j=b.width,k=b.height,l=i.w,m=i.h,n=1;(l>j||m>k)&&(n=Math.min(j/l,k/m));var o=l*n,p=m*n,q=Math.round((j-o)/2),r=Math.round((k-p)/2);c.drawImage(d.img,i.x,i.y,i.w,i.h,q,r,o,p)}})};var md=m("qc.editor.FrameNode",qc.editor.ItemNode,function yf(a){var b=this;yf["super"].constructor.call(b,a)});md.prototype.addToDataModel=function(a,b){var c=this,d=c.uuid;if(a._dataMap[d])throw"Data already in this DataModel";null!=c.id&&(a._idMap[c.id]=c),a._dataMap[d]=c,a._datas.splice(b,0,c),c._setDataModel(a),a.onAdd(c),a.emit("dataModelChange",{kind:"add",data:c})},md.prototype.getImageComps=function(){var a=this,b=md["super"].getImageComps.call(a);return b.push({type:"circle",rect:{func:function(a){return[a.width-13,1,12,12]}},borderColor:"rgb(222, 70, 67)",background:"rgb(252, 97, 93)",borderWidth:1,visible:{func:function(a,b){return b._hoverData===a?!0:!1}}}),b.push({type:"shape",points:{func:function(a){for(var b=[2,2,8,8,2,8,8,2],c=0;c<b.length;c++)b[c]+=c%2===0?a.width-12:2;return b}},background:null,segments:[1,2,1,2],borderColor:"rgba(0, 0, 0, 0.6)",borderWidth:1,visible:{func:function(a,b){return b._hoverData===a?!0:!1}}}),b};var nd=m("qc.editor.FrameListInteractor",qc.widget.graph.Interactor,function(a){this.frameList=a,nd["super"].constructor.call(this,a)});nd.prototype.clear=function(){this._clientPoint=null},nd.prototype.handle_mousedown=function(a){this.handle_touchstart(a)},nd.prototype.handle_mouseup=function(a){this.handle_touchend(a)},nd.prototype.handle_touchstart=function(a){var b=this.frameList;if(this.clear(a),!b.isCloseToVScrollBar(a)){var c=b.getDataAt(a);if(this._clientPoint=B(a),!c&&b.clearSelectionOnBackgroundClicked&&b.selectionModel.clearSelection(),c){var d=c.rect,e=b.lp(a),f={x:d.x+d.width-13,y:d.y+1,width:12,height:12};v(f,e)||zb(c.a("associatedViewAndData"))}}},nd.prototype.handle_mouseleave=function(){var a=this.frameList,b=a._hoverData;a._hoverData=null,b&&a.invalidateData(b)},nd.prototype.handle_mousemove=function(a){var b=this.frameList,c=b._hoverData;if(ga.dragAndDrop.isDragging())b._hoverData=null,c&&b.invalidateData(c);else{var d=b.getDataAt(a);c!=d&&(b._hoverData=d,d&&b.invalidateData(d),c&&b.invalidateData(c))}},nd.prototype.handle_touchend=function(a){var b=this._clientPoint;if(b){var c=B(a);if(k.getDistance(c,b)<2){var d=this.frameList,e=d.getDataAt(a);if(e){var f=e.rect,g=d.lp(a),h={x:f.x+f.width-13,y:f.y+1,width:12,height:12};v(h,g)&&d.dataModel.remove(e)}}}this.clear(a)},nd.prototype.handle_keydown=function(a){var b=this.frameList;if(J(a)||K(a)||H(a)||I(a)){var c=b.dataModel.datas,d=b.selectionModel.lastData;if(!c.length)return;if(d){var e=c.indexOf(d);e>=0&&(J(a)||H(a)?0!==e&&(d=c[e-1],b.selection=d):e!==c.length-1&&(d=c[e+1],b.selection=d))}else b.selection=c[0]}};var od=m("qc.editor.FrameList",na,function zf(){var a=this;zf["super"].constructor.call(a),a.pannable=!1,a.clearSelectionOnBackgroundClicked=!0,a.interactors=[new qc.widget.graph.ScrollBarInteractor(a),new qc.widget.graph.SelectInteractor(a),new nd(a),new qc.widget.graph.BasicInteractor(a)],a.addBottomPainter(function(b){
var c=a.clientWidth,d=a.clientHeight;b.beginPath(),b.fillStyle=a._background,b.rect(0,-a.translateY,c,d),b.fill()}),a.addTopPainter(function(b){if(0===a.dataModel.length){var c="20px serif",d="rgb(100, 128, 163)",e=a.width,f=a.height;k.drawText(b,"Drop Atlas Frame",c,d,0,0,e,f-30,"center"),k.drawText(b,"from FileList to here",c,d,0,0,e,f+30,"center")}var g=a._focusData,h=a._focusType;if(g)if(1===g)b.beginPath(),b.fillStyle="#507aea",b.rect(1,2,2,a.itemHeight),b.fill();else{var i=g.rect;b.beginPath(),0===h?(b.strokeStyle="#507aea",b.lineWidth=2,b.rect(i.x+2,i.y+2,i.width-4,i.height-4),b.stroke()):-1===h?(b.fillStyle="#507aea",b.rect(i.x-1,i.y,2,i.height),b.fill()):(b.fillStyle="#507aea",b.rect(i.x+i.width+1,i.y,2,i.height),b.fill())}}),a.view._dropView=a});od.prototype._itemGap=2,b.defineProperties(od.prototype,{background:{get:function(){return this._background},set:function(a){this.setPropertyValue("background",a)}},borderColor:{get:function(){return this._borderColor},set:function(a){this.setPropertyValue("borderColor",a)}}}),od.prototype.validateImpl=function(){var a=this,b=a.borderColor,c="1px solid "+b;a.view.style.border=c,od["super"].validateImpl.call(a)},od.prototype.calculateClientWidth=function(){var a=this.width;return a-2},od.prototype.calculateClientHeight=function(){var a=this.height;return a-2};var pd=m("qc.editor.ResourceNode",qc.editor.ItemNode,function Af(a){var b=this;Af["super"].constructor.call(b,a)});pd.prototype.getImageComps=function(){var a=this,b=pd["super"].getImageComps.call(a);return b.push({type:"border",rect:[17,1,1],relative:!0,borderColor:"rgb(222, 70, 67)",borderWidth:2,visible:{func:function(a){return a.s("useless")}}}),b.push({type:"circle",rect:{func:function(a){return[a.width-13,1,12,12]}},borderColor:"rgb(222, 70, 67)",background:"rgb(252, 97, 93)",borderWidth:1,visible:{func:function(a,b){return b._hoverData===a?!0:!1}}}),b.push({type:"shape",points:{func:function(a){for(var b=[2,2,8,8,2,8,8,2],c=0;c<b.length;c++)b[c]+=c%2===0?a.width-12:2;return b}},background:null,segments:[1,2,1,2],borderColor:"rgba(0, 0, 0, 0.6)",borderWidth:1,visible:{func:function(a,b){return b._hoverData===a?!0:!1}}}),b};var qd=m("qc.editor.ResourceListInteractor",qc.widget.graph.Interactor,function(a){this.resourceList=a,qd["super"].constructor.call(this,a)});qd.prototype.clear=function(){this._clientPoint=null},qd.prototype.handle_mousedown=function(a){this.handle_touchstart(a)},qd.prototype.handle_mouseup=function(a){this.handle_touchend(a)},qd.prototype.handle_touchstart=function(a){var b=this.resourceList;if(this.clear(a),!b.isCloseToVScrollBar(a)){var c=b.getDataAt(a);this._clientPoint=B(a),!c&&b.clearSelectionOnBackgroundClicked&&b.selectionModel.clearSelection()}},qd.prototype.handle_mouseleave=function(){var a=this.resourceList,b=a._hoverData;a._hoverData=null,b&&a.invalidateData(b)},qd.prototype.handle_mousemove=function(a){var b=this.resourceList,c=b._hoverData,d=b.getDataAt(a);c!=d&&(b._hoverData=d,d&&b.invalidateData(d),c&&b.invalidateData(c))},qd.prototype.handle_touchend=function(a){var b=this._clientPoint;if(b){var c=B(a);if(k.getDistance(c,b)<2){var d=this.resourceList,e=d.getDataAt(a);if(e){var f=e.rect,g=d.lp(a),h={x:f.x+f.width-13,y:f.y+1,width:12,height:12};v(h,g)?d.dataModel.remove(e):d.selectionModel.selection=e}}}this.clear(a)};var rd=m("qc.editor.ResourceList",na,function Bf(){var a=this;Bf["super"].constructor.call(a),a.pannable=!1,a.clearSelectionOnBackgroundClicked=!0,a.interactors=[new qc.widget.graph.ScrollBarInteractor(a),new qd(a),new qc.widget.graph.BasicInteractor(a)],a.addBottomPainter(function(b){var c=a.clientWidth,d=a.clientHeight;b.beginPath(),b.fillStyle=a._background,b.rect(0,-a.translateY,c,d),b.fill()}),a.addTopPainter(function(b){if(0===a.dataModel.length){var c="20px serif",d="rgb(100, 128, 163)",e=a.width,f=a.height;k.drawText(b,ga._("Drop files here"),c,d,0,0,e,f-10,"center")}}),a._initNativeDND(),a.enableToolTip()});rd.prototype._itemGap=2,rd.prototype._itemWidth=60,rd.prototype._itemHeight=60,b.defineProperties(rd.prototype,{background:{get:function(){return this._background},set:function(a){this.setPropertyValue("background",a)}},borderColor:{get:function(){return this._borderColor},set:function(a){this.setPropertyValue("borderColor",a)}}}),rd.prototype._initNativeDND=function(){function a(a){f.borderColor="#ebd541",a.preventDefault(),a.stopPropagation()}function b(a){f.borderColor="rgb(32, 32, 32)",a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(a){f.borderColor="rgb(32, 32, 32)",a.preventDefault(),a.stopPropagation();for(var b=a.dataTransfer.files,c=b.length,d=0;c>d;d++){var g=b[d],h=new FileReader;h.onload=e,h.file=g,h.readAsArrayBuffer(g)}}function e(a){var b=a.target,c=b.file,d=b.result,e=c.name,g=new pd;if(g.name=e,g.fileContent=d,g.toolTip=e,0===c.type.indexOf("image/")){var h=document.createElement("img");h.onload=function(){g.image=h},h.src="data:"+c.type+";base64,"+f.arrayBuffer2Base64(d)}else g.image=e.indexOf(".json")===e.length-5?"JsonIcon":"UnknowIcon";f.dataModel.add(g)}var f=this,g=this._interactionDiv;g.addEventListener("dragenter",a,!1),g.addEventListener("dragleave",b,!1),g.addEventListener("dragover",c,!1),g.addEventListener("drop",d,!1)},rd.prototype.arrayBuffer2Base64=function(b){for(var c="",d=new Uint8Array(b),e=d.byteLength,f=0;e>f;f++)c+=String.fromCharCode(d[f]);return a.btoa(c)},rd.prototype.validateImpl=function(){var a=this,b=a.borderColor,c="1px solid "+b;a.view.style.border=c,rd["super"].validateImpl.call(a)},rd.prototype.calculateClientWidth=function(){var a=this.width;return a-2},rd.prototype.calculateClientHeight=function(){var a=this.height;return a-2};var sd=m("qc.editor.PropertyView",qc.widget.Container,function Cf(a){var b=this;Cf["super"].constructor.call(b,a),b.layout=new qc.widget.layout.VBoxLayout(b),b.layout.padding=[7,0,0,0],b.layout.gap=7,new ud(b)},{inspectPreferenceImpl:function(){var a=this;a.clear();var b=a.getPanelInstance(gd);a.setItems([b])},inspectSettingImpl:function(){var a=this;a.clear();var b=a.getPanelInstance(fd);a.setItems([b])},inspectFrameAnimationImpl:function(a){var b=this;b.clear();var c=new ld(a);b.setItems([c])},inspectAtlasImpl:function(a){var b=this;b.clear();var c=new qc.editor.AtlasNodePanel(a[0],a[1]);b.setItems([c])},inspectWebFontImpl:function(a){var b=this;b.clear();var c=new qc.editor.WebFontNodePanel(a);b.setItems([c])},inspectPluginManagerImpl:function(){var a=this;a.clear();var b=new ed;a.setItems([b])},inspectImportResourceImpl:function(){var a=this;a.clear();var b=new kd;a.setItems([b])},inspectJsImpl:function(a){var b=this;b.clear();var c=new qc.editor.JSNodePanel(a);b.setItems([c])},inspectSceneImpl:function(a){var b=this;b.clear();var c=new qc.editor.ScenePanel(a);b.setItems([c])},inspectCheckForUpdatesImpl:function(){var a=this;a.clear();var b=new hd;a.setItems([b])},inspectPanelImpl:function(a,b){var c=this;c.clear();var d=new qc.editor[a](b);c.setItems([d])},inspectImpl:function(a){var b=this;if(b.clear(),a){b.target=a;var c=[],d=b.getPanelInstance(qc.editor.NodePanel,a);c.push(d);var e=b.getPanelInstance(qc.editor.RectTransformPanel,a);c.push(e);var f=ga.inspector._nodesMap;for(var g in f){var h=f[g][0],i=f[g][1];if(a instanceof h){if(h===qc.ProgressBar&&a instanceof qc.Slider)continue;var j=b.getPanelInstance(i,a);c.push(j)}}var k=nc.drawBuiltinComponents(a);c=c.concat(k);var l=nc.drawUserDefines(a);c=c.concat(l),c.push(nc.drawAddComponent(a,b)),b.setItems(c),b._oldScripts=a.scripts?a.scripts.slice(0):[],b.update()}},inspect:function(a,b,c){var d=this;d._oldScripts=null,null!=d._laterId&&(k.cancelLater(d._laterId),delete d._laterId);var e=!1;if(d.layout.children){var f=d.layout.children[0];f instanceof ld&&f._valueChanged&&(e=!0,kb(ga._("Stop editing frame animation?"),ga._("Warning"),function(){d.startCallLater(b,a,c)},null,{icon:"alert"}))}e||d.startCallLater(b,a,c)},startCallLater:function(a,b,c){var d=this;d._laterId=U(function(){"setting"===a?d.inspectSettingImpl(b):"preference"===a?d.inspectPreferenceImpl(b):"atlas"===a?d.inspectAtlasImpl(c):"webfont"===a?d.inspectWebFontImpl(c):"js"===a?d.inspectJsImpl(c):"scene"===a?d.inspectSceneImpl(c):"frameAnimation"===a?d.inspectFrameAnimationImpl(c):"pluginManager"===a?d.inspectPluginManagerImpl(c):"importResource"===a?d.inspectImportResourceImpl(c):"checkForUpdates"===a?d.inspectCheckForUpdatesImpl():a&&0===a.indexOf("Panel:")?(a=a.replace("Panel:",""),d.inspectPanelImpl(a,c)):d.inspectImpl(b),delete d._laterId})},getCompAt:function(a){a=k.checkTouch(a);var b=this,c=a.target,d=b.children;if(d)for(var e=0;e<d.length;e++){var f=d[e];if(f instanceof Na){var g=f.eachChildren(function(a){return a.view.contains(c)?!0:void 0});if(g)return g}}},clear:function(){var a=this,b=a.children;a.setItems([]),b&&b.forEach(function(a){a&&a.dispose()}),a.target=null,ga.e.emit(ga.e.INSPECTOR_VIEW_CLEAR)}},{properties:[]},{});sd.prototype.isSameArray=function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<b.length;c++)if(b[c]!==a[c])return!1;return!0},sd.prototype.update=function(){var a=this,b=a.children,c=a.target;if(null==a._laterId){var d=this._oldScripts;if(d){var e=c.scripts||[],f=a.isSameArray(d,e);if(!f)return void a.inspect(c)}b&&(ga.inspector._updating=!0,b.forEach(function(b){if(b instanceof qc.editor.Panel){var c=!1,d=b._cacheForDetection;if(d)for(var e in d)if(c=!a.isSameArray(d[e],b.target[e]||[]))break;c?b.repaint():(b.updateChildrenValue(),b.update&&b.update())}}),ga.inspector._updating=!1)}},sd.prototype.getPanelInstance=function(a,b){return a===qc.editor.Panel||k.isSubClassOf(a,qc.editor.Panel)?new a(b):new a},b.defineProperties(sd.prototype,{target:{get:function(){return this._target},set:function(a){this._target=a}}});var td=m("qc.editor.PreviewView",qc.widget.Container,function Df(a){var b=this;Df["super"].constructor.call(b,a),b.layout=new qc.widget.layout.TableLayout(b),b.scrollBarModel="off",ga.e.on(ga.e.INSPECTOR_VIEW_CLEAR,function(){b.clear()})},{clear:function(){this.setItems([])}});b.defineProperties(td.prototype,{content:{get:function(){return this._content},set:function(a){var b=this;b.setPropertyValue("content",a),b.setItems([{widths:[.1],height:.1,cells:[{cellPadding:15,element:a,align:"center",vAlign:"middle"}]}])}}});var ud=m(null,b,function(a){var b=this;b._propertyView=a,b.addListeners()},{clear:function(){var a=this,b=a._mask;b&&(b.style.cursor="",a._propertyView.view.removeChild(b)),a._clientPoint=a._comp=a._oldValue=a._mask=null},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){Y(a);var b=this,c=b._propertyView,d=c.getCompAt(a);(d instanceof qc.widget.Label||d instanceof qc.editor.Text)&&d["for"]&&!d.disabled&&(b._clientPoint=B(a),b._comp=d)},handle_mousemove:function(a){this.handle_touchmove(a)},handle_touchmove:function(a){var b=this,c=b._clientPoint,d=b._comp,e=b.view,f=B(a);if(d&&!A()){var g=e.findViewById(d["for"]);if(b._oldValue=g.value||0,y(f,c)>=1){var h=b._mask=p();h.style.left="0",h.style.top="0",h.style.bottom="0",h.style.right="0",h.style.cursor="ew-resize",e.view.appendChild(h),z(b,a)}}},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(){A()||this.clear()},handleWindowMouseMove:function(a){this.handleWindowTouchMove(a)},handleWindowTouchMove:function(a){var b=this,c=b.view,d=b._comp,e=c.findViewById(d["for"]),f=b._clientPoint,g=null!=d.min?d.min:e.min,h=null!=d.max?d.max:e.max,i=e.precision,j=B(a),k=j.x-f.x;k=null==i?parseFloat(b._oldValue)+parseFloat(k)*(d.dragStep||1):parseFloat((parseFloat(b._oldValue)+parseFloat(k)*(d.dragStep||1)).toFixed(i)),null!=g&&g>k&&(k=g),null!=h&&k>h&&(k=h),e.value=k},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(){this.clear()}},{interactor:!0},{view:{get:function(){return this._propertyView}}}),vd=m("qc.editor.Inspector",qc.widget.Container,function Ef(a){var b=this;Ef["super"].constructor.call(b,a);var c=b.layout=new qc.widget.layout.BorderLayout(b),d=b.propertyView=new qc.editor.PropertyView,e=b.previewView=new qc.editor.PreviewView;c.splitterSize=18,c.toggleLength=62,c.hitSize=18,c.toggleIconScale=.6,c.toggleNinePatchImage="project_add.9",c.toggleNinePatchBorder=[10,10,10,10],b.addEventListener("mousedown",function(){ga.activeView=b}),b.setItems([{region:"center",element:d},{region:"bottom",height:200,element:e}]),ga.e.on(ga.e.ACTIVE_NODE_CHANGE,function(a){d.inspect(a.newValue)}),ga.e.on(ga.e.JS_CHANGED,function(){d.children&&1===d.children.length&&d.children[0]instanceof ad&&ga.inspector.propertyView.inspect(null,"js",d.children[0].treeData)})});vd.prototype.update=function(){this.propertyView.update()};var wd=m("qc.editor.Menu",qc.widget.Menu,function Ff(a){var b=this;Ff["super"].constructor.call(b,a),b.items=[],b._setBuiltinMenu(),b._bindingClose=function(){b.hide()}});qc.editor.Menu.prototype.registerCloseEvent=function(a){qc.editor.Menu["super"].registerCloseEvent.call(this,a),ga.e.on(ga.e.JS_CHANGED,this._bindingClose)},qc.editor.Menu.prototype.unregisterCloseEvent=function(a){qc.editor.Menu["super"].unregisterCloseEvent.call(this,a),ga.e.off(ga.e.JS_CHANGED,this._bindingClose)},wd.prototype._setBuiltinMenu=function(){this._addQCItems(),this._addProjectItems(),this._addEditorItems(),this._addAssetItems(),this._addComponentItems(),this._addToolItems(),this._addPluginsItems(),this._addLayoutItems(),this._addLanguageItems()};var wd=qc.widget.Menu.prototype;wd._addAssetItems=function(){var a=this;this.addItem(ga._("GameObject/Empty Node"),function(){a.createNode()}),this.addItem(ga._("GameObject/Image"),function(){a.createImage()}),this.addItem(ga._("GameObject/Sprite"),function(){a.createSprite()}),this.addItem(ga._("GameObject/Text"),function(){a.createText()}),this.addItem(ga._("GameObject/Button"),function(){a.createButton()}),this.addItem(ga._("GameObject/Toggle"),function(){a.createToggle()}),this.addItem(ga._("GameObject/ScrollBar"),function(){a.createScrollBar()}),this.addItem(ga._("GameObject/ScrollView"),function(){a.createScrollView()}),this.addItem(ga._("GameObject/ProgressBar"),function(){a.createProgressBar()}),this.addItem(ga._("GameObject/Slider"),function(){a.createSlider()}),this.addItem(ga._("GameObject/Input Field"),function(){a.createInputField()}),this.addItem(ga._("GameObject/Sound"),function(){a.createSound()}),this.addItem(ga._("GameObject/Dom"),function(){a.createDom()}),this.addItem(ga._("GameObject/Graphics"),function(){a.createGraphics()}),this.addItem(ga._("GameObject/UIRoot"),function(){a.createUIRoot()}),this.addItem(ga._("GameObject/Tilemap"),function(){a.createTilemap()})},wd.createUIRoot=function(){var a=new qc.UIRoot(ga.game);return ga.hierarchy.activeNode=a,ga.dataModel.addNodeForUndo(a),a},wd.createNode=function(a){var b=ga.game.add.node(a||hb());return ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createEmitter=function(a){var b=ga.game.add.emitter(a||hb());return ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createTilemap=function(a){var b=ga.game.add.tilemap(a||hb());return ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createImage=function(a){var b=ga.game.add.image(a||hb(!0));return b.texture=this._builtinAtlas(),b.frame="empty.png",ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createSprite=function(a){var b=ga.game.add.sprite(a||hb());return b.texture=this._builtinAtlas(),b.frame="empty.png",ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createText=function(a){var b=ga.game.add.text(a||hb(!0));return b.text="TEXT",b.width=120,b.height=30,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createButton=function(a){var b=ga.game.add.button(a||hb(!0));return b.texture=this._builtinAtlas(),b.frame="button.png",b.imageType=qc.UIImage.IMAGE_TYPE_SLICED,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createToggle=function(a){var b=ga.game.add.toggle(a||hb(!0));return b.background.texture=this._builtinAtlas(),b.background.frame="button.png",b.background.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.checkMark.texture=this._builtinAtlas(),b.checkMark.frame="ok.png",b.checkMark.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.checkMark.width=50,b.checkMark.height=50,b.text.text="Toggle",b.text.color=new qc.Color(16777215),b.text.fontSize=24,b.on=!0,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createScrollBar=function(a){var b=ga.game.add.scrollBar(a||hb(!0),!0);return b.texture=this._builtinAtlas(),b.frame="sliderbg.png",b.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.sliders.texture=this._builtinAtlas(),b.sliders.frame="button.png",b.sliders.imageType=qc.UIImage.IMAGE_TYPE_SLICED,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createScrollView=function(a){var b=ga.game.add.scrollView(a||hb(!0));b.texture=null,b.width=400,b.height=400,b.canVertical=!0,b.canHorizontal=!1,b.interactive=!0,b.movementType=qc.ScrollView.MOVEMENT_ELASTIC,b.elasticity=2;var c=b.addScript("qc.NodeMask");c.checkInField=!1;var d=ga.game.add.node(b);return d.width=400,d.height=800,b.content=d,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createSlider=function(a){var b=ga.game.add.slider(a||hb(!0),!0);return b.texture=this._builtinAtlas(),b.frame="button.png",b.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.height=15,b.sliders.texture=this._builtinAtlas(),b.sliders.frame="button.png",b.sliders.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.sliders.height=15,b.value=.5,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createProgressBar=function(a){var b=ga.game.add.progressBar(a||hb(!0),!0);return b.texture=this._builtinAtlas(),b.frame="button.png",b.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.value=.5,b.sliders.texture=this._builtinAtlas(),b.sliders.frame="button.png",b.sliders.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.sliders.colorTint=new qc.Color("#E0E0E0"),ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createInputField=function(a){var b=ga.game.add.inputField(a||hb(!0));return b.texture=this._builtinAtlas(),b.frame="button.png",b.imageType=qc.UIImage.IMAGE_TYPE_SLICED,b.textComponent.fontSize=18,b.placeholder.fontSize=18,ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createSound=function(a){var b=ga.game.add.sound(a||hb());return ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createDom=function(a){var b=ga.game.add.dom(a||hb());return ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd.createGraphics=function(a){var b=ga.game.add.graphics(a||hb());return ga.hierarchy.activeNode=b,ga.dataModel.addNodeForUndo(b),b},wd._builtinAtlas=function(){return ga.game.assets.find("__builtin_resource__")};var wd=qc.widget.Menu.prototype;wd._addComponentItems=function(){},wd._addComponentItem=function(a){this.addItem(a,function(){var a=ga.hierarchy.activeNode;if(a){try{target.addScript(event.label)}catch(b){return void ga.notification.warn(ga._("Current node is not allowed to add this component."))}nc.redraw(a)}})};var wd=qc.widget.Menu.prototype;wd._addEditorItems=function(){var b=this;this.addItem(ga._("Edit/Undo"),function(){Eb(document.activeElement)||b.undo()},{shortcut:"mod+z",suffix:Z?"Command+Z":"Ctrl+Z",disabled:function(){return!ga.undo.canUndo()}}),this.addItem(ga._("Edit/Redo"),function(){Eb(document.activeElement)||b.redo()},{shortcut:"mod+y",suffix:Z?"Command+Y":"Ctrl+Y",disabled:function(){return!ga.undo.canRedo()}}),this.addSeparator(ga._("Edit/Redo")),this.addItem(ga._("Edit/Cut"),function(){Eb(document.activeElement)||b.cut()},{shortcut:"mod+x",preventDefault:!1,suffix:Z?"Command+X":"Ctrl+X"}),this.addItem(ga._("Edit/Copy"),function(){Eb(document.activeElement)||b.copy()},{shortcut:"mod+c",preventDefault:!1,suffix:Z?"Command+C":"Ctrl+C"}),this.addItem(ga._("Edit/Paste"),function(){Eb(document.activeElement)||b.paste()},{shortcut:"mod+v",preventDefault:!1,suffix:Z?"Command+V":"Ctrl+V"}),this.addSeparator(ga._("Edit/Paste")),this.addItem(ga._("Edit/Duplicate"),function(){Eb(document.activeElement)||b.duplicate()},{shortcut:"mod+d",suffix:Z?"Command+D":"Ctrl+D"}),this.addItem(ga._("Edit/Delete"),function(){b["delete"]()}),this.addSeparator(ga._("Edit/Delete")),this.addItem(ga._("Edit/Preview (WebGL)"),function(){ga.playing?a.open("PreviewGameWebGL.html","previewGameWebGL"):(qc.editor.Operation.SAVE_CURR_SCENE(),a.open("PreviewGameWebGL.html","previewGameWebGL"))}),this.addItem(ga._("Edit/Preview (Canvas)"),function(){ga.playing?a.open("PreviewGameCanvas.html","previewGameCanvas"):(qc.editor.Operation.SAVE_CURR_SCENE(),a.open("PreviewGameCanvas.html","previewGameCanvas"))}),this.addItem(ga._("Edit/Run"),function(){b.run()},{shortcut:"mod+p",suffix:Z?"Command+P":"Ctrl+P"}),this.addSeparator(ga._("Edit/Run")),this.addItem(ga._("Edit/Apply To Prefab"),function(){b.applyPrefab()})},wd.undo=function(){ga.undo.undo()},wd.redo=function(){ga.undo.redo()},wd.copy=function(){var a=ga.activeView;a&&a.handleCopy&&a.handleCopy()},wd.cut=function(){var a=ga.activeView;a&&a.handleCut&&a.handleCut()},wd.paste=function(){var a=ga.activeView;a&&a.handlePaste&&a.handlePaste()},wd["delete"]=function(){var a=ga.activeView;a&&a.handleDelete&&a.handleDelete()},wd.duplicate=function(){var a=ga.activeView;a&&a.handleDuplicate&&a.handleDuplicate()},wd.run=function(){ga.playing=!ga.playing},wd.applyPrefab=function(){var a=ga.hierarchy.activeNode;if(a&&a._prefab){var b=ga.game.assets.findByUUID(a._prefab);b instanceof qc.Prefab&&qc.editor.Operation.SAVE_PREFAB(a,b.url)}};var wd=qc.widget.Menu.prototype;wd._addLanguageItems=function(){this.addItem("Language/中文",function(){if("zh"!==ga.localize.language){if(ga.playing)return void ga.notification.warn(ga._("Quit running mode first"));if(ga.prefabInfo)return void ga.notification.warn(ga._("Stop editing prefab first"));qc.editor.Operation.SAVE_CURR_SCENE(function(){ga.localize.language="zh",ga.storage.set("language",ga.localize.language),ga.storage.save(),ga.silentRefresh=!0,a.location.reload()})}},{id:"zh",type:"radio",groupId:"language",selected:function(){return"zh"===ga.localize.language}}),this.addItem("Language/English",function(){if("en"!==ga.localize.language){if(ga.playing)return void ga.notification.warn(ga._("Quit running mode first"));if(ga.prefabInfo)return void ga.notification.warn(ga._("Stop editing prefab first"));qc.editor.Operation.SAVE_CURR_SCENE(function(){ga.localize.language="en",ga.storage.set("language",ga.localize.language),ga.storage.save(),ga.silentRefresh=!0,a.location.reload()})}},{id:"en",type:"radio",groupId:"language",selected:function(){return"zh"!==ga.localize.language}})};var wd=qc.widget.Menu.prototype;wd._addLayoutItems=function(){var a=function(a){return ga.playing?void ga.notification.warn(ga._("Quit running mode first")):ga.prefabInfo?void ga.notification.warn(ga._("Stop editing prefab first")):void qc.editor.Operation.SAVE_CURR_SCENE(a)};this.addItem(ga._("Layout/Portrait"),function(){"Portrait"!==ga.orientation&&a(function(){ga.orientation="Portrait",ga.storage.set("orientation","Portrait")})},{id:"Portrait",type:"radio",groupId:"orientation",selected:function(){return"Portrait"===ga.orientation}}),this.addItem(ga._("Layout/Landscape"),function(){"Landscape"!==ga.orientation&&a(function(){ga.orientation="Landscape",ga.storage.set("orientation","Landscape")})},{id:"Landscape",type:"radio",groupId:"orientation",selected:function(){return"Landscape"===ga.orientation}})};var wd=qc.widget.Menu.prototype;wd._addPluginsItems=function(){this.addItem(ga._("Plugins/Plugin Manager"),function(){ga.inspector.propertyView.inspect({},"pluginManager")}),this.addItem(ga._("Plugins/Plugin Store"),function(){xd()}),this.addSeparator(ga._("Plugins/Plugin Store")),this.addItem(ga._("Plugins/Export Plugin"),function(){})};var xd=function(){ga.pluginStore&&(qc.Util.removeHTML(ga.pluginStore),ga.pluginStore=null);var a=document.createElement("iframe"),b=ga.storage.get("language"),c="http://"+location.host+"/Temp/InstallPlugin.html";a.src="http://www.zuoyouxi.com/Store/index?callback="+encodeURIComponent(c)+"&lng="+b,a.style.borderWidth="0",a.style.margin="0",a.style.padding="0",a.style.display="block";var d=new qc.editor.Dialog;d.title=ga._("Plugin Store");var e=Cb(760,600);d.width=e.width,d.height=e.height,d.htmlFill=!0,d.contentPadding=[2,2,2,2],d.content=a,d.modal=!0,d.show()},yd=function(a){qc.editor.Operation.QUERY_PLUGIN_INFO(function(b){ga.pluginInfo=b;var c=ga.pluginInfo&&ga.pluginInfo.plugins;a(c)})},zd=function(a,b,c,d){console.log(a,c),qc.editor.Operation.INSTALL_PLUGIN(a,b,c,d)};ga.initInstallPlugin=function(a){var b=ga.localize=new qc.editor.Localize("zh");ga._=function(a){return b._.call(b,a)};var c=a.document.getElementById("installPlugin");c.innerText=ga._("Checking..."),c.stat=0;var d=_("plugin_id",context),e=(_("plugin_name",context),_("version",context)),f=_("session",context);c.addEventListener("click",function(){1===c.stat&&(c.innerText=ga._("Installing..."),c.stat=2,zd(d,e,f,function(a){0===a?(c.stat=3,c.innerText=ga._("Installed"),ga.notification.info(ga._("{0} has been successfully installed."))):(c.stat=1,c.innerText=ga._("Install"),ga.notification.info(ga._("{0} failed to install.")))}))}),yd(function(a){var b=a[d];!b||qc.editor.version.versionCompare(b.version,e)<0?(c.stat=1,c.innerText=ga._("Install")):(c.stat=3,c.innerText=ga._("Installed"))})};var wd=qc.widget.Menu.prototype;wd._addProjectItems=function(){var b=this;b.addItem(ga._("Project/New Scene"),function(){b.createScene()},{shortcut:"mod+m",suffix:Z?"Command+M":"Ctrl+M"}),b.addItem(ga._("Project/Save Scene"),function(){b.saveScene()},{shortcut:"mod+s",suffix:Z?"Command+S":"Ctrl+S"}),b.addItem(ga._("Project/Reload Scene"),function(){ga.playing?ga.scene.reload():qc.editor.Operation.SAVE_CURR_SCENE(function(){ga.scene.reload()})}),b.addSeparator(ga._("Project/Reload Scene")),b.addItem(ga._("Project/Open Recent")),qc.editor.Operation.RECENT_OPEN(function(c){c&&c.forEach(function(c){var d,e=k.isMac?"/":"\\";c.charAt(c.length-1)===e&&(d=c.substring(0,c.lastIndexOf(e))),d&&(d=d.substr(d.lastIndexOf(e)+1),b.findItem(ga._("Project/Open Recent")+"/"+d)&&(d="`"+c+"`"),b.addItem(ga._("Project/Open Recent")+"/"+d,function(b){var c=function(){qc.editor.Operation.OPEN_PROJECT(b.project,function(b){b?(ga.silentRefresh=!0,ga.storage.set("switchProject","1"),a.location.reload()):ga.notification.error(ga._("Open project failed."))})};mb(c)},{project:c}))})}),b.addItem(ga._("Project/New Project"),function(){b.createProject()}),b.addItem(ga._("Project/Open Project"),function(){b.openProject()}),this.addSeparator(ga._("Project/Open Project")),this.addItem(ga._("Project/Publish..."),function(){b.publish()}),this.addSeparator(ga._("Project/Publish...")),this.addItem(ga._("Project/Settings..."),function(){b.openSettings()},{shortcut:"shift+mod+b",suffix:Z?"Shift+Command+B":"Shift+Ctrl+B"})},wd.createScene=function(){qc.editor.Operation.NEW_SCENE()},wd.saveScene=function(){return ga.playing?void ga.notification.warn(ga._("Quit running mode first")):ga.prefabInfo?void ga.notification.warn(ga._("Stop editing prefab first")):void(ga.config.editor.currScene&&"unsavedScene"!=ga.config.editor.currScene?(qc.editor.Operation.SAVE_SCENE(ga.config.editor.currScene),qc.editor.Operation.UPDATE_EDITOR_SETTINGS(ga.config.editor)):lb(ga._("Enter the new scene name"),"",function(a){if(a){ga.config.editor.currScene=a,qc.editor.Operation.SAVE_SCENE(a),qc.editor.Operation.UPDATE_EDITOR_SETTINGS(ga.config.editor);var c=b.keys(ga.config.scene.scene);c.push(a),qc.editor.Operation.UPDATE_SCENE_SETTINGS(c),ib()}}))},wd.createProject=function(){var b=function(){var b=new qc.editor.Dialog,c=new ab({labelWidth:"en"===ga.localize.language?110:70});b.contentPadding=[2,2,2,2],b.content=c,b.width=420,b.height=180,b.modal=!0,b.show(),c.on("create",function(b){var c=b.path;c?qc.editor.Operation.CREATE_PROJECT(c,function(b,d){b?qc.editor.Operation.OPEN_PROJECT(c,function(b){b?(ga.silentRefresh=!0,ga.storage.set("switchProject","1"),a.location.reload()):ga.notification.error(ga._("Open project failed."))}):ga.notification.error(ga._("Create project failed.")+" Reason:"+d)}):ga.notification.error(ga._("Please choose a folder to create the project"))})};mb(b)},wd.openProject=function(){mb(function(){var b=new db;b.onFolderChoosed=function(b){qc.editor.Operation.OPEN_PROJECT(b,function(b){b?(ga.silentRefresh=!0,ga.storage.set("switchProject","1"),a.location.reload()):ga.notification.error(ga._("Open project failed."))})},b.openFolderChooser()})},wd.publish=function(){qc.editor.Operation.PUBLISH()},wd.openSettings=function(){var a=ga.inspector;a.propertyView.inspect(null,"setting")};var wd=qc.widget.Menu.prototype;wd._addQCItems=function(){var b=this;b.addItem(ga._("QICI Engine/About QICI Engine..."),function(){"zh"==ga.localize.language?a.open("http://www.zuoyouxi.com","QICI Engine"):a.open("http://www.qiciengine.com","QICI Engine")}),b.addSeparator(ga._("QICI Engine/About QICI Engine...")),b.addItem(ga._("QICI Engine/Check for Updates..."),function(){b.checkForUpdates()}),b.addSeparator(ga._("QICI Engine/Check for Updates...")),b.addItem(ga._("QICI Engine/Help/zh/Manual..."),function(){a.open("http://docs.zuoyouxi.com/manual/index.html","QICI Engine")}),b.addItem(ga._("QICI Engine/Help/zh/API..."),function(){a.open("http://docs.zuoyouxi.com/api/index.html","QICI Engine")}),b.addItem(ga._("QICI Engine/Help/zh/Forum..."),function(){a.open("http://bbs.zuoyouxi.com","QICI Engine")}),b.addItem(ga._("QICI Engine/Help/en/Manual..."),function(){a.open("http://docs.qiciengine.com/manual/index.html","QICI Engine")}),b.addItem(ga._("QICI Engine/Help/en/API..."),function(){a.open("http://docs.qiciengine.com/api/index.html","QICI Engine")}),b.addItem(ga._("QICI Engine/Help/en/Forum..."),function(){a.open("http://bbs.qiciengine.com","QICI Engine")}),b.addItem(ga._("QICI Engine/Preference..."),function(){var a=ga.inspector;a.propertyView.inspect(null,"preference")})},wd.checkForUpdates=function(){var a=ga.inspector;a.propertyView.inspect(null,"checkForUpdates")};var wd=qc.widget.Menu.prototype;wd._addToolItems=function(){this.addItem(ga._("Tool/Frame Animation Editor"),function(){ga.inspector.propertyView.inspect(null,"frameAnimation")}),this.addItem(ga._("Tool/Import Assets"),function(){ga.inspector.propertyView.inspect(null,"importResource")}),this.addItem(ga._("Tool/Repack Texture Atlases"),function(){ga.texturePacker.packAll()}),this.addItem(ga._("Tool/Create WebFont"),function(){ga.inspector.propertyView.inspect(null,"webfont","")})};var Ad=m("qc.editor.FileTree",oa,function(a){Ad["super"].constructor.call(this,a),this.dragToIndexEnabled=!1,this.clearSelectionOnBackgroundClicked=!1,this._initMenu(),this.visibleFunc=function(a){return a.isDir?!0:!1},this.selectionModel.on("selectionChange",function(){ga.project.onTreeSelectionChange()})});Ad.prototype.blink=function(a){var b=this;if(b._anim&&(b._anim.finishFunc=function(){b._blinkData.s("blink.background",null),b._anim=null,b._blinkData=null},b._anim.stop()),a){b._blinkData=a;var c=0,d=function(){4>c?(c++,b._anim=W({duration:400,finishFunc:d,action:e})):(a.s("blink.background",null),b._anim=null,b._blinkData=null)},e=function(b){c%2===0&&(b=1-b),a.s("blink.background","rgba(255, 255, 0, "+b+")")};d()}},Ad.prototype.clearHighlight=function(){var a=this,b=a.dataModel;b.datas.forEach(function(a){a.s("blink.background",null)})},Ad.prototype.drawRowBackground=function(a,b,c,d,e,f){var g=this;Ad["super"].drawRowBackground.call(g,a,b,c,d,e,f);var h=b.s("blink.background");h&&(a.beginPath(),k.drawShape(a,"roundRect",{x:c,y:d,width:e,height:f}),a.fillStyle=h,a.fill())},Ad.prototype.rename=function(a,b){b&&b.length&&b!==a.name&&(a.name=b,qc.editor.Operation.RENAME(a.id,ga.project.getFullPath(a,b)))},Ad.prototype.constructTree=function(a,b){for(var c in a){var d=a[c],e=new qc.widget.Data;e.name=c,b||(e.displayName=e.name+"("+ga.projectPath+")"),"string"==typeof d.uuid?(e.icon="",e.assetType=d.assetType,e.isBin=!0,e.resUUID=d.uuid,e.dependences=d.dependences,e.source=d.source):d.raw===!0?e.isRaw=!0:(e.icon="tree_folder",
e.isDir=!0,b&&"Assets"===b.name&&b.predefined&&("atlas"===c?e.icon="tree_atlas_folder":"audio"===c?e.icon="tree_audio_folder":"excel"===c?e.icon="tree_excel_folder":"font"===c?e.icon="tree_font_folder":"state"===c?e.icon="tree_state_folder":"css"===c?e.icon="tree_css_folder":"prefab"===c?e.icon="tree_prefab_folder":"raw"===c?e.icon="tree_raw_folder":"sprite"===c?e.icon="tree_sprite_folder":"texture"===c&&(e.icon="tree_atlas_folder")),d.predefined&&("Assets"===c?e.icon="tree_assets_folder":"Scripts"===c&&(e.icon="tree_js_folder"),e.predefined=!0),d.virtualDir&&(e.virtualDir=!0,e.icon="tree_link_folder")),b&&(e.parent=b),this.dataModel.add(e),e.id=ga.project.getFullPath(e),e.isBin&&e.assetType!==ga.ASSET_TYPE.ASSET_JS&&ga.bgLoad.addResource(e.resUUID,e.id,e.assetType),e.isDir&&this.constructTree(d.sub,e)}},Ad.prototype.handleCrossDrag=function(a,b,c){(c.view===ga.fileList||c.view===ga.hierarchy)&&Ad["super"].handleCrossDrag.call(this,a,b,c)},Ad.prototype._endCrossDrag=function(a,b){if(b.view===ga.hierarchy){var c=ga.hierarchy.draggingData;if(c){var d=c.node;if(d){var e=this._crossDragInfo.rowIndex,f=this.rowDatas[e];if(!f)return;var g=f.id;qc.editor.Operation.SAVE_PREFAB(d,g+"/"+d.name+".prefab")}}}},Ad.prototype._endDrag=function(a,b){var c=b.rowIndex,d=this.rowDatas[c];if(d){var e=d.id;if(this.isSelected(this.draggingData))this.topRowOrderSelection.forEach(function(a){var b=a.id;ga.project.canMoveDir(b,e)&&(qc.editor.Operation.MOVE(b,e),a.parent=d)},this);else{var f=this.draggingData.id;ga.project.canMoveDir(f,e)&&(qc.editor.Operation.MOVE(f,e),this.draggingData.parent=d)}}},Ad.prototype._initMenu=function(){var b=this,c=new qc.editor.ContextMenu([{label:ga._("New Folder"),func:"handleMakeDir",disabled:function(){return b._isInVirtualDir()}},{label:ga._("Delete"),func:"handleDelete",disabled:function(){return b._isInVirtualDir()||0===b.selection.length}},{label:ga._("Rename"),func:"handleRename",disabled:function(){return b._isInVirtualDir()||1!==b.selection.length}},{type:"-"},{label:ga._("New JavaScript File"),func:"handleCreateJS",disabled:function(){return b._isInVirtualDir()||1!==b.selection.length||!b.selectionModel.lastData||!ga.project.canCreateJSInPath(b.selectionModel.lastData.id)}},{type:"-"},{label:ga._("Reimport"),func:"handleReimport",disabled:function(){return 1!==b.selection.length}},{type:"-"},{label:ga._("Open in Local File Explorer"),func:"handleReveal",disabled:function(){return!/^(127\.0\.0\.1|localhost)(:\d+|)$/.test(a.location.host)}},{type:"-"},{label:ga._("Expand"),func:"handleExpand"},{label:ga._("Collapse"),func:"handleCollapse"}]);c.on("action",function(a){a.item.func&&("function"==typeof a.item.func?a.item.func():b[a.item.func](a))}),c.addTo(b)},Ad.prototype.handleExpand=function(){var a=this.selectionModel.lastData;this.expandAll(a)},Ad.prototype.handleCollapse=function(){var a=this.selectionModel.lastData;this.collapseAll(a)},Ad.prototype.handleMakeDir=function(){var a=this._getMenuDestDir();if("string"==typeof a)return this._isInVirtualDir()?void ga.notification.error("{0} cannot be modified(builtin files).",data.id):void lb(ga._("Enter a new folder name"),"",function(b){b&&b.length&&qc.editor.Operation.MKDIR(a?a+"/"+b:b)})},Ad.prototype.handleReveal=function(){var a=this._getMenuDestDir();"string"==typeof a&&qc.editor.Operation.REVEAL_IN_FINDER(a)},Ad.prototype._isInVirtualDir=function(a){var b=this;if(a=a||b.selectionModel.lastData,!a)return!1;for(var c=a.virtualDir;!c&&a;)a=a.parent,c|=a&&a.virtualDir;return c},Ad.prototype._getMenuDestDir=function(){var a=this.selectionModel.lastData;return a?a.id:null},Ad.prototype.handleCreateJS=function(){var a=this._getMenuDestDir();"string"==typeof a&&ga.project.canCreateJSInPath(a)&&lb(ga._("Enter a new JavaScript file name"),"",function(b){qc.editor.Operation.CREATE_JS(a,b)})},Ad.prototype.handleRename=function(){var a=this.selectionModel.lastData;if(a){if(this._isInVirtualDir(a))return void ga.notification.error("{0} cannot be modified(builtin files).",a.treeData.id);this.beginEditing(a)}},Ad.prototype.handleDelete=function(){var a=this,b=a.selection.slice(0);0!==b.length&&kb(ga._("Sure to delete this file?"),ga._("Warning"),function(){b.forEach(function(b){a._isInVirtualDir(b)?ga.notification.error("{0} cannot be removed(builtin files).",b.id):b.predefined?ga.notification.error(ga._("{0} cannot be removed(builtin files)."),b.id):(qc.editor.Operation.REMOVE(b.id),a.dataModel.remove(b))})},null,{icon:"alert"})},Ad.prototype.handleReimport=function(){var a=this._getMenuDestDir();"string"==typeof a&&ga.project.reimportResource(a)};var Bd=m("qc.editor.FileNodeUI",qc.widget.graph.NodeUI,function Gf(a,b){var c=this;Gf["super"].constructor.call(c,a,b)});Bd.prototype.blinkBackground={width:{func:function(a){return a._width}},height:{func:function(a){return a._height}},comps:[{type:"roundRect",rect:[17,1,1],relative:!0,background:{func:function(a){return a.s("blink.background")}}}]},Bd.prototype.prepare=function(){var a=this,b=a.data,c=a.gv,d=b.followers;if(Bd["super"].prepare.call(a),"tile"===c.layout&&d&&d.length>0){var e=b.rect,f=c.itemWidth/48*16,g=c.itemHeight/48*16,h={};h.x=e.x+e.width-c.itemWidth/48*5,h.y=e.y+e.height/2-g/2,h.width=f,h.height=g,a.addRect(h),a.nodeInfo.expandIconRect=h}},Bd.prototype.drawBody=function(a){var b=this,c=b.data,d=b.gv,e=b.nodeInfo,f=c.s("blink.background"),g=e.expandIconRect,h=c._position,i=c._anchor,j=c._rotation,l=c.width,m=c.height,n=c._scale,o=n.x,p=n.y,q={x:-l*i.x,y:-m*i.y,width:l,height:m};q.x+=h.x,q.y+=h.y;var r=j||1!==o||1!==p;if(r&&(a.save(),k.gTranslate(a,h.x,h.y),k.gRotate(a,j),a.scale(o,p),k.gTranslate(a,-h.x,-h.y)),"list"===d.layout&&d.isSelected(c)&&(a.beginPath(),a.fillStyle=d===ga.activeView?d._selectBackground:d._inactiveSelectBackground,a.rect(0,q.y,d.viewRect.width,q.height),a.fill()),f&&(a.beginPath(),k.drawImage(a,b.blinkBackground,"fill",q.x,q.y,q.width,q.height,c,d)),r&&a.restore(),Bd["super"].drawBody.call(b,a),g&&"list"!==d.layout){var s="project_expand";c.expand&&(s="project_collapse"),k.drawImage(a,s,"uniform",g.x,g.y,g.width,g.height,c,d)}};var Cd=m("qc.editor.FileNode",qc.editor.ItemNode,function Hf(a){var b=this;Hf["super"].constructor.call(b,a)},{},{properties:["expand","followers"]},{uiClass:{get:function(){return Bd}}});Cd.prototype.getImageComps=function(){var a=this,b=Cd["super"].getImageComps.call(a);return b.splice(0,0,{type:"image",stretch:null,rect:{func:function(a,b){var c=b._indent,d=b._rowHeight;return[0,1,c,d-2]}},name:{func:function(a,b){return"list"===b.layout&&a.followers?a.expand?"treeExpand":"treeCollapse":void 0}}}),b.splice(1,0,{type:"rect",rect:[17,1,1],relative:!0,background:"#484848",borderColor:"#507aea",borderWidth:2,visible:{func:function(a){return a.a("focused")===!0}}}),b.push({type:"border",rect:[17,1,1],relative:!0,borderColor:"#507aea",borderWidth:2,visible:{func:function(a){return a.a("focused")===!0}}}),b},Cd.prototype.addToDataModel=function(a,b){var c=this,d=c.uuid;if(a._dataMap[d])throw"Data already in this DataModel";null!=c.id&&(a._idMap[c.id]=c),a._dataMap[d]=c,a._datas.splice(b,0,c),c._setDataModel(a),a.onAdd(c),a.emit("dataModelChange",{kind:"add",data:c})},Cd.prototype.addFollower=function(a){var b=this,c=b.followers||[];c.indexOf(a)<0&&(c=c.slice(0),c.push(a),b.followers=c)},Cd.prototype.removeFollower=function(a){var b=this,c=b.followers||[];c.indexOf(a)>=0&&(c=c.slice(0),k.removeArray(c,a),b.followers=c)},Cd.prototype.onPropertyChange=function(a){Cd["super"].onPropertyChange.call(this,a);var b=this;if("expand"===a.property){var c=b.expand,d=b.followers,e=b.dataModel;if(d)for(var f=e.datas.indexOf(b),g=0;g<d.length;g++){var h=d[g];c?h.addToDataModel(e,f+g+1):e.remove(h)}}else if("followers"===a.property){var i=a.oldValue,j=a.newValue;i&&i.forEach(function(a){delete a.master}),j&&j.forEach(function(a){a.master=b})}};var Dd=m("qc.editor.FileList",qc.editor.ItemList,function If(){var a=this;If["super"].constructor.call(a),a.pannable=!1,a._lastClickTime=(new Date).getTime(),a.clearSelectionOnBackgroundClicked=!0,a.editable=!0,a._initMenu(),a._initNativeDND(),a._initCrossDND(),a.selectionModel.on("selectionChange",function(){a.selectionChange()}),new qc.editor.FileListSelectionInteractor(a),a.interactors=[new qc.widget.graph.ScrollBarInteractor(a),new qc.editor.FileListInteractor(a),new qc.widget.graph.BasicInteractor(a)],a.view._dropView=a,a.addBottomPainter(a.drawFollowersBackground.bind(a)),ga.e.on(ga.e.BG_RESOURCE_LOADED,a._onBgResourceLoaded)});b.defineProperties(Dd.prototype,{editable:{get:function(){return this._editable},set:function(a){this._editable=a}}}),Dd.prototype.getListLabelIndent=function(a){var b=this,c=b._indent;return a.master?3*c:2*c},Dd.prototype.getListIndent=function(a){var b=this,c=b._indent;return a.master?2*c:c},Dd.prototype.calcRightGap=function(){var a=this.itemWidth,b=this.itemGap;return Math.max(b,a/48*16-a/48*5)},Dd.prototype.onBackgroundDoubleClick=function(){var a=ga.fileTree.selectionModel.lastData;a&&a.parent&&(ga.fileTree.selection=a.parent)},Dd.prototype.selectionChange=function(){if(!ga.project._updatingFileListDataModel){var a=this.selectionModel.lastData;if(a&&!this._selectedByRestore){var b,c=a.treeData;if(c||a.master&&(c=a.master.treeData,b=a.name),c){var d=c.assetType,e=a.name;if(d===ga.ASSET_TYPE.ASSET_ATLAS){var f=ga.inspector.propertyView.children;if(f&&f.length&&c.resUUID===f[0].uuid)f[0].selectFrame(b,!0);else{if(f&&f.length&&f[0].frameAnimationEditor&&f[0].target&&c.resUUID===f[0].target.uuid)return;if(!ga.project.findByUUID(c.resUUID))return;ga.inspector.propertyView.inspect(null,"atlas",[c.resUUID,b])}}else if(d===ga.ASSET_TYPE.ASSET_WEBFONT)ga.inspector.propertyView.inspect(null,"webfont",c.resUUID);else if(d===ga.ASSET_TYPE.ASSET_JS)ga.inspector.propertyView.inspect(null,"js",c);else if(d===ga.ASSET_TYPE.ASSET_SCENE)ga.inspector.propertyView.inspect(null,"scene",c);else if(e.indexOf(".png")===e.length-4||e.indexOf(".jpg")===e.length-4){ga.inspector.propertyView.clear();var g=aa.painter({background:null});ga.inspector.previewView.content=g,g.addTopPainter(function(b){var c=k.getImage(a._image),d=g.width,e=g.height;k.drawImage(b,c,"centerUniform",0,0,d,e);var f="12px Arial";b.font=f;var h=c.width+" * "+c.height,i=k.getTextSize(f,h);i.width+=6;var j=(d-i.width)/2,l=e-16;b.beginPath(),b.rect(j,l,i.width,16),b.fillStyle="rgb(19, 19, 19)",b.fill(),b.beginPath(),k.drawText(b,h,f,"white",j,l,i.width,16,"center")})}else c.isBin&&ga.inspector.propertyView.clear()}}}},Dd.prototype._showImageWhenDoubleClick=function(a){var b=new qc.editor.Dialog;b.position="center",b.title=a;var c=Cb(400,400);b.width=c.width,b.height=c.height,b.htmlFill=!0,b.content="<div style=\"background: url('"+a+"?"+ga.game.math.uuid()+"') no-repeat;background-size: contain;background-position: 50% 50%;\"><div>",b.show()},Dd.prototype._showTextEditorWhenDoubleClick=function(b,c){U(function(){var d=document.createElement("iframe");d.style.borderWidth="0",d.style.margin="0",d.style.padding="0",d.style.display="block",d.src="CodeEditor.html?filePath="+b;var e=new qc.editor.Dialog;e.title=ga._("Code Editor")+" - "+(c||b);var f=Cb(800,600);e.width=f.width,e.height=f.height,e.htmlFill=!0,e.contentPadding=[2,2,2,2],e.content=d,e.handleToolClick=function(){d.contentWindow.codePaneValueChanged?nb(ga._("Do you want to save the changes?"),ga._("Confirm"),[{text:ga._("Save"),key:"enter",onClick:function(){d.contentWindow.saveCode(),this.hide(),e.hide(),a.focus()}},{text:ga._("Don't Save"),onClick:function(){this.hide(),e.hide(),a.focus()}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}]):(e.hide(),a.focus())},e.show()})},Dd.prototype.onDataDoubleClick=function(a,b){if(!this.isOnExpandIcon(b,a)){var c=a.treeData;if(c)if(c.isDir)ga.fileTree.selection=c,ga.fileTree.expand(c);else if(c.isRaw){var d=ub(c.name);if([".png",".jpg",".jpeg",".gif"].indexOf(d)>=0)this._showImageWhenDoubleClick(c.id);else if("js"==d){var e=ga.preference.query("JSEditor");e==ga._("Double Click")||b.shiftKey?qc.editor.Operation.OPEN_JS(f):this._showTextEditorWhenDoubleClick(c.id)}else[".text",".txt",".css",".js",".html"].indexOf(d)>=0&&this._showTextEditorWhenDoubleClick(c.id)}else if(c.assetType===ga.ASSET_TYPE.ASSET_SCENE)qc.editor.Operation.SWITCH_SCENE(c.name.slice(0,-4));else if(c.assetType===ga.ASSET_TYPE.ASSET_PREFAB)ga.startEditingPrefab(c);else if(c.assetType===ga.ASSET_TYPE.ASSET_ATLAS)this._showImageWhenDoubleClick(ga.project.getImageURLByTreeData(c),c.id);else{var f=c.id;c.assetType===ga.ASSET_TYPE.ASSET_TEXT&&(f=f.substring(0,f.length-4)+c.source[0]);var d=ub(c.name),e=ga.preference.query("JSEditor");".js"!=d||e!=ga._("Double Click")&&!b.shiftKey?this._showTextEditorWhenDoubleClick(f,c.name):qc.editor.Operation.OPEN_JS(f)}}},Dd.prototype.addFileNode=function(a){var b=new qc.editor.FileNode;if(b.name=a.name,b.id=a.id,b.treeData=a,a.isBin)switch(a.assetType){case ga.ASSET_TYPE.ASSET_SOUND:b.image="SoundIcon";break;case ga.ASSET_TYPE.ASSET_JS:b.image="JsIcon";break;case ga.ASSET_TYPE.ASSET_WEBFONT:b.image="FontIcon";break;case ga.ASSET_TYPE.ASSET_SCENE:b.image="StateIcon";break;case ga.ASSET_TYPE.ASSET_ATLAS:case ga.ASSET_TYPE.ASSET_FONT:var c=ga.project.getImageURLByTreeData(a);b.image=c,c.indexOf("@atlas")>=0&&(b.name=sb(c)),a.assetType===ga.ASSET_TYPE.ASSET_ATLAS&&this.addAtlasFrame(b);break;default:b.image="UnknowIcon"}else if(a.isRaw){var d=ub(a.name);b.image=[".png",".jpg",".jpeg",".gif"].indexOf(d)>=0?ga.service.url+a.id:".js"===d?"JsIcon":[".mp3",".ogg"].indexOf(d)>=0?"SoundIcon":".css"===d?"CssIcon":"UnknowIcon"}else{var e=a.name,f="folder";"Assets"===e&&a.predefined?f="assets_folder":"Scripts"===e&&a.predefined?f="js_folder":a.virtualDir?f="link_folder":a.parent&&"Assets"===a.parent.name&&a.parent.predefined&&("atlas"===e?f="atlas_folder":"audio"===e?f="audio_folder":"excel"===e?f="excel_folder":"font"===e?f="font_folder":"state"===e?f="state_folder":"css"===e?f="css_folder":"prefab"===e?f="prefab_folder":"raw"===e?f="raw_folder":"sprite"===e?f="sprite_folder":"texture"===e&&(f="atlas_folder")),b.image=f}this.dataModel.add(b)},Dd.prototype.addAtlasFrame=function(a){var c=a.treeData,d=ga.project.findByUUID(c.resUUID),e=ga.project.getImageURLByTreeData(c);if(d&&d.json&&(d.json.SubTexture||d.json.frames)){var f;d.json.SubTexture?(f={},d.json.SubTexture.forEach(function(a){f[a.name]={frame:{x:a.x,y:a.y,w:a.width,h:a.height}}})):f=d.json.frames;var g=b.keys(f).sort();g.forEach(function(b){var c=f[b].frame,d=new qc.editor.FileNode;d.name=b,d.image=e,d.a("clipX",c.x),d.a("clipY",c.y),d.a("clipWidth",c.w),d.a("clipHeight",c.h),a.addFollower(d)})}},Dd.prototype.isOnExpandIcon=function(a,b){if(b){var c=this,d=c.lp(a);if("tile"===c.layout){var e=c.getDataUI(b),f=e.nodeInfo,g=f.expandIconRect;if(g&&v(g,d))return!0}else{var h=b.rect;if(h.width=c._indent,h.height=c._rowHeight,b.followers&&v(h,d))return!0}}},Dd.prototype.blink=function(a){var b=this;if(b._anim&&(b._anim.finishFunc=function(){b._blinkData.s("blink.background",null),b._anim=null,b._blinkData=null},b._anim.stop()),a){b._blinkData=a;var c=0,d=function(){4>c?(c++,b._anim=W({duration:400,finishFunc:d,action:e})):(a.s("blink.background",null),b._anim=null,b._blinkData=null)},e=function(b){c%2===0&&(b=1-b),a.s("blink.background","rgba(255, 255, 0, "+b+")")};d()}},Dd.prototype._onBgResourceLoaded=function(a){var b=a.uuid,d=ga.fileList,e=ga.fileTree.dataModel.getDataById(a.url);if(e&&e.assetType===ga.ASSET_TYPE.ASSET_ATLAS){var f=ga.project.getImageURLByTreeData(e);qc.widget.Default.setImage(f,c)}var g;if(d.dataModel&&(g=d.dataModel._roots)){for(var h,i,j=0,k=g.length;k>j;j++)if(h=g[j],h&&h.treeData&&h.treeData.resUUID===b){i=!0;break}i&&(d.savePanelContext(),ga.project.onTreeSelectionChange(),d.restorePanelContext())}},Dd.prototype.savePanelContext=function(){var a=this,b=[];a.dataModel.roots.forEach(function(a){a.expand&&b.push(a.id)}),a._contextSnap={search:ga.project.searchValue,translateY:a.translateY,selection:a.selection.slice(),expanded:b}},Dd.prototype.restorePanelContext=function(){var a=this,b=a._contextSnap;delete a._contextSnap;var c=b.search,d=b.translateY,e=b.selection,f=b.expanded;c&&(ga.project.searchValue=c),a.dataModel.roots.forEach(function(a){a.followers&&f.indexOf(a.id)>=0&&(a.expand=!0)});for(var g=[],h=0;h<e.length;h++){var i,j=e[h];j.id?(i=a.dataModel.getDataById(j.id),i&&g.push(i)):j.master&&(i=a.dataModel.getDataById(j.master.id),i&&i.followers&&i.followers.forEach(function(a){a.name===j.name&&g.push(a)}))}a._selectedByRestore=!0,a.selection=g,delete a._selectedByRestore,a.translateY=d},Dd.prototype.clearHighlight=function(){var a=this,b=a.dataModel;b.datas.forEach(function(a){a.s("blink.background",null)})},Dd.prototype.drawFollowersBackground=function(a){var b=this,c=b.dataModel,d=c.datas;if("list"!==b.layout)for(var e=0;e<d.length;e++){var f=d[e],g=f.followers;if(g&&g.length>0&&f.expand)for(var h=0;h<g.length;h++){var i=g[h],j=i.rect;j.x-=8,j.width+=16,a.beginPath(),a.fillStyle="rgb(82, 82, 82)";var l=b.itemWidth/48*8;0===h&&1===g.length?k.drawRoundRect(a,j.x,j.y,j.width,j.height,l,l,l,l):0===h?k.drawRoundRect(a,j.x,j.y,j.width,j.height,l,0,l,0):h===g.length-1?k.drawRoundRect(a,j.x,j.y,j.width,j.height,0,l,0,l):a.rect(j.x,j.y,j.width,j.height),a.fill()}}},Dd.prototype._initMenu=function(){var b=this,c=new qc.editor.ContextMenu([{label:ga._("New Folder"),func:"handkeMakeDir",disabled:function(){return b._isInVirtualDir()}},{label:ga._("Delete"),func:"handleDelete",disabled:function(){return b._isInVirtualDir()||0===b.selection.length}},{label:ga._("Rename"),func:"handleRename",disabled:function(){return b._isInVirtualDir()||1!==b.selection.length}},{type:"-"},{label:ga._("New JavaScript File"),func:"handleCreateJS",disabled:function(){var a=b._getMenuDestDir();return b._isInVirtualDir()||!ga.project.canCreateJSInPath(a)}},{type:"-"},{label:ga._("Reimport"),func:"handleReimport"},{type:"-"},{label:ga._("Show Retainers"),func:"handleFindReferences",disabled:function(){var a=ga.fileList.selectionModel.selection[0];return a&&a.treeData&&(a.treeData.assetType===ga.ASSET_TYPE.ASSET_JS||a.treeData.assetType===ga.ASSET_TYPE.ASSET_PREFAB)?!1:!0}},{label:ga._("Open in Local File Explorer"),func:"handleReveal",disabled:function(){return!/^(127\.0\.0\.1|localhost)(:\d+|)$/.test(a.location.host)}}]);c.on("action",function(a){a.item.func&&("function"==typeof a.item.func?a.item.func():b[a.item.func](a))}),c.addTo(b)},Dd.prototype._isInVirtualDir=function(a){var b=this;if(a=a||b.selectionModel.lastData&&b.selectionModel.lastData.treeData||ga.fileTree.selection[0],!a)return!1;for(var c=a.virtualDir;!c&&a;)a=a.parent,c|=a&&a.virtualDir;return c},Dd.prototype._getMenuDestDir=function(){var a,b=this,c=b.selectionModel.lastData;if(c){var d=c.treeData;d&&d.isDir&&(a=d.id)}return a||(a=b.currentDir),a},Dd.prototype.handkeMakeDir=function(){if(this._isInVirtualDir())return void ga.notification.error("{0} cannot be modified(builtin files).",data.treeData.id);var a=this._getMenuDestDir();lb(ga._("Enter a new folder name"),"",function(b){b&&b.length&&qc.editor.Operation.MKDIR(a?a+"/"+b:b)})},Dd.prototype.handleReveal=function(){qc.editor.Operation.REVEAL_IN_FINDER(this._getMenuDestDir())},Dd.prototype.handleRename=function(){var a=this.selectionModel.lastData;if(a){if(this._isInVirtualDir(a.treeData))return void ga.notification.error("{0} cannot be modified(builtin files).",data.treeData.id);this.beginEditing(a)}},Dd.prototype.handleDelete=function(){var a=this,b=a.selection.slice(0);0!==b.length&&kb(ga._("Sure to delete this file?"),ga._("Warning"),function(){b.forEach(function(b){b.treeData&&(a._isInVirtualDir(b.treeData)?ga.notification.error("{0} cannot be removed(builtin files).",b.treeData.id):b.treeData.predefined?ga.notification.error("{0} cannot be removed(builtin files).",b.treeData.id):(qc.editor.Operation.REMOVE(b.treeData.id),a.dataModel.remove(b),ga.fileTree.dataModel.remove(b.treeData)))})},null,{icon:"alert"})},Dd.prototype.handleCreateJS=function(){var a=this._getMenuDestDir();ga.project.canCreateJSInPath(a)&&lb(ga._("Enter a new JavaScript file name"),"",function(b){qc.editor.Operation.CREATE_JS(a,b)})},Dd.prototype.findScriptReferences=function(a){qc.editor.Operation.SOURCE(a,function(a){var b=a.source,c=b.match(/qc.defineBehaviour[\(\s]*['"](.*)['"]/);if(c){c=c[1];var d=[],e=function(a){for(var b=a.children,f=0;f<b.length;f++){for(var g=b[f],h=g.scripts,i=0;i<h.length;i++){var j=h[i];j["class"]===c&&d.push({node:g})}e(g)}};e(ga.game.world),ga.inspector.propertyView.inspect(null,"Panel:ReferencePanel",d)}})},Dd.prototype.findPrefabReferences=function(a){var b=a.resUUID,c=[],d=function(a){for(var e=a.children,f=0;f<e.length;f++){var g=e[f],h=g.getMeta();for(var i in h)if(16===h[i]&&g[i]&&g[i].key===b)c.push({node:g,property:i});else if(17===h[i]&&g[i])for(var j=0;j<g[i].length;j++)if(g[i][j].key===b){c.push({node:g,property:i});break}for(var k=g.scripts,j=0;j<k.length;j++){var l=k[j];h=l.getMeta();for(var i in h)if(16===h[i]&&l[i]&&l[i].key===b)c.push({node:g,script:l,property:i});else if(17===h[i]&&l[i])for(var m=0;m<l[i].length;m++)if(l[i][m].key===b){c.push({node:g,script:l,property:i});break}}d(g)}},e=ga.game.world;d(e),ga.inspector.propertyView.inspect(null,"Panel:ReferencePanel",c)},Dd.prototype.handleFindReferences=function(){var a=this.selectionModel.lastData,b=a.treeData;b&&(b.assetType===ga.ASSET_TYPE.ASSET_JS?this.findScriptReferences(b.id):b.assetType===ga.ASSET_TYPE.ASSET_PREFAB&&this.findPrefabReferences(b))},Dd.prototype.handleReimport=function(){var a=this._getMenuDestDir();ga.project.reimportResource(a)},Dd.prototype.handleDataDoubleSelect=function(a,b){var c=this;if(c.editable){if(c._pendingEditing)return void(c._pendingEditing="cancel");if(!L(a)&&b.treeData){var d=c.getDataUI(b);d.labelInfo&&v(d.labelInfo.rect,c.lp(a))&&(c._pendingEditing=!0,setTimeout(function(){c._pendingEditing&&(!k.popup&&"cancel"!==c._pendingEditing&&c.isSelected(b)&&c===ga.activeView&&c.beginEditing(b),delete c._pendingEditing)},700))}}},Dd.prototype.beginEditing=function(a){if(a.treeData){var b=this,c=b.getDataUI(a);if(c.labelInfo){var d,e,f,g,h,i,j=new qc.widget.TextField,k=j.getInput(),l=a.name,m=c.labelInfo.rect;if(j.maskRe=/[^\s\\/'"?\.]/,(h=l.indexOf(".mp3.bin"))>0&&h===l.length-8)l=l.substr(0,l.length-8),j.extension=".mp3.bin";else if((i=l.indexOf(".ogg.bin"))>0&&i===l.length-8)l=l.substr(0,l.length-8),j.extension=".ogg.bin";else{var o=l.lastIndexOf(".");o>0&&(j.extension=l.substr(o),l=l.substring(0,o))}"tile"===b.layout?(d=m.x+m.width/2-b.itemWidth/2,e=m.y,f=b.itemWidth,g=m.height):(d=m.x,e=m.y,f=b.width-d,g=m.height),d+=b.translateX,e+=b.translateY,b._currentEditor=j,b.view.appendChild(j.view),n(j,d,e,f,g),k.style.font=a.s("label.font"),k.onblur=function(){b.endEditing()},k.onkeydown=function(a){G(a)?b.endEditing():F(a)&&b.cancelEditing()},j._data=a,j.value=null==l?"":l,k.focus(),U(k.select,k)}}},Dd.prototype.rename=function(a,b){var c=a.treeData;if(c&&b&&b.length&&b!==a.name){var d=c.name;a.name=b,c.name=b,qc.editor.Operation.RENAME(c.id,ga.project.getFullPath(c,b)),c.assetType===ga.ASSET_TYPE.ASSET_SCENE&&d===ga.config.editor.currScene+".bin"&&(ga.config.editor.currScene=b.replace(".bin",""),ib())}},Dd.prototype.endEditing=function(){var a=this._currentEditor;a&&(this.rename(a._data,a.value+(null==a.extension?"":a.extension)),delete this._currentEditor,r(a.view),this.iv())},Dd.prototype.cancelEditing=function(){var a=this._currentEditor;a&&(delete this._currentEditor,r(a.view),this.iv())},Dd.prototype._clearDragInfo=function(){ga.dragAndDrop.hideTip(),this._dragInfo&&(this._dragInfo.focusData&&this._dragInfo.focusData.a("focused",!1),this._dragInfo=null,this.iv())},Dd.prototype._endDrag=function(){},Dd.prototype.handleDragAndDrop=function(a,b){if("prepare"===b)return void this._clearDragInfo();if("begin"===b){var c=this.draggingData.name;if(this.isSelected(this.draggingData)){var d=this.selection.length;c+=d>1?" (+"+d+") ":""}this._dragInfo={tip:c,view:this}}var e=this._dragInfo;if(e){if("begin"===b||"between"===b){var f=this.view.contains(Bb(a));return f?(e.inView=!0,e.focusData&&e.focusData.a("focused")===!0&&e.focusData.a("focused",!1),e.focusData=this.getDataAt(a),e.focusData&&e.focusData.a("focused",!0),this.autoScroll(a),ga.dragAndDrop.clearDropView(a,e)):(e.inView=!1,e.focusData&&(e.focusData.a("focused",!1),e.focusData=null),ga.dragAndDrop.crossDrag(a,e)),void ga.dragAndDrop.showTip(e.tip,a)}return"end"===b?(this._moveDragFiles(a,e),e.inView?this._endDrag(a,e):ga.dragAndDrop.crossDrop(a,e),void this._clearDragInfo()):"cancel"===b?(e.inView||ga.dragAndDrop.crossCancel(a,e),void this._clearDragInfo()):void 0}},Dd.prototype._moveDragFiles=function(a,b){var c,d=this;if(b.inView){var e=d.getDataAt(a);e&&(c=e.treeData)}else ga.dragAndDrop._dropView===ga.fileTree&&(c=ga.fileTree.getDataAt(a));if(c&&c.isDir){var f=c.id,g=d.draggingData;if(d.isSelected(g)){var h=[];d.selection.forEach(function(a){if(a.treeData){var b=a.treeData.id;ga.project.canMoveDir(b,f)&&(qc.editor.Operation.MOVE(b,f),h.push(a))}}),h.forEach(function(a){d.dataModel.remove(a),a.treeData.parent=c})}else if(g.treeData){var i=g.treeData.id;ga.project.canMoveDir(i,f)&&(qc.editor.Operation.MOVE(i,f),d.dataModel.remove(g),g.treeData.parent=c)}}},Dd.prototype._initCrossDND=function(){this.view._dropView=this},Dd.prototype.handleCrossDrag=function(a,b,c){if(c.view===ga.hierarchy){var d=this._crossFocusData;if("exit"===b||"cancel"===b)return void(d&&(d.a("focused",!1),this._crossFocusData=null));if(this._crossFocusData=this.getDataAt(a),"enter"===b||"over"===b)d!==this._crossFocusData&&(d&&d.a("focused",!1),this._crossFocusData&&this._crossFocusData.a("focused",!0));else if("drop"===b){var e=ga.hierarchy.draggingData;if(e){var f=e.node;f&&qc.editor.Operation.SAVE_PREFAB(f,this.currentDir+"/"+f.name+".prefab")}this._crossFocusData&&(this._crossFocusData.a("focused",!1),this._crossFocusData=null)}}},Dd.prototype._initNativeDND=function(){function a(a){a.preventDefault(),a.stopPropagation()}function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(a){a.preventDefault(),a.stopPropagation();for(var b=a.dataTransfer.files,c=b.length,d=0;c>d;d++){var f=b[d],g=new FileReader;g.onload=e,g.file=f,g.readAsArrayBuffer(f)}}function e(a){var b=a.target,c=b.result,d=b.file.name;ga.project.uploadFile(f.currentDir+"/"+d,c)}var f=this,g=this._interactionDiv;g.addEventListener("dragenter",a,!1),g.addEventListener("dragleave",b,!1),g.addEventListener("dragover",c,!1),g.addEventListener("drop",d,!1)};var Ed=m("qc.editor.FileListInteractor",qc.widget.graph.Interactor,function(a){this.fileList=a,this._dragging=!1,this._lastSelectDataTime=X(),Ed["super"].constructor.call(this,a)});Ed.prototype.clear=function(a){var b=this.fileList;this._dragging&&!this._dragCancel&&b.handleDragAndDrop(a,"end"),b.draggingData&&(b.draggingData=null,b.invalidateAll()),this._dragging=this._clientPoint=this._dragCancel=this._touchStartDataId=null},Ed.prototype.handle_mousedown=function(a){this.handle_touchstart(a)},Ed.prototype.handle_mouseup=function(a){this.handle_touchend(a)},Ed.prototype.handleWindowMouseMove=function(a){this.handleWindowTouchMove(a)},Ed.prototype.handleWindowMouseUp=function(a){this.handleWindowTouchEnd(a)},Ed.prototype.handle_touchstart=function(a){var b=this.fileList,c=b.getDataAt(a);if(!b.isCloseToVScrollBar(a)){this.clear(a),this._clientPoint=B(a);var d=b.isOnExpandIcon(a,c);d&&(c.expand=!c.expand,b.redraw()),N(a)?(c&&!d&&(this._touchStartDataId=c.id),!c&&b.clearSelectionOnBackgroundClicked&&b.selectionModel.clearSelection(),c&&b.handleDragAndDrop&&!b.isCloseToVScrollBar(a)&&!b.isOnExpandIcon(a,c)&&(b.draggingData=c,b.invalidateAll(),b.handleDragAndDrop(a,"prepare"),z(this,a))):(c&&(d||this.handleSelection(a,c)),this.clear(a))}},Ed.prototype.handle_touchend=function(a){if(this._clientPoint&&!this._dragging){var b=this.fileList.getDataAt(a);if(b&&b.id===this._touchStartDataId){var c=this.fileList.isOnExpandIcon(a,b);c||this.handleSelection(a,b)}}this.clear(a)},Ed.prototype.handleWindowTouchMove=function(a){this._dragging?this._dragCancel||this.fileList.handleDragAndDrop(a,"between"):this._clientPoint&&this.fileList.draggingData&&y(B(a),this._clientPoint)>2&&(this._dragging=!0,this.fileList.handleDragAndDrop(a,"begin"))},Ed.prototype.handleWindowTouchEnd=function(a){this.clear(a)},Ed.prototype.handleSelection=function(a,b){var c=this.fileList,d=c.selectionModel,e=d.lastData;if(P(a))c.isSelected(b)?d.removeSelection(b):d.appendSelection(b);else if(O(a))if(e)for(var f=c.dataModel.datas,g=f.indexOf(e),h=f.indexOf(b);g!==h;)g+=h>g?1:-1,d.appendSelection(f[g]);else d.selection=b;else if(N(a)){var i=X();d.isSelected(b)?i-this._lastSelectDataTime<1500&&c.handleDataDoubleSelect(a,b):d.selection=b,this._lastSelectDataTime=i}},Ed.prototype.handle_keydown=function(a){var b=this.fileList;if(F(a))this._dragging&&!this._dragCancel&&(b.handleDragAndDrop(a,"cancel"),this._dragCancel=!0);else if(J(a)||K(a)||H(a)||I(a)){var c=b.dataModel.datas,d=b.selectionModel.lastData;if(!c.length)return;if(d){var e=c.indexOf(d);e>=0&&(J(a)||H(a)?0!==e&&(d=c[e-1],b.selection=d):e!==c.length-1&&(d=c[e+1],b.selection=d))}else b.selection=c[0]}};var Fd=(m("qc.editor.FileListSelectionInteractor",b,function(a){var b=this;b._fileList=a,b.addListeners()},{clearHierarchySelection:function(){ga.hierarchy.selectionModel.clearSelection()},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){var b=this,c=b._fileList;if(b._isOnExpandIcon=null,b._startPoint=null,c.isCloseToVScrollBar(a));else{var d=c.getDataAt(a);d?(b._startPoint=B(a),b._isOnExpandIcon=c.isOnExpandIcon(a,d)):b.clearHierarchySelection()}},handle_mouseup:function(a){this.handle_touchend(a)},handle_touchend:function(a){var b=this,c=b._startPoint,d=B(a);!b._isOnExpandIcon&&c&&y(c,d)<2&&b.clearHierarchySelection(),b._startPoint=null,b._isOnExpandIcon=null}},{interactor:!0},{view:{get:function(){return this._fileList}}}),[{region:"top",elementConfig:{type:"container",layout:"table",scrollBarMode:"off",children:[{height:30,widths:["40+0.1",170],cells:[{fill:"none",vAlign:"middle",elementConfig:{type:"dropdownbutton",icon:"project_add",ninePatchImage:"project_add.9",ninePatchBorder:[10,10,10,10],hoverNinePatchImage:"project_add.9",hoverNinePatchBorder:[10,10,10,10],activeNinePatchImage:"project_add.9",activeNinePatchBorder:[10,10,10,10],borderWidth:0,preferredSize:{width:34,height:25},iconWidth:null,iconHeight:null,id:"projectCreate"}},{elementConfig:{type:"container",layout:{type:"hbox",align:"right"},children:[{type:"textfield",id:"searchField",preferredSize:{width:160},padding:[2,0,2,22]}]}}]}]}},{region:"left",elementConfig:{type:"qc.editor.FileTree",id:"fileTree",preferredSize:{width:140}}},{region:"center",elementConfig:{type:"container",layout:{type:"border",bottomSplitterVisible:!1},children:[{region:"center",elementConfig:{type:"qc.editor.FileList",id:"fileList"}},{region:"bottom",elementConfig:{type:"container",layout:"table",scrollBarMode:"off",children:[{height:26,widths:[.1,70],cells:[{elementConfig:{type:"qc.editor.Text",id:"filePathLabel",align:"left"}},{elementConfig:{type:"slider",id:"projectSlider",preferredSize:{width:70,height:26},min:1,max:100}}]}]}}]}}]),Gd=m("qc.editor.Project",qc.widget.Container,function Jf(a){var b=this;Jf["super"].constructor.call(b,a),b.layout=new qc.widget.layout.BorderLayout(b),o(Fd,b),b.layout.topToggleVisible=!1,b.layout.topResizable=!1,b.layout.leftToggleVisible=!1,b.layout.splitterSize=1,b.layout.topSplitterSize=2,ga.fileTree=b.findViewById("fileTree"),ga.fileList=b.findViewById("fileList"),this._searchField=b.findViewById("searchField");var d=this._searchField.input.style;d.backgroundImage='url("'+ga.assetPath+'magnifying-glass.png")',d.backgroundRepeat="no-repeat",d.backgroundSize="17px 17px",d.backgroundPosition="2px 50%";var e=b.findViewById("projectCreate");e.menuItems=[{label:ga._("Folder")},{type:"-"},{label:ga._("JavaScript File"),createType:"js",
disabled:function(){if(!ga||!ga.project)return!0;var a=ga.project._getMenuDestDir();return ga.project.canCreateJSInPath(a)?!1:!0}}],e.contextMenu.on("action",function(a){var c=a.item;b._handleCreateMenu(c)}),b._slider=b.findViewById("projectSlider");var f=b._filePathLabel=b.findViewById("filePathLabel");f.iv=function(a){var b=this._sourceText;if(b){var c=k.getTextSize(k.labelFont,b);this._text=c.width>this.width?"<marquee>"+b+"</marquee>":b}else this._text="";qc.editor.Text.prototype.iv.call(this,a)},ga.fileList.selectionModel.on("selectionChange",function(){if(!b._updatingFileListDataModel){var a=ga.fileList.selectionModel.lastData;if(a&&a.treeData){b._fileListSelectionId=a.id;for(var d=a.treeData,e=d.name;d.parent&&d.parent.parent;)e=d.parent.name+"/"+e,d=d.parent;f._sourceText=e,f.iv()}else b._fileListSelectionId=c,f._sourceText="",f.iv()}}),b._initSlider(),b._initSearchField()});Gd.prototype._initSlider=function(){var a=this,b=a._slider,c=ga.fileList;b.value=32,b.disableToolTip(),b.onValueChange=function(a){16>=a?1===a?c.layout="list":b.value=1:(c.layout="tile",c.itemWidth=c.itemHeight=40+Math.round(.5*a-8))}},Gd.prototype._initSearchField=function(){var a=this;a._searchField.on("propertyChange",function(b){"value"===b.property&&a.onSearchFieldChanged()})},Gd.prototype.onSearchFieldChanged=function(){var a=this,b=ga.fileList,c=a.searchValue;if(a._updatingFileListDataModel=!0,c.length){b.dataModel.clear(),b.contentType="search";var d=new RegExp(c,"i"),e=function(a,c){var f=a.name;!c&&d.test(f)&&b.addFileNode(a),a.children&&a.children.forEach(function(a){e(a)})};ga.fileTree.topRowOrderSelection.forEach(function(a){e(a,!0)})}else if("search"===b.contentType){var f=b.dataModel.getDataById(a._fileListSelectionId);f?ga.fileTree.selectionModel.selection=[f.treeData.parent]:this.onTreeSelectionChange()}b.selectionModel.selection=b.dataModel.getDataById(a._fileListSelectionId),a._updatingFileListDataModel=!1},Gd.prototype.canMoveDir=function(a,b){var a=a.replace(/\\/g,"/"),b=b.replace(/\\/g,"/"),c=["","Assets","Editor","ProjectSetting","Scripts","Temp"];if(c.indexOf(a)>=0)return ga.notification.warn(ga._("Built-in files cannot be modified")),!1;if(0===a.indexOf("Plugins")||0===b.indexOf("Plugins"))return ga.notification.warn(ga._("Built-in files cannot be modified")),!1;var d=0===a.indexOf("Assets/raw"),e=0===b.indexOf("Assets/raw");return!d&&e?(ga.notification.warn(ga._("Can not move file into raw floder")),!1):a===b?!1:b.indexOf(a)>=0?!1:a.indexOf(b)>=0&&tb(a)==b?!1:!0},Gd.prototype.onTreeSelectionChange=function(){var a=ga.fileList;a.dataModel.clear(),a.contentType="explore";var b=ga.fileTree.selectionModel.lastData;b&&(this.searchValue="",a.currentDir=b.id,b.children.forEach(function(b){a.addFileNode(b)}))},Gd.prototype.getFullPath=function(a,b){if(b=b||a.name,a.parent){var c=a.parent.id;return c?c+"/"+b:b}return""},Gd.prototype.exploreTree=function(a,b){b=b||ga.game.world;for(var c,d=b.children,e=this,f=0,g=d.length;g>f;f++)c=d[f],a(c),e.exploreTree(a,c)},Gd.prototype.findFileNodeByUUID=function(a){var b,c=this;return ga.fileTree.dataModel._roots.forEach(function(d){c.exploreTree(function(c){c.resUUID===a&&(b=c)},d)}),b},Gd.prototype.findByUUID=function(a,b){if(!ga.hiddenGame)return null;var c=ga.hiddenGame.assets.find(a);return c?this.descAssetByType(c,b):null},Gd.prototype.findByType=function(a,b){var c=ga.hiddenGame.assets._assets,d=[];for(var e in c){var f=c[e];f.meta&&f.meta.type===a&&d.push(this.descAssetByType(f,b))}return d},Gd.prototype.findByName=function(a,b){var c=ga.hiddenGame.assets._assets,d=[];for(var e in c){var f=c[e];f.url.indexOf(a)>=0&&d.push(this.descAssetByType(f,b))}return d},Gd.prototype.descAssetByType=function(a,b){switch(b){case"basename":return sb(a.url);case"name":return a.url;case"uuid":return a.uuid;case"type":return a.meta.type;default:return a}},Gd.prototype.uploadFile=function(a,b){var c=this.pendingUpload;if(c||(this.pendingUpload=c={list:[],index:0}),c.list.push([a,b]),!c.isUploading){c.isUploading=!0;var d=this,e=function(){if(d.pendingUpload.index===d.pendingUpload.list.length)return void delete d.pendingUpload;var a=d.pendingUpload.list[c.index++];setTimeout(function(){qc.editor.Operation.UPLOAD(a[0],a[1],e)},30)};e()}},Gd.prototype.getImageURLByAtlas=function(a){var b,c;if(a.meta&&a.meta.source){c=a.meta.source;for(var d=0,e=c.length;e>d;d++)if(".json"!==c[d]){b=c[d];break}}return b=b||".png",ga.service.url+a.url.slice(0,-4)+b},Gd.prototype.getImageURLByTreeData=function(a){var b,c;if(a.source){c=a.source;for(var d=0,e=c.length;e>d;d++)if(".json"!==c[d]){b=c[d];break}}return b=b||".png",ga.service.url+a.id.slice(0,-4)+b},Gd.prototype.reimportResource=function(a){var b=ga.fileTree.dataModel.getDataById(a);if(b){var d=[];return ga.project.exploreTree(function(a){a.assetType!==c&&a.assetType!==ga.ASSET_TYPE.ASSET_UNKNOWN&&a.assetType!==ga.ASSET_TYPE.ASSET_JS&&d.push(a.id)},b),d.length?void qc.editor.Operation.REMOVE_BIN(d,function(){ga.notification.info(ga._("Reimport completed"))}):void qc.editor.Operation.EXPLORE()}},Gd.prototype.canCreateJSInPath=function(a){return/^(Scripts|Editor)($|\/)/.test(a)},Gd.prototype._getMenuDestDir=function(){var a;return ga.activeView===ga.fileList&&(a=ga.fileList._getMenuDestDir()),a||(a=ga.fileTree._getMenuDestDir()),a},Gd.prototype._handleCreateMenu=function(a){var b,c=this,d=a.createType||"folder";b=c._getMenuDestDir(),"string"==typeof b&&lb(ga._("js"===d?"Enter a new JavaScript file name":"Enter a new folder name"),"",function(a){if(a&&a.length)if("folder"===d)qc.editor.Operation.MKDIR(b?b+"/"+a:a);else if("js"===d){if(".js"!==a.slice(-3)&&(a+=".js"),a=b+"/"+a,ga.fileTree.dataModel.getDataById(a))return;qc.editor.Operation.UPLOAD(a,"")}})},b.defineProperties(Gd.prototype,{sliderValue:{get:function(){return this._slider.value},set:function(a){this._slider.value=a}},searchValue:{get:function(){return this._searchField.value},set:function(a){this._searchField.value=a}}});var Hd=qc.editor.Service=function(a,b){ga.service=this,this._ip=a||"127.0.0.1",this._port=b||5002,this._url="http://"+this.ip+":"+this.port+"/",this._cookie=0,this._cbs={},this._cmds={};for(var c in Hd.prototype.cmds)Hd.prototype.cmds[c]()};Hd.prototype={},Hd.prototype.constructor=Hd,Hd.prototype.cmds=[],b.defineProperties(Hd.prototype,{ip:{get:function(){return this._ip}},port:{get:function(){return this._port}},url:{get:function(){return this._url}}}),Hd.prototype.connect=function(){console.log("** Connect to server, ip:",this.ip," port:",this.port,"**"),this.socket&&(this.socket.close(),this.socket=null);var a=this.socket,b=this,c=this.socket=io.connect("http://"+this.ip+":"+this.port);if(c.connection=this,a===this.socket)return this.socket;c.on("OPERATION_DONE",function(a,c){b._done(a,c)});for(var d in b._cmds)b._registerCmdToIO(d);return c.on("connect_failed",function(){alert(ga._("Connect failed"))}),c},Hd.prototype.request=function(a,b,c){return this.isConnected?(this._cookie++,"function"==typeof c&&(this._cbs[this._cookie]=c),this.socket.emit(a,this._cookie,b),!0):!1},b.defineProperty(Hd.prototype,"isConnected",{get:function(){return this.socket&&this.socket.connected}}),Hd.prototype.registerCmd=function(a){if("function"!=typeof a.main||"string"!=typeof a.name)throw new Error("消息处理器未正确定义。");this._cmds[a.name]&&console.error("消息处理器已经存在了！",a.name),this._cmds[a.name]=a},Hd.prototype._done=function(a,b){var c=this._cbs[a];c&&(c(b),delete this._cbs[a])},Hd.prototype._registerCmdToIO=function(a){var b=this;b.socket.on(a,function(c){var d=b._cmds[a];d.main.call(d,c)})};var Id=m("qc.editor.ImageList",qc.editor.ItemList,function Kf(a){var b=this;Kf["super"].constructor.call(b,a),b.tileSize=48,b.selectionModel.on("selectionChange",function(){var a=b.selectionModel.selection;1===a.length&&(a=a[0]),b.emit(ga.e.SELECT_IMAGE,a)}),b.view.style.background="white",b.view.style.border="1px solid rgb(97, 97, 97)"},{_layout:"tile"});Id.prototype.add=function(a,b,c,d,e,f){var g=new qc.editor.ItemNode;g.name=a,g.image=b,g.a("clipX",c),g.a("clipY",d),g.a("clipWidth",e),g.a("clipHeight",f),this.dataModel.add(g)},Id.prototype.remove=function(a){for(var b=this.dataModel,c=b.datas,d=0;d<c.length;d++){var e=c[d];if(e.name===a){b.remove(e);break}}},b.defineProperties(Id.prototype,{tileSize:{get:function(){return this._tileSize},set:function(a){var b=this._tileSize;b!==a&&(this.setPropertyValue("tileSize",a),this.itemWidth=a,this.itemHeight=a)}}}),Id.prototype.calculateClientWidth=function(){return this.width-2},Id.prototype.calculateClientHeight=function(){return this.height-2};var Jd={name:"FILE_CHANGED",main:function(b){if(ga.bgLoad){var d=b.fileName;d&&ga.bgLoad.markForceLoad(b);var e=this,f=(new Date).getTime();f-e._fileChangeMutex<500&&e._timeoutID&&clearTimeout(e._timeoutID),e._fileChangeMutex=f,e._timeoutID=setTimeout(function(){delete e._fileChangeMutex,delete e._timeoutID,qc.editor.Operation.EXPLORE()},500);var g=d.replace(/\\/g,"/");0===g.indexOf("Assets/raw")&&/\.(png|gif|jpg|jpeg)/.test(g.toLowerCase())&&qc.widget.Default.setImage(ga.service.url+g,c);var h={unlink:1,change:1,add:1,rename:1};if(h[b.event]&&d&&(d.indexOf("globalUrlMap.js")<0&&d.indexOf(".js")===d.length-3||d.indexOf(".css")===d.length-4)){if(null!=e._scriptTimeoutID)return;if(!ga.workable)return;e._scriptTimeoutID=setTimeout(function(){var b=[],c=[],f=function(a,d){a&&a.forEach(function(a){var e=a.siblings.indexOf(a);d?e=d+"/"+e:e+="",ga.hierarchy.isExpanded(a)&&b.push(e),ga.hierarchy.selectionModel.isSelected(a)&&c.push(e),f(a.children,e)})},g=ga.hierarchy.rootData;f(g.children,""),ga.storage.set("hierarchyExpandedDatas",b),ga.storage.set("hierarchySelectedDatas",c),ga.windowFocused&&!ga.playing?(ga.e.emit(ga.e.JS_CHANGED),qc.editor.Operation.SAVE_CURR_SCENE(function(){0===d.indexOf("Editor/")?(ga.silentRefresh=!0,a.location.reload()):ga.scene.reload()}),delete e._scriptTimeoutID):(0===d.indexOf("Editor/")?ga.reloadEditorOnFocus=!0:ga.reloadSceneOnFocus=!0,delete e._scriptTimeoutID)},500)}}}};qc.editor.Service.prototype.cmds.push(function(a){return function(){ga.service.registerCmd(a)}}(Jd));var Jd={name:"NEW_VERSION_AVAILABLE",main:function(){ga.inspector&&ga.inspector.propertyView&&ga.inspector.propertyView.children[0]instanceof qc.editor.CheckForUpdatesEditor?ga.inspector.propertyView.children[0].queryLatestVersion(!1):qc.editor.version.checkLatestUpdates()}};qc.editor.Service.prototype.cmds.push(function(a){return function(){ga.service.registerCmd(a)}}(Jd));var Jd={name:"PROGRESS_UPDATE_VERSION",main:function(a){qc.editor.version.progressUpdateDialog(a.percent),a.percent<0&&qc.editor.version.showUpdateFailed(a.percent),a.percent<80?qc.editor.version.progressUpdateDialog(a.percent,ga._("Downloading...")):a.percent<90?qc.editor.version.progressUpdateDialog(a.percent,ga._("Backup current version...")):a.percent<100?qc.editor.version.progressUpdateDialog(a.percent,ga._("Completing update...")):(qc.editor.Operation.NOTIFY_UPDATE_MESSAGE_RECEIVED(),setTimeout(function(){qc.editor.version.showUpdateFinished()},1e3))}};qc.editor.Service.prototype.cmds.push(function(a){return function(){ga.service.registerCmd(a)}}(Jd));var Jd={name:"UPDATE_VERSION_RESULT",main:function(a){ga.project&&ga.notification.info(0!==a.result?ga._("Update failed, please try again later."):ga._("Updated successfully, restart the node.js server and refresh this page"))}};qc.editor.Service.prototype.cmds.push(function(a){return function(){ga.service.registerCmd(a)}}(Jd));{qc.editor.Operation={}}qc.editor.Operation.ADD_DEPENDENCE=function(a,b,c){var d=function(a){c&&c(a)};ga.service.request("ADD_DEPENDENCE",{item:a,dep:b},d)},qc.editor.Operation.ARCHIVE_VERSION=function(a,b){ga.service.request("ARCHIVE_VERSION",{version:a},b)},qc.editor.Operation.ASSET_TYPE=function(a,b){var c=function(a){b&&b(a)};ga.service.request("ASSET_TYPE",a,c)},qc.editor.Operation.CHECK_FOR_UPDATES=function(a,b){ga.service.request("CHECK_FOR_UPDATES",{needQuery:a},b)},qc.editor.Operation.CREATE_JS=function(a,b,c){b&&b.length&&(".js"!==b.slice(-3)&&(b+=".js"),ga.fileTree.dataModel.getDataById(a+"/"+b)||ga.service.request("CREATE_JS",{destDir:a,name:b},c))},qc.editor.Operation.CREATE_PROJECT=function(a,b){ga.service.request("CREATE_PROJECT",{path:a},function(a){a&&a.operRet===!0?b&&b(!0):b&&b(!1,a.reason)})},qc.editor.Operation.DEBUG=function(a,b){var c=function(a){ga.log.trace("DEBUG请求结果：{1}",a),b&&b(a)};ga.log.trace("Debug请求：{0}",a),ga.service.request("DEBUG",a,c)},qc.editor.Operation.DOWNSCALE_ANIMATION=function(a,b){var c,d=function(a){b&&b(a),ga.notification.info(ga._("Downscaling is done."))};if(a)c=[ga.fileTree.dataModel.getDataById(a)];else{if(c=ga.fileList.dataModel.selectionModel.selection,!c||!c.length)return void ga.notification.error(ga._("Please select an animation asset"));for(var e=0,f=c.length;f>e;e++)c[e]=c[e].treeData}for(var e=0,f=c.length;f>e;e++){var g=c[e];if(g){var h=g.resUUID,i=ga.project.findByUUID(h);if(i&&i.img&&i.json){var j=i.img,k=j.width/2,l=j.height/2,m=document.createElement("canvas");m.setAttribute("width",k),m.setAttribute("height",l);var n=m.getContext("2d");n.drawImage(j,0,0,k,l);var o=m.toDataURL();ga.service.request("DOWNSCALE_ANIMATION",{img:o,dir:i.url},d)}}}},qc.editor.Operation.EXPLORE=function(){var a=function(a){var b=ga.fileTree,c=ga.fileList,d=b.translateY,e=b.selection.slice(),f=b.expandedDatas;c.savePanelContext(),b.dataModel.clear(),b.constructTree(a);for(var g=0;g<f.length;g++){var a=b.dataModel.getDataById(f[g].id);a&&b.expand(a)}for(var h=[],g=0;g<e.length;g++){var a=b.dataModel.getDataById(e[g].id);a&&h.push(a)}h.length||(h=b.dataModel.roots[0]),b.selection=h,b.translateY=d,c.restorePanelContext(),ga.e.emit(ga.e.EXPLORE)};ga.service.request("EXPLORE",c,a)},qc.editor.Operation.GET_SCENE_BACKUP_LIST=function(a,b){var c=function(a){b&&b(a)};ga.service.request("GET_SCENE_BACKUP_LIST",{name:a},c)},qc.editor.Operation.GET_USER_HOME_DIR=function(a){var b=function(b){a&&a(b)};ga.service.request("GET_USER_HOME_DIR",{},b)},qc.editor.Operation.IMPORT_RESOURCE=function(a,b,c,d){var e=function(a){d&&d(a)};ga.service.request("IMPORT_RESOURCE",{dir:a,binName:b,files:c},e)},qc.editor.Operation.INSTALL_PLUGIN=function(a,b,c,d){ga.service.request("INSTALL_PLUGIN",{pluginId:a,version:b,session:c},d)},qc.editor.Operation.IS_SCRIPT_ENTRY=function(a,b){var c=function(a){b&&b(a)};ga.service.request("IS_SCRIPT_ENTRY",{item:a},c)},qc.editor.Operation.LIST_DIR=function(a,b){var c=function(a){b&&b(a)};ga.service.request("LIST_DIR",a,c)},qc.editor.Operation.MKDIR=function(a,b){var c=function(a){a.operRet?ga.notification.info(ga._("Folder created")):ga.notification.error(ga._("Failed to create folder")),b&&b(a)};ga.service.request("MKDIR",{dir:a},c)},qc.editor.Operation.MOVE=function(a,b,c){var d=a.lastIndexOf(a.indexOf("\\")>=0?"\\":"/"),e=b+"/"+a.substr(d+1);qc.editor.Operation.RENAME(a,e,c)},qc.editor.Operation.NEW_SCENE=function(){if(ga.prefabInfo)return void ga.notification.warn(ga._("Stop editing prefab first"));var a=function(){ga.service.request("NEW_SCENE",!0,function(){ga.storage.set("switchScene","1"),ga.config.editor.currScene="",ga.scene.reload(),ib()})};return ga.playing?void nb(ga._("Stop running game?"),ga._("Confirm"),[{text:ga._("Stop"),key:"enter",onClick:function(){this.hide(),ga.playing=!1;var b=function(){a(),ga.e.off(ga.e.GAME_CHANGE,b)};ga.e.on(ga.e.GAME_CHANGE,b)}},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}]):void mb(a)},qc.editor.Operation.NOTIFY_UPDATE_MESSAGE_RECEIVED=function(a){ga.service.request("NOTIFY_UPDATE_MESSAGE_RECEIVED",{},a)},qc.editor.Operation.OPEN_JS=function(b){var c=/^(127\.0\.0\.1|localhost|192.168.*)(:\d+|)$/.test(a.location.host);c&&ga.service.request("OPEN_JS",b)},qc.editor.Operation.OPEN_PROJECT=function(a,b){ga.service.request("OPEN_PROJECT",{path:a},function(a){a&&a.operRet===!0?b&&b(!0):b&&b(!1)})},qc.editor.Operation.PUBLISH=function(a){var b=function(b){b&&b.operRet?ga.notification.info(ga._("Publish succeeded")):ga.notification.error(ga._("Publish failed:")+(b.reason?"，"+b.reason:"。")),a&&a(b)};ga.service.request("PUBLISH",{},b)},qc.editor.Operation.QUERY_EDITORSERVICE_SETTING=function(a,b){var c=function(a){a&&a.operRet===!1&&a.reason&&ga.notification.error(a.reason),b&&b(a)};ga.service.request("QUERY_EDITORSERVICE_SETTING",{key:a},c)},qc.editor.Operation.QUERY_PLUGIN_INFO=function(a){ga.service.request("QUERY_PLUGIN_INFO","",a)},qc.editor.Operation.QUERY_PLUGIN_SCRIPT=function(a,b){ga.service.request("QUERY_PLUGIN_SCRIPT",{id:a},b)},qc.editor.Operation.QUERY_SETTINGS=function(a){var b=function(b){ga.config=b,a&&a()};ga.service.request("QUERY_SETTINGS","",b)},qc.editor.Operation.RECENT_OPEN=function(a,b){ga.service.request("RECENT_OPEN",{checkTempScene:b},function(b){var c;b&&b.operRet===!0?c=b.resent:(c=[],ga.notification.error(ga._("Failed to fetch recent projects list")));var d=b.checkRet;a&&a(c,d,b.unsaved)})},qc.editor.Operation.REMOVE=function(a){var b=function(a){a.operRet?ga.notification.info(ga._("Remove completed")):ga.notification.error(ga._("Remove failed:")+a.reason)};ga.service.request("REMOVE",a,b)},qc.editor.Operation.REMOVE_BIN=function(a){var b=function(){};ga.service.request("REMOVE_BIN",a,b)},qc.editor.Operation.REMOVE_DEPENDENCE=function(a,b,c){var d=function(a){c&&c(a)};ga.service.request("REMOVE_DEPENDENCE",{item:a,dep:b},d)},qc.editor.Operation.REMOVE_RECENT_OPEN=function(a,b){ga.service.request("REMOVE_RECENT_OPEN",{path:a},function(a){a||(a={operRet:!1},ga.notification.error(ga._("Failed to fetch recent projects list"))),b&&b(a)})},qc.editor.Operation.RENAME=function(a,b,c){var d=function(a){ga.notification.info(ga._("Rename succeeded")),c&&c(a)};ga.service.request("RENAME",{old:a,"new":b},d)},qc.editor.Operation.REVEAL_IN_FINDER=function(a,b){ga.service.request("REVEAL_IN_FINDER",{path:a},function(a){a&&a.operRet===!0?b&&b(!0):b&&b(!1)})},qc.editor.Operation.REVERT_SCENE_TO_REVISION=function(a,b,c){var d=function(a){a&&a.operRet===!1&&a.reason&&ga.notification.error(a.reason),c&&c(a)};ga.service.request("REVERT_SCENE_TO_REVISION",{state:a,version:b},d)},qc.editor.Operation.REVERT_TO_DRAGONBONES=function(a,b){var c=function(a){var c=a&&a.operRet===!0;c?ga.notification.info("Revert to Dragonbones successfully."):ga.notification.warn(a&&a.reason?a.reason:ga._("Operate Failed")),b&&b(c)};ga.service.request("REVERT_TO_DRAGONBONES",{path:a},c)},qc.editor.Operation.SAMPLE_DRAGON_BONES=function(a,b,d){var e,f=function(a){ga.notification.info(ga._("DragonBone({0}) sampling is done"),e),d&&d(a)},g=function(a){var b=[],c=function(a,d,e,f,g,h,i){a.children.forEach(function(a){var j,k,l,m,n,o;if("qc.UIImage"===a["class"]){var p=a.phaser,q=a.pivotX,r=a.pivotY;if(isNaN(q)||isNaN(r))return;var s=Math.cos(a.skewY||0),t=Math.sin(a.skewY||0),u=-Math.sin(a.skewX||0),v=Math.cos(a.skewX||0),w=p.position.x,x=p.position.y,y=Math.sin(p.rotation),z=Math.cos(p.rotation),A=z*p.scale.x,B=y*p.scale.x,C=-y*p.scale.y,D=z*p.scale.y,E=0,F=0;j=A*s+B*u,k=A*t+B*v,l=C*s+D*u,m=C*t+D*v,n=E*s+F*u+w,o=E*t+F*v+x;var G=j,H=l,I=n;j=j*d+k*f,k=G*e+k*g,l=l*d+m*f,m=H*e+m*g,n=n*d+o*f+h,o=I*e+o*g+i;var J=function(a){return Math.floor(1e3*a)/1e3};b.push({uuid:a.uuid,frame:a.frame},J(j),J(k),J(l),J(m),J(n),J(o),J(q),J(r),Math.floor(255*a.alpha))}else{var y=Math.sin(a.rotation),z=Math.cos(a.rotation);j=z*a.scaleX,k=y*a.scaleX,l=-y*a.scaleY,m=z*a.scaleY,n=a.x,o=a.y;var G=j,H=l,I=n;j=j*d+k*f,k=G*e+k*g,l=l*d+m*f,m=H*e+m*g,n=n*d+o*f+h,o=I*e+o*g+i}c(a,j,k,l,m,n,o)})};return c(a,1,0,0,1,0,0),b},h=function(a,b){var c=a.phaser.texture.baseTexture.width,d=a.phaser.texture.baseTexture.height,e=a.texture.getFrame(b),f=e.width,g=e.height,h=e.x,i=e.y;return[h/c,i/d,(h+f)/c,(i+g)/d]},i=function(a,b){for(var d={uvs:[],samples:{}},e=a.animationNameList,f=d.samples,i=0,j=e.length;j>i;i++){var k=e[i],l=8,m=[];f[k]={loop:0===a.getAnimationInfo(k).loop?!0:!1,rate:b,frames:m},a._armature.animation.gotoAndPlay(k,0,c,1),a._armature.advanceTime(0),m.push(g(a));for(var n=0;!a.isComplete&&a.lastAnimationName===k;){for(n=0;l>n&&(a._armature.advanceTime(1/(l*b)),!a.isComplete&&a.lastAnimationName===k);n++);m.push(g(a))}f[k].last=(m.length-2)*l+2+n}for(var o,p=[],q=[],i=0,j=e.length;j>i;i++)for(var k=e[i],m=f[k].frames,r=0,s=m.length;s>r;r++)for(var t=m[r],u=0,v=t.length;v>u;u+=10){var w=t[u],x=w.uuid,y=p.indexOf(x);y>=0?t[u]=y:(p.push(x),q.push(w.frame),t[u]=p.length-1)}o=d.uvs=new Array(4*q.length);for(var i=0,j=q.length;j>i;i++){var z=h(a,q[i]);o[4*i+0]=z[0],o[4*i+1]=z[1],o[4*i+2]=z[2],o[4*i+3]=z[3]}return d};lb(ga._("Sample Frame Rate(1-60, default 15)"),"15",function(c){if(!c)return void(b&&b(!1));if(c=Math.round(1*c),isNaN(c)||c>60||0>=c)return ga.notification.error(ga._("Please input an integer between 1 - 60")),void(b&&b(!1));var d,g;if("qc.Sprite"===a["class"])d=a;else{var d=ga.hiddenGame.add.sprite();d.texture=a,g=!0}e=d.texture.url,ga.service.request("SAMPLE_DRAGON_BONES",{path:e,samples:i(d,c)},f),g&&d.destroyImmediately(),b&&b(!0)})},qc.editor.Operation.SAVE_ATLAS=function(a,b,c,d){var e=function(a){d&&d(a)};ga.service.request("SAVE_ATLAS",{atlasName:a,imageContent:b,json:c},e)},qc.editor.Operation.SAVE_CURR_SCENE=function(a){if(ga.workable){if(ga.prefabInfo)return void(a&&a());if(!ga.scene.editable)return void(a&&a());if(!ga.sceneManager.dirty)return void(a&&a());var b={},c=ga.game.serializer.buildBundle(ga.game.world,b);c.dependences=ga.game.serializer.combineDependence(b);var d=function(){a&&a()};ga.sceneManager.dirty=!1,ga.sceneManager.unsaved=!0,console.log("temporary scene have changed, save it."),ga.service.request("SAVE_CURR_SCENE",{data:c},d)}},qc.editor.Operation.SAVE_EDITORSERVICE_SETTING=function(a,b,c){var d=function(a){a&&a.operRet===!1&&a.reason&&ga.notification.error(a.reason),c&&c(a)};ga.service.request("SAVE_EDITORSERVICE_SETTING",{key:a,value:b},d)},qc.editor.Operation.SAVE_PADDING=function(a,b,c,d){var e=function(a){d&&d(a)};ga.service.request("SAVE_PADDING",{texturePath:a,frame:b,padding:c},e)},qc.editor.Operation.SAVE_PLUGIN_INFO=function(a,b){var c=function(a){b&&b(a)};ga.service.request("SAVE_PLUGIN_INFO",{data:a},c)},qc.editor.Operation.SAVE_PREFAB=function(a,b){if(a!==ga.game.world){var c={},d=ga.game.serializer.buildBundle(a,c);d.dependences=ga.game.serializer.combineDependence(c);var e=function(b){a._prefab=b,ga.notification.info(ga._("Prefab saved"))};ga.service.request("SAVE_PREFAB",{path:b,data:d},e)}},qc.editor.Operation.SAVE_SCENE=function(a){if(ga.workable){if(ga.prefabInfo)return void ga.notification.warn(ga._("Stop editing prefab first"));var b={},c=ga.game.serializer.buildBundle(ga.game.world,b);c.dependences=ga.game.serializer.combineDependence(b);var d=function(){ga.notification.info(ga._("Scene saved")),ga.e.emit(ga.e.SCENE_SAVED,a)};ga.sceneManager.unsaved=!1,ga.sceneManager.dirty=!1,ga.service.request("SAVE_SCENE",{data:c,name:a},d)}},qc.editor.Operation.SET_SCRIPT_ENTRY=function(a,b){var c=function(a){a&&a.operRet===!1&&a.reason&&ga.notification.error(a.reason),b&&b(a)};ga.service.request("SET_SCRIPT_ENTRY",{item:a},c)},qc.editor.Operation.SOURCE=function(a,b){ga.service.request("SOURCE",a,b)},qc.editor.Operation.SWITCH_SCENE=function(a){if(ga.prefabInfo)return void ga.notification.warn(ga._("Stop editing prefab first"));var b=function(){ga.sceneManager.unsaved=!1,ga.sceneManager.dirty=!1,ga.service.request("SWITCH_SCENE",a,function(){ga.storage.set("switchScene","1"),ga.config.editor.currScene=a,ga.scene.reload(),ib()})};if(ga.playing){var c=function(){this.hide(),ga.playing=!1;var a=function(){b(),ga.e.off(ga.e.GAME_CHANGE,a)};ga.e.on(ga.e.GAME_CHANGE,a)};return void nb(ga._("Stop running game?"),ga._("Confirm"),[{text:ga._("Stop"),key:"enter",onClick:c},{text:ga._("Cancel"),key:"esc",onClick:function(){this.hide()}}])}mb(b)},qc.editor.Operation.UPDATE_EDITOR_SETTINGS=function(a){ga.service.request("UPDATE_EDITOR_SETTINGS",a)},qc.editor.Operation.UPDATE_PROJECT_SETTINGS=function(a){ga.service.request("UPDATE_PROJECT_SETTINGS",a)},qc.editor.Operation.UPDATE_SCENE_SETTINGS=function(a){var b=function(a){ga.config.scene=a};ga.service.request("UPDATE_SCENE_SETTINGS",a,b)},qc.editor.Operation.UPDATE_VERSION=function(a){ga.service.request("UPDATE_VERSION","",a)},qc.editor.Operation.UPLOAD=function(a,b,c){ga.service.request("UPLOAD",{path:a,content:b},c)};var Kd=qc.editor.BgLoad=function(){ga.bgLoad=this,this.editorSceneForceLoad={},this.editorSceneDownloadList={},this.hiddenSceneForceLoad={},this.hiddenSceneDownloadList={},ga.e.on(ga.e.HIDDEN_SCENE_LOADED,this.tryHiddenSceneDownload);var a=this;ga.e.on(ga.e.GAME_CHANGE,function(){a.canEditorSceneDownload=!1}),ga.e.on(ga.e.SCENE_LOADED,function(){a.canEditorSceneDownload=!0,a.tryEditorSceneDownload()})};Kd.prototype={},Kd.prototype.constructor=Kd,Kd.prototype.clearResources=function(){this.editorSceneDownloadList={},this.hiddenSceneDownloadList={}},Kd.prototype.addResource=function(a,b,c){b.indexOf("@atlas")>=0||(c!==ga.ASSET_TYPE.ASSET_SCENE&&(this.editorSceneDownloadList[a]=b),this.hiddenSceneDownloadList[a]=b,this.tryHiddenSceneDownload(),this.tryEditorSceneDownload())},Kd.prototype.markForceLoad=function(a){var b=a.fileName.replace(/\\/g,"/");this.editorSceneForceLoad[b]=a,this.hiddenSceneForceLoad[b]=a},Kd.prototype.tryHiddenSceneDownload=function(){var a=ga.bgLoad,b=(new Date).getTime();b-a._hiddenSceneLoadMutex<100||(a._hiddenSceneLoadMutex=b,setTimeout(function(){delete a._hiddenSceneLoadMutex,a._startHiddenSceneDownload()},100))},Kd.prototype._startHiddenSceneDownload=function(){var a=this;if(!ga.service.isConnected||!ga.hiddenGame)return void a.tryHiddenSceneDownload();var c=a.hiddenSceneDownloadList;if(b.keys(c).length){var d=a.hiddenSceneForceLoad,e=ga.hiddenGame.assets;this._download(e,c,d)}},Kd.prototype.tryEditorSceneDownload=function(){var a=ga.bgLoad,b=(new Date).getTime();b-a._editorSceneLoadMutex<100||(a._editorSceneLoadMutex=b,setTimeout(function(){delete a._editorSceneLoadMutex,a._startEditorSceneDownload()},100))},Kd.prototype._startEditorSceneDownload=function(){var a=this,c=!0;do{if(!ga.workable)break;if(!ga.scene.editable)return;if(!ga.scene||!a.canEditorSceneDownload)break;if(!ga.service.isConnected)break;c=!1}while(!1);if(c)return void a.tryEditorSceneDownload();var d=a.editorSceneDownloadList;if(b.keys(d).length){var e=a.editorSceneForceLoad,f=ga.game.assets;this._download(f,d,e)}},Kd.prototype._download=function(a,c,d){var e={},f=function(b){if(ga.workable){if(a!==ga.game.assets){if(!e[b.uuid])return;return void ga.e.emit(ga.e.BG_RESOURCE_LOADED,b)}if(b instanceof qc.Atlas||b instanceof qc.Prefab||b instanceof qc.SoundAsset){var c=b.uuid;if(e[c]){var d,f=function(a){var d=a.scripts;if(d&&d.length)for(var e=0,f=d.length;f>e;e++){var g=d[e];for(var h in g)g[h]&&g[h].key===c&&(g[h]=b)}};d=b instanceof qc.Atlas?function(a){if(a.texture&&a.texture.uuid===c){var d;if(a.animationType===qc.Sprite.FRAME_ANIMATION){var e=a.phaser.animations.currentAnim;if(e&&e.isPlaying){var g=a._animation[e.name],h=g&&g.rate?g.rate:60;d={name:e.name,loop:e.loop,speed:a._speed/h}}}if(a.texture=b,a.frame=a.frame,a.animationType===qc.Sprite.FRAME_ANIMATION){var i=a.phaser.animations._anims;for(var j in i)delete i[j];a.phaser.animations._anims={},d&&a.animationNameList.indexOf(d.name)>=0&&a.playAnimation(d.name,d.speed,d.loop)}}f(a)}:f,ga.project.exploreTree(d,ga.game.world),ga.e.emit(ga.e.SCENE_RESOURCE_LOADED,b)}}}};b.keys(c).forEach(function(b){var g=c[b];if(a.addUrlConf(b,g),d[g]){var h=d[g];delete d[g],h.exist?(e[b]=!0,a.load(b,g,f,!0)):(delete a._assets[g],delete c[b])}else a.find(b,g)||(e[b]=!0),a.load(b,g,f)})};var Ld=qc.editor.HiddenScene=function(){var a=this._iframe=document.createElement("iframe");a.src="StartHiddenScene.html",navigator.userAgent.indexOf("Firefox")>0?a.style.visibility="hidden":a.style.display="none",a.style.position="absolute",document.body.appendChild(a),ga.hiddenScene=this,ga.e.on(ga.e.HIDDEN_SCENE_INITED,function(a){ga.hiddenGame=a.game,ga.e.emit(ga.e.HIDDEN_SCENE_LOADED)})};Ld.prototype={},Ld.prototype.constructor=Ld,ga.qcplay=1,ga.extend=new qc.editor.Extend,ga.initCodeEditor=function(){var a=ga.localize=new qc.editor.Localize("en");ga._=function(b){return a._.call(a,b)},ga.log=new da,ga.log.enableTrace=!0,ga.notification=new Ob;var b=function(){qc.editor.VERSION=ga.config.editorVersion,ga.storage=new ja(ga.config.project.projectName),ga.preference=new Pb,ga.localize.language=ga.storage.get("language")||"en",ga.skin="Light"===ga.storage.get("skin")?"Light":"Dark";var a=ga.skinManager=new ca;a.registerCodeEditorIcons(),a.overrideSizeMethod(),a.initTheme(),a.page="CodeEditor",a.skin=ga.skin,ga._initCodeEditorLayout()};ga._initService(b)},ga._initCodeEditorLayout=function(){var b=new qc.widget.Container,c=b.layout=new qc.widget.layout.BorderLayout(b);c.topResizable=!1,c.topToggleVisible=!1,c.splitterSize=1,c.splitterColor="rgb(100, 101, 105)";var d=new qc.editor.Button({text:ga._("Save"),padding:0,borderWidth:0,preferredSize:{width:70}}),e=new qc.widget.Toolbar;e.setItems([d]);var f=a.codePane=new qc.editor.CodePane,g=_("filePath");g&&g.indexOf(".css")===g.length-4&&(f.mode="css"),qc.editor.Operation.SOURCE(g,function(b){f.value=b.source,f.editor.on("change",function(){a.codePaneValueChanged=!0})});var h=a.saveCode=function(b){b&&b.preventDefault(),qc.editor.Operation.UPLOAD(g,f.value),ga.notification.info(ga._("Code Saved")),a.codePaneValueChanged=!1};d.on("click",h),qc.widget.Mousetrap.bind("mod+s",h),b.setItems([{region:"top",height:28,element:e},{region:"center",element:f}]),b.addToDOM(),U(function(){f.editor.focus()}),document.title=g},ga.initProject=function(){var a=ga.localize=new qc.editor.Localize("en");ga._=function(b){return a._.call(a,b)},ga.log=new da,ga.log.enableTrace=!0,ga.notification=new Ob;var b=function(){qc.editor.VERSION=ga.config.editorVersion,ga.storage=new ja(ga.config.project.projectName),ga.localize.language=ga.storage.get("language")||"en",ga.preference=new Pb,ga.skin="Light"===ga.storage.get("skin")?"Light":"Dark";var a=ga.skinManager=new ca;a.registerProjectIcons(),a.overrideSizeMethod(),a.initTheme(),a.page="Project",a.skin=ga.skin,ga._initProjectLayout(),qc.editor.version.checkLatestUpdates()};ga._initService(function(){qc.editor.Operation.RECENT_OPEN(function(a){a&&a.length>0?(ga.projectPath=a[0],b()):qc.editor.Operation.GET_USER_HOME_DIR(function(a){ga._defaultProjectPath=k.isMac?a+"/":a+"\\",b()})})})},ga._initProjectLayout=function(){ga.mainContainer=new qc.widget.Container;var a=ga.mainContainer.layout=ga.mainLayout=new qc.widget.layout.BorderLayout(ga.mainContainer);a.spliterColor="rgb(100, 101, 105)",a.splitterSize=2,a.leftToggleVisible=!1,a.leftResizable=!1,ga.actionPane=new qc.editor.ProjectActionPane,ga.mainContainer.setItems([{region:"left",width:300,element:ga.actionPane}]),ga.mainContainer.addToDOM()},ga.init=function(){a.name="",a.addEventListener("focus",function(){ga.windowFocused=!0,ga.reloadSceneOnFocus&&!ga.playing?(ga.workable&&(ga.e.emit(ga.e.JS_CHANGED),qc.editor.Operation.SAVE_CURR_SCENE(function(){ga.scene.reload()})),delete ga.reloadSceneOnFocus):ga.reloadEditorOnFocus&&!ga.playing&&(ga.workable&&(ga.e.emit(ga.e.JS_CHANGED),qc.editor.Operation.SAVE_CURR_SCENE(function(){ga.silentRefresh=!0,a.location.reload()})),delete ga.reloadEditorOnFocus)}),a.addEventListener("blur",function(){ga.windowFocused=!1}),k.onDialogClosed=function(){ga.activeView&&ga.activeView.requestFocus()},k.onContextMenuClose=function(){document.activeElement===document.body&&ga.activeView&&ga.activeView.requestFocus()},ga.initOk=!1,qc.widget.DataModel.prototype._indexAdjustable=!1;var b=ga.localize=new qc.editor.Localize("en");ga._=function(a){return b._.call(b,a)},ga.ASSET_TYPE={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_JS:100,ASSET_UNKNOWN:101},ga.log=new da,ga.log.enableTrace=!0,ga.clipboard=new ha,ga.notification=new Ob,ga.undo=new Kb;var c=function(){if(qc.editor.VERSION=ga.config.editorVersion,/Chrome/.test(a.navigator.userAgent)){var b=["%c♥ %c %c %c QICI Engine v"+qc.editor.VERSION+"  %c %c %c %c http://www.qiciengine.com %c %c http://www.zuoyouxi.com/ %c %c♥","color: #ff2424; background: #fff","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff","color: #FFD100; background: #242424;","background: #ffffff","color: #FFD100; background: #242424;","background: #ffffff","color: #ff2424; background: #fff"];

console.log.apply(console,b)}ga.editMode=ga.storage.get("editMode")?ga.storage.get("editMode"):"default",ga.gridVisible=null!=ga.storage.get("gridVisible")?ga.storage.get("gridVisible"):!0,ga.playing=!1;var c=ga.storage.get("gameSizeValue");c&&null!=ga.rightBanner.findViewById("gameSize")._map[c]&&(ga.rightBanner.gameSize={size:ga.storage.get("gameSize"),value:c});var d=function(){for(var a=ga.fileTree.dataModel.datas,b=0;b<a.length;b++){var c=a[b];if("state"===c.name&&c.parent&&"Assets"===c.parent.name&&c.parent.predefined){ga.fileTree.expand(c),ga.fileTree.selectionModel.selection=c;break}}ga.e.off(ga.e.SCENE_LOADED,d)};ga.e.on(ga.e.SCENE_LOADED,d),ga.e.on(ga.e.SCENE_LOADED,function(){ga.windowDisabled=!1,ga.scene.fitContent(!1),setTimeout(function(){ga.workable&&("1"===ga.storage.get("switchScene")||"1"===ga.storage.get("switchProject"))&&(ga.storage.set("switchScene","0"),ga.storage.set("switchProject","0"))},50);var a=ga.storage.get("hierarchyExpandedDatas"),b=ga.storage.get("hierarchySelectedDatas");a&&(a.forEach(function(a){for(var b=ga.hierarchy.rootData,c=a.split("/"),d=0;d<c.length&&b;d++){var e=c[d];b=b.children[e]}b&&ga.hierarchy.expand(b)}),ga.storage.del("hierarchyExpandedDatas")),b&&(b.forEach(function(a){for(var b=ga.hierarchy.rootData,c=a.split("/"),d=0;d<c.length&&b;d++){var e=c[d];b=b.children[e]}b&&ga.hierarchy.selectionModel.appendSelection(b)}),ga.storage.del("hierarchySelectedDatas"))}),ga.texturePacker=new qc.editor.TexturePacker,new qc.editor.HiddenScene,new qc.editor.BgLoad,qc.editor.Operation.EXPLORE(),ga.extend.init(),ga.initOk=!0},d=function(a){a&&a.length>0?(ga.projectPath=a[0],ib(),c()):qc.editor.Operation.GET_USER_HOME_DIR(function(a){ga._defaultProjectPath=k.isMac?a+"/":a+"\\",ib(),c()})},e=function(a){var b=ga.config.editor.currScene;b||(b=ga.config.scene.entryScene),b?ga.service.request("SWITCH_SCENE",b,function(){var b=d.bind(null,a);qc.editor.Operation.QUERY_SETTINGS(b)}):d(a)};ga._initService(function(){qc.editor.Operation.RECENT_OPEN(function(a,b,c){if(ga._initLayout(),ga.preference=new Pb,ga.sceneManager=new qc.editor.SceneManager,ga.sceneManager.unsaved=c,2==b){var f="'"+ga.config.editor.currScene+"' "+ga._("Scene file changed");nb(f,ga._("Confirm"),[{text:ga._("Reload"),onClick:function(){this.hide(),e(a)}},{text:ga._("Cancel"),onClick:function(){this.hide(),d(a)}}])}else 1==b?e(a):d(a)},!0)})},ga._initLayout=function(){ga.storage=new ja(ga.config.project.projectName),ga.storage.get("switchProject")||ga.storage.set("switchProject","1"),ga.localize.language=ga.storage.get("language")||"en",ga.orientation="Landscape"===ga.storage.get("orientation")?"Landscape":"Portrait",ga.skin="Light"===ga.storage.get("skin")?"Light":"Dark";var b=ga.skinManager=new ca;b.page="Editor",b.registerIcons(),ga.dragAndDrop=new ia,b.overrideSizeMethod(),b.initTheme(),ga.mainContainer=new qc.editor.LayoutContainer,ga.menu=new qc.editor.Menu,ga.mainContainer.add("menu",qc.editor.LayoutContainer.TOP_MENU,ga.menu),ga.leftBanner=new qc.editor.LeftBanner,ga.mainContainer.add("leftBanner",qc.editor.LayoutContainer.TOP_LEFT,ga.leftBanner),ga.runBanner=new qc.editor.RunBanner,ga.mainContainer.add("runBanner",qc.editor.LayoutContainer.TOP_RUN,ga.runBanner),ga.middleBanner=new qc.editor.MiddleBanner,ga.mainContainer.add("middleBanner",qc.editor.LayoutContainer.TOP_MIDDLE,ga.middleBanner),ga.rightBanner=new qc.editor.RightBanner,ga.mainContainer.add("rightBanner",qc.editor.LayoutContainer.TOP_RIGHT,ga.rightBanner),ga.inspector=new qc.editor.Inspector,ga.inspector.title="Inspector    ",ga.inspector.icon="inspector",ga.mainContainer.add("inspector",qc.editor.LayoutContainer.INSPECTOR,ga.inspector),ga.project=new qc.editor.Project,ga.project.title="Project    ",ga.project.icon="project",ga.mainContainer.add("project",qc.editor.LayoutContainer.PROJECT,ga.project),ga.hierarchy=new qc.editor.Hierarchy,ga.hierarchy.title="Hierarchy    ",ga.hierarchy.icon="hierarchy",ga.mainContainer.add("hierarchy",qc.editor.LayoutContainer.HIERARCHY,ga.hierarchy),ga.scene=new qc.editor.Scene,ga.ruler=new Nb(ga.scene),ga.mainContainer.add("scene",qc.editor.LayoutContainer.SCENE,ga.ruler),ga.mainContainer.addToDOM(),ga.mainContainer.view.addEventListener("contextmenu",function(a){ga.menu.view.contains(a.target)||Eb(a.target)||a.preventDefault()}),ga.mainContainer.orientation=ga.orientation,ga.storage.get("layout")&&ga.mainContainer.deserialize(JSON.parse(ga.storage.get("layout"))),ga.project.sliderValue=ga.storage.get("project_list")||17;var c=ga.storage.get("preview_expand"),d=ga.storage.get("preview_height");ga.inspector.layout.setExpanded("bottom",null==c?!0:c),ga.inspector.layout.bottomHeight=null==d?200:d,a.addEventListener("keydown",function(a){E(a)&&!Eb(a.target)&&a.preventDefault()},!1),a.onbeforeunload=function(){return ga.storage.set("layout",ga.mainContainer.serialize()),ga.storage.set("project_list",ga.project.sliderValue),ga.storage.set("preview_expand",ga.inspector.layout.isExpanded("bottom")),ga.storage.set("preview_height",ga.inspector.layout.bottomHeight),ga.silentRefresh?void 0:ga._("Close Tip")},b.skin=ga.skin},ga._initService=function(b){new qc.editor.Service(a.location.hostname,a.location.port),ga.service.connect();var c=function(){ga.service.isConnected?(console.log("** Connected."),qc.editor.Operation.QUERY_SETTINGS(b)):setTimeout(c,100)};c()}}}(this,Object);